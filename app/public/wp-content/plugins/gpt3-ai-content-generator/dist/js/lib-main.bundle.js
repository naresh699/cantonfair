(()=>{(function(){"use strict";function _(n,s=[],o={}){return{botId:n,triggers:JSON.parse(JSON.stringify(s)),schemas:o,isDirty:!1,editingTriggerId:null}}window.aipkit_initTriggerBuilderState=_})();(function(){"use strict";function _(n){let s=document.getElementById(`aipkit_trigger_builder_${n}`),o=s?s.querySelector(".aipkit_trigger_raw_data_source"):null;if(!o)return[];let r=o.value;try{let a=JSON.parse(r);return Array.isArray(a)?a:[]}catch{return[]}}window.aipkit_loadInitialTriggers=_})();(function(){"use strict";function _(n){let s=document.getElementById(`aipkit_trigger_builder_${n}`),o=s?s.querySelector(".aipkit_trigger_schemas_source"):null;if(!o)return console.warn(`AIPKit Trigger Data: Schemas source input for bot ${n} not found.`),{};let r=o.getAttribute("data-schemas");try{let a=JSON.parse(r);return typeof a=="object"&&a!==null?a:{}}catch(a){return console.error(`AIPKit Trigger Data: Failed to parse trigger schemas JSON for bot ${n}. Error:`,a),{}}}window.aipkit_loadTriggerSchemas=_})();(function(){"use strict";function _(n,s){let o=document.getElementById(`aipkit_bot_${n}_triggers_json`);if(!o)return console.error(`AIPKit Trigger Data: Main hidden textarea for triggers JSON (bot ID: ${n}) not found.`),!1;try{return o.value=JSON.stringify(s,null,2),!0}catch(r){return console.error(`AIPKit Trigger Data: Failed to stringify triggers array for bot ${n}.`,r),o.value="[]",!1}}window.aipkit_updateTriggersJsonForSave=_})();(function(){"use strict";let _=null;function n(o){_=o}function s(){return _}window.aipkit_setTriggerBuilderState=n,window.aipkit_getUIBuilderState=s})();(function(){"use strict";function _(n,s){let o=window.aipkit_escapeHtml||function(c){return c},r=[],a=s?.ConditionSchema?.properties?.field,e=s?.ConditionSchema?.properties?.fields_by_type?.default;if(e&&Array.isArray(e[n]))return e[n].forEach(c=>{typeof c=="string"&&c!==""&&r.push({value:c,label:o(c.replace(/_/g," "))})}),r.sort((c,i)=>c.label.localeCompare(i.label));if(!a||!a.description)return console.warn("GetConditionFields: Field schema or description missing."),r;let l=a.description.match(/Examples: (.*)\./);return l&&l[1]&&l[1].split(",").forEach(i=>{let t=i.trim().replace(/"/g,"");n==="user_context"&&(t.includes("user_")||t.includes("logged_in"))?r.push({value:t,label:o(t.replace(/_/g," "))}):n==="text_content"&&t.includes("message_text")?r.push({value:t,label:o(t.replace(/_/g," "))}):n==="conversation_state"&&t.includes("message_count")?r.push({value:t,label:o(t.replace(/_/g," "))}):n==="ai_model_context"&&(t.includes("provider")||t.includes("model"))?r.push({value:t,label:o(t.replace(/_/g," "))}):n==="error_context"&&(t.includes("error_")||t.includes("failed_"))?r.push({value:t,label:o(t.replace(/_/g," "))}):n==="http_context"&&(t.includes("http_")||t.includes("user_agent")||t.includes("referer"))?r.push({value:t,label:o(t.replace(/_/g," "))}):n==="post_context"&&t.includes("post_")&&r.push({value:t,label:o(t.replace(/_/g," "))})}),r.length===0&&a.enum&&a.enum.forEach(c=>r.push({value:c,label:o(c.replace(/_/g," "))})),r.length===0&&r.push({value:"custom_field",label:"Custom Field (Advanced)"}),r.sort((c,i)=>c.label.localeCompare(i.label))}window.aipkit_getConditionFieldsForType=_})();(function(){"use strict";function _(n,s,o){let r=window.aipkit_escapeHtml||function(c){return c},a=o?.ConditionSchema?.properties?.operator?.enum||[],e=[],l="string";return s==="is_logged_in"?l="boolean":s==="message_count"||s==="post_id"||s==="priority"?l="numeric":s==="user_role"&&(l="array_string"),a.forEach(c=>{let i=r(c.replace(/_/g," "));l==="boolean"&&["is_true","is_false"].includes(c)?e.push({value:c,label:i}):l==="string"&&["equals","not_equals","contains","not_contains","starts_with","ends_with","matches_regex","is_empty","is_not_empty","is_one_of","is_not_one_of","equals_ignore_case"].includes(c)?e.push({value:c,label:i}):l==="numeric"&&["greater_than","less_than","equals_numeric","not_equals_numeric","greater_than_or_equals","less_than_or_equals"].includes(c)?e.push({value:c,label:i}):l==="array_string"&&["is_one_of","is_not_one_of","contains","not_contains"].includes(c)&&e.push({value:c,label:i})}),e.length===0&&a.forEach(c=>e.push({value:c,label:r(c.replace(/_/g," "))})),e.sort((c,i)=>c.label.localeCompare(i.label))}window.aipkit_getConditionOperatorsForField=_})();(function(){"use strict";function _(n,s,o=null){if(!window.aipkit_getUIBuilderState()||!n||!s)return;let a=window.aipkit_escapeHtml||function(c){return c},e=n.value;if(["is_true","is_false","is_empty","is_not_empty"].includes(e))s.style.display="none",s.value="";else{s.style.display="",s.type="text",s.placeholder=a("Value");let t=n.closest(".aipkit_condition_row").querySelector(".aipkit_condition_field_select").value;(t==="message_count"||t==="priority")&&(s.type="number",s.step="1"),o&&o.value!==void 0?Array.isArray(o.value)&&(e==="is_one_of"||e==="is_not_one_of")?s.value=o.value.join(", "):s.value=String(o.value):s.value=""}}window.aipkit_updateConditionValueInput=_})();(function(){"use strict";function _(n,s,o,r=null){let a=window.aipkit_getUIBuilderState();if(!a||!n||!s||!o)return;let e=window.aipkit_escapeHtml||function(t){return t},l=n.closest(".aipkit_condition_row").querySelector(".aipkit_condition_type_select").value,c=n.value;if(s.innerHTML="",typeof window.aipkit_getConditionOperatorsForField!="function"){console.error("UpdateConditionOperators: aipkit_getConditionOperatorsForField function not found.");return}let i=window.aipkit_getConditionOperatorsForField(l,c,a.schemas);i.forEach(t=>{s.appendChild(new Option(e(t.label),e(t.value)))}),r&&r.operator?s.value=r.operator:i.length>0&&(s.value=i[0].value),typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(s,o,r)}window.aipkit_updateConditionOperators=_})();(function(){"use strict";function _(n,s,o,r,a=null){let e=window.aipkit_getUIBuilderState();if(!e||!n||!s||!o||!r)return;let l=window.aipkit_escapeHtml||function(t){return t},c=n.value;if(s.innerHTML="",typeof window.aipkit_getConditionFieldsForType!="function"){console.error("UpdateConditionFields: aipkit_getConditionFieldsForType function not found.");return}let i=window.aipkit_getConditionFieldsForType(c,e.schemas);i.forEach(t=>{s.appendChild(new Option(l(t.label),l(t.value)))}),a&&a.field?s.value=a.field:i.length>0&&(s.value=i[0].value),typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(s,o,r,a)}window.aipkit_updateConditionFields=_})();(function(){"use strict";function _(n,s=null){let o=window.aipkit_getUIBuilderState();if(!o||!n)return;let r=window.aipkit_escapeHtml||function(p){return p},a=document.querySelector(".aipkit_condition_row_template");if(!a){console.error("RenderConditionRow: Condition row template not found.");return}let l=a.content.cloneNode(!0).querySelector(".aipkit_condition_row"),c=l.querySelector(".aipkit_condition_type_select"),i=l.querySelector(".aipkit_condition_field_select"),t=l.querySelector(".aipkit_condition_operator_select"),d=l.querySelector(".aipkit_condition_value_input");(o.schemas?.ConditionSchema?.properties?.type?.enum||[]).forEach(p=>{c.appendChild(new Option(r(p.replace(/_/g," ")),r(p)))}),s?(c.value=s.type||"",typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(c,i,t,d,s)):(c.options.length>0&&(c.value=c.options[0].value),typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(c,i,t,d)),n.appendChild(l)}window.aipkit_renderConditionRow=_})();(function(){"use strict";function _(n,s=[]){if(!window.aipkit_getUIBuilderState()||!n)return;let r=window.aipkit_escapeHtml||function(l){return l},a=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:l=>l,e=n.querySelector(".aipkit_options_list");e&&(e.innerHTML="",(s||[]).forEach((l,c)=>{let i=document.createElement("div");i.className="aipkit_form_element_option_row",i.dataset.optionIndex=c;let t=document.createElement("input");t.type="text",t.className="aipkit_form-input aipkit_element_option_value aipkit_form_element_prop_change",t.placeholder=a("Value (e.g., option1)","gpt3-ai-content-generator"),t.value=r(l.value||""),t.dataset.property=`options[${c}].value`;let d=document.createElement("input");d.type="text",d.className="aipkit_form-input aipkit_element_option_text aipkit_form_element_prop_change",d.placeholder=a("Display Text (e.g., Option One)","gpt3-ai-content-generator"),d.value=r(l.text||""),d.dataset.property=`options[${c}].text`;let p=document.createElement("button");p.type="button",p.className="aipkit_btn aipkit_btn-icon aipkit_form_option_remove_btn",p.title=a("Remove Option","gpt3-ai-content-generator"),p.innerHTML='<span class="dashicons dashicons-no-alt"></span>',i.appendChild(t),i.appendChild(d),i.appendChild(p),e.appendChild(i)}))}window.aipkit_updateFormElementOptionControls=_})();(function(){"use strict";function _(n,s,o){if(!window.aipkit_getUIBuilderState())return console.error("RenderFormElementEditorItem: UI Builder state not initialized."),null;let a=window.aipkit_escapeHtml||function(m){return m},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:m=>m,l=`${o}_${n.id||`el_${Date.now()}_${s}`}`,c=document.createElement("div");c.className="aipkit_form_element_editor_item",c.dataset.elementIndex=s,c.dataset.elementId=n.id||"";let i=document.createElement("div");i.className="aipkit_form_element_editor_header";let t=document.createElement("span");t.className="aipkit_form_element_editor_title",t.innerHTML=`${a(n.label||n.id||e("New Element","gpt3-ai-content-generator"))} <span class="aipkit_element_type_badge">${a(n.type||"text_input")}</span> <span class="aipkit_element_id_badge">${n.id?a(n.id):""}</span>`;let d=document.createElement("div");d.className="aipkit_form_element_editor_actions";let p=document.createElement("button");p.type="button",p.className="aipkit_btn aipkit_btn-icon aipkit_form_element_remove_btn",p.title=e("Remove Element","gpt3-ai-content-generator"),p.innerHTML='<span class="dashicons dashicons-trash"></span>',d.appendChild(p),i.appendChild(t),i.appendChild(d),c.appendChild(i);let u=document.createElement("div");u.className="aipkit_form_element_editor_content";let f='<div class="aipkit_form-row">';f+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_type_${a(l)}">${e("Element Type","gpt3-ai-content-generator")}</label>
            <select id="fe_type_${a(l)}" data-property="type" class="aipkit_form-input aipkit_form_element_prop_change">
                ${["text_input","textarea","dropdown","checkbox_group","radio_group","label","heading"].map(m=>`<option value="${a(m)}" ${n.type===m?"selected":""}>${a(m.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase()))}</option>`).join("")}
            </select>
        </div>`,f+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_id_${a(l)}">${e("Field ID / Variable","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_id_${a(l)}" data-property="id" class="aipkit_form-input aipkit_form_element_prop_change" value="${a(n.id||"")}" placeholder="${e("e.g., product_name","gpt3-ai-content-generator")}">
        </div></div>`,f+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_label_${a(l)}">${n.type==="label"||n.type==="heading"?e("Text Content","gpt3-ai-content-generator"):e("Display Label","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_label_${a(l)}" data-property="label" class="aipkit_form-input aipkit_form_element_prop_change" value="${a(n.label||"")}">
        </div></div>`,["text_input","textarea"].includes(n.type)&&(f+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_placeholder_${a(l)}">${e("Placeholder Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_placeholder_${a(l)}" data-property="placeholder" class="aipkit_form-input aipkit_form_element_prop_change" value="${a(n.placeholder||"")}">
            </div></div>`);let h="";if(["label","heading"].includes(n.type)||(h+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_checkbox-label" for="fe_required_${a(l)}">
                    <input type="checkbox" id="fe_required_${a(l)}" data-property="required" class="aipkit_toggle_switch aipkit_form_element_prop_change" ${n.required?"checked":""}>
                    ${e("Required Field","gpt3-ai-content-generator")}
                </label>
            </div>`,h+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_default_value_${a(l)}">${e("Default Value","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_default_value_${a(l)}" data-property="default_value" class="aipkit_form-input aipkit_form_element_prop_change" value="${a(String(n.default_value||""))}">
                <p class="aipkit_form-help">${n.type==="checkbox_group"?e("For checkboxes, separate multiple default values with a comma (e.g., val1,val2).","gpt3-ai-content-generator"):""}</p>
            </div>`),h&&(f+=`<div class="aipkit_form-row">${h}</div>`),f+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_help_text_${a(l)}">${e("Help Text (Optional)","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_help_text_${a(l)}" data-property="help_text" class="aipkit_form-input aipkit_form_element_prop_change" value="${a(n.help_text||"")}">
        </div></div>`,["dropdown","checkbox_group","radio_group"].includes(n.type)&&(f+=`<div class="aipkit_form_element_options_editor" data-element-type="${a(n.type)}"><h6>${e("Options","gpt3-ai-content-generator")}</h6><div class="aipkit_options_list"></div>
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_option_btn"><span class="dashicons dashicons-plus-alt"></span> ${e("Add Option","gpt3-ai-content-generator")}</button>
            <p class="aipkit_form-help">${e("Format: actual_value|Display Text. e.g., blue_val|Blue Sky","gpt3-ai-content-generator")}</p></div>`),u.innerHTML=f,c.appendChild(u),["dropdown","checkbox_group","radio_group"].includes(n.type)){let m=c.querySelector(".aipkit_form_element_options_editor");m&&typeof window.aipkit_updateFormElementOptionControls=="function"&&window.aipkit_updateFormElementOptionControls(m,n.options||[])}return i.addEventListener("click",()=>{let m=u.style.display==="block";u.style.display=m?"none":"block",u.classList.toggle("aipkit_expanded",!m)}),n.id||(u.style.display="block",u.classList.add("aipkit_expanded")),c}window.aipkit_renderFormElementEditorItem=_})();(function(){"use strict";function _(n,s,o={},r=null){let a=window.aipkit_getUIBuilderState();if(!a||!n)return;let e=window.aipkit_escapeHtml||function(p){return p},l=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:p=>p,c=a.schemas||{};n.innerHTML="";let i=c.ActionSchema?.properties?.payload?.properties||{},t="";function d(p,u,f,h="action.payload."){let m='<div class="aipkit_form-group">';m+=`<label class="aipkit_form-label" for="action_payload_${e(p)}_${a.editingTriggerId||""}">${e(u.description||p.replace(/_/g," "))}</label>`;let y=`${h}${p}`;if(u.type==="boolean")m+=`<input type="checkbox" id="action_payload_${e(p)}_${a.editingTriggerId||""}" data-field="${e(y)}" class="aipkit_form-input aipkit_trigger_field" ${f===!0?"checked":""}>`;else if(u.enum)m+=`<select id="action_payload_${e(p)}_${a.editingTriggerId||""}" data-field="${e(y)}" class="aipkit_form-input aipkit_trigger_field">`,u.enum.forEach(E=>{m+=`<option value="${e(E)}" ${f===E?"selected":""}>${e(E.replace(/_/g," "))}</option>`}),m+="</select>";else if(u.type==="integer"||u.type==="number")m+=`<input type="number" id="action_payload_${e(p)}_${a.editingTriggerId||""}" data-field="${e(y)}" class="aipkit_form-input aipkit_trigger_field" value="${e(String(f||u.default||""))}"`,u.minimum!==void 0&&(m+=` min="${e(String(u.minimum))}"`),u.maximum!==void 0&&(m+=` max="${e(String(u.maximum))}"`),m+=">";else if(u.type==="object"){let E=f&&typeof f=="object"&&!Array.isArray(f)?f:{};m+=`<textarea id="action_payload_${e(p)}_${a.editingTriggerId||""}" data-field="${e(y)}" class="aipkit_form-input aipkit_trigger_field" rows="3" placeholder="${e('e.g., {"X-My-Header": "Value"}')}">${e(JSON.stringify(E,null,2))}</textarea>`,m+=`<div class="aipkit_form-help">${e("Enter as a JSON object or one header per line (Key: Value).")}</div>`}else p==="message"||p==="content"||p==="body_template"||p==="reason"||p==="log_message_format"?(m+=`<textarea id="action_payload_${e(p)}_${a.editingTriggerId||""}" data-field="${e(y)}" class="aipkit_form-input aipkit_trigger_field" rows="3">${e(f||u.default||"")}</textarea>`,p==="body_template"&&(m+=`<div class="aipkit_form-help">${e(l("Webhook placeholders: {{submitted_data_json}}, {{submitted_data_display_json}}, {{submitted_data_labels_json}}, {{submitted.field_id}}, {{submitted_display.field_id}}, {{submitted_label.field_id}}.","gpt3-ai-content-generator"))}</div>`)):m+=`<input type="text" id="action_payload_${e(p)}_${a.editingTriggerId||""}" data-field="${e(y)}" class="aipkit_form-input aipkit_trigger_field" value="${e(f||"")}">`;return m+="</div>",m}if(Object.keys(i).forEach(p=>{let u=i[p],f=!0;s==="bot_reply"&&!["message","stop_processing_ai"].includes(p)&&(f=!1),s==="inject_context"&&!["placement","content"].includes(p)&&(f=!1),s==="block_message"&&!["reason"].includes(p)&&(f=!1),s==="call_webhook"&&!["endpoint_url","http_method","headers","body_template","timeout_seconds"].includes(p)&&(f=!1),s==="set_variable"&&!["scope","key"].includes(p)&&(f=!1),s==="display_form"&&!["title","elements","submit_button_text"].includes(p)&&(f=!1),s==="store_form_submission"&&!["log_message_format"].includes(p)&&(f=!1),f&&(s==="display_form"&&p==="elements"||(t+=d(p,u,o[p])))}),s==="set_variable"){let p=c.ActionSchema?.properties?.value||{type:"string",description:"Value"};t+=d("value",p,r,"action.")}if(s==="display_form"){let p=o&&typeof o.form_id=="string"&&o.form_id.trim()!==""?o.form_id:`form_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;o||(o={}),o.form_id=p,t+=`<input type="hidden" class="aipkit_trigger_field" data-field="action.payload.form_id" value="${e(p)}">`,t+=`<div class="aipkit_form_elements_editor_container">
                <h6>${l("Form Elements","gpt3-ai-content-generator")}</h6>
                <div class="aipkit_form_elements_list"></div>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_element_btn">
                    <span class="dashicons dashicons-plus"></span> ${l("Add Form Element","gpt3-ai-content-generator")}
                </button>
            </div>`}if(n.innerHTML=t,s==="display_form"){let p=n.querySelector(".aipkit_form_elements_list");p&&o&&Array.isArray(o.elements)&&o.elements.forEach((u,f)=>{if(typeof window.aipkit_renderFormElementEditorItem=="function"){let h=window.aipkit_renderFormElementEditorItem(u,f,o.form_id);h&&p.appendChild(h)}})}}window.aipkit_renderActionPayloadFields=_})();(function(){"use strict";function _(n,s){let o=window.aipkit_getUIBuilderState();if(!o||!n||!s){console.error("AIPKit RenderTriggerEditorForm: Missing state, content element, or trigger data.");return}let r=window.aipkit_escapeHtml||function(t){return t},a=o.schemas||{},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:t=>t,l=`
            <div class="aipkit_form-row">
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_name_${s.id}">${r(e("Trigger Name","gpt3-ai-content-generator"))}</label>
                    <input type="text" id="trigger_name_${s.id}" data-field="name" class="aipkit_form-input aipkit_trigger_field" value="${r(s.name||"")}">
                </div>
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_event_${s.id}">${r(e("Event","gpt3-ai-content-generator"))}</label>
                    <select id="trigger_event_${s.id}" data-field="event_name" class="aipkit_form-input aipkit_trigger_field">
                        ${(a.EventSchema?.properties?.name?.enum||[]).map(t=>`<option value="${r(t)}" ${s.event_name===t?"selected":""}>${r(t.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()))}</option>`).join("")}
                    </select>
                </div>
                <div class="aipkit_form-group aipkit_form-col" style="max-width: 120px;">
                    <label class="aipkit_form-label" for="trigger_priority_${s.id}">${r(e("Priority","gpt3-ai-content-generator"))}</label>
                    <input type="number" id="trigger_priority_${s.id}" data-field="priority" class="aipkit_form-input aipkit_trigger_field" value="${r(String(s.priority||10))}" min="0" step="1">
                </div>
            </div>
        `;l+=`<div class="aipkit_conditions_container"><h6>${r(e("Conditions (All must be met)","gpt3-ai-content-generator"))}</h6><div class="aipkit_condition_rows_list">`,s.conditions&&s.conditions.length>0||(l+=`<p class="aipkit_form-help">${r(e("No conditions defined. This trigger will run if the event occurs.","gpt3-ai-content-generator"))}</p>`),l+=`</div><button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_trigger_add_condition_btn" style="margin-top:10px;"><span class="dashicons dashicons-plus"></span> ${r(e("Add Condition","gpt3-ai-content-generator"))}</button></div>`,l+=`<div class="aipkit_action_container"><h6>${r(e("Action","gpt3-ai-content-generator"))}</h6>`,l+=`<div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="action_type_${s.id}">${r(e("Action Type","gpt3-ai-content-generator"))}</label>
                        <select id="action_type_${s.id}" data-field="action.type" class="aipkit_form-input aipkit_trigger_field aipkit_trigger_action_type_select">
                            ${(a.ActionSchema?.properties?.type?.enum||[]).map(t=>`<option value="${r(t)}" ${s.action?.type===t?"selected":""}>${r(t.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()))}</option>`).join("")}
                        </select>
                     </div>`,l+='<div class="aipkit_action_payload_container"></div>',l+="</div>",n.innerHTML=l;let c=n.querySelector(".aipkit_condition_rows_list");c&&s.conditions&&s.conditions.length>0&&(c.innerHTML="",s.conditions.forEach(t=>{typeof window.aipkit_renderConditionRow=="function"&&window.aipkit_renderConditionRow(c,t)}));let i=n.querySelector(".aipkit_action_payload_container");i&&s.action?.type&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(i,s.action.type,s.action.payload,s.action.value)}window.aipkit_renderTriggerEditorForm=_})();(function(){"use strict";function _(n){if(!window.aipkit_getUIBuilderState())return console.error("AIPKit RenderSingleTriggerItem: UI Builder state not initialized."),null;let o=window.aipkit_escapeHtml||function(d){return d},r=document.querySelector(".aipkit_trigger_editor_template");if(!r)return console.error("AIPKit RenderSingleTriggerItem: Trigger editor template not found."),null;let e=r.content.cloneNode(!0).querySelector(".aipkit_trigger_item"),l=e.querySelector(".aipkit_trigger_item_name_display"),c=e.querySelector(".aipkit_trigger_item_id_display"),i=e.querySelector(".aipkit_trigger_is_active_checkbox"),t=e.querySelector(".aipkit_trigger_item_content");return e.dataset.triggerId=n.id,l&&(l.textContent=o(n.name||"Unnamed Trigger")),c&&(c.textContent=`(ID: ${o(n.id)})`),i&&(i.checked=n.is_active===!0),t?t.innerHTML="":console.error("AIPKit RenderSingleTriggerItem: .aipkit_trigger_item_content missing in template for trigger:",n.id),e}window.aipkit_renderSingleTriggerItem=_})();(function(){"use strict";function _(){let n=window.aipkit_getUIBuilderState();if(!n){console.error("RenderTriggerList: UI Builder state not initialized.");return}let s=document.getElementById(`aipkit_trigger_list_for_${n.botId}`),o=s?s.querySelector(".aipkit_trigger_list_empty_message"):null;if(!s){console.error(`RenderTriggerList: List container for bot ${n.botId} not found.`);return}if(s.querySelectorAll(".aipkit_trigger_item").forEach(r=>r.remove()),n.triggers&&n.triggers.length>0)o&&(o.style.display="none"),n.triggers.forEach(r=>{if(typeof window.aipkit_renderSingleTriggerItem=="function"){let a=window.aipkit_renderSingleTriggerItem(r);a&&s.appendChild(a)}else console.error("RenderTriggerList: aipkit_renderSingleTriggerItem function not found.")});else if(o){let r=o.dataset.emptyText;r&&(o.textContent=r),o.style.display="block"}}window.aipkit_renderTriggerList=_})();(function(){"use strict";let _=null;function n(o){_=o}function s(){return _}window.aipkit_setTriggerEventManagerState=n,window.aipkit_getTriggerEventManagerState=s})();(function(){"use strict";function _(n,s,o){let r=s.split("."),a=n;for(let e=0;e<r.length-1;e++)(!a[r[e]]||typeof a[r[e]]!="object")&&(a[r[e]]={}),a=a[r[e]];a[r[r.length-1]]=o}window.aipkit_setNestedValue=_})();(function(){"use strict";function _(n,s,o){let r=window.aipkit_getTriggerEventManagerState();if(!r)return;let a=r.triggers.findIndex(e=>e.id===n);if(a===-1){console.warn(`UpdateTriggerData: Trigger ID ${n} not found in state for bot ${r.botId}.`);return}window.aipkit_setNestedValue(r.triggers[a],s,o),r.isDirty=!0}window.aipkit_updateTriggerData=_})();(function(){"use strict";function _(n,s){let o=window.aipkit_getTriggerEventManagerState();if(!o||!s)return console.error("SaveTriggerFromForm: State or triggerItemElement missing."),!1;let r=o.triggers.findIndex(c=>c.id===n);if(r===-1)return console.warn(`SaveTriggerFromForm: Trigger ID ${n} not found in state for bot ${o.botId}.`),!1;let a=s.querySelector(".aipkit_trigger_item_content");if(!a||a.style.display==="none")return!0;let e=JSON.parse(JSON.stringify(o.triggers[r]));a.querySelectorAll(".aipkit_trigger_field[data-field]").forEach(c=>{let i=c.dataset.field,t=c.type==="checkbox"?c.checked:c.type==="number"?parseFloat(c.value)||0:c.value;window.aipkit_setNestedValue(e,i,t)}),e.conditions=[],a.querySelectorAll(".aipkit_condition_row").forEach(c=>{let i=c.querySelector(".aipkit_condition_type_select")?.value,t=c.querySelector(".aipkit_condition_field_select")?.value,d=c.querySelector(".aipkit_condition_operator_select")?.value,p=c.querySelector(".aipkit_condition_value_input"),u=p?.value;if(p?.type==="number"?u=parseFloat(u)||0:p?.type==="text"&&(d==="is_one_of"||d==="is_not_one_of")&&(u=u.split(",").map(f=>f.trim()).filter(f=>f!=="")),p?.style.display==="none"&&(u=void 0),i&&t&&d){let f={type:i,field:t,operator:d};u!==void 0&&(f.value=u),e.conditions.push(f)}});let l=a.querySelector(".aipkit_trigger_action_type_select");if(l&&(e.action.type=l.value),e.action&&e.action.type){let c=function(t){if(!t||typeof t!="string")return{};let d=t.trim();if(!d)return{};try{let u=JSON.parse(d);if(u&&typeof u=="object"&&!Array.isArray(u))return u}catch{}let p={};return d.split(/\r?\n/).forEach(u=>{let f=u.trim();if(!f)return;let h=f.indexOf(":")!==-1?f.indexOf(":"):f.indexOf("=");if(h===-1)return;let m=f.slice(0,h).trim(),y=f.slice(h+1).trim();m&&(p[m]=y)}),p};e.action.payload={},a.querySelectorAll('.aipkit_action_payload_container .aipkit_trigger_field[data-field^="action.payload."]').forEach(t=>{let d=t.dataset.field.substring(15),p=t.type==="checkbox"?t.checked:t.value;d==="headers"&&typeof p=="string"&&(p=c(p)),(e.action.type==="store_form_submission"&&d==="log_message_format"||d&&d!=="elements")&&(e.action.payload[d]=p)}),e.action.type==="display_form"&&(e.action.payload.elements=[],a.querySelectorAll(".aipkit_form_element_editor_item").forEach(t=>{let d={};t.querySelectorAll(".aipkit_form_element_prop_change").forEach(p=>{let u=p.dataset.property,f=p.type==="checkbox"?p.checked:p.value;d[u]=f}),["dropdown","checkbox_group","radio_group"].includes(d.type)&&(d.options=[],t.querySelectorAll(".aipkit_form_element_option_row").forEach(p=>{let u=p.querySelector(".aipkit_element_option_value")?.value,f=p.querySelector(".aipkit_element_option_text")?.value;u!==void 0&&f!==void 0&&d.options.push({value:u,text:f})})),e.action.payload.elements.push(d)}));let i=a.querySelector('.aipkit_action_payload_container .aipkit_trigger_field[data-field="action.value"]');i?e.action.value=i.value:delete e.action.value}return o.triggers[r]=e,o.isDirty=!0,!0}window.aipkit_saveTriggerFromForm=_})();(function(){"use strict";let _;function n(s,o){clearTimeout(_),_=setTimeout(()=>{typeof window.aipkit_saveTriggerFromForm=="function"?window.aipkit_saveTriggerFromForm(s,o):console.error("DebouncedSave: aipkit_saveTriggerFromForm function not found.")},750)}window.aipkit_debouncedSave=n})();(function(){"use strict";function _(){let n=window.aipkit_getTriggerEventManagerState();if(!n){console.error("AIPKit AddNewTrigger: State not found.");return}let s=`trigger_${Date.now()}_${Math.random().toString(36).substring(2,7)}`,o=n.schemas?.EventSchema?.properties?.name?.enum[0]||"user_message_received",r=n.schemas?.ActionSchema?.properties?.type?.enum[0]||"bot_reply",a={id:s,name:"New Rule",event_name:o,conditions:[],action:{type:r,payload:{}},priority:10,is_active:!1};n.triggers.push(a),n.isDirty=!0;let e=document.getElementById(`aipkit_trigger_list_for_${n.botId}`);if(!e){console.error("AIPKit AddNewTrigger: List container not found.");return}let l=e.querySelector(".aipkit_trigger_list_empty_message");if(l&&(l.style.display="none"),typeof window.aipkit_renderSingleTriggerItem=="function"){let c=window.aipkit_renderSingleTriggerItem(a);if(c)if(e.appendChild(c),typeof window.aipkit_toggleTriggerItemContent=="function"){window.aipkit_toggleTriggerItemContent(c,s,!0);let i=c.querySelector('input[data-field="name"]');i?i.focus():console.warn("AIPKit AddNewTrigger: Name input not found after expanding.")}else console.error("AIPKit AddNewTrigger: aipkit_toggleTriggerItemContent function not found.");else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem returned null.")}else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem function not found.");typeof window.aipkit_requestTriggerAutosave=="function"&&window.aipkit_requestTriggerAutosave()}window.aipkit_handleAddNewTrigger=_})();(function(){"use strict";function _(n,s,o=!1){let r=window.aipkit_getUIBuilderState(),a=window.aipkit_getTriggerEventManagerState();if(!r||!a){console.error("AIPKit ToggleContent: UI Builder or Event Manager State not found.");return}let e=n.querySelector(".aipkit_trigger_item_content"),l=n.querySelector(".aipkit_trigger_item_header");if(!e||!l){console.error("AIPKit ToggleContent: Content or header element not found.");return}let c=e.style.display==="block";if(o&&c&&a.editingTriggerId===s){let i=r.triggers.find(t=>t.id===s);i&&typeof window.aipkit_renderTriggerEditorForm=="function"&&window.aipkit_renderTriggerEditorForm(e,i);return}if(c&&!o)e.style.display="none",e.classList.remove("aipkit_expanded"),l.classList.remove("aipkit_expanded"),a.editingTriggerId===s&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(s,n),a.editingTriggerId=null);else{let i=document.querySelector(`#aipkit_trigger_list_for_${r.botId} .aipkit_trigger_item_content.aipkit_expanded`);if(i&&i!==e){let t=i.closest(".aipkit_trigger_item");t&&t.dataset.triggerId&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t.dataset.triggerId,t),i.style.display="none",i.classList.remove("aipkit_expanded"),i.previousElementSibling?.classList.remove("aipkit_expanded"))}if(e.style.display="block",e.classList.add("aipkit_expanded"),l.classList.add("aipkit_expanded"),a.editingTriggerId=s,e.innerHTML.trim()===""||o){let t=r.triggers.find(d=>d.id===s);t&&typeof window.aipkit_renderTriggerEditorForm=="function"?window.aipkit_renderTriggerEditorForm(e,t):console.error("AIPKit ToggleContent: Trigger data or render function not found for form rendering.")}}}window.aipkit_toggleTriggerItemContent=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s)return;let r=(window.aipkit_trigger_builder_config?.text||{}).confirmDeleteTrigger||`Are you sure you want to delete trigger ID: ${n}?`;if(!confirm(r))return;s.triggers=s.triggers.filter(l=>l.id!==n),s.isDirty=!0;let a=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${n}"]`);a&&a.remove();let e=document.getElementById(`aipkit_trigger_list_for_${s.botId}`);if(e){let l=e.querySelector(".aipkit_trigger_list_empty_message");if(s.triggers.length===0&&l){let c=l.dataset.emptyText;c&&(l.textContent=c),l.style.display="block"}}typeof window.aipkit_requestTriggerAutosave=="function"&&window.aipkit_requestTriggerAutosave()}window.aipkit_handleDeleteTrigger=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s||!n)return;let o=n.querySelector(".aipkit_condition_rows_list");o&&typeof window.aipkit_renderConditionRow=="function"?(window.aipkit_renderConditionRow(o),s.isDirty=!0,typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(n.dataset.triggerId,n),typeof window.aipkit_requestTriggerAutosave=="function"&&window.aipkit_requestTriggerAutosave()):console.error("HandleAddCondition: Condition rows list or render function not found.")}window.aipkit_handleAddCondition=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s||!n||!n.parentNode)return;let o=n.closest(".aipkit_trigger_item");n.remove(),s.isDirty=!0,o&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(o.dataset.triggerId,o),typeof window.aipkit_requestTriggerAutosave=="function"&&window.aipkit_requestTriggerAutosave()}window.aipkit_handleRemoveCondition=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s||!n)return;let o=n.dataset.triggerId,r=s.triggers.findIndex(t=>t.id===o);if(r===-1)return;let a=s.triggers[r];if(a.action.type!=="display_form")return;(!a.action.payload.elements||!Array.isArray(a.action.payload.elements))&&(a.action.payload.elements=[]);let e=a.action.payload.elements.length,c={id:`field_${Date.now()}_${e}`,type:"text_input",label:"New Field",placeholder:"",required:!1,default_value:"",help_text:""};a.action.payload.elements.push(c),s.isDirty=!0;let i=n.querySelector(".aipkit_form_elements_list");if(i&&typeof window.aipkit_renderFormElementEditorItem=="function"){let t=window.aipkit_renderFormElementEditorItem(c,e,a.action.payload.form_id);if(t){i.appendChild(t);let d=t.querySelector(".aipkit_form_element_editor_content");d&&(d.style.display="block",d.classList.add("aipkit_expanded"));let p=t.querySelector('input[data-property="id"]');p&&p.focus()}typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(o,n)}}window.aipkit_handleAddFormElement=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s||!n||!n.parentNode)return;let o=n.closest(".aipkit_trigger_item");if(!o)return;let r=o.dataset.triggerId,a=s.triggers.findIndex(c=>c.id===r);if(a===-1)return;let e=parseInt(n.dataset.elementIndex,10);if(isNaN(e))return;let l=s.triggers[a];if(l.action.type==="display_form"&&l.action.payload.elements&&e>=0&&e<l.action.payload.elements.length){l.action.payload.elements.splice(e,1),s.isDirty=!0,n.remove();let c=o.querySelector(".aipkit_form_elements_list");c&&c.querySelectorAll(".aipkit_form_element_editor_item").forEach((i,t)=>{i.dataset.elementIndex=t,i.querySelectorAll(".aipkit_element_option_value, .aipkit_element_option_text").forEach(d=>{let p=d.dataset.prop.split(".")[1];d.dataset.property=`options[${optionRow.dataset.optionIndex}].${p}`})}),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(r,o)}}window.aipkit_handleRemoveFormElement=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s)return;let o=n.target,r=o.dataset.property;if(!r)return;let a=o.closest(".aipkit_form_element_editor_item"),e=o.closest(".aipkit_trigger_item");if(!a||!e)return;let l=e.dataset.triggerId,c=parseInt(a.dataset.elementIndex,10);if(isNaN(c))return;let i=s.triggers.findIndex(f=>f.id===l);if(i===-1)return;let t=s.triggers[i];if(t.action.type!=="display_form"||!t.action.payload.elements||c<0||c>=t.action.payload.elements.length)return;let d=t.action.payload.elements[c],p=o.type==="checkbox"?o.checked:o.value,u=r.match(/^options\[(\d+)\]\.(value|text)$/);if(u){let f=parseInt(u[1],10),h=u[2];d.options||(d.options=[]),d.options[f]||(d.options[f]={}),d.options[f][h]=p}else d[r]=p;if(s.isDirty=!0,r==="type"){let f=a.querySelector(".aipkit_element_type_badge").textContent.toLowerCase().replace(" ","_");if(e.querySelector(".aipkit_action_payload_container")&&typeof window.aipkit_renderActionPayloadFields=="function"){let m=window.aipkit_renderFormElementEditorItem(d,c,t.action.payload.form_id);if(m&&a.parentNode){a.parentNode.replaceChild(m,a);let y=m.querySelector(".aipkit_form_element_editor_content");y&&(y.style.display="block",y.classList.add("aipkit_expanded"))}}}else if(r==="label"||r==="id"){let f=a.querySelector(".aipkit_form_element_editor_title");f&&(f.innerHTML=`${window.aipkit_escapeHtml(d.label||d.id||"New Element")} <span class="aipkit_element_type_badge">${window.aipkit_escapeHtml(d.type||"text_input")}</span> <span class="aipkit_element_id_badge">${d.id?window.aipkit_escapeHtml(d.id):""}</span>`)}typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(l,e)}window.aipkit_handleFormElementPropertyChange=_})();(function(){"use strict";function _(n){if(!window.aipkit_getTriggerEventManagerState())return;let o=n.target,r=o.closest(".aipkit_trigger_item");if(!r)return;let a=r.dataset.triggerId;a&&(o.closest(".aipkit_trigger_item_header")&&!o.closest(".aipkit_trigger_item_actions button, .aipkit_trigger_is_active_toggle input")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(r,a):o.closest(".aipkit_trigger_edit_btn")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(r,a,!0):o.closest(".aipkit_trigger_delete_btn")?typeof window.aipkit_handleDeleteTrigger=="function"&&window.aipkit_handleDeleteTrigger(a):o.closest(".aipkit_trigger_add_condition_btn")?typeof window.aipkit_handleAddCondition=="function"&&window.aipkit_handleAddCondition(r):o.closest(".aipkit_condition_remove_btn")&&typeof window.aipkit_handleRemoveCondition=="function"&&window.aipkit_handleRemoveCondition(o.closest(".aipkit_condition_row")))}window.aipkit_handleListContainerClick=_})();(function(){"use strict";function _(n){let s=window.aipkit_getTriggerEventManagerState();if(!s)return;let o=n.target,r=o.closest(".aipkit_trigger_item");if(!r)return;let a=r.dataset.triggerId;if(a)if(o.matches(".aipkit_trigger_is_active_checkbox"))typeof window.aipkit_updateTriggerData=="function"&&window.aipkit_updateTriggerData(a,"is_active",o.checked);else if(o.matches(".aipkit_condition_type_select")){let e=o.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(o,e.querySelector(".aipkit_condition_field_select"),e.querySelector(".aipkit_condition_operator_select"),e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(a,r)}else if(o.matches(".aipkit_condition_field_select")){let e=o.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(o,e.querySelector(".aipkit_condition_operator_select"),e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(a,r)}else if(o.matches(".aipkit_condition_operator_select")){let e=o.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(o,e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(a,r)}else if(o.matches(".aipkit_trigger_action_type_select")){let e=r.querySelector(".aipkit_action_payload_container"),l=s.triggers.find(c=>c.id===a);e&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(e,o.value,l?.action?.payload,l?.action?.value),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(a,r)}else o.matches(".aipkit_trigger_field")&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(a,r)}window.aipkit_handleListContainerChange=_})();(function(){"use strict";function _(n){if(!window.aipkit_getTriggerEventManagerState())return;let o=n.target,r=o.closest(".aipkit_trigger_item");if(!r)return;let a=r.dataset.triggerId;if(a)if(o.matches('input[data-field="name"]')){let e=r.querySelector(".aipkit_trigger_item_name_display");e&&(e.textContent=o.value||"Unnamed Trigger"),typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(a,r)}else o.matches(".aipkit_trigger_field")&&typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(a,r)}window.aipkit_handleListContainerInput=_})();(function(){"use strict";function _(n){let s=document.getElementById(`aipkit_trigger_builder_${n}`);if(!s){console.warn(`InitEventListeners: Builder container for bot ${n} not found.`);return}if(s.dataset.eventManagerInitialized==="true")return;let o=s.querySelector(".aipkit_trigger_add_new_btn");o&&typeof window.aipkit_handleAddNewTrigger=="function"?o.addEventListener("click",window.aipkit_handleAddNewTrigger):o&&console.error("InitEventListeners: aipkit_handleAddNewTrigger function not found.");let r=s.querySelector(".aipkit_trigger_list_container");r?(typeof window.aipkit_handleListContainerClick=="function"?r.addEventListener("click",window.aipkit_handleListContainerClick):console.error("InitEventListeners: aipkit_handleListContainerClick function not found."),typeof window.aipkit_handleListContainerChange=="function"?r.addEventListener("change",window.aipkit_handleListContainerChange):console.error("InitEventListeners: aipkit_handleListContainerChange function not found."),typeof window.aipkit_handleListContainerInput=="function"?r.addEventListener("input",window.aipkit_handleListContainerInput):console.error("InitEventListeners: aipkit_handleListContainerInput function not found."),r.addEventListener("click",function(a){let e=a.target.closest(".aipkit_form_add_element_btn"),l=a.target.closest(".aipkit_form_element_remove_btn"),c=a.target.closest(".aipkit_form_add_option_btn"),i=a.target.closest(".aipkit_form_option_remove_btn");if(e){let t=e.closest(".aipkit_trigger_item");t&&typeof window.aipkit_handleAddFormElement=="function"&&window.aipkit_handleAddFormElement(t)}else if(l){let t=l.closest(".aipkit_form_element_editor_item");t&&typeof window.aipkit_handleRemoveFormElement=="function"&&window.aipkit_handleRemoveFormElement(t)}else if(c){let t=c.closest(".aipkit_form_element_options_editor"),d=t.closest(".aipkit_trigger_item"),p=t.closest(".aipkit_form_element_editor_item");if(t&&d&&p&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let u=window.aipkit_getTriggerEventManagerState(),f=d.dataset.triggerId,h=parseInt(p.dataset.elementIndex,10),m=u.triggers.find(y=>y.id===f);m&&m.action.payload.elements[h]&&(m.action.payload.elements[h].options||(m.action.payload.elements[h].options=[]),m.action.payload.elements[h].options.push({value:"",text:""}),u.isDirty=!0,window.aipkit_updateFormElementOptionControls(t,m.action.payload.elements[h].options),window.aipkit_saveTriggerFromForm(f,d))}}else if(i){let t=i.closest(".aipkit_form_element_option_row"),d=i.closest(".aipkit_form_element_options_editor"),p=d.closest(".aipkit_trigger_item"),u=d.closest(".aipkit_form_element_editor_item");if(t&&d&&p&&u&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let f=parseInt(t.dataset.optionIndex,10),h=window.aipkit_getTriggerEventManagerState(),m=p.dataset.triggerId,y=parseInt(u.dataset.elementIndex,10),E=h.triggers.find(T=>T.id===m);E&&E.action.payload.elements[y]&&E.action.payload.elements[y].options[f]!==void 0&&(E.action.payload.elements[y].options.splice(f,1),h.isDirty=!0,window.aipkit_updateFormElementOptionControls(d,E.action.payload.elements[y].options),window.aipkit_saveTriggerFromForm(m,p))}}}),r.addEventListener("change",function(a){let e=a.target;e.matches&&(e.matches(".aipkit_form_element_prop_change")||e.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&window.aipkit_handleFormElementPropertyChange(a)}),r.addEventListener("input",function(a){let e=a.target;e.matches&&(e.matches(".aipkit_form_element_prop_change")||e.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&(clearTimeout(e.aipkitDebounceTimeout),e.aipkitDebounceTimeout=setTimeout(()=>{window.aipkit_handleFormElementPropertyChange(a)},500))})):console.warn(`InitEventListeners: List container not found for bot ${n}.`),s.dataset.eventManagerInitialized="true"}window.aipkit_initTriggerBuilderEventListeners=_})();(function(){"use strict";let _={};function n(o){if(!o){console.error("AIPKit Trigger Main: Bot ID is required to initialize UI.");return}let r=document.getElementById(`aipkit_trigger_builder_${o}`);if(!r){console.error(`AIPKit Trigger Main: Builder container for bot ${o} not found.`);return}if(r.dataset.triggerUiInitialized==="true")return;let a=["aipkit_loadInitialTriggers","aipkit_loadTriggerSchemas","aipkit_initTriggerBuilderState","aipkit_setTriggerBuilderState","aipkit_setTriggerEventManagerState","aipkit_renderTriggerList","aipkit_initTriggerBuilderEventListeners","aipkit_renderFormElementEditorItem","aipkit_updateFormElementOptionControls","aipkit_handleAddFormElement","aipkit_handleRemoveFormElement","aipkit_handleFormElementPropertyChange"],e=!1;if(a.forEach(d=>{typeof window[d]!="function"&&(console.error(`AIPKit Trigger Main: CRITICAL DEPENDENCY MISSING -> ${d}. Check script loading and function names.`),e=!0)}),e){r.innerHTML='<p style="color:red;">Error: Trigger UI components failed to load. Check console for details.</p>';return}let l=window.aipkit_loadInitialTriggers(o),c=window.aipkit_loadTriggerSchemas(o);(!c||Object.keys(c).length===0)&&console.error(`AIPKit Trigger Main: Trigger schemas not loaded for bot ${o}.`);let i=window.aipkit_initTriggerBuilderState(o,l,c);_[o]=i,window.aipkit_setTriggerBuilderState(i),window.aipkit_setTriggerEventManagerState(i),window.aipkit_renderTriggerList(),window.aipkit_initTriggerBuilderEventListeners(o),r.dataset.triggerUiInitialized="true";let t=r.closest("form.aipkit_chatbot_settings_form");t&&(t.dataset.triggerSaveListenerAttached||(t.addEventListener("submit",function(d){let p=window.aipkit_getTriggerBuilderState(o);if(p){let u=window.aipkit_getTriggerEventManagerState();if(u&&u.editingTriggerId){let f=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${u.editingTriggerId}"]`);f&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(u.editingTriggerId,f)}typeof window.aipkit_updateTriggersJsonForSave=="function"?window.aipkit_updateTriggersJsonForSave(o,p.triggers):console.error("AIPKit Trigger Main: aipkit_updateTriggersJsonForSave is not defined. Triggers JSON might not be saved correctly.")}}),t.dataset.triggerSaveListenerAttached="true"))}function s(o){return _[o]||null}window.aipkit_initTriggerBuilderUI=n,window.aipkit_getTriggerBuilderState=s})();(function(){"use strict";function _(o){if(!o)return;let r=o.querySelector(".aipkit_enable_realtime_voice_toggle"),a=o.querySelector(".aipkit_realtime_voice_settings_container");if(!r||!a)return;let e=r.checked;a.style.display=e?"block":"none",typeof n=="function"&&n(o)}function n(o){if(!o)return;let r=o.querySelector(".aipkit_enable_realtime_voice_toggle"),a=o.querySelector('input[name="direct_voice_mode"]'),e=a?a.closest(".aipkit_form-group"):null,l=o.closest(".aipkit_chatbot-settings-area"),c=l?l.querySelector('input[name="popup_enabled"]'):null;if(!r||!a||!e||!c)return;let i=r.checked,t=c.checked,d=i&&t,p=e.getAttribute("data-tooltip-disabled")||"";d?(a.disabled=!1,e.removeAttribute("title"),e.classList.remove("aipkit-disabled-tooltip")):(a.checked&&(a.checked=!1,a.dispatchEvent(new Event("change",{bubbles:!0}))),a.disabled=!0,e.setAttribute("title",p),e.classList.add("aipkit-disabled-tooltip"))}function s(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let r="data-realtime-voice-ui-listener-attached";o.getAttribute(r)||(o.addEventListener("change",function(a){let e=a.target,l=e.closest(".aipkit_chatbot-settings-area");if(l){if(e.matches&&e.matches(".aipkit_enable_realtime_voice_toggle")){let c=e.closest(".aipkit_accordion-content");c&&_(c)}else if(e.matches&&e.matches('input[name="popup_enabled"]')){let c=l.querySelector('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content');c&&n(c)}}}),o.setAttribute(r,"true"),o.querySelectorAll('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content').forEach(a=>{_(a)}))}window.aipkit_initRealtimeVoiceAgentUI=s,window.aipkit_updateDirectVoiceModeState=n})();(function(){"use strict";function _(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n)return;let s="data-embed-copy-listener-attached";n.getAttribute(s)||(n.setAttribute(s,"true"),n.addEventListener("click",function(o){let r=o.target.closest(".aipkit_copy_embed_code_btn");if(!r)return;let a=r.dataset.target;if(!a)return;let e=document.getElementById(a);if(e){let l=e.value;typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(l,r):(console.error("AIPKit Embed: copyShortcode utility not found."),alert("Could not copy code."))}}))}window.aipkit_initEmbedCodeCopy=_})();(function(){"use strict";let _,n=window.aipkit_escapeHtml||function(e){return e};function s(e,l,c="",i="",t=""){if(!e)return;let d=e.querySelector(".aipkit_gsheets_status_container");if(!d){let g=e.querySelector(".aipkit_gsheets_indicator"),k=e.querySelector(".aipkit_gsheets_file_display"),v=e.querySelector(".aipkit_gsheets_shortcut_link_wrapper"),x=e.querySelector(".aipkit_gsheets_shortcut_link"),S=(window.aipkit_cw_pro_config||{}).gsheets_text||{};if(!g||!k)return;switch(g.innerHTML="",g.className="aipkit_gsheets_indicator",v&&(v.style.display="none"),k.style.display="none",l){case"verifying":g.innerHTML=`<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle; margin-right:4px;"></span> ${S.verifying||"Verifying..."}`,g.classList.add("aipkit_gsheets_indicator--verifying");break;case"success":g.innerHTML=`<span class="dashicons dashicons-yes-alt" style="color:green;"></span> ${S.accessible||"Accessible"}`,g.classList.add("aipkit_gsheets_indicator--success"),t&&(k.innerHTML=`<span>${n(t)}</span> <span class="dashicons dashicons-yes-alt"></span>`,k.style.display="inline-block"),v&&x&&i&&(x.href=`https://docs.google.com/spreadsheets/d/${encodeURIComponent(i)}/edit`,v.style.display="block");break;case"loaded":t&&(k.innerHTML=`<span>${n(t)}</span> <span class="dashicons dashicons-yes-alt"></span>`,k.style.display="inline-block");break;case"error":g.innerHTML=`<span class="dashicons dashicons-warning" style="color:red;"></span> ${S.error_prefix||"Error:"} ${n(c)}`,g.classList.add("aipkit_gsheets_indicator--error");break;case"clear":default:g.innerHTML="",k.innerHTML="",k.style.display="none";break}return}let p=e.querySelector(".aipkit_gsheets_upload_zone"),u=e.querySelector(".aipkit_gsheets_file_badge"),f=e.querySelector(".aipkit_gsheets_file_display"),h=e.querySelector(".aipkit_gsheets_shortcut_link"),m=e.querySelector(".aipkit_gsheets_credentials_file_input"),y=(window.aipkit_cw_pro_config||{}).gsheets_text||{};if(p&&u&&(t&&l!=="clear"?(p.classList.add("aipkit_gsheets_upload_zone--has-file"),u.style.display="flex",f&&(f.textContent=t)):(p.classList.remove("aipkit_gsheets_upload_zone--has-file"),u.style.display="none")),h&&i&&l==="success"&&(h.href=`https://docs.google.com/spreadsheets/d/${encodeURIComponent(i)}/edit`,h.closest(".aipkit_gsheets_shortcut_link_wrapper").style.display="flex"),!d)return;let E="",T="";switch(l){case"verifying":T="verifying",E=`
          <div class="aipkit_gsheets_status_card" data-status="verifying">
            <span class="aipkit_gsheets_status_icon">
              <span class="aipkit_spinner" style="width:16px;height:16px;border-width:2px;"></span>
            </span>
            <div class="aipkit_gsheets_status_content">
              <span class="aipkit_gsheets_status_title">${y.verifying||"Verifying Connection"}</span>
              <span class="aipkit_gsheets_status_message">${y.verifying_msg||"Checking sheet access..."}</span>
            </div>
          </div>
        `;break;case"success":T="success",E=`
          <div class="aipkit_gsheets_status_card" data-status="success">
            <span class="aipkit_gsheets_status_icon">
              <span class="dashicons dashicons-yes-alt"></span>
            </span>
            <div class="aipkit_gsheets_status_content">
              <span class="aipkit_gsheets_status_title">${y.accessible||"Sheet Connected"}</span>
              <span class="aipkit_gsheets_status_message">${y.success_msg||"Ready to import content"}</span>
            </div>
          </div>
        `;break;case"error":T="error",E=`
          <div class="aipkit_gsheets_status_card" data-status="error">
            <span class="aipkit_gsheets_status_icon">
              <span class="dashicons dashicons-warning"></span>
            </span>
            <div class="aipkit_gsheets_status_content">
              <span class="aipkit_gsheets_status_title">${y.error_prefix||"Connection Failed"}</span>
              <span class="aipkit_gsheets_status_message">${n(c)||y.invalid_creds||"Unable to access sheet"}</span>
            </div>
          </div>
        `;break;case"loaded":T="",E="";break;case"clear":default:T="",E="";break}d.innerHTML=E,d.dataset.gsheetsStatus=T}function o(e){if(!e)return;let l=e.querySelector(".aipkit_gsheets_credentials_file_input"),c=e.querySelector(".aipkit_gsheets_credentials_hidden_input");l&&(l.value=""),c&&(c.value="",delete c.dataset.filename),s(e,"clear")}async function r(e){if(!e)return;let l=e.querySelector(".aipkit_gsheets_sheet_id_input"),c=e.querySelector(".aipkit_gsheets_credentials_hidden_input"),i=(window.aipkit_cw_pro_config||{}).gsheets_text||{},t=l?l.value.trim():"",d=c?c.value.trim():"";if(!t||!d){s(e,"clear");return}let p=c.dataset.filename||"credentials.json";s(e,"verifying");try{let u=document.getElementById("aipkit_content_writer_nonce"),f=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,h=u?u.value:f;if(!h)throw new Error("Security token could not be found.");await window.aipkit_apiRequest("aipkit_content_writer_verify_gsheets",{gsheets_sheet_id:t,gsheets_credentials:d,_ajax_nonce:h}),s(e,"success","Connection successful.",t,p)}catch(u){s(e,"error",u.message||i.invalid_creds||"Invalid credentials or sheet not shared.")}}function a(){if(!window.aipkit_dashboard||!window.aipkit_dashboard.isProPlan)return;let e=document.getElementById("aipkit_module-container");if(!e)return;let l="data-gsheets-listener-attached";e.getAttribute(l)||(e.addEventListener("input",c=>{if(c.target.matches(".aipkit_gsheets_sheet_id_input, .aipkit_gsheets_id_input")){clearTimeout(_);let i=c.target.closest(".aipkit_gsheets_section_container");_=setTimeout(()=>r(i),1e3)}}),e.addEventListener("change",c=>{if(c.target.matches(".aipkit_gsheets_credentials_file_input")){let i=c.target,t=i.closest(".aipkit_gsheets_section_container");if(!t)return;let d=t.querySelector(".aipkit_gsheets_credentials_hidden_input");if(!d)return;let p=i.files[0];if(!p){d.value="",delete d.dataset.filename,s(t,"clear");return}let u=new FileReader;u.onload=function(f){d.value=f.target.result,d.dataset.filename=p.name,clearTimeout(_),r(t)},u.onerror=function(){console.error("Error reading file."),s(t,"error","Could not read the selected file.")},u.readAsText(p)}}),e.addEventListener("click",c=>{if(c.target.closest(".aipkit_gsheets_file_remove")){c.preventDefault();let i=c.target.closest(".aipkit_gsheets_section_container");i&&o(i)}}),e.addEventListener("dragover",c=>{let i=c.target.closest(".aipkit_gsheets_upload_zone");i&&(c.preventDefault(),i.classList.add("aipkit_gsheets_upload_zone--dragover"))}),e.addEventListener("dragleave",c=>{let i=c.target.closest(".aipkit_gsheets_upload_zone");i&&i.classList.remove("aipkit_gsheets_upload_zone--dragover")}),e.addEventListener("drop",c=>{let i=c.target.closest(".aipkit_gsheets_upload_zone");if(i){c.preventDefault(),i.classList.remove("aipkit_gsheets_upload_zone--dragover");let d=i.closest(".aipkit_gsheets_section_container")?.querySelector(".aipkit_gsheets_credentials_file_input");if(d&&c.dataTransfer.files.length>0){let p=new DataTransfer;p.items.add(c.dataTransfer.files[0]),d.files=p.files,d.dispatchEvent(new Event("change",{bubbles:!0}))}}}),e.setAttribute(l,"true"),document.querySelectorAll(".aipkit_gsheets_section_container").forEach(c=>{let i=c.querySelector(".aipkit_gsheets_credentials_hidden_input");i&&i.value.trim()!==""&&(i.dataset.filename="credentials.json",r(c))}))}window.aipkit_initGsheetsVerification=a,window.aipkit_verifyGSheetsCredentials=r,window.aipkit_setGsheetsIndicator=s,window.aipkit_clearGsheetsFile=o})();(function(){"use strict";function _(r,a){if(!r||!a)return;let l=r.value.trim().split(`
`).filter(c=>{let i=c.trim();return i&&/^https?:\/\//i.test(i)});a.textContent=l.length}function n(){let r=document.getElementById("aipkit_cw_url_list"),a=document.querySelector("[data-url-count]");r&&a&&_(r,a)}window.aipkit_refreshUrlCounter=n;function s(r,a){if(!r)return;r.dataset.status=a;let e=r.querySelector("[data-url-status-icon]");if(e){let l=e.querySelector(".dashicons");l&&(l.classList.remove("dashicons-update","dashicons-yes-alt","dashicons-warning"),a==="loading"?l.classList.add("dashicons-update"):a==="error"?l.classList.add("dashicons-warning"):l.classList.add("dashicons-yes-alt"))}}function o(){let r=document.getElementById("aipkit_cw_test_scrape_btn"),a=document.getElementById("aipkit_cw_url_list"),e=document.getElementById("aipkit_cw_scrape_results_wrapper"),l=document.getElementById("aipkit_cw_scrape_results");if(!r||!a||!e||!l)return;let c=e.querySelector("[data-url-status-card]"),i=e.querySelector("[data-url-preview-hint]"),t=e.querySelector("[data-url-preview-close]"),d=document.querySelector("[data-url-count]");d&&(_(a,d),a.addEventListener("input",()=>{_(a,d)}),a.addEventListener("change",()=>{_(a,d)}),setTimeout(()=>{_(a,d)},100));let p=u=>{e.hidden=!u,e.style.display=u?"block":"none"};t&&t.addEventListener("click",()=>{p(!1),l.textContent="",i&&(i.textContent=""),c&&s(c,"")}),r.addEventListener("click",async()=>{let u=a.value.trim().split(`
`),f=u[0]?u[0].trim():"";if(!f){p(!0),l.textContent="Please enter at least one URL to test.",i&&(i.textContent=""),c&&s(c,"error");return}p(!0),l.textContent="Extracting content from the URL...",i&&(i.textContent=f),c&&s(c,"loading"),typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,"Test Extract","Extracting...");try{let h=document.getElementById("aipkit_content_writer_nonce"),m=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,y=h?h.value:m;if(!y)throw new Error("Security token could not be found.");let T=(await window.aipkit_apiRequest("aipkit_content_writer_scrape_url",{url:f,_ajax_nonce:y})).scraped_text||"No text could be extracted.";l.textContent=T,c&&s(c,T&&T!=="No text could be extracted."?"success":"error")}catch(h){l.textContent=`Error: ${h.message||"Failed to scrape URL."}`,c&&s(c,"error"),console.error("URL Scrape Error:",h)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,"Test First URL")}})}window.aipkit_initUrlScrapeHandler=o})();(function(){"use strict";function _(i){if(!i||!i.trim())return 0;let t=i.split(/\r?\n/),d=0;return t.forEach(p=>{let u=p.trim();u&&/^https?:\/\/.+/i.test(u)&&d++}),d}function n(i){let t=i.closest(".aipkit_rss_textarea_wrapper");if(!t)return;let d=t.querySelector("[data-rss-url-count]");if(!d)return;let p=_(i.value);d.textContent=p;let u=d.closest(".aipkit_rss_url_counter");u&&(p>0?(u.style.background="#dcfce7",d.style.color="#16a34a"):(u.style.background="#f1f5f9",d.style.color=""))}function s(i,t,d={}){let p=!!i.closest("#aipkit_autogpt_container"),u=i.querySelector("[data-rss-input-zone]"),f=i.querySelector("[data-rss-status]"),h=i.querySelector("[data-rss-status-card]"),m=i.querySelector("[data-rss-status-icon]"),y=i.querySelector("[data-rss-status-title]"),E=i.querySelector("[data-rss-status-message]"),T=i.querySelector("[data-rss-items-count]");if(!(!f||!h)){if(t==="idle"){u&&u.classList.remove("is-hidden"),f.hidden=!0,T&&(T.value="0"),!p&&typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState("rss");return}if(u&&u.classList.add("is-hidden"),f.hidden=!1,h.dataset.status=t,m){let g="dashicons-yes-alt";t==="loading"&&(g="dashicons-update"),t==="error"&&(g="dashicons-warning"),m.innerHTML=`<span class="dashicons ${g}" aria-hidden="true"></span>`;let k=m.querySelector(".dashicons");k&&t==="loading"&&(k.style.animation="aipkit_rss_spin 1s linear infinite")}if(y)if(t==="loading")y.textContent="Fetching feeds...";else if(t==="success"){let g=d.feeds_found||0,k=d.items_found||0,v=g===1?"feed":"feeds",x=k===1?"item":"items";y.textContent=`${k} ${x} from ${g} ${v}`}else t==="error"&&(y.textContent="Error");if(E&&(t==="loading"?E.textContent="Please wait...":t==="success"?(E.textContent=d.items_found>0?"Ready! Click Generate to proceed.":"No new items found.",p&&d.items_found>0&&(E.textContent="Ready to save the task.")):t==="error"&&(E.textContent=d.message||"Failed to fetch feeds.")),T&&(T.value=d.items_found||0),!p&&t==="success"&&d.items_found>0){let g=document.querySelector(".aipkit_cw_generate_split");g&&(g.dataset.aipkitCwAction="generate");let k=document.getElementById("aipkit_content_writer_generate_btn");if(k){k.dataset.action="generate";let v=k.querySelector(".aipkit_btn-text");v&&(v.textContent="Generate")}typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState("rss")}}}async function o(i,t){let d=i.querySelector("#aipkit_cw_rss_feeds"),p=i.querySelector("#aipkit_cw_rss_include_keywords"),u=i.querySelector("#aipkit_cw_rss_exclude_keywords");if(!d)return;let f=d.value.trim();if(!f){s(i,"error",{message:"Please enter at least one RSS feed URL."});return}if(_(f)===0){s(i,"error",{message:"No valid URLs found. Please check your input."});return}s(i,"loading"),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!0,"Fetch Feeds","Fetching...");let m=document.getElementById("aipkit_content_writer_nonce"),y=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,E=m?m.value:y;if(!E){s(i,"error",{message:"Security token could not be found."});return}try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function not available.");let T=await window.aipkit_apiRequest("aipkit_content_writer_fetch_rss",{rss_feeds:f,rss_include_keywords:p?p.value:"",rss_exclude_keywords:u?u.value:"",_ajax_nonce:E});if(s(i,"success",{feeds_found:T.feeds_found||0,items_found:T.items_found||0,message:T.message||""}),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"){delete t.dataset.originalText;let g=!!t.closest("#aipkit_autogpt_container");window.aipkit_setLoadingStateOpenAI(t,!1,g?"Fetch Feeds":"Generate")}if(t){let g=t.querySelector(".aipkit_btn-text"),k=!!t.closest("#aipkit_autogpt_container");g&&(g.textContent=k?"Fetch Feeds":"Generate"),k||(t.dataset.action="generate")}}catch(T){console.error("RSS Fetch Error:",T),s(i,"error",{message:T.message||"Failed to fetch RSS feeds."}),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,"Fetch Feeds")}}function r(i){s(i,"idle")}function a(i){let t=document.querySelector("[data-rss-container]");if(!t){console.error("RSS Fetch: Container not found.");return}o(t,i)}function e(){let i=document.querySelector("[data-rss-container]");if(!i||i.dataset.rssHandlerAttached==="true")return;let t=i.querySelector("#aipkit_cw_rss_feeds"),d=i.querySelector("[data-rss-edit-btn]");t&&(n(t),t.addEventListener("input",function(){n(this)}),t.addEventListener("paste",function(){setTimeout(()=>n(this),10)})),d&&d.addEventListener("click",function(p){p.preventDefault(),r(i)}),i.dataset.rssHandlerAttached="true"}function l(){let i=document.getElementById("aipkit_task_cw_rss_feeds")||document.getElementById("aipkit_cw_rss_feeds");if(!i||i.dataset.rssHandlerAttached==="true")return;let t=i.closest("[data-rss-container]")||document.querySelector("[data-rss-container]"),d=t?t.querySelector("[data-rss-edit-btn]"):null,p=t?t.querySelector("[data-rss-fetch-btn]"):null;n(i),i.addEventListener("input",function(){n(this)}),i.addEventListener("paste",function(){setTimeout(()=>n(this),10)}),d&&d.addEventListener("click",function(u){u.preventDefault(),r(t)}),p&&p.addEventListener("click",function(u){u.preventDefault(),o(t,p)}),i.dataset.rssHandlerAttached="true"}function c(){let i=document.getElementById("aipkit_cw_rss_feeds");i&&n(i)}window.aipkit_initRssInputHandler=e,window.aipkit_initTaskRssInputHandler=l,window.aipkit_handleRssFetchFromGenerateButton=a,window.aipkit_refreshRssCounter=c})();(function(){"use strict";let _=window.aipkit_escapeHtml||(r=>r);function n(r,a){let e=window.aipkit_automated_tasks_config||{},l,c,i,t,d;r==="openai"?(l=a.querySelector("#aipkit_task_ce_openai_vector_store_ids"),c=e.openai_vector_stores||[],i="id",t="name",d="No OpenAI stores found."):r==="pinecone"?(l=a.querySelector("#aipkit_task_ce_pinecone_index_name"),c=e.pinecone_indexes||[],i="name",t="name",d="No Pinecone indexes found."):r==="qdrant"&&(l=a.querySelector("#aipkit_task_ce_qdrant_collection_name"),c=e.qdrant_collections||[],i="name",t="name",d="No Qdrant collections found."),l&&(l.innerHTML="",c.length>0?(l.multiple?c.forEach(p=>{l.add(new Option(_(p[t]),p[i]))}):(l.add(new Option("-- Select --","")),c.forEach(p=>{l.add(new Option(_(p[t]),p[i]))})),l.disabled=!1):(l.add(new Option(d,"")),l.disabled=!0))}function s(r,a){let e=a.querySelector("#aipkit_task_ce_vector_embedding_model");if(!e)return;let l=window.aipkit_automated_tasks_config||{},c=r==="google"?l.google_embedding_models||[]:r==="azure"?l.azure_embedding_models||[]:l.openai_embedding_models||[];e.innerHTML="",c.length>0?(e.add(new Option("-- Select Model --","")),c.forEach(i=>{e.add(new Option(_(i.name||i.id),i.id))}),e.disabled=!1):(e.add(new Option("No models found","")),e.disabled=!0)}function o(r){let a=document.getElementById("aipkit_automated_task_form");if(!a)return;let e=document.getElementById("aipkit_task_ce_post_types");e&&(Array.from(e.options).forEach(w=>w.selected=!1),(r.post_types||[]).forEach(w=>{let b=e.querySelector(`option[value="${w}"]`);b&&(b.selected=!0)}));let l=document.getElementById("aipkit_task_ce_post_categories");l&&(Array.from(l.options).forEach(w=>w.selected=!1),(r.post_categories||[]).forEach(w=>{let b=l.querySelector(`option[value="${w}"]`);b&&(b.selected=!0)}));let c=document.getElementById("aipkit_task_ce_post_authors");c&&(Array.from(c.options).forEach(w=>w.selected=!1),(r.post_authors||[]).forEach(w=>{let b=c.querySelector(`option[value="${w}"]`);b&&(b.selected=!0)}));let i=document.getElementById("aipkit_task_ce_post_status");i&&(Array.from(i.options).forEach(w=>w.selected=!1),(r.post_statuses||["publish"]).forEach(w=>{let b=i.querySelector(`option[value="${w}"]`);b&&(b.selected=!0)}));let t=document.getElementById("aipkit_task_ce_update_title");t&&(t.checked=r.update_title==="1");let d=document.getElementById("aipkit_task_ce_update_excerpt");d&&(d.checked=r.update_excerpt==="1");let p=document.getElementById("aipkit_task_ce_update_content");p&&(p.checked=r.update_content==="1");let u=document.getElementById("aipkit_task_ce_update_meta");u&&(u.checked=r.update_meta==="1");let f=document.getElementById("aipkit_task_ce_enhance_existing_now_flag");f&&(f.checked=r.enhance_existing_now_flag==="1"),typeof window.aipkit_initContentEnhancementTaskFormUI=="function"&&setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0);let h=document.getElementById("aipkit_task_ce_title_prompt");h&&(h.value=r.title_prompt||"");let m=document.getElementById("aipkit_task_ce_excerpt_prompt");m&&(m.value=r.excerpt_prompt||"");let y=document.getElementById("aipkit_task_ce_content_prompt");y&&(y.value=r.content_prompt||"");let E=document.getElementById("aipkit_task_ce_meta_prompt");E&&(E.value=r.meta_prompt||"");let T=document.getElementById("aipkit_task_ce_ai_provider"),g=document.getElementById("aipkit_task_ce_ai_model");T&&g&&(T.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&r.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_ce_populateModels=="function"&&window.aipkit_task_ce_populateModels(T,g));let k=document.getElementById("aipkit_task_ce_ai_temperature");if(k){k.value=r.ai_temperature||1;let w=document.getElementById(k.id+"_value");w&&(w.textContent=k.value)}let v=document.getElementById("aipkit_task_ce_content_max_tokens");if(v){v.value=r.content_max_tokens||4e3;let w=document.getElementById(v.id+"_value");w&&(w.textContent=v.value),v.dispatchEvent(new Event("change",{bubbles:!0}))}let x=a.elements.ce_reasoning_effort;if(x){let w=r.reasoning_effort||"";w&&(x.value=w==="minimal"?"low":w,x.dispatchEvent(new Event("change",{bubbles:!0})))}g&&typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&setTimeout(()=>g.dispatchEvent(new Event("change",{bubbles:!0})),100),a.elements.task_frequency&&(a.elements.task_frequency.value=r.task_frequency||"daily");let S=a.querySelector("#aipkit_autogpt_ce_vector_settings_popover");if(S){typeof window.aipkit_initCeKnowledgeBaseUI=="function"&&window.aipkit_initCeKnowledgeBaseUI();let w=S.querySelector("#aipkit_task_ce_enable_vector_store");if(w){let b=r.enable_vector_store==="1";w.checked=b,w.dispatchEvent(new Event("change",{bubbles:!0}))}if(r.enable_vector_store==="1"){let b=r.vector_store_provider||"openai",I=S.querySelector("#aipkit_task_ce_vector_store_provider");I&&(I.value=b,I.dispatchEvent(new Event("change",{bubbles:!0})));let q=S.querySelector("#aipkit_task_ce_vector_store_top_k");if(q){q.value=r.vector_store_top_k||"3";let C=S.querySelector("#aipkit_task_ce_vector_store_top_k_value");C&&(C.textContent=q.value)}if(b==="openai"){let C=S.querySelector("#aipkit_task_ce_openai_vector_store_ids");C&&Array.isArray(r.openai_vector_store_ids)&&(Array.from(C.options).forEach(F=>{F.selected=r.openai_vector_store_ids.includes(F.value)}),C.dispatchEvent(new Event("change",{bubbles:!0})))}else if(b==="pinecone"){let C=S.querySelector("#aipkit_task_ce_pinecone_index_name");C&&(C.value=r.pinecone_index_name||"")}else if(b==="qdrant"){let C=S.querySelector("#aipkit_task_ce_qdrant_collection_name");C&&(C.value=r.qdrant_collection_name||"")}if(b==="pinecone"||b==="qdrant"){let C=r.vector_embedding_provider||"openai",F=S.querySelector("#aipkit_task_ce_vector_embedding_provider"),A=S.querySelector("#aipkit_task_ce_vector_embedding_model");F&&(F.value=C,F.dispatchEvent(new Event("change",{bubbles:!0}))),A&&r.vector_embedding_model&&setTimeout(()=>{A.value=r.vector_embedding_model},50)}}typeof window.aipkit_updateCeKnowledgeBaseUI=="function"&&window.aipkit_updateCeKnowledgeBaseUI()}}window.aipkit_form_populateContentEnhancementFields=o})();(function(){"use strict";function _(){let n=document.getElementById("aipkit_automated_task_form"),s=window.aipkit_dashboard||{};if(!n)return;let o=document.getElementById("aipkit_task_ce_ai_provider"),r=document.getElementById("aipkit_task_ce_ai_model"),a=n.elements.ce_reasoning_effort;if(o&&r){let l=(s.main_provider||"openai").toLowerCase();if(o.value=l,typeof window.aipkit_task_ce_populateModels=="function"){window.aipkit_task_ce_populateModels(o,r);let c="",i=s?.models?.[l];switch(l){case"openai":c="gpt-4o-mini";break;case"google":c="gemini-1.5-flash-latest";break;case"openrouter":c="moonshotai/kimi-k2.5";break;case"azure":case"deepseek":case"ollama":Array.isArray(i)&&i.length>0&&(c=i[0].id||"");break}r.querySelector(`option[value="${CSS.escape(c)}"]`)?r.value=c:console.warn(`Default model ${c} not found for provider ${l}.`),r.dispatchEvent(new Event("change",{bubbles:!0}))}}a&&!a.value&&(a.value="medium");let e=n.querySelector("#aipkit_task_ce_content_max_tokens");e&&(e.value="4000",e.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setContentEnhancementDefaults=_})();(function(){"use strict";function _(n,s){if(n.task_type==="enhance_existing_content"){let o={ce_ai_provider:"ai_provider",ce_ai_model:"ai_model",ce_ai_temperature:"ai_temperature",ce_content_max_tokens:"content_max_tokens",ce_reasoning_effort:"reasoning_effort",ce_title_prompt:"title_prompt",ce_excerpt_prompt:"excerpt_prompt",ce_content_prompt:"content_prompt",ce_meta_prompt:"meta_prompt",ce_vector_store_provider:"vector_store_provider",ce_vector_store_top_k:"vector_store_top_k",ce_pinecone_index_name:"pinecone_index_name",ce_qdrant_collection_name:"qdrant_collection_name",ce_vector_embedding_provider:"vector_embedding_provider",ce_vector_embedding_model:"vector_embedding_model"};for(let[a,e]of Object.entries(o))n[a]!==void 0&&(n[e]=n[a],delete n[a]);n.post_types=s.getAll("ce_post_types[]"),n.post_categories=s.getAll("ce_post_categories[]"),n.post_authors=s.getAll("ce_post_authors[]"),n.post_statuses=s.getAll("ce_post_statuses[]"),n.openai_vector_store_ids=s.getAll("ce_openai_vector_store_ids[]"),n.update_title=s.has("ce_update_title")?"1":"0",n.update_excerpt=s.has("ce_update_excerpt")?"1":"0",n.update_content=s.has("ce_update_content")?"1":"0",n.update_meta=s.has("ce_update_meta")?"1":"0",n.enhance_existing_now_flag=s.has("ce_enhance_existing_now_flag")?"1":"0",n.enable_vector_store=s.has("ce_enable_vector_store")?"1":"0",delete n["ce_post_types[]"],delete n["ce_post_categories[]"],delete n["ce_post_authors[]"],delete n["ce_post_statuses[]"],delete n["ce_openai_vector_store_ids[]"],delete n.ce_update_title,delete n.ce_update_excerpt,delete n.ce_update_content,delete n.ce_update_meta,delete n.ce_enhance_existing_now_flag,delete n.ce_enable_vector_store,["post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","content_title_bulk","content_keywords","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","openai_vector_store_ids[]","csv_file_input"].forEach(a=>delete n[a])}return n}window.aipkit_save_task_handleContentEnhancement=_})();(function(){"use strict";let _=window.aipkit_escapeHtml||(i=>i);function n(i){if(!i)return;let t=i.querySelector(".aipkit_task_ce_vector_store_toggle"),d=i.querySelectorAll(".aipkit_task_ce_vector_store_settings_container");if(!t||!d.length)return;let p=t.checked;d.forEach(u=>{u.style.display=p?"block":"none"}),p&&s(i)}function s(i){if(!i)return;let t=i.querySelector(".aipkit_task_ce_vector_store_provider_select");if(!t)return;let d=t.value,p=i.querySelector(".aipkit_task_ce_vector_openai_field"),u=i.querySelector(".aipkit_task_ce_vector_pinecone_field"),f=i.querySelector(".aipkit_task_ce_vector_qdrant_field"),h=i.querySelector(".aipkit_task_ce_vector_embedding_config_row"),m=(y,E)=>{y&&(y.style.display=E?"block":"none")};if(m(p,d==="openai"),m(u,d==="pinecone"),m(f,d==="qdrant"),h){let y=d==="pinecone"||d==="qdrant";h.style.display=y?"block":"none",y&&o(i)}}function o(i){let t=i.querySelector("#aipkit_task_ce_vector_embedding_model");if(!t)return;let d=i.querySelector("#aipkit_task_ce_vector_embedding_provider"),p=d?d.value:"openai",u=window.aipkit_automated_tasks_config||{},f=[];p==="google"?f=u.google_embedding_models||[]:p==="azure"?f=u.azure_embedding_models||[]:f=u.openai_embedding_models||[],t.innerHTML="",f.length>0?(t.add(new Option("-- Select Model --","")),f.forEach(h=>{t.add(new Option(_(h.name||h.id),h.id))}),t.disabled=!1):(t.add(new Option("No models found","")),t.disabled=!0)}function r(i){if(!i)return;let t=i.getAttribute("aria-expanded")==="true",d=i.getAttribute("aria-controls"),p=document.getElementById(d);p&&(i.setAttribute("aria-expanded",(!t).toString()),p.setAttribute("aria-hidden",t?"true":"false"))}function a(i){if(!i)return;let t=document.getElementById(i.id+"_value");t&&(t.textContent=i.value)}function e(i){i&&(i.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(t=>{t.querySelector(".aipkit_task_ce_vector_store_toggle")&&(n(t),t.querySelectorAll(".aipkit_vector_slider").forEach(d=>{a(d)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(i))}function l(){let i=document.getElementById("aipkit_autogpt_container");!i||i.dataset.kbCeListenerAttached==="true"||(i.addEventListener("change",t=>{let d=t.target;if(d.matches(".aipkit_task_ce_vector_store_toggle")){let p=d.closest(".aipkit_vector_settings_redesigned");n(p)}else if(d.matches(".aipkit_task_ce_vector_store_provider_select")){let p=d.closest(".aipkit_vector_settings_redesigned");s(p)}else if(d.matches(".aipkit_task_ce_vector_embedding_provider_select")){let p=d.closest(".aipkit_vector_settings_redesigned");o(p)}}),i.addEventListener("input",t=>{let d=t.target;d.matches(".aipkit_vector_slider")&&a(d)}),i.addEventListener("click",t=>{let d=t.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!d)return;let p=d.closest(".aipkit_vector_settings_redesigned");!p||!p.querySelector(".aipkit_task_ce_vector_store_toggle")||(t.preventDefault(),r(d))}),e(i),i.dataset.kbCeListenerAttached="true")}function c(){let i=document.getElementById("aipkit_autogpt_container");i&&(l(),i.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(t=>{t.querySelector(".aipkit_task_ce_vector_store_toggle")&&(n(t),s(t),o(t))}))}window.aipkit_initCeKnowledgeBaseUI=l,window.aipkit_updateCeKnowledgeBaseUI=c})();(function(){"use strict";function _(){let n=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(!n)return;let s=n.querySelector("#aipkit_task_ce_ai_provider"),o=n.querySelector("#aipkit_task_ce_ai_model");s&&o&&typeof window.aipkit_task_ce_populateModels=="function"&&(s.dataset.ceProviderListenerAttached||(s.addEventListener("change",()=>window.aipkit_task_ce_populateModels(s,o)),s.dataset.ceProviderListenerAttached="true"),o.dataset.ceModelListenerAttached||(o.addEventListener("change",()=>{typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}),o.dataset.ceModelListenerAttached="true"),window.aipkit_task_ce_populateModels(s,o));let r=n.querySelector("#aipkit_task_ce_ai_temperature");r&&typeof window.aipkit_task_ce_handleTemperatureSlider=="function"&&window.aipkit_task_ce_handleTemperatureSlider(r);let a=n.querySelector("#aipkit_task_ce_content_max_tokens");a&&typeof window.aipkit_task_ce_handleMaxTokensSlider=="function"&&window.aipkit_task_ce_handleMaxTokensSlider(a);let e=n.querySelector("#aipkit_task_ce_ai_settings_toggle"),l=n.querySelector("#aipkit_task_ce_ai_parameters_row");e&&l&&(e.dataset.ceAiSettingsListenerAttached||(e.addEventListener("click",()=>{let i=l.style.display==="none"||l.style.display==="";l.style.display=i?"block":"none",e.classList.toggle("aipkit_active",i),e.setAttribute("aria-expanded",i)}),e.dataset.ceAiSettingsListenerAttached="true"));let c=n.querySelector("#aipkit_task_config_enhancement_ai_and_prompts_main");c&&(c.dataset.cePromptListenerAttached||(c.addEventListener("click",i=>{let t=i.target.closest(".aipkit_textarea_toggle");if(!t)return;let d=t.dataset.target,p=document.getElementById(d),u=t.querySelector(".dashicons");if(!p||!u)return;p.classList.toggle("aipkit_collapsed")?(u.classList.remove("dashicons-minus"),u.classList.add("dashicons-plus-alt2"),t.title="Expand"):(u.classList.remove("dashicons-plus-alt2"),u.classList.add("dashicons-minus"),t.title="Collapse")}),c.dataset.cePromptListenerAttached="true")),typeof window.aipkit_initCeKnowledgeBaseUI=="function"?window.aipkit_initCeKnowledgeBaseUI():console.error("AIPKit CE UI: Knowledge base UI initializer not found.")}window.aipkit_initContentEnhancementTaskFormUI=_})();(function(){"use strict";function _(n){if(!n)return;let s=n.closest(".aipkit_slider_wrapper"),o=s?s.querySelector(".aipkit_slider_value"):null;o&&(o.textContent=n.value,n.dataset.listenerAttached||(n.addEventListener("input",()=>o.textContent=n.value),n.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleMaxTokensSlider=_})();(function(){"use strict";let _=window.aipkit_escapeHtml||function(s){return s};function n(s,o){let r=s.value,a=r?r.toLowerCase():"",e=window.aipkit_dashboard?.models,l=window.aipkit_automated_tasks_form_state||{};if(!o)return;if(!e){o.innerHTML=`<option value="">${_("Error: Model data object not found")}</option>`,o.disabled=!0;return}let c=e[a],i=l.pendingModelSelection||o.value;if(o.innerHTML="",a==="openai"&&typeof c=="object"&&!Array.isArray(c)?Object.keys(c).forEach(t=>{let d=document.createElement("optgroup");d.label=_(t),Array.isArray(c[t])&&c[t].forEach(p=>{p&&p.id&&d.appendChild(new Option(_(p.name||p.id),p.id))}),o.appendChild(d)}):Array.isArray(c)&&c.forEach(t=>{t&&t.id&&o.appendChild(new Option(_(t.name||t.id),t.id))}),o.options.length===0)o.appendChild(new Option(_(`No models for ${r}`),"")),o.disabled=!0;else{o.disabled=!1;let t=!1;if(i&&o.querySelector(`option[value="${CSS.escape(i)}"]`)&&(o.value=i,t=!0),!t&&o.options.length>0){let d=o.querySelector('option:not([value=""])');d&&(o.value=d.value)}}l&&(l.pendingModelSelection=null),typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort(),o&&o.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_ce_populateModels=n})();(function(){"use strict";function _(n){if(!n)return;let s=n.closest(".aipkit_slider_wrapper"),o=null;if(s&&(o=s.querySelector(".aipkit_slider_value")),!o){let r=n.closest(".aipkit_ai_temperature_control");r&&(o=r.querySelector(".aipkit_ai_behavior_value"))}o&&(o.textContent=n.value,n.dataset.listenerAttached||(n.addEventListener("input",()=>o.textContent=n.value),n.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleTemperatureSlider=_})();(function(){"use strict";function _(){let l=document.querySelector("#aipkit_task_ce_ai_provider"),c=document.querySelector("#aipkit_task_ce_ai_model"),i=document.querySelector(".aipkit_task_ce_reasoning_effort_field"),t=i?i.closest(".aipkit_ai_settings_redesigned"):null;if(!l||!c||!i){i&&(i.style.display="none");return}let d=(l.value||"").toLowerCase(),u=(c.value||"").toLowerCase();d==="openai"&&s(u)?(i.style.display="block",t&&n(t,u)):i.style.display="none"}function n(l,c){let i=l.querySelector("[data-aipkit-reasoning-select]"),t=l.querySelectorAll(".aipkit_ai_reasoning_option");if(!i||!t.length)return;let d=r(c),p=new Set(d.allowed);t.forEach(m=>{let y=m.querySelector(".aipkit_ai_reasoning_input");if(!y)return;let E=y.value==="minimal"?"low":y.value,T=p.has(E);m.style.display=T?"":"none",T||(y.checked=!1)});let u=i.value||"";u==="minimal"&&(u="low"),p.has(u)||(u=d.defaultValue),p.has(u)||(u=d.allowed[0]||"");let f=i.value;u&&(i.value=u);let h=l.querySelector(`.aipkit_ai_reasoning_input[value="${u}"]`);if(h){h.checked=!0,l.querySelectorAll(".aipkit_ai_reasoning_option").forEach(y=>y.classList.remove("aipkit_ai_reasoning_option--selected"));let m=h.closest(".aipkit_ai_reasoning_option");m&&m.classList.add("aipkit_ai_reasoning_option--selected")}f!==i.value&&i.dispatchEvent(new Event("change",{bubbles:!0}))}function s(l){if(o(l))return!1;let c=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),i=l.includes("gpt-5");return c||i}function o(l){return/(?:^|[-_])chat(?:[-_]|$)/.test(l)}function r(l){return e(l)?{allowed:["high"],defaultValue:"high"}:l.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:a(l)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function a(l){let c=l.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let i=l.match(/gpt-(\d+)/);return i?Number.parseInt(i[1],10)>=6:!1}function e(l){return/gpt-5(\.\d+)?-pro/.test(l)}window.aipkit_autogpt_ce_toggleReasoningEffort=_})();(function(){"use strict";let _={files:[],uploading:!1,currentXhr:null,cancelled:!1,totals:{loaded:0,size:0}};function n(){let g=window.aipkit_dashboard?.isProPlan;return g===!0||g===1||g==="1"}function s(g){return document.getElementById(g)}function o(){let g=s("aipkit_vs_global_file_queue");if(!g)return;if(!_.files.length){g.innerHTML="";return}let k=_.files.map((v,x)=>{let S=Math.round(v.size/1048576*10)/10,w=(typeof Intl<"u"?new Intl.NumberFormat(void 0,{minimumFractionDigits:1,maximumFractionDigits:1}):{format:b=>b.toFixed(1)}).format(S);return`<div class="aipkit_queue_item" data-idx="${x}" data-status="pending" style="display:flex;align-items:center;gap:8px;margin:4px 0;">
        <span class="aipkit_queue_item_icon" title="Pending" aria-label="Pending" style="font-size:14px;line-height:1;width:18px;text-align:center;">\u23F3</span>
        <div class="aipkit_queue_item_meta" style="flex:1 1 auto;min-width:0;">
          <div style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="${r(v.name)}">${r(v.name)}</div>
          <div class="aipkit_queue_item_progress" style="height:4px;background:#eee;border-radius:2px;overflow:hidden;margin-top:4px;">
            <div class="aipkit_queue_item_bar" style="width:0%;height:100%;background:#007cba;transition:width .2s;"></div>
          </div>
        </div>
  <div class="aipkit_queue_item_size" style="font-size:11px;color:#666;min-width:64px;text-align:right;">${w} MB</div>
        <button type="button" class="aipkit_queue_remove_btn aipkit_btn_icon" aria-label="Remove file" title="Remove" style="border:none;background:transparent;cursor:pointer;">
          <span class="dashicons dashicons-no"></span>
        </button>
      </div>`}).join("");g.innerHTML=k,g.querySelectorAll(".aipkit_queue_remove_btn").forEach(v=>{v.addEventListener("click",x=>{let S=x.currentTarget.closest(".aipkit_queue_item");if(!S)return;let w=parseInt(S.dataset.idx,10);isNaN(w)||(_.files.splice(w,1),o())})})}function r(g){let k=document.createElement("div");return k.textContent=String(g??""),k.innerHTML}function a(g,k){typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(g,k||"info","aipkit_knowledge_base_global_status")}let e=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"];function l(){let g=window.aipkit_uploadLimits?.allowed_mime_types;return Array.isArray(g)&&g.length?g:e}function c(g){let k=Number(window.aipkit_effectiveUploadLimitBytes||0);if(!Number.isFinite(k)||k<=0)if(g==="openai")k=10*1024*1024;else return Number.POSITIVE_INFINITY;return g==="openai"&&(k=Math.min(k,10*1024*1024)),k}function i(g,k){let v=l(),x=c(k),S=[];g.size>x&&S.push(`Too large: ${g.name} (${t(g.size)}). Max ${t(x)}.`);let w=v.map(I=>I.toLowerCase()),b=String(g.type||"").toLowerCase();if(b&&!w.includes(b)){let I=(g.name.split(".").pop()||"").toLowerCase(),C={txt:"text/plain",text:"text/plain",log:"text/plain",md:"text/plain",pdf:"application/pdf",htm:"text/html",html:"text/html",xhtml:"application/xhtml+xml",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",csv:"text/csv",json:"application/json"}[I];(!C||!w.includes(C.toLowerCase()))&&S.push(`Unsupported type: ${g.name} (${g.type}).`)}return S}function t(g){if(!Number.isFinite(g))return`${g}`;let k=["B","KB","MB","GB"],v=0,x=g;for(;x>=1024&&v<k.length-1;)x/=1024,v++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:w=>w.toFixed(1)}).format(x)} ${k[v]}`}function d(g,k){let v=s("aipkit_vs_global_file_queue");if(!v)return;let x=v.querySelector(`.aipkit_queue_item[data-idx="${g}"]`);if(!x)return;let S=x.querySelector(".aipkit_queue_item_bar");S&&(S.style.width=Math.max(0,Math.min(100,k))+"%")}function p(g,k){let v=s("aipkit_vs_global_file_queue");if(!v)return;let x=v.querySelector(`.aipkit_queue_item[data-idx="${g}"]`);if(!x)return;let S=x.querySelector(".aipkit_queue_item_icon"),{icon:w,label:b}=u(k);S&&(S.textContent=w,S.title=b,S.setAttribute("aria-label",b)),x.dataset.status=k}function u(g){switch(g){case"completed":return{icon:"\u2705",label:"Completed"};case"error":return{icon:"\u274C",label:"Error"};case"processing":return{icon:"\u{1F504}",label:"Processing"};case"pending":default:return{icon:"\u23F3",label:"Pending"}}}function f(g){}function h(g,k){let v=new FormData,x=g.vectorStoreProvider;if(v.append("provider",x),v.append("source_type","file_upload"),g.embeddingProvider&&v.append("embedding_provider",g.embeddingProvider),g.embeddingModel&&v.append("embedding_model",g.embeddingModel),x==="openai"){let S=g.targetStoreId.startsWith("_create_new_")?"":g.targetStoreId;v.append("target_store_id",S),v.append("new_store_name_openai",g.newStoreNameOpenAI||"")}else if(x==="pinecone"){let S=g.targetStoreId.startsWith("_create_new_")?"":g.targetStoreId;v.append("index_name",S),v.append("target_store_id",g.targetStoreId)}else x==="qdrant"&&v.append("target_store_id",g.targetStoreId);return k&&v.append("_ajax_nonce",k),v}function m(g,k,v){return new Promise((x,S)=>{let w=new XMLHttpRequest;_.currentXhr=w,w.open("POST",g,!0),w.withCredentials=!0,w.upload.onprogress=b=>{if(b.lengthComputable&&typeof v=="function"){let I=b.loaded/b.total*100;v(I)}},w.onreadystatechange=function(){if(w.readyState===4){_.currentXhr=null;try{let b=JSON.parse(w.responseText||"{}");if(w.status>=200&&w.status<300&&b.success)x(b.data);else{let I=new Error(b?.data?.message||`Upload failed (${w.status})`);I.server=b,S(I)}}catch{S(new Error(`Upload error: invalid JSON (${w.status})`))}}},w.onerror=()=>{_.currentXhr=null,S(new Error("Network error"))},w.send(k)})}async function y(g){if(!n()||!_.files.length||!window.aipkit_dashboard?.ajaxurl)return!1;let k=g.vectorStoreProvider,v="";if(k==="openai"?v="aipkit_upload_and_add_file_to_store_direct_openai":k==="pinecone"?v="aipkit_upload_file_and_upsert_to_pinecone":k==="qdrant"&&(v="aipkit_upload_file_and_upsert_to_qdrant"),!v)return!1;let w=s(k==="openai"?"aipkit_vector_store_nonce_openai":k==="pinecone"?"aipkit_vector_store_pinecone_nonce_management":"aipkit_vector_store_qdrant_nonce_management")?.value||"";a("Uploading files...","info"),_.uploading=!0,_.cancelled=!1,_.totals.size=_.files.reduce((b,I)=>b+(I?.size||0),0),_.totals.loaded=0;for(let b=0;b<_.files.length;b++){let I=_.files[b];if(_.cancelled)break;let q=i(I,k);if(q.length){p(b,"error"),q.forEach(A=>a(A,"warning")),d(b,100),_.totals.loaded+=I.size,_.totals.loaded/Math.max(1,_.totals.size)*100;continue}p(b,"processing");let C=h(g,w),F=k==="openai"?"aipkit_vs_global_file_to_submit":"file_to_upload";C.append("action",v),C.append(F,I);try{let A=await m(window.aipkit_dashboard.ajaxurl,C,L=>{d(b,L)});d(b,100),p(b,"completed"),a(A?.message||`${I.name} uploaded`,"success"),_.totals.loaded+=I.size,_.totals.loaded/Math.max(1,_.totals.size)*100}catch(A){if(_.cancelled){a("Upload cancelled.","warning"),p(b,"error");break}p(b,"error"),a(A.message||`Failed to upload ${I.name}`,"error"),_.totals.loaded+=I.size,_.totals.loaded/Math.max(1,_.totals.size)*100}}return _.uploading=!1,_.files=[],o(),!0}function E(){let g=s("aipkit_vs_global_file_to_submit");g&&(g.dataset.queueBound||(g.addEventListener("change",()=>{if(!g.files||!g.files.length){_.files=[],o();return}let k=document.getElementById("aipkit_vs_global_provider_select")?.value||"openai",v=Array.from(g.files),x=l(),S=c(k),w=[],b=0;v.forEach(I=>{let q=i(I,k);q.length?(b++,q.forEach(C=>a(C,"warning"))):w.push(I)}),_.files=w,o(),b>0&&a(`Some files were skipped. Allowed types: ${x.join(", ")}. Max per file: ${t(S)}.`,"info")}),g.dataset.queueBound="1"))}function T(){n()&&(E(),o())}window.aipkit_initUploadQueue=T,window.aipkit_runUploadQueue=y})();(function(){"use strict";function _(s){return document.getElementById(s)}function n(){let s=_("aipkit_vs_global_dropzone"),o=_("aipkit_vs_global_file_to_submit"),r=typeof window.aipkit_initUploadQueue=="function";if(!s||!o||s.dataset.ddBound)return;function a(e){s.style.background=e?"#f6f7f7":"#fff",s.style.borderColor=e?"#2271b1":"#c3c4c7"}s.addEventListener("click",()=>o.click()),s.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),o.click())}),s.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),a(!0)}),s.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),a(!1)}),s.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),a(!1);let l=e.dataTransfer?.files;if(!l||!l.length)return;try{let i=new DataTransfer;Array.from(l).forEach(t=>i.items.add(t)),o.files=i.files}catch{}let c=new Event("change",{bubbles:!0});o.dispatchEvent(c),r&&window.aipkit_initUploadQueue()}),s.dataset.ddBound="1"}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n(),window.aipkit_initUploadDragDrop=n})();})();
