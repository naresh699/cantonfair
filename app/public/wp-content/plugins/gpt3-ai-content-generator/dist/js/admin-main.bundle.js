(()=>{(function(){"use strict";function k(n,t){if(!n)return;let a=n.querySelector(".aipkit_btn-text");if(a){a.textContent=t;return}let s=n.querySelector(".aipkit_spinner"),l=Array.from(n.childNodes).find(c=>c.nodeType===Node.TEXT_NODE);l?l.textContent=t+(s?" ":""):n.insertBefore(document.createTextNode(t+(s?" ":"")),n.firstChild),s&&n.appendChild(s)}function r(n,t,a,s=4e3){if(!n)return;let l=n.dataset.baseClass||"aipkit_form-help";n.dataset.baseClass||(n.dataset.baseClass=l),n.messageTimeoutId&&(clearTimeout(n.messageTimeoutId),n.messageTimeoutId=null),n.textContent=a,n.className=l,n.classList.add(`aipkit_form-help-${t}`),n.style.opacity="1",n.style.display="block",n.messageTimeoutId=setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{n.textContent===a&&(n.textContent="",n.className=l,n.style.display="",n.messageTimeoutId=null)},300)},s)}window.aipkit_setButtonText=k,window.aipkit_showTemporaryMessage=r})();(function(){"use strict";function k(n){return n===null||typeof n>"u"?"":String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function r(n){return k(n)}window.aipkit_escapeHtml=k,window.aipkit_escapeAttribute=r})();(function(){"use strict";function k(n){let t=document.createElement("div");if(t.textContent="Copied!",Object.assign(t.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(t),n){let{top:a,left:s,width:l}=n.getBoundingClientRect(),c=a+window.scrollY+2,o=s+window.scrollX+l+5;t.style.top=`${c}px`,t.style.left=`${o}px`;let e=t.getBoundingClientRect(),i=8,d=window.innerWidth-i;if(e.right>d){let u=s+window.scrollX-e.width-5,p=Math.max(window.scrollX+i,u);t.style.left=`${p}px`}}else t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{t.style.opacity="1",t.style.transform="translateY(0)"}),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(-5px)",t.addEventListener("transitionend",()=>t.remove(),{once:!0}),setTimeout(()=>{t.parentNode&&t.remove()},500)},1e3)}async function r(n,t){if(n)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(n),k(t);return}throw new Error("Clipboard API not available")}catch(a){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",a);try{let s=document.createElement("textarea");s.value=n,s.style.position="fixed",s.style.top="-9999px",s.style.left="-9999px",s.style.opacity="0",s.setAttribute("readonly",""),document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999);let l=document.execCommand("copy");if(document.body.removeChild(s),l)k(t);else throw new Error('document.execCommand("copy") failed.')}catch(s){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",s),window.prompt("Please copy the shortcode manually:",n)}}}window.aipkit_copyShortcode=r})();(function(){"use strict";function k(a){let s=Number(a);if(!s||isNaN(s))return"";try{let l=new Date(s*1e3);if(isNaN(l.getTime()))return"";let c=String(l.getHours()).padStart(2,"0"),o=String(l.getMinutes()).padStart(2,"0"),e=String(l.getSeconds()).padStart(2,"0");return`${c}:${o}:${e}`}catch(l){return console.error("Error formatting timestamp:",a,l),""}}function r(a){if(!a)return"";try{let s=new Date(a.replace(" ","T")+"Z");if(isNaN(s.getTime()))return"";let l=new Date,c=(s.getTime()-l.getTime())/1e3;if(c<0)return"In the past";if(c<60)return"in less than a minute";if(c<3600){let d=Math.round(c/60);return`in ${d} minute${d!==1?"s":""}`}let o=new Date(l.getFullYear(),l.getMonth(),l.getDate()),e=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1),i=new Date(s.getFullYear(),s.getMonth(),s.getDate());return i.getTime()===o.getTime()?`Today at ${s.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:i.getTime()===e.getTime()?`Tomorrow at ${s.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${s.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(s){return console.error("Error formatting relative time:",a,s),a}}function n(a){if(!a)return"N/A";try{let s=new Date(a.replace(" ","T")+"Z");return isNaN(s.getTime())?"Invalid Date":s.toLocaleString()}catch(s){return console.error("Error formatting UTC date string:",a,s),a}}function t(a){if(!a)return"N/A";try{let s=new Date(a.replace(" ","T")+"Z");if(isNaN(s.getTime()))return"Invalid Date";let l=Math.floor((Date.now()-s.getTime())/1e3);if(Number.isNaN(l)||l<0)return s.toLocaleString();if(l<60)return"Just now";let c=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],o=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let e of c)if(l>=e.seconds){let i=Math.floor(l/e.seconds);return o?o.format(-i,e.unit):`${i} ${e.unit}${i!==1?"s":""} ago`}return s.toLocaleString()}catch(s){return console.error("Error formatting relative date string:",a,s),a}}window.aipkit_formatTimestamp=k,window.aipkit_formatFriendlyFutureDate=r,window.aipkit_formatUtcDateTime=n,window.aipkit_formatRelativeDateTime=t})();(function(){"use strict";function k(r){return!r||typeof r!="string"?"":r.charAt(0).toUpperCase()+r.slice(1)}window.aipkit_ucfirst=k,window.ucfirst=k})();(function(){"use strict";function k(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let r=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&r.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=r,r}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=k})();(function(){"use strict";function k(r,n="",t="",a={}){if(!r)return"N/A";let s=r.toLowerCase();if(s.includes("text content submitted for indexing"))return"Text";if(s.includes("file content submitted for indexing")||s.includes("file content embedded and upserted")||s.includes("original filename:"))return"File Upload";if(s.includes("wordpress post content submitted for indexing"))return"Site Content";if(t==="openai")return"N/A";if(t==="pinecone"&&s.includes("vectors upserted")){if(n.startsWith("wp_post_"))return"Site Content";if(n.startsWith("text_"))return"Text";if(n.includes("pinecone_file_")||n.includes("file_"))return"File Upload"}if(t==="qdrant"){if(s.includes("points upserted to qdrant"))return a.post_id||s.includes("post id:")?"Site Content":"Text";if(s.includes("wordpress post content submitted for indexing"))return"Site Content"}if(n&&t==="pinecone"){if(n.startsWith("wp_post_"))return"Site Content";if(n.startsWith("text_"))return"Text";if(n.includes("file_")||n.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=k})();(function(){"use strict";async function k(t){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",t)}async function r(t,a){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));t.set("action",a);try{let c=t.get("provider")||"openai",o=t.has("file_to_upload")?"file_to_upload":t.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,e=o?t.get(o):null;if(e&&typeof e.size=="number"){let i=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],d=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:i,u=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(u)||u<=0)&&(u=10*1024*1024),c==="openai"&&(u=Math.min(u,10*1024*1024));let p=[];if(e.size>u&&p.push(`File is too large (${n(e.size)}). Max allowed is ${n(u)}.`),e.type&&!d.map(f=>f.toLowerCase()).includes(String(e.type).toLowerCase())&&p.push(`Unsupported file type (${e.type}). Allowed: ${d.join(", ")}.`),p.length){let f=new Error(p.join(" "));throw f.code="client_validation_failed",f}}}catch(c){throw console.warn("[AIPKit] Client-side file validation failed",c),c}let s;try{let c=t.has("file_to_upload")?"file_to_upload":t.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(c)try{let o=t.get(c);o&&console.debug("[AIPKit] File upload request",{action:a,fileField:c,name:o.name,size_bytes:o.size,type:o.type})}catch{}s=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:t,credentials:"same-origin"})}catch(c){throw console.error("[AIPKit] Network error during file upload",{action:a,error:c}),c}let l;try{l=await s.json()}catch(c){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:a,status:s?.status,parseErr:c});let o=new Error(`Unexpected server response (status ${s?.status||"n/a"})`);throw o.status=s?.status,o}if(!s.ok||!l.success){let c=l?.data||{},o=new Error(c.message||`HTTP error! status: ${s.status}`);throw o.code=c.code,o.status=s.status,o.details=c.details||void 0,o.serverResponse=l,console.error("[AIPKit] File upload failed",{action:a,status:s.status,server:l}),o}return l.data}function n(t){if(!Number.isFinite(t))return`${t}`;let a=["B","KB","MB","GB"],s=0,l=t;for(;l>=1024&&s<a.length-1;)l/=1024,s++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:o=>o.toFixed(1)}).format(l)} ${a[s]}`}window.aipkit_api_upsertOpenAIText=k,window.aipkit_api_upsertFile=r})();(function(){"use strict";function k(r){let n=document.querySelector(r);if(!n)return;n.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(a=>{let s=a.id+"_value",l=null,c=a.closest(".aipkit_slider_wrapper");if(c&&(l=c.querySelector(".aipkit_slider_value")),!l)try{l=n.querySelector(`#${CSS.escape(s)}`)}catch{l=n.querySelector("#"+s)}if(l){let o=a.getAttribute("data-suffix")||(a.id.includes("confidence_threshold")?"%":"");l.textContent=a.value+o,a.hasAttribute("data-range-listener-attached")||(a.addEventListener("input",function(){l.textContent=this.value+o}),a.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=k})();(function(){"use strict";function k(r){let n=document.querySelector(r);if(!n)return;let t="data-apikey-toggle-listener-attached";n.getAttribute(t)||(n.addEventListener("click",function(a){let s=a.target.closest(".aipkit_api-key-toggle");if(!s)return;let l=s.closest(".aipkit_api-key-wrapper");if(!l)return;let c=l.querySelector(".aipkit_form-input"),o=s.querySelector(".dashicons");!c||!o||(c.type==="password"?(c.type="text",o.classList.remove("dashicons-visibility"),o.classList.add("dashicons-hidden")):(c.type="password",o.classList.remove("dashicons-hidden"),o.classList.add("dashicons-visibility")))}),n.setAttribute(t,"true"))}window.aipkit_initApiKeyToggles=k})();(function(){"use strict";function k(r,n,t="Submit",a="Processing..."){if(!r)return;let s=r.querySelector(".aipkit_btn-text")||r.querySelector(".aipkit_btn_text"),l=r.querySelector(".aipkit_spinner"),c=r.querySelector(".dashicons");if(n){if(r.disabled=!0,!r.dataset.originalText)if(s)r.dataset.originalText=s.textContent;else{let e="";r.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE&&(e+=i.textContent.trim())}),r.dataset.originalText=e.trim()}c&&(c.dataset.originalDisplay||(c.dataset.originalDisplay=c.style.display||"inline-block"),c.style.display="none");let o=t===""?"":r.dataset.loadingText||a;s?(r.dataset.originalText||(r.dataset.originalText=s.textContent),s.textContent=o):(!c||c.style.display==="none")&&o&&(Array.from(r.childNodes).forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),o&&r.insertBefore(document.createTextNode(o),r.firstChild)),l&&(l.style.display="inline-block")}else{r.disabled=!1;let o=t===""?"":r.dataset.originalText||t;c&&c.dataset.originalDisplay&&(c.style.display=c.dataset.originalDisplay,delete c.dataset.originalDisplay),s?s.textContent=o:t!==""&&(Array.from(r.childNodes).forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),o&&(c?c.insertAdjacentText("afterend"," "+o):r.insertBefore(document.createTextNode(o),r.firstChild))),l&&(l.style.display="none"),delete r.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=k})();(function(){"use strict";function k(r,n="info",t="aipkit_knowledge_base_global_status"){let a=document.getElementById(t);if(!a)return;a.messageTimeoutId&&clearTimeout(a.messageTimeoutId),a.messageTimeoutId=null;let s=r?String(r).trim():"";if(s===""){a.textContent="",a.className="aipkit_form-help",a.style.display="none",a.style.opacity="0",a.classList.remove("aipkit-active");return}let l=a.classList.contains("aipkit_settings_message-error"),c=n;l&&n!=="error"&&(c="error"),a.className="aipkit_form-help",c==="success"?a.classList.add("aipkit_settings_message-success"):c==="error"?a.classList.add("aipkit_settings_message-error"):a.classList.add("aipkit_settings_message-info"),c==="error"&&a.textContent||l&&n!=="error"&&a.textContent?a.textContent=a.textContent+`
`+s:a.textContent=s,a.style.display="block",a.style.opacity="1",a.classList.add("aipkit-active"),c!=="error"&&(a.messageTimeoutId=setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.textContent.includes(s)&&(a.textContent="",a.className="aipkit_form-help",a.style.display="none",a.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=k})();(function(){"use strict";async function k(a,s,l,c){let o=document.getElementById("aipkit_nonce"),e=o&&o.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:e,provider:a,store_id:s,batch_id:l,page:c,per_page:10})}function r({snippetText:a="",fileId:s="",provider:l="",batchId:c="",storeId:o=""}={}){let e=window.aipkit_escapeHtml||function(_){return _},i=document.createElement("div");i.className="aipkit-snippet-modal-overlay";let d=document.createElement("div");d.className="aipkit-snippet-modal-content";let u=l?`${l} Indexed Snippet`:"Indexed Snippet",p=s?` (${e(s)})`:"",f=!!c&&!!o&&!!l;d.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${u}${p}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${f?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${e(a)}</pre>
        `}
      </div>
    `,i.appendChild(d),document.body.appendChild(i);function m(){i.classList.remove("active"),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)}d.querySelector(".aipkit-snippet-modal-close").addEventListener("click",m),i.addEventListener("click",_=>{_.target===i&&m()});function g(_){_.key==="Escape"&&(m(),document.removeEventListener("keydown",g))}if(document.addEventListener("keydown",g),requestAnimationFrame(()=>{i.classList.add("active")}),f){let _=d.querySelector(".aipkit-chunks-list"),w=d.querySelector(".aipkit-chunks-page-info"),h=d.querySelector(".aipkit-chunks-prev"),E=d.querySelector(".aipkit-chunks-next"),x=1,v=1,I=b=>{if(!b||!b.length){_.innerHTML="<p>No chunks found.</p>";return}_.innerHTML=b.map(y=>{let S=y.indexed_content||"",C=y.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${e(C)}</div>
            <pre class="aipkit-chunk-text">${e(S)}</pre>
          </div>`}).join("")};async function P(b){_.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let y=await k(l,o,c,b);I(y.chunks||[]),x=y.pagination?.current_page||b,v=y.pagination?.total_pages||1,w.textContent=`Page ${x} / ${v}`,h.disabled=x<=1,E.disabled=x>=v}catch(y){_.innerHTML=`<p class="aipkit_text-danger">${y&&y.message||"Failed to load chunks."}</p>`}}h.addEventListener("click",()=>{x>1&&P(x-1)}),E.addEventListener("click",()=>{x<v&&P(x+1)}),P(1)}}function n(a,s,l=""){return r({snippetText:a,fileId:s,provider:l})}function t(a,s=""){a&&a.querySelectorAll(".aipkit_view_snippet_icon").forEach(l=>{let c=l.cloneNode(!0);l.parentNode.replaceChild(c,l),c.addEventListener("click",o=>{o.preventDefault();let e=c.dataset.snippet,i=c.dataset.fileId,d=c.dataset.batchId||"",u=c.dataset.storeId||"";r({snippetText:e,fileId:i,provider:s,batchId:d,storeId:u})})})}window.aipkit_showSnippetModal=n,window.aipkit_showSnippetModalEnhanced=r,window.aipkit_attachSnippetModalListeners=t})();(function(){"use strict";function k(r,n,t){if(!r||!n||typeof t!="function"){n&&(n.innerHTML="");return}n.innerHTML="";let{total_logs:a,total_pages:s,current_page:l}=r,c=parseInt(l,10);if(!a||a<=0||!s||s<=1)return;let o=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,e=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,g,_)=>_>1?g:m,i=document.createElement("span");i.className="aipkit_pagination-count",i.textContent=`${a.toLocaleString()} ${e("item","items",a)}`,n.appendChild(i);let d=document.createElement("span");d.className="aipkit_pagination-links";let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML="&laquo; "+o("Previous","gpt3-ai-content-generator"),u.disabled=c<=1,u.disabled||u.addEventListener("click",m=>{m.preventDefault(),t(c-1)}),d.appendChild(u);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${o("Page","gpt3-ai-content-generator")} ${c} ${o("of","gpt3-ai-content-generator")} ${s}`,d.appendChild(p);let f=document.createElement("button");f.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",f.innerHTML=o("Next","gpt3-ai-content-generator")+" &raquo;",f.disabled=c>=s,f.disabled||f.addEventListener("click",m=>{m.preventDefault(),t(c+1)}),d.appendChild(f),n.appendChild(d)}window.aipkit_renderLogsPagination=k})();(function(){"use strict";function k(r){let n=document.querySelector(r);if(!n)return;let t="data-restore-icon-listener-attached";n.getAttribute(t)||(n.addEventListener("click",function(a){let s=a.target.closest(".aipkit_restore-default-icon");if(!s)return;let l=s.getAttribute("data-target-input"),c=s.getAttribute("data-default-value");if(!l||c===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",s);return}let o=document.getElementById(l);if(o){if(o.value!==c){o.value=c;let i=new Event("change",{bubbles:!0,cancelable:!0}),d=new Event("blur",{bubbles:!0,cancelable:!0});if(o.dispatchEvent(i),o.dispatchEvent(d),o.type==="range"){let u=document.getElementById(`${l}_value`);u&&(u.textContent=c)}}}else console.warn(`AIPKit Restore Default: Target input element #${l} not found.`)}),n.setAttribute(t,"true"))}window.aipkit_initRestoreDefaultIcons=k})();(function(){"use strict";let k="aipkit_settings_global_messages",r=new Set(["aipkit_settings_messages","aipkit_settings_others_messages"]),n=new Set([k,"aipkit_settings_messages","aipkit_settings_others_messages"]);function t(o){return o?r.has(o)&&document.getElementById(k)?k:o:""}function a(o){!o||!o.parentNode||o.classList.contains("aipkit_message_fadeout")||(o.classList.add("aipkit_message_fadeout"),o.addEventListener("animationend",()=>{o.parentNode&&o.parentNode.removeChild(o)},{once:!0}),setTimeout(()=>{o&&o.parentNode&&o.parentNode.removeChild(o)},500))}function s(o,e,i){let d=t(o),u=document.getElementById(d);if(!u){console.error(`AIPKit Message Handler: Container #${d} not found.`);return}let p=n.has(d);u.querySelectorAll(".aipkit_settings_message").forEach(w=>{w.dataset.timerId&&clearTimeout(parseInt(w.dataset.timerId,10)),w.remove()});let m=u.querySelector(".aipkit_saving-indicator");m&&m.remove();let g=document.createElement("div");if(g.className=`aipkit_settings_message aipkit_settings_message-${e}`,p)g.textContent=i;else{let w=e==="success"?"dashicons-yes-alt":e==="error"?"dashicons-warning":"dashicons-info-alt",h=document.createElement("span");h.className=`dashicons ${w}`,h.style.marginRight="5px",g.appendChild(h),g.appendChild(document.createTextNode(` ${i}`));let E=document.createElement("span");E.className="dashicons dashicons-dismiss aipkit_settings_message-close",E.setAttribute("aria-label","Dismiss message"),E.title="Dismiss message",g.appendChild(E)}if(u.appendChild(g),p){if(e!=="error"){let w=setTimeout(()=>{g&&g.parentNode&&g.parentNode.removeChild(g)},3e3);g.dataset.timerId=w}return}let _=setTimeout(()=>{a(g)},5e3);g.dataset.timerId=_}function l(o){let e=t(o);if(n.has(e))return;let i=document.getElementById(e);if(!i){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let d=`data-close-listener-${e}`;i.getAttribute(d)!=="true"&&(i.addEventListener("click",function(u){let p=u.target.closest(".aipkit_settings_message-close");if(p){let f=p.closest(".aipkit_settings_message");f&&(f.dataset.timerId&&clearTimeout(parseInt(f.dataset.timerId,10)),a(f))}}),i.setAttribute(d,"true"))}function c(o){let e=t(o),i=document.getElementById(e);if(i){let d=i.querySelector(".aipkit_saving-indicator");d&&d.remove(),i.querySelectorAll(".aipkit_settings_message").forEach(p=>{p.dataset.timerId&&clearTimeout(parseInt(p.dataset.timerId,10)),p.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=s,window.aipkit_initMessageCloseButtons=l,window.aipkit_clearStatusMessages=c})();(function(){"use strict";function k(t,a){let s=document.getElementById(t);if(!s){console.error(`AIPKit Saving Indicator: Container #${t} not found.`);return}let l=s.querySelector(".aipkit_saving-indicator");if(a)if(!l)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(t):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),l=document.createElement("span"),l.className="aipkit_saving-indicator",l.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',s.appendChild(l),requestAnimationFrame(()=>{let c=s.querySelector(".aipkit_saving-indicator");c&&c.classList.add("aipkit_active")});else{l.style.display="inline-flex",l.classList.add("aipkit_active");let c=l.querySelector(".aipkit_spinner");c&&(c.style.display="inline-block")}else l&&(l.classList.remove("aipkit_active"),setTimeout(()=>{l&&l.parentNode&&l.remove()},200))}function r(t){n(t);let a=document.createElement("span");a.className="aipkit-title-spinner aipkit_spinner",a.style.display="inline-block",t.parentNode.insertBefore(a,t.nextSibling)}function n(t){let a=t.parentNode.querySelector(".aipkit-title-spinner");a&&a.remove()}window.aipkit_showSavingIndicator=k,window.aipkit_showLinkSpinner=r,window.aipkit_hideLinkSpinner=n})();(function(){"use strict";function k(t){let a=t.textContent;t.textContent="Copied!",t.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{t&&t.classList.contains("aipkit-placeholder--copied")&&(t.textContent=a,t.classList.remove("aipkit-placeholder--copied"))},1500)}function r(t){let a=t.target;if(!a.matches(".aipkit-placeholder"))return;t.preventDefault(),t.stopPropagation();let s=a.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(s).then(()=>{k(a)}).catch(l=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",l)})}function n(){let t=document.body;if(t){let a="data-placeholder-copy-listener-attached";t.getAttribute(a)||(t.addEventListener("click",r),t.setAttribute(a,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",n)})();(function(){"use strict";let k="select[data-aipkit-provider-notice-target]",r="a[data-aipkit-load-module]";function n(){let g=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return g&&typeof g=="object"?g:{}}function t(g){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=g}function a(g){return g?String(g).trim().toLowerCase():""}function s(g,_){return!g||!_||!Object.prototype.hasOwnProperty.call(_,g)?null:!!_[g]}function l(g,_){if(!g)return"";let w=_?g.getAttribute(`data-message-${_}`):"";return w||g.getAttribute("data-message-default")||""}function c(g){g&&g.classList.add("aipkit_provider_notice--hidden")}function o(g){g&&g.classList.remove("aipkit_provider_notice--hidden")}function e(g,_){if(!g)return;let w=g.getAttribute("data-aipkit-provider-notice-target");if(!w)return;let h=document.getElementById(w);if(!h)return;if(g.getAttribute("data-aipkit-provider-notice-defer")==="1"&&g.dataset.aipkitProviderNoticeArmed!=="true"){c(h);return}let x=a(g.value);if(!x){c(h);return}let v=s(x,_);if(v===null){c(h);return}if(v){c(h);return}let I=h.querySelector(".aipkit_provider_notice_message");I&&(I.textContent=l(h,x)),o(h)}function i(g){return g?g.offsetParent!==null?!0:g.getClientRects().length>0:!1}function d(g){let _=n(),w=g||document,h=Array.from(w.querySelectorAll(k)),E=new Map;h.forEach(x=>{let v=x.getAttribute("data-aipkit-provider-notice-target");v&&(E.has(v)||E.set(v,[]),E.get(v).push(x))}),E.forEach(x=>{let v=x.find(i)||x[0];v&&e(v,_)})}function u(){let g={...n()},_=!1,w=W=>{let H=document.getElementById(W);if(H)return _=!0,String(H.value||"").trim()},h=w("aipkit_openai_api_key");h!==void 0&&(g.openai=h!=="");let E=w("aipkit_openrouter_api_key");E!==void 0&&(g.openrouter=E!=="");let x=w("aipkit_google_api_key");x!==void 0&&(g.google=x!=="");let v=w("aipkit_azure_api_key"),I=w("aipkit_azure_endpoint");(v!==void 0||I!==void 0)&&(g.azure=(v||"")!==""&&(I||"")!=="");let P=w("aipkit_claude_api_key");P!==void 0&&(g.claude=P!=="");let b=w("aipkit_deepseek_api_key");b!==void 0&&(g.deepseek=b!=="");let y=w("aipkit_ollama_base_url");y!==void 0&&(g.ollama=y!=="");let S=w("aipkit_replicate_api_key"),C=w("aipkit_task_cw_replicate_api_key");(S!==void 0||C!==void 0)&&(g.replicate=(S||"")!==""||(C||"")!=="");let A=w("aipkit_pinecone_api_key");A!==void 0&&(g.pinecone=A!=="");let M=w("aipkit_qdrant_api_key"),$=w("aipkit_qdrant_url");return(M!==void 0||$!==void 0)&&(g.qdrant=(M||"")!==""&&($||"")!==""),_?(t(g),!0):!1}function p(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_claude_api_key","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(_=>{let w=document.getElementById(_);if(!w||w.dataset.aipkitProviderStatusBound==="true")return;let h=()=>{u()&&d(document)};w.addEventListener("input",h),w.addEventListener("change",h),w.dataset.aipkitProviderStatusBound="true"})}function f(g){(g||document).querySelectorAll(r).forEach(h=>{h.dataset.aipkitProviderNoticeLinkBound!=="true"&&(h.addEventListener("click",E=>{let x=h.getAttribute("data-aipkit-load-module");!x||typeof window.aipkit_loadModule!="function"||(E.preventDefault(),window.aipkit_loadModule(x))}),h.dataset.aipkitProviderNoticeLinkBound="true")})}function m(g){let _=g||document;_.querySelectorAll(k).forEach(h=>{h.dataset.aipkitProviderNoticeBound!=="true"&&(h.addEventListener("change",()=>{h.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(h.dataset.aipkitProviderNoticeArmed="true"),e(h,n())}),h.dataset.aipkitProviderNoticeBound="true")}),u(),d(_),p(),f(_)}window.aipkit_initProviderKeyNotices=m,document.addEventListener("DOMContentLoaded",function(){m(document)})})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelectorAll("[data-aipkit-popover-target]");if(!n.length)return;let t=null,a=null,s=!1,l=d=>d?r.querySelector(`#${d}`):null,c=(d,u)=>{if(!d||!u)return;let p=d.getBoundingClientRect(),f=u.getBoundingClientRect(),m=f.width||400,g=f.height||0,_=window.innerWidth,w=window.innerHeight,h=12;if(d.dataset.aipkitPopoverPlacement==="bottom"){let v=p.left;v+m>_-h&&(v=p.right-m),v=Math.max(h,Math.min(v,_-m-h));let I=p.bottom+8;I+g>w-h&&(I=p.top-g-8),I=Math.max(h,Math.min(I,w-g-h)),u.style.left=`${Math.round(v)}px`,u.style.top=`${Math.round(I)}px`;return}if(d.dataset.aipkitPopoverPlacement==="left"){let v=p.left-m-10;v<h&&(v=p.right+10),v=Math.max(h,Math.min(v,_-m-h));let I=p.top;I+g>w-h&&(I=w-g-h),I=Math.max(h,I),u.style.left=`${Math.round(v)}px`,u.style.top=`${Math.round(I)}px`;return}let E=p.right+10;E+m>_-h&&(E=p.right-m-10),E=Math.max(h,Math.min(E,_-m-h));let x=p.top;x+g>w-h&&(x=w-g-h),x=Math.max(h,x),u.style.left=`${Math.round(E)}px`,u.style.top=`${Math.round(x)}px`},o=()=>{!a||!t||s||(s=!0,window.requestAnimationFrame(()=>{let d=t.querySelector(".aipkit_model_settings_popover_panel");c(a,d),s=!1}))},e=()=>{if(!t)return;let d=t.id;t.classList.remove("aipkit-active"),t.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),d==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),t=null,a=null},i=d=>{if(!d)return;let u=d.getAttribute("data-aipkit-popover-target"),p=l(u);if(!p)return;t&&t!==p&&e(),t=p,a=d,p.classList.add("aipkit-active"),p.setAttribute("aria-hidden","false"),d.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${u}`);let f=p.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{c(d,f)})};n.forEach(d=>{d.dataset.popoverListenerAttached!=="true"&&(d.addEventListener("click",u=>{if(u.preventDefault(),!(d.dataset.aipkitPopoverKeepOpen==="true")&&t&&a===d&&t.classList.contains("aipkit-active")){e();return}i(d)}),d.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover").forEach(d=>{d.dataset.overlayListenerAttached!=="true"&&(d.addEventListener("click",p=>{p.target===d&&e()}),d.dataset.overlayListenerAttached="true");let u=d.querySelector(".aipkit_model_settings_popover_close");u&&u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",p=>{p.preventDefault(),e()}),u.dataset.popoverListenerAttached="true"),d.querySelectorAll("[data-aipkit-popover-close]").forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.preventDefault(),e()}),p.dataset.popoverListenerAttached="true")})}),r.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",d=>{d.key==="Escape"&&t&&e()}),r.dataset.escapeListenerAttached="true"),r.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",o),window.addEventListener("scroll",o,!0),r.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=k})();(function(){"use strict";let k=a=>{if(!a)return null;let s=a.querySelector("#aipkit_enhancer_editor_integration"),l=a.querySelector("#aipkit_enhancer_list_button"),c=a.querySelector('input[name="enhancer_insert_position_default"]:checked');return!s||!l||!c?null:{enhancer_editor_integration:s.checked?"1":"0",enhancer_list_button:l.checked?"1":"0",enhancer_insert_position_default:c.value||"replace"}},r=a=>a?JSON.stringify(a):"",n=async a=>{if(!a||typeof window.aipkit_apiRequest!="function")return;let s=k(a);if(!s)return;let l=a.dataset.assistantAutosaveBaseline||"",c=r(s);if(!c||c===l||a.dataset.assistantAutosaveBusy==="true")return;let o=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,e=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,i=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;a.dataset.assistantAutosaveBusy="true",o&&o("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",s),a.dataset.assistantAutosaveBaseline=c,e&&e("Updated")}catch(d){i&&i(`Error: ${d.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",d)}finally{a.dataset.assistantAutosaveBusy="false"}};function t(a){let s=a||document.getElementById("aipkit_content_writer_container"),l=document.getElementById("aipkit_cw_builder_sheet");if(!s||!l)return;let c=l.querySelector(".aipkit_builder_sheet_title"),o=l.querySelector(".aipkit_builder_sheet_description"),e=l.querySelectorAll(".aipkit_builder_sheet_section"),i=l.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),d=l.querySelector(".aipkit_builder_sheet_close"),u=f=>{if(!f)return;let m=f.getAttribute("data-sheet-title")||"Sheet",g=f.getAttribute("data-sheet-description")||"",_=f.getAttribute("data-sheet-content")||"placeholder";c&&(c.textContent=m),o&&(o.textContent=g);let w=!1;if(e.forEach(h=>{h.dataset.sheet===_?(h.hidden=!1,w=!0):h.hidden=!0}),!w&&i&&(i.hidden=!1),l.classList.add("aipkit-active"),l.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),_==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!l.dataset.assistantAutosaveBound)){let h=k(l);l.dataset.assistantAutosaveBaseline=r(h),l.addEventListener("change",E=>{let x=E.target;!x||!x.matches("#aipkit_enhancer_editor_integration")&&!x.matches("#aipkit_enhancer_list_button")&&!x.matches('input[name="enhancer_insert_position_default"]')||n(l)}),l.dataset.assistantAutosaveBound="true"}d&&d.focus()},p=()=>{l.classList.remove("aipkit-active"),l.setAttribute("aria-hidden","true")};s.dataset.assistantSheetBound||(s.addEventListener("click",f=>{let m=f.target.closest(".aipkit_builder_sheet_trigger");m&&(f.preventDefault(),u(m))}),s.dataset.assistantSheetBound="true"),d&&d.dataset.assistantSheetBound!=="true"&&(d.addEventListener("click",p),d.dataset.assistantSheetBound="true"),l.dataset.assistantSheetBound||(l.addEventListener("click",f=>{f.target===l&&p()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&l.classList.contains("aipkit-active")&&p()}),l.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=t})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],r=e=>{let i=k.findIndex(d=>d.key===e);return i===-1?1:i},n=(e,i)=>{let d=Number(e);if(!d||Number.isNaN(d))return"medium";let u="medium",p=1/0;return Object.keys(i).forEach(f=>{let m=Math.abs(d-i[f]);m<p&&(p=m,u=f)}),u},t=(e,i)=>{if(!e)return;let d=e.querySelector(".aipkit_ai_behavior_value"),u=e.querySelector(".aipkit_ai_behavior_hint"),p=e.querySelector(".aipkit_ai_length_slider"),f=k[r(i)];d&&(d.textContent=f.label),u&&(u.textContent=`Approx. ${f.words} words`),p&&(p.value=String(r(i)+1))},a=e=>{let i=e.querySelector(".aipkit_ai_temperature_control");if(!i)return;let d=i.querySelector(".aipkit_ai_temperature_slider"),u=i.querySelector(".aipkit_ai_behavior_value");if(!d||!u||d.dataset.enhancedListenerAttached==="true")return;let p=()=>{u.textContent=d.value};d.addEventListener("input",p),p(),d.dataset.enhancedListenerAttached="true"},s=e=>{let i=e.querySelectorAll(".aipkit_ai_reasoning_input"),d=e.querySelector("[data-aipkit-reasoning-select]");if(!i.length||!d||d.dataset.reasoningSyncAttached==="true")return;let u=f=>f==="minimal"?"low":f,p=f=>{let m=u(f);e.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>_.classList.remove("aipkit_ai_reasoning_option--selected"));let g=e.querySelector(`.aipkit_ai_reasoning_input[value="${m}"]`);if(g){g.checked=!0;let _=g.closest(".aipkit_ai_reasoning_option");_&&_.classList.add("aipkit_ai_reasoning_option--selected")}};i.forEach(f=>{f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",()=>{f.checked&&(d.value=u(f.value),d.dispatchEvent(new Event("change",{bubbles:!0})),p(f.value))}),f.dataset.reasoningListenerAttached="true")}),d.addEventListener("change",()=>{p(d.value||"medium")}),p(d.value||"medium"),d.dataset.reasoningSyncAttached="true"},l=e=>{let i=e.querySelector(".aipkit_ai_length_control");if(!i)return;let d=i.querySelector(".aipkit_ai_length_slider"),u=i.querySelector("[data-aipkit-length-input]");if(!d||!u||d.dataset.lengthListenerAttached==="true")return;let p=i.dataset.aipkitLengthMode||"content_length",f={short:Number(i.dataset.aipkitLengthShort||2e3),medium:Number(i.dataset.aipkitLengthMedium||4e3),long:Number(i.dataset.aipkitLengthLong||6e3)},m=(_,w)=>{let h=k.some(E=>E.key===_)?_:"medium";if(t(i,h),p==="content_length")u.value!==h&&(u.value=h);else{let E=f[h]||f.medium;Number(u.value)!==E&&(u.value=String(E))}w&&u.dispatchEvent(new Event("change",{bubbles:!0}))},g=()=>{if(p==="content_length"){m(u.value||"medium",!1);return}let _=n(u.value,f);m(_,!1)};d.addEventListener("input",()=>{let _=Math.max(1,Math.min(3,Number(d.value||2)))-1,w=k[_]?.key||"medium";m(w,!0)}),u.addEventListener("change",g),g(),d.dataset.lengthListenerAttached="true"},c=e=>{!e||e.dataset.aiSettingsInit==="true"||(a(e),l(e),s(e),e.dataset.aiSettingsInit="true")};function o(e){let i=e||document.getElementById("aipkit_autogpt_container");i&&i.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>o()):o(),window.aipkit_initAutogptAiSettingsRedesigned=o})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function k(n){if(typeof n!="string"||!n)return[];let t=new Set;return n==="aipkit_save_ai_settings"&&["settings","dashboard-home","chatbot","sources","content-writer","autogpt","ai-forms","image-generator"].forEach(a=>t.add(a)),(n==="aipkit_save_chatbot_settings"||/^aipkit_update_chatbot_/.test(n)||/^aipkit_(create|delete|duplicate|reset|rename)_chatbot$/.test(n))&&(t.add("chatbot"),t.add("dashboard-home")),/^aipkit_(save|duplicate|delete|delete_all)_ai_forms?$/.test(n)&&(t.add("ai-forms"),t.add("dashboard-home")),(/^aipkit_(save|delete)_automated_task$/.test(n)||/^aipkit_update_automated_task_/.test(n))&&(t.add("autogpt"),t.add("dashboard-home")),(/^aipkit_(save|delete)_cw_template$/.test(n)||n==="aipkit_reset_cw_starter_templates")&&(t.add("content-writer"),t.add("dashboard-home")),Array.from(t)}function r(n,t={},a={}){return new Promise((s,l)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return l(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let c=new FormData;c.append("action",n),!Object.prototype.hasOwnProperty.call(t,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&c.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Array.isArray(t[i])?t[i].forEach(d=>{c.append(i+"[]",d)}):c.append(i,t[i]));let o=new AbortController,e=setTimeout(()=>{o.abort()},a.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:c,credentials:"same-origin",signal:o.signal}).then(i=>(clearTimeout(e),i.json())).then(i=>{if(i.success)typeof window.aipkit_invalidateModuleCache=="function"&&k(n).forEach(u=>{window.aipkit_invalidateModuleCache(u)}),s(i.data);else{let d=i.data||{},u=d.message||"Unknown error",p=new Error(u);d.debug_error&&(p.debug=d.debug_error),p.data=d,d.code&&(p.code=d.code),d.details&&(p.details=d.details),l(p)}}).catch(i=>{clearTimeout(e),i.name==="AbortError"?l(new Error("Request timeout")):l(i)})})}window.aipkit_apiRequest=r})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_modulesMenu");if(r){let t=r.querySelector(".aipkit_dropdown-panel"),a=r.querySelector(".aipkit_menu-trigger");a&&a.addEventListener("click",function(s){s.stopPropagation(),r.classList.toggle("aipkit_show-menu")}),t&&t.addEventListener("click",function(s){s.stopPropagation()})}document.addEventListener("click",function(t){r&&r.classList.contains("aipkit_show-menu")&&(r.contains(t.target)||r.classList.remove("aipkit_show-menu"))});let n=document.getElementById("aipkit_modulesMenuMobile");if(n){n.addEventListener("click",function(a){a.stopPropagation(),n.classList.toggle("aipkit_show-menu")});let t=n.querySelector(".aipkit_dropdown-menu");t&&t.addEventListener("click",function(a){a.stopPropagation()})}}window.aipkit_initSettingsMenus=k})();(function(){"use strict";function k(){let t=document.getElementById("aipkit_upgradeBtn"),a=document.getElementById("aipkit_upgradeModal");!t||!a||(t.addEventListener("click",function(s){s.preventDefault(),r(a)}),a.querySelectorAll("[data-close-modal]").forEach(function(s){s.addEventListener("click",function(l){l.preventDefault(),n(a)})}),document.addEventListener("keydown",function(s){s.key==="Escape"&&a.classList.contains("aipkit_active")&&n(a)}),a.querySelector(".aipkit_modal").addEventListener("click",function(s){s.stopPropagation()}))}function r(t){t.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let a=t.querySelector('button, a, [tabindex]:not([tabindex="-1"])');a&&setTimeout(()=>a.focus(),100)}function n(t){t.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initUpgradeModal=k})();(function(){"use strict";let t=new Map,a=new Map,s=new Map,l=!1,c={"dashboard-home":"aipkit_initDashboardHome",settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"},o=".aipkit_chatbot_builder_left",e="aipkit_last_module",i=(v,I)=>{if(!v)return;let P=I==="settings";v.classList.toggle("aipkit_module-container--settings-active",P);let b=v.closest(".aipkit_wrap");b&&b.classList.toggle("aipkit_wrap--settings-active",P)},d=(v,I={})=>{let P=Object.keys(I||{}).sort();if(!P.length)return`${v}::default`;let b={};return P.forEach(y=>{b[y]=I[y]}),`${v}::${JSON.stringify(b)}`},u=v=>s.get(v)||0,p=v=>{let I=u(v)+1;return s.set(v,I),I},f=v=>{if(!t.has(v))return null;let I=t.get(v);return!I||typeof I.html!="string"||Date.now()-(I.timestamp||0)>3e5?(t.delete(v),null):I},m=(v,I,P="",b=null)=>{!v||typeof I!="string"||P&&b!==null&&b!==u(P)||t.set(v,{html:I,timestamp:Date.now()})},g=v=>{if(l||typeof window.aipkit_apiRequest!="function")return;l=!0;let I=Array.from(document.querySelectorAll(".aipkit_module-link")).filter(y=>y&&y.offsetParent!==null).map(y=>String(y.getAttribute("data-module")||"").trim()).filter(y=>y&&y!==v);if(!I.length)return;let P=typeof window.requestIdleCallback=="function"?window.requestIdleCallback.bind(window):y=>setTimeout(y,400),b=(y=0)=>{if(y>=I.length)return;let S=I[y],C={module:S};if(S==="chatbot"){try{let H=localStorage.getItem("aipkit_last_selected_chatbot");H&&(C.force_active_bot_id=H)}catch{}try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(C.layout="next")}catch{}}let A={...C};delete A.module;let M=d(S,A),$=u(S);if(f(M)||a.has(M)){P(()=>b(y+1));return}let W=window.aipkit_apiRequest("aipkit_dashboard_load_module",C).then(H=>{H&&typeof H.html=="string"&&m(M,H.html,S,$)}).catch(()=>{}).finally(()=>{a.delete(M),P(()=>b(y+1))});a.set(M,W)};P(()=>b(0))},_=v=>{v&&(v.style.removeProperty("--aipkit-loader-left"),v.style.removeProperty("--aipkit-loader-top"))},w=(v,I)=>{if(_(v),!v||I!=="chatbot")return;let P=v.querySelector(o);if(!P)return;let b=v.getBoundingClientRect(),y=P.getBoundingClientRect();if(b.width<=0||b.height<=0||y.width<=0||y.height<=0)return;let S=y.left-b.left+y.width/2,C=y.top-b.top+y.height/2,A=Math.max(24,Math.min(b.width-24,S)),M=Math.max(24,Math.min(b.height-24,C));v.style.setProperty("--aipkit-loader-left",`${Math.round(A)}px`),v.style.setProperty("--aipkit-loader-top",`${Math.round(M)}px`)},h=v=>{if(!(!v||v==="dashboard-home"||v==="settings"))try{localStorage.setItem(e,v)}catch{}};async function E(v,I,P){let b={};typeof I=="function"?P=I:typeof I=="object"&&I!==null&&(b={...I});let y=b.aipkit_silent===!0;Object.prototype.hasOwnProperty.call(b,"aipkit_silent")&&delete b.aipkit_silent;let S=b.aipkit_force_refresh===!0;Object.prototype.hasOwnProperty.call(b,"aipkit_force_refresh")&&delete b.aipkit_force_refresh;let C=b.aipkit_bypass_leave_guard===!0;if(Object.prototype.hasOwnProperty.call(b,"aipkit_bypass_leave_guard")&&delete b.aipkit_bypass_leave_guard,!C&&typeof window.aipkit_beforeModuleChange=="function")try{if(await window.aipkit_beforeModuleChange(v)===!1)return typeof P=="function"&&P(new Error("Module switch cancelled.")),Promise.resolve()}catch(pe){return console.error("AIPKit Loader: Module leave guard failed.",pe),typeof P=="function"&&P(pe),Promise.reject(pe)}if(v==="chatbot"&&!b.force_active_bot_id&&!b.force_active_tab)try{let pe=localStorage.getItem("aipkit_last_selected_chatbot");pe&&(b.force_active_bot_id=pe)}catch(pe){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",pe)}if(v==="chatbot"&&!b.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(b.layout="next")}catch(pe){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",pe)}document.querySelectorAll(".aipkit_module-link").forEach(pe=>pe.classList.remove("aipkit_active"));let M=document.querySelector(`.aipkit_module-link[data-module="${v}"]`);M&&M.classList.add("aipkit_active");let $=document.getElementById("aipkit_module-container");if(!$)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof P=="function"&&P(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));i($,v);let W=$.innerHTML.trim()!=="",H=y||W,N=null,G=0,Q=()=>{let pe=$.offsetHeight||0,Ce=Math.round(window.innerHeight*.55),He=Math.max(pe,Ce,280);$.style.minHeight=`${He}px`},F=()=>{$.style.minHeight=""},L=()=>{requestAnimationFrame(()=>{$.classList.remove("aipkit_module-container--show-feedback"),$.classList.remove("aipkit_module-container--silent-loading"),F(),_($)})},O=()=>{if(!H)return;if(N&&(clearTimeout(N),N=null),!G){L();return}let Ce=220-(Date.now()-G);Ce>0?setTimeout(L,Ce):L()};if(H&&(w($,v),$.classList.add("aipkit_module-container--silent-loading"),Q(),N=setTimeout(()=>{N=null,G=Date.now(),$.classList.add("aipkit_module-container--show-feedback")},120)),!H){let pe=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",v):`Loading ${v}...`;$.innerHTML=`
                <div class="aipkit_container aipkit_loading-placeholder">
                    <div class="aipkit_container-body">
                        <p style="text-align: center; padding: 30px;">
                            <span class="aipkit_spinner"
                                style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                            </span>
                            ${pe}
                        </p>
                    </div>
                </div>
            `}if(typeof window.aipkit_apiRequest!="function"){let pe="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${v}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError($,v,pe),typeof P=="function"&&P(new Error(pe)),O(),Promise.reject(new Error(pe))}let D={module:v,...b},R=d(v,b),Z=u(v),J=pe=>{if(!pe||typeof pe.html!="string")throw new Error('Missing or invalid "html" in response data');$.innerHTML=pe.html,v==="chatbot"&&pe.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=pe.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let Ce=c[v];if(Ce&&typeof window[Ce]=="function")try{window[Ce]()}catch(He){let Ke=`Error initializing ${v} module scripts.`;throw new Error(`${Ke} (Details: ${He.message})`)}typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices($),h(v)};try{let pe=S?null:f(R);if(pe)return J({html:pe.html}),typeof P=="function"&&P(),O(),g(v),Promise.resolve();let Ce=await window.aipkit_apiRequest("aipkit_dashboard_load_module",D);return J(Ce),Ce&&typeof Ce.html=="string"&&m(R,Ce.html,v,Z),typeof P=="function"&&P(),O(),g(v),Promise.resolve()}catch(pe){return pe&&pe.debug?console.error(`AIPKit Loader: Module loading error for '${v}':`,pe.message,`
Server debug:`,pe.debug):console.error(`AIPKit Loader: Module loading error for '${v}':`,pe),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError($,v,pe.message),typeof P=="function"&&P(pe),O(),Promise.reject(pe)}}let x=v=>{if(!v)return;p(v);let I=`${v}::`;for(let P of Array.from(t.keys()))P.startsWith(I)&&t.delete(P)};window.aipkit_loadModule=E,window.aipkit_invalidateModuleCache=x})();(function(){"use strict";function k(r,n,t){if(!r)return;let a=window.aipkit_dashboard?.text||{},s=a.errorLoadingModuleTitle||"Error Loading Module",l=a.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",c=a.errorDetails||"Details:",o=l.replace("%s",n);r.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${s}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${o}</p>
                    <p><strong>${c}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${t||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_modulesMenu");if(!r)return;let n=r.querySelector(".aipkit_dropdown-panel");n&&(n.addEventListener("change",function(t){let a=t.target;if(a.matches&&a.matches(".aipkit_module-toggle")){let s=n.querySelectorAll(".aipkit_module-toggle");s.forEach(p=>p.disabled=!0),s.forEach(p=>p.disabled=!0);let l=a.getAttribute("data-module"),c=a.getAttribute("data-option-key"),o=a.getAttribute("data-icon"),e=a.getAttribute("data-label"),i=a.checked,d=document.querySelector(`.aipkit_module-link[data-module="${l}"]`);i?d?d.style.display="":console.log(`Module Toggle: Enabling '${l}'. Nav link will appear on refresh if needed.`):d&&(d.style.display="none");let u={moduleKey:c,enabled:i?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),a.checked=!i,d&&(d.style.display=i?"none":""),s.forEach(p=>p.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",u).then(()=>{console.log(`Module Toggle: '${l}' status updated successfully.`)}).catch(p=>{console.error("Error updating module setting:",p.message),alert(`Error updating module setting: ${p.message}`),a.checked=!i,d&&(d.style.display=i?"none":"")}).finally(()=>{s.forEach(p=>p.disabled=!1)})}}),n.addEventListener("click",function(t){let a=t.target.closest(".aipkit_module-item");if(a){let s=a.querySelector(".aipkit_toggle-switch");if(s&&!s.contains(t.target)){let l=a.querySelector(".aipkit_module-toggle");if(l&&!l.disabled){l.checked=!l.checked;let c=new Event("change",{bubbles:!0});l.dispatchEvent(c)}}}}))}window.aipkit_initModuleToggles=k})();(function(){"use strict";function k(){document.querySelectorAll(".aipkit_tabs").forEach(t=>{if(t.dataset.tabGroupListenerAttached==="true")return;let a=t.querySelectorAll(".aipkit_tab"),s=t.nextElementSibling;if(!s||!s.classList.contains("aipkit_tab_content_container")){let l=t.closest(".aipkit_container-body, .aipkit_container"),c=l?l.querySelector(".aipkit_tab_content_container"):null;if(!c)return;let o=c.querySelectorAll(".aipkit_tab-content");r(t,a,o)}else{let l=s.querySelectorAll(".aipkit_tab-content");r(t,a,l)}})}function r(n,t,a){t.forEach(s=>{s.addEventListener("click",function(){t.forEach(o=>o.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),a.forEach(o=>o.classList.remove("aipkit_active"));let l=this.getAttribute("data-tab"),c=Array.from(a).find(o=>o.id===l+"-content");c&&(c.classList.add("aipkit_active"),c.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),n.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=k})();(function(){"use strict";var k="aipkit_last_module";function r(_){return _?document.querySelector('.aipkit_module-tabs_list .aipkit_module-link[data-module="'+_+'"]'):null}function n(_,w){var h=r(_);if(h){if(w){h.hidden=!1,h.removeAttribute("aria-hidden"),h.removeAttribute("tabindex"),h.classList.remove("aipkit_module-tab--is-hidden");return}h.hidden=!0,h.setAttribute("aria-hidden","true"),h.setAttribute("tabindex","-1"),h.classList.add("aipkit_module-tab--is-hidden"),h.classList.remove("aipkit_active")}}function t(_){var w=r(_);return w?!w.hidden&&!w.classList.contains("aipkit_module-tab--is-hidden"):null}function a(_,w){if(!(w||!_||typeof window.aipkit_loadModule!="function")){var h=document.querySelector('.aipkit_module-link.aipkit_active[data-module="'+_+'"]');if(h){var E=r("dashboard-home");E&&!E.hidden&&window.aipkit_loadModule("dashboard-home")}}}function s(_,w,h,E){c(w,E),n(h,E),a(h,E),o(_)}function l(_){_.querySelectorAll(".aipkit_home_toggle_input").forEach(function(w){var h=w.getAttribute("data-module")||"",E=w.closest(".aipkit_home_module_row"),x=t(h);x===null&&(x=!!w.checked),w.checked!==x&&(w.checked=x),c(E,x)}),o(_)}function c(_,w){if(_){_.classList.toggle("is-disabled",!w);var h=_.getAttribute("data-module")||"",E=_.querySelector(".aipkit_home_module_main");E&&(w&&h?(E.setAttribute("data-aipkit-open-module",h),E.setAttribute("tabindex","0"),E.setAttribute("aria-disabled","false")):(E.removeAttribute("data-aipkit-open-module"),E.setAttribute("tabindex","-1"),E.setAttribute("aria-disabled","true")))}}function o(_){var w=_.querySelector("#aipkit_home_continue_btn");if(w){var h="";try{h=localStorage.getItem(k)||""}catch{h=""}if(!h){w.hidden=!0,w.removeAttribute("data-aipkit-open-module");return}var E=_.querySelector('.aipkit_home_module_row[data-module="'+h+'"]');if(!E||E.classList.contains("is-disabled")){w.hidden=!0,w.removeAttribute("data-aipkit-open-module");return}var x=E.getAttribute("data-module-label")||h,v=w.getAttribute("data-label-prefix")||"Continue:";w.textContent=v+" "+x,w.setAttribute("data-aipkit-open-module",h),w.hidden=!1}}function e(_){_.addEventListener("click",function(w){var h=w.target.closest("[data-aipkit-scroll-target]");if(!(!h||!_.contains(h))){var E=h.getAttribute("data-aipkit-scroll-target")||"";if(E){var x=_.querySelector(E);x&&(w.preventDefault(),x.scrollIntoView({behavior:"smooth",block:"start"}))}}})}function i(_){var w=_.querySelector(".aipkit_home_hero"),h=_.querySelector(".aipkit_home_panel--setup");if(!(!w||!h)){var E=window.matchMedia("(max-width: 1180px)").matches;if(E){w.style.minHeight="",w.style.height="";return}var x=Math.ceil(h.getBoundingClientRect().height);x>0&&(w.style.minHeight=x+"px",w.style.height=x+"px")}}function d(_){var w=_.querySelector(".aipkit_home_section--modules"),h=_.querySelector(".aipkit_home_panel--chart");if(!(!w||!h)){var E=window.matchMedia("(max-width: 1180px)").matches;if(E){w.style.minHeight="",w.style.height="";return}var x=Math.ceil(h.getBoundingClientRect().height);x>0&&(w.style.minHeight=x+"px",w.style.height=x+"px")}}function u(_){var w=function(){i(_),d(_)};typeof window.__aipkitHomeHeroHeightResizeHandler=="function"&&window.removeEventListener("resize",window.__aipkitHomeHeroHeightResizeHandler);var h=function(){window.requestAnimationFrame(w)};if(window.__aipkitHomeHeroHeightResizeHandler=h,window.addEventListener("resize",h,{passive:!0}),window.__aipkitHomeHeroHeightObserver&&typeof window.__aipkitHomeHeroHeightObserver.disconnect=="function"&&window.__aipkitHomeHeroHeightObserver.disconnect(),typeof window.ResizeObserver=="function"){var E=_.querySelector(".aipkit_home_panel--setup"),x=_.querySelector(".aipkit_home_panel--chart");if(E||x){var v=new ResizeObserver(function(){w()});E&&v.observe(E),x&&v.observe(x),window.__aipkitHomeHeroHeightObserver=v}}w()}function p(_){_.querySelectorAll(".aipkit_home_module_main").forEach(function(w){w.addEventListener("keydown",function(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),w.getAttribute("aria-disabled")!=="true"&&w.click())})})}function f(_){_.querySelectorAll(".aipkit_home_toggle_input").forEach(function(w){w.addEventListener("change",function(){var h=w.getAttribute("data-option-key"),E=w.getAttribute("data-module"),x=!!w.checked,v=w.closest(".aipkit_home_module_row"),I=v?!v.classList.contains("is-disabled"):!x;if(s(_,v,E,x),!h||typeof window.aipkit_apiRequest!="function"){w.checked=I,s(_,v,E,I);return}typeof window.aipkit_invalidateModuleCache=="function"&&(window.aipkit_invalidateModuleCache(E),window.aipkit_invalidateModuleCache("dashboard-home")),w.disabled=!0,window.aipkit_apiRequest("aipkit_update_module_setting",{moduleKey:h,enabled:x?"1":"0"}).catch(function(){w.checked=I,s(_,v,E,I),typeof window.aipkit_invalidateModuleCache=="function"&&(window.aipkit_invalidateModuleCache(E),window.aipkit_invalidateModuleCache("dashboard-home"))}).finally(function(){w.disabled=!1})})})}function m(){var _=document.getElementById("aipkit_token_usage_chart_container");if(!(!_||typeof window.aipkit_loadTokenUsageChart!="function")){var w=document.getElementById("aipkit_home_chart_period"),h=w&&parseInt(w.value,10)||7;window.aipkit_loadTokenUsageChart(h),w&&w.addEventListener("change",function(){var E=parseInt(w.value,10)||7;window.aipkit_loadTokenUsageChart(E)})}}function g(){var _=document.getElementById("aipkit_dashboard_home");_&&(e(_),u(_),p(_),l(_),f(_),m())}window.aipkit_initDashboardHome=g})();document.addEventListener("DOMContentLoaded",function(){(()=>{document.addEventListener("click",function(a){let s=a.target.closest("[data-aipkit-open-module], .aipkit_module-link[data-module]");if(!s)return;let l=s.getAttribute("data-aipkit-open-module")||s.getAttribute("data-module")||"";if(!(!l||typeof window.aipkit_loadModule!="function")){if(s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"){a.preventDefault();return}a.preventDefault(),window.aipkit_loadModule(l)}})})(),typeof window.aipkit_initSettingsMenus=="function"&&window.aipkit_initSettingsMenus();let t=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(t)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let a=["dashboard-home","settings","chatbot","content-writer","ai-forms","image-generator","sources"],s=Array.from(document.querySelectorAll(".aipkit_module-link")),l=null;for(let c=0;c<a.length;c++){let o=a[c];if(s.find(i=>i.getAttribute("data-module")===o&&i.offsetParent!==null)){l=o;break}}if(!l){let c=s.find(o=>o.offsetParent!==null);c&&(l=c.getAttribute("data-module"))}if(l)window.aipkit_loadModule(l);else if(s.find(o=>o.getAttribute("data-module")==="dashboard-home"))window.aipkit_loadModule("dashboard-home");else{let o=document.getElementById("aipkit_module-container");o&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(o,"initial","No modules enabled or accessible. Please review module access and settings."):o&&(o.innerHTML='<p style="text-align:center; padding: 30px;">No modules are currently available.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!t){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let a=document.getElementById("aipkit_module-container");a&&(a.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector("#aipkit_sources_settings_popover");if(!n)return;let t=Array.from(n.querySelectorAll("[data-aipkit-settings-panel]"));if(!t.length||n.dataset.panelsBound==="true")return;let a=n.querySelector(".aipkit_model_settings_popover_title"),s=n.querySelector(".aipkit_model_settings_popover_back"),l=r.querySelector("#aipkit_sources_settings_trigger"),c={root:n.dataset.titleRoot||"Settings",general:n.dataset.titleGeneral||"General","provider-credentials":n.dataset.titleProviderCredentials||"Provider credentials","document-chunking":n.dataset.titleDocumentChunking||"Document chunking"},o=null,e=i=>{let d=i||"root",u=n.querySelector(`[data-aipkit-settings-panel="${d}"]`)||n.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let p=u.dataset.aipkitSettingsPanel||"root";p!==o&&(t.forEach(f=>{f.hidden=f!==u}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),o=p,n.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};n.addEventListener("click",i=>{let d=i.target.closest("[data-aipkit-panel-target]");if(!d)return;i.preventDefault();let u=d.dataset.aipkitPanelTarget;e(u)}),s&&s.addEventListener("click",i=>{i.preventDefault(),e("root")}),l&&l.addEventListener("click",()=>{e("root")}),e("root"),n.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=k})();(function(){"use strict";let k=window.wp&&window.wp.i18n?window.wp.i18n:null,r=k&&typeof k.__=="function"?k.__:F=>F,n=k&&typeof k.sprintf=="function"?k.sprintf:(F,...L)=>F.replace(/%s/g,()=>L.shift()),t=k&&typeof k._n=="function"?k._n:(F,L,O)=>O===1?F:L,a=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:F=>String(F??""),s=60,l={openai:{singular:r("Vector store","gpt3-ai-content-generator"),plural:r("Vector stores","gpt3-ai-content-generator"),loading:r("Loading vector stores...","gpt3-ai-content-generator"),empty:r("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:r("Index","gpt3-ai-content-generator"),plural:r("Indexes","gpt3-ai-content-generator"),loading:r("Loading indexes...","gpt3-ai-content-generator"),empty:r("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:r("Collection","gpt3-ai-content-generator"),plural:r("Collections","gpt3-ai-content-generator"),loading:r("Loading collections...","gpt3-ai-content-generator"),empty:r("No collections found.","gpt3-ai-content-generator")},default:{singular:r("Index","gpt3-ai-content-generator"),plural:r("Indexes","gpt3-ai-content-generator"),loading:r("Loading indexes...","gpt3-ai-content-generator"),empty:r("No indexes found.","gpt3-ai-content-generator")}},c={openai:{key:"openai",typeLabel:r("Vector stores","gpt3-ai-content-generator"),emptyLabel:r("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:r("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:r("Store name","gpt3-ai-content-generator"),namePlaceholder:r("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:r("store","gpt3-ai-content-generator"),countPlural:r("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:r("Indexes","gpt3-ai-content-generator"),emptyLabel:r("No indexes found.","gpt3-ai-content-generator"),loadingLabel:r("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:r("Index name","gpt3-ai-content-generator"),namePlaceholder:r("e.g. site-content","gpt3-ai-content-generator"),countSingular:r("index","gpt3-ai-content-generator"),countPlural:r("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:r("Collections","gpt3-ai-content-generator"),emptyLabel:r("No collections found.","gpt3-ai-content-generator"),loadingLabel:r("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:r("Collection name","gpt3-ai-content-generator"),namePlaceholder:r("e.g. docs","gpt3-ai-content-generator"),countSingular:r("collection","gpt3-ai-content-generator"),countPlural:r("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},o={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},e={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:r("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:r("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:r("collection","gpt3-ai-content-generator")}},i="aipkit_sources_filters_v1";function d(){try{let F=window.localStorage.getItem(i);if(!F)return{};let L=JSON.parse(F);return L&&typeof L=="object"?L:{}}catch{return{}}}function u(F){try{window.localStorage.setItem(i,JSON.stringify(F))}catch{}}function p(F){if(!F)return[];try{let L=JSON.parse(F);return Array.isArray(L)?L:[]}catch{return[]}}function f(F,L){return F?F.length>L?`${F.slice(0,L)}...`:F:""}function m(F){return String(F||"").trim().toLowerCase()}function g(F){return c[m(F)]||null}function _(F){return e[m(F)]||null}function w(F){let L=m(F);return l[L]||l.default}function h(){let F=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return F&&typeof F=="object"?F:{}}function E(F){let L=m(F),O=h();return Object.prototype.hasOwnProperty.call(O,L)?!!O[L]:null}function x(F){let L=E(F);return L===!0?{label:r("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:L===!1?{label:r("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:r("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function v(F,L){return!L||typeof L!="object"?"":F==="openai"?L.id||L.vector_store_id||"":F==="pinecone"?L.name||L.id||"":F==="qdrant"?L.name||L.id||L.collection_name||"":L.id||L.name||""}function I(F,L){let O=v(F,L);return!L||typeof L!="object"?O||"\u2014":L.name||L.vector_store_name||O||"\u2014"}function P(F){let L=m(F);return L==="openai"?"openaiVectorStores":L==="pinecone"?"pineconeIndexes":L==="qdrant"?"qdrantCollections":""}function b(F,L){let O=P(F);if(!O)return;(!window.aipkit_chat_config||typeof window.aipkit_chat_config!="object")&&(window.aipkit_chat_config={});let D=Array.isArray(L)?L:[];window.aipkit_chat_config[O]=D,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:m(F),stores:D}}))}function y(F){let L=String(F?.message||"").toLowerCase(),O=m(F?.provider||""),D=String(F?.file_id||""),R=!!F?.post_id;if(L.includes("file content submitted for indexing")||L.includes("file content embedded and upserted")||L.includes("original filename:")||L.includes("file uploaded"))return{key:"file",label:r("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((O==="pinecone"||O==="qdrant")&&D&&(D.includes("pinecone_file_")||D.includes("file_"))&&!D.startsWith("wp_post_")&&!D.startsWith("text_"))return{key:"file",label:r("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if(L.includes("text content submitted for indexing"))return{key:"text",label:r("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(O==="qdrant"&&L.includes("points upserted to qdrant"))return R||L.includes("post id:")?{key:"site",label:r("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:r("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(O==="pinecone"&&L.includes("vectors upserted")){if(D.startsWith("wp_post_"))return{key:"site",label:r("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(D.startsWith("text_"))return{key:"text",label:r("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(D.includes("pinecone_file_")||D.includes("file_"))return{key:"file",label:r("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if(L.includes("wordpress post content submitted for indexing"))return{key:"site",label:r("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(R)return{key:"site",label:r("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(O==="pinecone"&&D){if(D.startsWith("wp_post_"))return{key:"site",label:r("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(D.startsWith("text_"))return{key:"text",label:r("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:r("N/A","gpt3-ai-content-generator"),className:""}}function S(F){let L=F||"";return L==="indexed"||L==="skipped_already_indexed"||L==="success"?{label:r("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:L==="failed"?{label:L.replace(/_/g," "),className:"aipkit_status-warning"}:L?{label:L.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function C(F){return F.post_title?String(F.post_title):F.post_id?`${r("Post","gpt3-ai-content-generator")} #${F.post_id}`:F.indexed_content?String(F.indexed_content):F.message?String(F.message):F.file_id?String(F.file_id):F.vector_store_name?String(F.vector_store_name):"\u2014"}function A(F){let L=m(F);return L?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[L]||String(F):"\u2014"}function M(F){let L=m(F);return L&&["openai","pinecone","qdrant"].includes(L)?`aipkit_settings_select_picker_icon--${L}`:""}function $(F){return F.vector_store_name?String(F.vector_store_name):F.vector_store_id?String(F.vector_store_id):"\u2014"}function W(F,L,O){if(!F)return;let D=F.classList.contains("aipkit_training_status");if(F.textContent=L||"",D){F.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),L&&F.classList.add("is-visible"),O&&F.classList.add(`is-${O}`);return}F.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),O==="success"?F.classList.add("aipkit_form-help-success"):O==="error"&&F.classList.add("aipkit_form-help-error")}function H(F,L,O){F&&(F.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${a(O)}</td></tr>`,L&&(L.innerHTML=""))}function N(F,L){if(!F)return;if(!Array.isArray(L)||!L.length){H(F,null,r("No sources found.","gpt3-ai-content-generator"));return}let O=L.map(D=>{let R=y(D),Z=S(D.status),J=D.status==="processing"||D.status==="queued",pe=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(D.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(D.timestamp):D.timestamp||"\u2014",Ce=A(D.provider),He=M(D.provider),Ke=He?`<span class="aipkit_settings_select_picker_icon ${a(He)}" aria-hidden="true"></span>`:"",nt=$(D),mt=f(nt,40),wt=Ce?`${Ce} \xB7 ${nt}`:nt,ge=String(C(D)||"\u2014"),se=f(ge,s),ae=D.indexed_content||"",Se=[];return R.key==="site"&&D.post_id&&D.vector_store_id&&D.file_id&&Se.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${a(D.provider||"")}"
              data-store-id="${a(D.vector_store_id||"")}"
              data-vector-id="${a(D.file_id||"")}"
              data-log-id="${a(D.id||"")}"
              data-post-id="${a(D.post_id||"")}"
              data-embedding-provider="${a(D.embedding_provider||"")}"
              data-embedding-model="${a(D.embedding_model||"")}"
              ${J?'disabled aria-disabled="true"':""}
            >${a(r(J?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),R.key==="text"&&ae&&D.vector_store_id&&D.file_id&&Se.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${a(D.provider||"")}"
              data-store-id="${a(D.vector_store_id||"")}"
              data-vector-id="${a(D.file_id||"")}"
              data-log-id="${a(D.id||"")}"
              data-embedding-provider="${a(D.embedding_provider||"")}"
              data-embedding-model="${a(D.embedding_model||"")}"
              data-content="${a(encodeURIComponent(ae))}"
              ${J?'disabled aria-disabled="true"':""}
            >${a(r(J?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),ae&&Se.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${a(ae)}"
              ${J?'disabled aria-disabled="true"':""}
            >${a(r("View","gpt3-ai-content-generator"))}</button>`),D.file_id&&Se.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${a(D.provider||"")}"
              data-store-id="${a(D.vector_store_id||"")}"
              data-vector-id="${a(D.file_id||"")}"
              data-log-id="${a(D.id||"")}"
              ${J?'disabled aria-disabled="true"':""}
            >${a(r("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${a(D.id||"")}">
          <td>${a(pe)}</td>
          <td title="${a(wt)}">
            <span class="aipkit_popover_option_label_group">
              ${Ke}
              <span>${a(mt)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${a(R.className)}">${a(R.label)}</span></td>
          <td title="${a(ge)}">${a(se)}</td>
          <td><span class="aipkit_status-tag ${a(Z.className)}">${a(Z.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${Se.join("")}</div>
          </td>
        </tr>`}).join("");F.innerHTML=O}function G(F,L,O){if(!L)return;L.innerHTML="";let D=Number(F?.total_logs||0),R=Number(F?.total_pages||0),Z=Number(F?.current_page||1);if(!D)return;let J=document.createElement("span");if(J.className="aipkit_pagination-count",J.textContent=`${D.toLocaleString()} ${t("source","sources",D,"gpt3-ai-content-generator")}`,L.appendChild(J),R<=1)return;let pe=document.createElement("span");pe.className="aipkit_pagination-links";let Ce=document.createElement("button");Ce.type="button",Ce.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",Ce.textContent=r("Prev","gpt3-ai-content-generator"),Ce.disabled=Z<=1,Ce.addEventListener("click",()=>O(Z-1));let He=document.createElement("span");He.className="aipkit_pagination-current",He.textContent=`${Z}/${R}`;let Ke=document.createElement("button");Ke.type="button",Ke.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",Ke.textContent=r("Next","gpt3-ai-content-generator"),Ke.disabled=Z>=R,Ke.addEventListener("click",()=>O(Z+1)),pe.appendChild(Ce),pe.appendChild(He),pe.appendChild(Ke),L.appendChild(pe)}function Q(){let F=document.getElementById("aipkit_sources_module_container");if(!F)return;let L=document.getElementById("aipkit_sources_table_body"),O=document.getElementById("aipkit_sources_pagination"),D=document.getElementById("aipkit_sources_status"),R=document.getElementById("aipkit_sources_provider_filter"),Z=document.getElementById("aipkit_sources_index_filter"),J=document.getElementById("aipkit_sources_status_filter"),pe=document.getElementById("aipkit_sources_type_filter"),Ce=document.getElementById("aipkit_sources_search_input"),He=document.getElementById("aipkit_sources_provider_popover_body"),Ke=document.getElementById("aipkit_sources_settings_trigger"),nt=document.getElementById("aipkit_sources_settings_popover"),mt=document.getElementById("aipkit_sources_indexing_manage"),wt=F.querySelector('[data-aipkit-settings-action="indexing-controls"]'),ge=mt||wt,se=document.getElementById("aipkit_sources_settings_save"),ae=document.getElementById("aipkit_sources_settings_sheet"),Se=ae?ae.querySelector(".aipkit_builder_sheet_close"):null,je=document.getElementById("aipkit_save_indexing_settings_btn"),bt=document.getElementById("aipkit_indexing_settings_messages"),re=document.getElementById("aipkit_sources_settings_sheet_messages"),ve=document.getElementById("aipkit_sources_semantic_manage"),Ee=F.querySelector('[data-aipkit-settings-action="semantic-search"]'),Fe=ve||Ee,Be=document.getElementById("aipkit_sources_semantic_sheet"),Ve=Be?Be.querySelector(".aipkit_builder_sheet_close"):null,Je=document.getElementById("aipkit_sources_semantic_vector_provider"),Ze=document.getElementById("aipkit_sources_semantic_target_id"),Pt=document.getElementById("aipkit_sources_semantic_target_label"),Mi=document.getElementById("aipkit_sources_semantic_embedding_model"),Qt=document.getElementById("aipkit_sources_semantic_embedding_provider"),ti=document.getElementById("aipkit_sources_semantic_num_results"),gt=document.getElementById("aipkit_sources_semantic_no_results_text"),tt=document.getElementById("aipkit_sources_semantic_shortcode_copy"),Ye=document.getElementById("aipkit_sources_semantic_demo_form"),ei=document.getElementById("aipkit_sources_semantic_demo_input"),li=document.getElementById("aipkit_sources_semantic_demo_results"),Jt=document.getElementById("aipkit_sources_semantic_demo_submit"),Ut=document.getElementById("aipkit_sources_index_empty_action"),Di=document.getElementById("aipkit_sources_index_create_trigger"),xt=document.getElementById("aipkit_sources_editor_modal"),pi=xt?xt.querySelector(".aipkit_sources_editor_textarea"):null,Wt=xt?xt.querySelector(".aipkit_sources_editor_close"):null,Wi=xt?xt.querySelector(".aipkit_sources_editor_cancel"):null,Sn=xt?xt.querySelector(".aipkit_sources_editor_save"):null,Ki=document.getElementById("aipkit_sources_view_modal"),ln=Ki?Ki.querySelector(".aipkit_sources_view_textarea"):null,Vn=Ki?Ki.querySelector(".aipkit_sources_view_close"):null,ke=Ki?Ki.querySelector(".aipkit_sources_view_close_btn"):null,Le=document.getElementById("aipkit_sources_delete_modal"),Oe=Le?Le.querySelector(".aipkit_sources_delete_close"):null,qt=Le?Le.querySelector(".aipkit_sources_delete_cancel"):null,ot=Le?Le.querySelector(".aipkit_sources_delete_confirm"):null;if(!L||typeof window.aipkit_apiRequest!="function")return;let Tt=d(),fi=Tt.indexByProvider&&typeof Tt.indexByProvider=="object"?{...Tt.indexByProvider}:{},Ht=Tt.embeddingByProvider&&typeof Tt.embeddingByProvider=="object"?{...Tt.embeddingByProvider}:{};R&&typeof Tt.provider=="string"&&Array.from(R.options).some(te=>te.value===Tt.provider)&&(R.value=Tt.provider),J&&typeof Tt.status=="string"&&Array.from(J.options).some(te=>te.value===Tt.status)&&(J.value=Tt.status),pe&&typeof Tt.type=="string"&&Array.from(pe.options).some(te=>te.value===Tt.type)&&(pe.value=Tt.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let hi=null,mi=null,Bi=null,gi=null,ii=null,ji=null,Ne={page:1,perPage:10,provider:R?R.value:"",status:J?J.value:"",type:pe?pe.value:"",search:Ce?Ce.value.trim():"",indexByProvider:fi,embeddingByProvider:Ht,openIndexCreateOnOpen:!1},ui={activeProvider:"",stores:{},syncTokens:{}},Hi={nonce:F.dataset.settingsNonce||"",isPro:F.dataset.settingsIsPro==="1"||F.dataset.settingsIsPro==="true"},En={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},Do=null,Ao=!1,Wo=!1,gn={nonce:F.dataset.semanticSearchNonce||"",pineconeIndexes:p(F.dataset.semanticPineconeIndexes),qdrantCollections:p(F.dataset.semanticQdrantCollections)},uo={initialized:!1,autosaveBound:!1,dirty:!1},Ca=null,Ho=!1,ta=!1,Vo={pinecone_api_key:F.dataset.pineconeApiKey||"",qdrant_api_key:F.dataset.qdrantApiKey||"",qdrant_url:F.dataset.qdrantUrl||""},ia=null,Mn=()=>{hi&&window.clearTimeout(hi),hi=window.setTimeout(()=>{W(D,"","")},3e3)},xr=()=>{gi&&window.clearTimeout(gi),gi=window.setTimeout(()=>{W(bt,"","")},3e3)},xa=()=>!Z||Z.disabled?"":Z.value||"",Uo=()=>!Z||!Z.id?null:document.getElementById(`${Z.id}_picker_btn`),Go=j=>{if(!Z)return;let te=!j;Z.hidden=te;let de=Uo();de&&(de.hidden=te)},na=(j,te={})=>{if(!Z)return;Z.disabled=j;let de=Uo();de&&(te.disableTrigger!==!1?(de.disabled=j,j?de.setAttribute("aria-disabled","true"):de.removeAttribute("aria-disabled")):(de.disabled=!1,de.removeAttribute("aria-disabled")))},_o=(j,te)=>{if(!Ut||!Di)return;Ut.hidden=!j;let de=Uo();if(de&&(j?de.hidden=!0:(!Z||!Z.hidden)&&(de.hidden=!1)),!j)return;let ce=m(te),he=w(ce);Di.textContent=n(r("Create new %s","gpt3-ai-content-generator"),he.singular.toLowerCase());let $e=E(ce),Te=!!ce&&$e!==!1;Di.disabled=!Te,Te?(Di.removeAttribute("aria-disabled"),Di.removeAttribute("title")):(Di.setAttribute("aria-disabled","true"),Di.setAttribute("title",r("Add credentials to create.","gpt3-ai-content-generator")))},oa=j=>{let te=Uo();if(!te||!j)return;let de=j.getBoundingClientRect(),ce={hidden:te.hidden,style:te.getAttribute("style")||""};te.hidden=!1,te.style.position="fixed",te.style.left=`${Math.round(de.left)}px`,te.style.top=`${Math.round(de.top)}px`,te.style.width=`${Math.round(de.width)}px`,te.style.height=`${Math.round(de.height)}px`,te.style.opacity="0",te.style.pointerEvents="none",te.click();let he=()=>{te.setAttribute("style",ce.style),ce.hidden&&(te.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(he)})},aa=()=>!Z||!Z.id?null:document.getElementById(`${Z.id}_picker_popover`),An=()=>{let j=aa();if(!j)return null;j.classList.add("aipkit_sources_index_picker_popover");let te=j.querySelector(".aipkit_model_settings_popover_body");if(!te)return null;let de=te.querySelector(".aipkit_sources_index_picker_actions");return de||(de=document.createElement("div"),de.className="aipkit_sources_index_picker_actions",de.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${Yt(r("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${Yt(r("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${Yt(r("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${Yt(r("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${Yt(r("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${Yt(r("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${Yt(r("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${Yt(r("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${Yt(r("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,te.appendChild(de)),de},fo=()=>{let j=An();return j?{footer:j,actionList:j.querySelector(".aipkit_sources_index_action_list"),newButton:j.querySelector(".aipkit_sources_index_new_btn"),deleteButton:j.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:j.querySelector(".aipkit_sources_index_inline_form"),createButton:j.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:j.querySelector(".aipkit_sources_index_cancel_create"),nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:j.querySelector(".aipkit_sources_index_dimension_row"),createLabel:j.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:j.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:j.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:j.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:j.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:j.querySelector(".aipkit_sources_index_status")}:null},Io=(j,te)=>{let de=fo(),ce=D||(de?de.statusEl:null);ce&&(W(ce,j,te),de&&ce===de.statusEl&&(ce.style.display=j?"block":"none"))},Lo=()=>{Bi&&window.clearTimeout(Bi),Bi=window.setTimeout(()=>{Io("","")},3e3)},Rn=()=>{let j=fo();j&&(j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="none"),j.actionList&&(j.actionList.style.display=""),j.nameInput&&(j.nameInput.value=""),j.dimensionInput&&(j.dimensionInput.value=""),Io("",""))},Bn=j=>{let te=fo();if(!te)return;let de=m(j),ce=de?E(de):null,he=!!de&&ce!==!1,$e=he&&!!(Z&&Z.value);te.nameInput&&(te.nameInput.disabled=!he),te.dimensionInput&&(te.dimensionInput.disabled=!he),te.newButton&&(te.newButton.disabled=!he,he?te.newButton.removeAttribute("aria-disabled"):te.newButton.setAttribute("aria-disabled","true")),te.createButton&&(te.createButton.disabled=!he,he?te.createButton.removeAttribute("aria-disabled"):te.createButton.setAttribute("aria-disabled","true")),te.deleteButton&&(te.deleteButton.disabled=!$e,$e?te.deleteButton.removeAttribute("aria-disabled"):te.deleteButton.setAttribute("aria-disabled","true"))},Aa=j=>{let te=fo();if(!te||!te.dimensionInput)return;let de=m(j),ce=g(de);if(!ce||!ce.needsDimension)return;let he=ce.defaultDimension||1536;te.dimensionInput.value||(te.dimensionInput.value=String(he))},Fn=j=>{let te=fo();if(!te)return;let de=m(j),ce=g(de),he=w(de),$e=ce?ce.namePlaceholder:"",Te=ce?ce.nameLabel:he.singular;te.createLabel&&(te.createLabel.textContent=he.singular),te.nameInput&&(te.nameInput.placeholder=$e,te.nameInput.setAttribute("aria-label",Te)),te.dimensionRow&&(te.dimensionRow.style.display=ce&&ce.needsDimension?"":"none"),Bn(de)},zn=()=>{let j=fo();if(!j||j.footer.dataset.indexActionsBound==="true")return;j.newButton&&j.newButton.addEventListener("click",()=>{Rn(),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Aa(R?R.value:""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select())}),j.cancelCreate&&j.cancelCreate.addEventListener("click",()=>{Rn()}),j.deleteButton&&j.deleteButton.addEventListener("click",()=>{let de=m(R?R.value:""),ce=Z?Z.value:"";if(!de||!ce){let We=w(de);Io(n(r("Select a %s to delete.","gpt3-ai-content-generator"),We.singular.toLowerCase()),"error"),Lo();return}let he=Z&&Z.selectedOptions?Z.selectedOptions[0]:null,$e=he?he.textContent:ce,Te=_(de),Ue=Te?Te.label:w(de).singular.toLowerCase();j.deleteConfirmText&&(j.deleteConfirmText.textContent=n(r('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Ue,$e)),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="")}),j.cancelDelete&&j.cancelDelete.addEventListener("click",()=>{Rn()}),j.createButton&&j.createButton.addEventListener("click",async()=>{let de=m(R?R.value:"");if(!de)return;let ce=await Mo(de,j.createButton,{root:j.inlineForm,statusUpdater:Io,clearStatusSoon:Lo});Bn(de),ce&&ce.success&&Rn()}),j.confirmDelete&&j.confirmDelete.addEventListener("click",async()=>{let de=m(R?R.value:""),ce=Z?Z.value:"";if(!de||!ce)return;let he=Z&&Z.selectedOptions?Z.selectedOptions[0]:null,$e=he?he.textContent:ce,Te=await Po(de,ce,$e,j.confirmDelete,{skipConfirm:!0,statusUpdater:Io,clearStatusSoon:Lo,defaultLabel:r("Confirm","gpt3-ai-content-generator")});Un(),Te&&(Rn(),yn(1))}),j.footer.dataset.indexActionsBound="true";let te=Uo();te&&te.dataset.indexActionsBound!=="true"&&(te.addEventListener("click",()=>{Rn(),Fn(Ne.provider||""),Ne.openIndexCreateOnOpen&&(Ne.openIndexCreateOnOpen=!1,j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Aa(Ne.provider||""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select()))}),te.dataset.indexActionsBound="true")},Qn=(j,te,de={})=>{if(!Z)return;let ce=m(j),he=ce&&Ne.indexByProvider[ce]||"",$e=w(ce),Te=!!ce;Go(Te),Z.dataset.aipkitPickerTitle=$e.singular;let Ue=document.getElementById(`${Z.id}_picker_title`);Ue&&(Ue.textContent=$e.singular);let We=document.getElementById(`${Z.id}_picker_search`);if(We){let ht=$e.singular?`Search ${$e.singular.toLowerCase()}...`:r("Search...","gpt3-ai-content-generator");We.setAttribute("placeholder",ht)}if(Z.innerHTML="",!Te){let ht=document.createElement("option");ht.value="",ht.textContent=$e.plural,Z.appendChild(ht),Z.value="",na(!0),_o(!1,ce),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(ce);return}if(de.loading){let ht=document.createElement("option");ht.value="",ht.textContent=$e.loading,ht.disabled=!0,Z.appendChild(ht),Z.value="",na(!0,{disableTrigger:!1}),_o(!1,ce),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(ce);return}let Re=Array.isArray(te)?te:[];if(!Re.length){let ht=document.createElement("option");ht.value="",ht.textContent=de.emptyLabel||$e.empty,ht.disabled=!0,Z.appendChild(ht),Z.value="",na(!0,{disableTrigger:!1}),_o(!0,ce),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(ce);return}let _t=document.createElement("option");_t.value="",_t.textContent=n(r("All %s","gpt3-ai-content-generator"),$e.plural.toLowerCase()),Z.appendChild(_t),Re.forEach(ht=>{let Xi=v(ce,ht),Ai=I(ce,ht);if(!Xi)return;let Mt=document.createElement("option");Mt.value=Xi,Mt.textContent=Ai||Xi,Z.appendChild(Mt)});let Rt=Ne.indexByProvider[ce]||"",ni=Rt?Re.some(ht=>v(ce,ht)===Rt):!1;Rt&&!ni&&(Ne.indexByProvider[ce]=""),Z.value=ni?Rt:"",na(!1),_o(!1,ce),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),ce&&he!==Ne.indexByProvider[ce]&&u({provider:Ne.provider,status:Ne.status,type:Ne.type,indexByProvider:Ne.indexByProvider,embeddingByProvider:Ne.embeddingByProvider}),zn(),Fn(ce)},mo=()=>bt||D||(He?He.querySelector("#aipkit_sources_provider_panel_status"):null),an=(j,te)=>{let de=mo();W(de,j,te)},kn=()=>{mi&&window.clearTimeout(mi),mi=window.setTimeout(()=>{an("","")},3e3)},Ia=()=>{Ki&&(Ki.classList.remove("aipkit-active"),Ki.setAttribute("aria-hidden","true"),ln&&(ln.value=""))},Cn=j=>{!Ki||!ln||(ln.value=j||"",ln.scrollTop=0,Ki.classList.add("aipkit-active"),Ki.setAttribute("aria-hidden","false"),ln.focus())},Jn=()=>{xt&&(xt.classList.remove("aipkit-active"),xt.setAttribute("aria-hidden","true"),xt.dataset.provider="",xt.dataset.storeId="",xt.dataset.vectorId="",xt.dataset.logId="",xt.dataset.embeddingProvider="",xt.dataset.embeddingModel="",pi&&(pi.value=""))},er=j=>{!xt||!pi||(xt.dataset.provider=j.dataset.provider||"",xt.dataset.storeId=j.dataset.storeId||"",xt.dataset.vectorId=j.dataset.vectorId||"",xt.dataset.logId=j.dataset.logId||"",xt.dataset.embeddingProvider=j.dataset.embeddingProvider||"",xt.dataset.embeddingModel=j.dataset.embeddingModel||"",pi.value=j.dataset.content?decodeURIComponent(j.dataset.content):"",xt.classList.add("aipkit-active"),xt.setAttribute("aria-hidden","false"),setTimeout(()=>pi.focus(),0))},go=()=>{Le&&(Le.classList.remove("aipkit-active"),Le.setAttribute("aria-hidden","true"),Le.dataset.provider="",Le.dataset.storeId="",Le.dataset.vectorId="",Le.dataset.logId="")},qo=j=>{Le&&(Le.dataset.provider=j.provider||"",Le.dataset.storeId=j.storeId||"",Le.dataset.vectorId=j.vectorId||"",Le.dataset.logId=j.logId||"",Le.classList.add("aipkit-active"),Le.setAttribute("aria-hidden","false"),ot&&(ot.disabled=!1))},Li=j=>{let te=document.getElementById(j);return te?te.value:""},hn=j=>{let te=o[m(j)];return te?Li(te):""},dn=()=>{let j={...h()};return j.pinecone=!!Vo.pinecone_api_key,j.qdrant=!!(Vo.qdrant_api_key&&Vo.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=j,j};dn();let To=j=>j.startsWith("pinecone_")?"pinecone":j.startsWith("qdrant_")?"qdrant":"",tr=async()=>{if(!He)return;let j=He.querySelectorAll("[data-aipkit-provider-config]");if(!j.length)return;let te={},de=!1,ce=new Set;if(j.forEach(he=>{let $e=he.dataset.aipkitProviderConfig;if(!$e)return;let Te=he.value.trim();if(te[$e]=Te,Vo[$e]!==Te){de=!0;let Ue=To($e);Ue&&ce.add(Ue)}}),!!de){an(r("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",te),Object.keys(te).forEach(he=>{Vo[he]=te[he]}),dn(),Un(),ce.forEach(he=>{E(he)!==!1&&(ui.activeProvider===he?pn(he,{silent:!0}):ui.stores[he]=null)}),an(r("Saved","gpt3-ai-content-generator"),"success"),kn()}catch(he){let $e=he&&he.message?he.message:r("Save failed.","gpt3-ai-content-generator");an(`${r("Error:","gpt3-ai-content-generator")} ${$e}`,"error"),kn()}}},ra=()=>{ia&&window.clearTimeout(ia),ia=window.setTimeout(()=>{tr()},600)},Yn=(j=He)=>j?{nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:j.querySelector("[data-aipkit-provider-delete-selected]")}:{},Un=()=>{let j=m(R?R.value:He?.dataset.provider||""),te=Z?Z.value:"",de=!!j&&!!te&&E(j)===!0,{deleteButton:ce}=Yn();ce&&(ce.disabled=!de,de?ce.removeAttribute("aria-disabled"):ce.setAttribute("aria-disabled","true")),Bn(j)},$n=(j,te,de={})=>{let ce=m(j),he=m(R?R.value:"");if(!ce){Qn("",[]),Un();return}ce===he&&(Qn(ce,te,{loading:de.loading===!0,emptyLabel:de.emptyLabel}),Un())},Xn=(j,te,de,ce)=>{j&&(te?(j.disabled=!0,j.setAttribute("aria-disabled","true"),j.textContent=ce):(j.disabled=!1,j.removeAttribute("aria-disabled"),j.textContent=de))},pn=async(j,te={})=>{let de=g(j);if(!de)return;let ce=m(j),he=te.silent===!0;if(E(ce)===!1){an(r("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),kn();return}let Te=hn(ce);if(!Te){an(r("Provider nonce missing.","gpt3-ai-content-generator"),"error"),kn();return}let Ue=`${ce}-${Date.now()}`;ui.syncTokens[ce]=Ue,$n(ce,ui.stores[ce],{loading:!0}),he||an(r("Syncing stores...","gpt3-ai-content-generator"),"");let We={_ajax_nonce:Te};ce==="openai"&&(We.limit=100,We.order="desc");let Re=te.triggerButton||(He&&He.dataset.provider===ce?He.querySelector(".aipkit_sources_provider_sync"):null);Xn(Re,!0,r("Sync","gpt3-ai-content-generator"),r("Syncing...","gpt3-ai-content-generator"));try{let _t=await window.aipkit_apiRequest(de.listAction,We);if(ui.syncTokens[ce]!==Ue)return;let Rt=Array.isArray(_t[de.listKey])?_t[de.listKey]:[];ui.stores[ce]=Rt,b(ce,Rt),ce==="pinecone"?gn.pineconeIndexes=Rt:ce==="qdrant"&&(gn.qdrantCollections=Rt),Je&&m(Je.value)===ce&&ko(ce,{preserveValue:!0}),ui.activeProvider===ce&&$n(ce,Rt),he||(an(_t.message||r("Stores synced.","gpt3-ai-content-generator"),"success"),kn())}catch(_t){if(ui.syncTokens[ce]!==Ue)return;let Rt=_t&&_t.message?_t.message:r("Sync failed.","gpt3-ai-content-generator");an(`${r("Error:","gpt3-ai-content-generator")} ${Rt}`,"error"),kn(),$n(ce,ui.stores[ce])}finally{Xn(Re,!1,r("Sync","gpt3-ai-content-generator"),r("Syncing...","gpt3-ai-content-generator"))}},Po=async(j,te,de,ce,he={})=>{let $e=_(j);if(!$e)return!1;let Te=m(j),Ue=typeof he.statusUpdater=="function"?he.statusUpdater:an,We=typeof he.clearStatusSoon=="function"?he.clearStatusSoon:kn,Re=he.defaultLabel||(ce?ce.textContent.trim():"")||r("Delete","gpt3-ai-content-generator"),_t=he.loadingLabel||r("Deleting...","gpt3-ai-content-generator"),Rt=!1;if(!te)return Ue(r("Missing store identifier.","gpt3-ai-content-generator"),"error"),We(),!1;let ni=de||te,ht=n(r('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),$e.label,ni);if(he.skipConfirm!==!0&&!window.confirm(ht))return!1;let Xi=hn(Te);if(!Xi)return Ue(r("Provider nonce missing.","gpt3-ai-content-generator"),"error"),We(),!1;Xn(ce,!0,Re,_t),Ue(r("Deleting...","gpt3-ai-content-generator"),"");let Ai={_ajax_nonce:Xi};Ai[$e.param]=te;try{let Mt=await window.aipkit_apiRequest($e.action,Ai),ki=(Array.isArray(ui.stores[Te])?ui.stores[Te]:[]).filter(qi=>v(Te,qi)!==te);ui.stores[Te]=ki,b(Te,ki),Te==="pinecone"?gn.pineconeIndexes=ki:Te==="qdrant"&&(gn.qdrantCollections=ki),Je&&m(Je.value)===Te&&ko(Te,{preserveValue:!0}),ui.activeProvider===Te&&$n(Te,ki),Ue(Mt.message||r("Deleted.","gpt3-ai-content-generator"),"success"),We(),Rt=!0}catch(Mt){let _i=Mt&&Mt.message?Mt.message:r("Delete failed.","gpt3-ai-content-generator");Ue(`${r("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),We()}finally{Xn(ce,!1,Re,_t)}return Rt},Mo=async(j,te,de={})=>{let ce=g(j);if(!ce)return{success:!1,createdId:""};let he=m(j),$e=typeof de.statusUpdater=="function"?de.statusUpdater:an,Te=typeof de.clearStatusSoon=="function"?de.clearStatusSoon:kn,Ue=!1,We="";if(E(he)===!1)return $e(r("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),Te(),{success:!1,createdId:""};let _t=hn(he);if(!_t)return $e(r("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Te(),{success:!1,createdId:""};let{nameInput:Rt,dimensionInput:ni}=Yn(de.root||He),ht=Rt?Rt.value.trim():"";if(!ht)return $e(r("Name is required.","gpt3-ai-content-generator"),"error"),Te(),{success:!1,createdId:""};let Xi=0;if(ce.needsDimension&&(Xi=ni?parseInt(ni.value,10):0,!Xi||Number.isNaN(Xi)))return $e(r("Dimension is required.","gpt3-ai-content-generator"),"error"),Te(),{success:!1,createdId:""};Xn(te,!0,r("Create","gpt3-ai-content-generator"),r("Creating...","gpt3-ai-content-generator")),$e(r("Creating...","gpt3-ai-content-generator"),"");let Ai={_ajax_nonce:_t,name:ht};ce.needsDimension&&(Ai.dimension=Xi),he==="openai"&&(Ai.source_type="sources_module_create");try{let Mt=await window.aipkit_apiRequest(ce.createAction,Ai),_i=Mt[ce.createKey];if(_i){let ki=Array.isArray(ui.stores[he])?ui.stores[he].slice():[];We=v(he,_i),We&&ki.some(qi=>v(he,qi)===We)||ki.unshift(_i),ui.stores[he]=ki,b(he,ui.stores[he]),he==="pinecone"?gn.pineconeIndexes=ui.stores[he]:he==="qdrant"&&(gn.qdrantCollections=ui.stores[he]),Je&&m(Je.value)===he&&ko(he,{preserveValue:!0}),ui.activeProvider===he&&$n(he,ui.stores[he])}else await pn(he);Rt&&(Rt.value=""),ni&&(ni.value=""),$e(Mt.message||r("Store created.","gpt3-ai-content-generator"),"success"),Te(),Ue=!0}catch(Mt){let _i=Mt&&Mt.message?Mt.message:r("Create failed.","gpt3-ai-content-generator");$e(`${r("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Te()}finally{Xn(te,!1,r("Create","gpt3-ai-content-generator"),r("Creating...","gpt3-ai-content-generator"))}return{success:Ue,createdId:We}},Dn=j=>{let te=m(j);if(ui.activeProvider=te,Rn(),!te)Qn("",[]);else{let de=ui.stores[te];if(Array.isArray(de))$n(te,de);else if(E(te))$n(te,[],{loading:!0}),pn(te,{silent:!0});else{let ce=w(te);$n(te,[],{emptyLabel:n(r("Add credentials to load %s.","gpt3-ai-content-generator"),ce.plural.toLowerCase())})}}Un()},sa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,Bo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),Fo=j=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(j)):String(j).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),ir=async(j,te,de,ce,he)=>{let $e=j.toLowerCase();if($e==="openai"){let We=Li("aipkit_vector_store_nonce_openai");if(!We)throw new Error(r("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:We,target_store_id:te,text_content:de,source_type:"text_entry_global_form"});return}if(!ce||!he)throw new Error(r("Select an embedding model.","gpt3-ai-content-generator"));let Te=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:de,embedding_provider:ce,embedding_model:he}),Ue=Te.embeddings&&Te.embeddings.length?Te.embeddings[0]:null;if(!Ue)throw new Error(r("Failed to generate embedding.","gpt3-ai-content-generator"));if($e==="pinecone"){let We=Li("aipkit_vector_store_pinecone_nonce_management");if(!We)throw new Error(r("Pinecone nonce missing.","gpt3-ai-content-generator"));let Re=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:We,vectors:JSON.stringify([{id:Re,values:Ue,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:de,vector_id:Re}}]),embedding_provider:ce,embedding_model:he,original_text_content:de,index_name:te});return}if($e==="qdrant"){let We=Li("aipkit_vector_store_qdrant_nonce_management");if(!We)throw new Error(r("Qdrant nonce missing.","gpt3-ai-content-generator"));let Re=Bo(),_t={_ajax_nonce:We,vectors:JSON.stringify([{id:Re,vector:Ue,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:de,vector_id:Re}}]),embedding_provider:ce,embedding_model:he,original_text_content:de,collection_name:te,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",_t);return}throw new Error(r("Unsupported provider for edit.","gpt3-ai-content-generator"))},Yt=window.aipkit_escapeHtml||(j=>j==null?"":String(j)),nr=(j,te)=>{let de=document.createElement("div");de.className="aipkit_indexing_settings_section";let ce=document.createElement("h5");ce.textContent=r("Basic Labels","gpt3-ai-content-generator"),de.appendChild(ce);let he=document.createElement("table");he.className="wp-list-table widefat striped",he.innerHTML=`
        <thead>
          <tr>
            <th>${Yt(r("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${Yt(r("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let $e=he.querySelector("tbody"),Te=["source_url","title","excerpt","content"],Ue=[r("Source URL","gpt3-ai-content-generator"),r("Title","gpt3-ai-content-generator"),r("Excerpt","gpt3-ai-content-generator"),r("Content","gpt3-ai-content-generator")];return Te.forEach((We,Re)=>{let _t=te&&te[We]?te[We]:Ue[Re],Rt=En.originalSettings?.[j]?.basic_labels?.[We]||_t,ni=document.createElement("tr");ni.innerHTML=`
          <td><code>${Yt(Ue[Re])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(j)}][basic_labels][${Yt(We)}]"
              value="${Yt(Rt)}"
              placeholder="${Yt(_t)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,$e.appendChild(ni)}),de.appendChild(he),de},La=(j,te,de,ce)=>{let he=document.createElement("div");if(he.className="aipkit_indexing_settings_section",!ce||Object.keys(ce).length===0)return he.innerHTML=`<p><em>${Yt(n(r("No %s found for this content type.","gpt3-ai-content-generator"),j.toLowerCase()))}</em></p>`,he;let $e=document.createElement("h5");$e.textContent=j,he.appendChild($e);let Te=document.createElement("table");Te.className="wp-list-table widefat striped",Te.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${Hi.isPro?"":"disabled"} />
            </th>
            <th>${Yt(r("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${Yt(r("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Ue=Te.querySelector("tbody");Object.keys(ce).forEach(Re=>{let _t=ce[Re],Rt=En.originalSettings?.[te]?.[de]?.[Re]||{},ni=typeof Rt.enabled=="boolean"?Rt.enabled:!0,ht=Rt.label||"",Xi=document.createElement("tr");Xi.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${Yt(te)}][${Yt(de)}][${Yt(Re)}][enabled]"
              value="1"
              ${ni?"checked":""}
              ${Hi.isPro?"":"disabled"}
            >
          </th>
          <td><code>${Yt(Re)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(te)}][${Yt(de)}][${Yt(Re)}][label]"
              value="${Yt(ht)}"
              placeholder="${Yt(_t)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,Ue.appendChild(Xi)});let We=Te.querySelector(".aipkit-indexing-select-all");return We&&We.addEventListener("change",Re=>{Ue.querySelectorAll('input[type="checkbox"]').forEach(_t=>{_t.checked=Re.target.checked})}),he.appendChild(Te),he},qa=(j,te,de)=>{let ce=document.createElement("div");ce.className="aipkit_accordion";let he=document.createElement("div");he.className="aipkit_accordion-header",he.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${Yt(te)}`;let $e=document.createElement("div");return $e.className="aipkit_accordion-content",$e.appendChild(nr(j,de.basic_labels||{})),$e.appendChild(La(r("Custom Fields","gpt3-ai-content-generator"),j,"fields",de.fields||{})),$e.appendChild(La(r("Taxonomies","gpt3-ai-content-generator"),j,"taxonomies",de.taxonomies||{})),j==="product"&&de.woo_attributes&&$e.appendChild(La(r("Product Data","gpt3-ai-content-generator"),j,"woo_attributes",de.woo_attributes)),ce.appendChild(he),ce.appendChild($e),ce},Ta=async()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(j){if(j.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${Yt(r("Loading content types...","gpt3-ai-content-generator"))}</p>`,!Hi.nonce){j.innerHTML=`<p class="aipkit_text-danger">${Yt(r("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let te=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:Hi.nonce}),de={},ce={};if(te&&typeof te.success<"u"){if(!te.success)throw new Error(te.data||"Failed to load content types.");de=te.data?.cpt_data||{},ce=te.data?.saved_settings||{}}else te&&(de=te.cpt_data||{},ce=te.saved_settings||{});if(En.originalSettings=ce||{},j.innerHTML="",!Object.keys(de).length){j.innerHTML=`<p class="aipkit_text-center">${Yt(r("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let he=document.createElement("div");he.className="aipkit_accordion-group",Object.keys(de).forEach(Te=>{let Ue=de[Te];he.appendChild(qa(Te,Ue.label||Te,Ue))}),j.appendChild(he);let $e=document.getElementById("aipkit_indexing_settings_form");$e&&!En.accordionsBound&&($e.addEventListener("click",Te=>{let Ue=Te.target.closest(".aipkit_accordion-header");Ue&&(Ue.classList.toggle("aipkit_active"),Ue.nextElementSibling&&Ue.nextElementSibling.classList.toggle("aipkit_active"))}),En.accordionsBound=!0)}catch(te){j.innerHTML=`<p class="aipkit_text-danger">${Yt(te&&te.message?te.message:r("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},or=()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(!j)return{};let te={},de=document.getElementById("aipkit_hide_user_uploads_checkbox");te.hide_user_uploads=de?de.checked:!0;let ce=document.getElementById("aipkit_show_index_button_checkbox");te.show_index_button=ce?ce.checked:!0;let he=document.getElementById("aipkit_chunk_avg_chars_per_token"),$e=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),Te=document.getElementById("aipkit_chunk_overlap_tokens");if(he&&$e&&Te){let Ue=parseInt(he.value,10),We=parseInt($e.value,10),Re=parseInt(Te.value,10);Number.isNaN(Ue)||(te.chunk_avg_chars_per_token=Ue),Number.isNaN(We)||(te.chunk_max_tokens_per_chunk=We),Number.isNaN(Re)||(te.chunk_overlap_tokens=Re)}return j.querySelectorAll('input[type="checkbox"]').forEach(Ue=>{let We=Ue.name.match(/[^[\]']+/g);if(We&&We.length===5&&We[4]==="enabled"){let[,Re,_t,Rt]=We;te[Re]||(te[Re]={}),te[Re][_t]||(te[Re][_t]={}),te[Re][_t][Rt]||(te[Re][_t][Rt]={}),te[Re][_t][Rt].enabled=Ue.checked}}),j.querySelectorAll('input[type="text"]').forEach(Ue=>{let We=Ue.name.match(/[^[\]']+/g);if(We&&We.length===5&&We[4]==="label"){let[,Re,_t,Rt]=We;te[Re]||(te[Re]={}),te[Re][_t]||(te[Re][_t]={}),te[Re][_t][Rt]||(te[Re][_t][Rt]={}),te[Re][_t][Rt].label=Ue.value.trim()}else if(We&&We.length===4&&We[2]==="basic_labels"){let[,Re,,_t]=We;te[Re]||(te[Re]={}),te[Re].basic_labels||(te[Re].basic_labels={}),te[Re].basic_labels[_t]=Ue.value.trim()}}),te},ca=(j,te)=>{if(!j)return;j.dataset.label||(j.dataset.label=j.textContent.trim());let de=j.dataset.label||r("Save","gpt3-ai-content-generator"),ce=j.querySelector(".aipkit_spinner"),he=j.querySelector(".aipkit_btn-text"),$e=te?r("Saving...","gpt3-ai-content-generator"):de;he?he.textContent=$e:j.textContent=$e,ce&&(ce.style.display=te?"inline-block":"none"),j.disabled=te},Pa=(j,te)=>{if(!bt)return;W(bt,te,{success:"success",error:"error",info:"loading"}[j]||""),(j==="success"||j==="error")&&xr()},la=async(j={})=>{let{button:te=null,mode:de="manual"}=j;if(!Hi.nonce)return;te&&ca(te,!0),de==="auto"&&Pa("info",r("Auto-saving...","gpt3-ai-content-generator"));let ce=or();try{let he=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:Hi.nonce,settings:JSON.stringify(ce)});En.originalSettings=ce;let $e=he.message||r("Settings saved!","gpt3-ai-content-generator");Pa("success",de==="auto"?r("Saved","gpt3-ai-content-generator"):$e)}catch(he){let $e=he&&he.message?he.message:r("Failed to save settings.","gpt3-ai-content-generator");Pa("error",$e)}finally{te&&ca(te,!1)}},ar=j=>{let te=document.getElementById("aipkit_upgradeBtn");if(te){te.click();return}let de=j&&j.dataset?j.dataset.upgradeUrl:"";de&&window.open(de,"_blank","noopener")},Ar=j=>{j.preventDefault();let te=j.currentTarget;if(te&&te.dataset&&te.dataset.upgradeOnly==="1"){ar(te);return}la({button:j.currentTarget,mode:"manual"})},Ma=async()=>{if(Ao){Wo=!0;return}Ao=!0,await la({mode:"auto"}),Ao=!1,Wo&&(Wo=!1,Ma())},Ba=()=>{Hi.nonce&&(Do&&window.clearTimeout(Do),Do=window.setTimeout(()=>{Ma()},600))},Fa=()=>{if(En.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:te,events:de})=>{te&&(de.forEach(ce=>{te.addEventListener(ce,Ba)}),te.addEventListener("blur",Ba))}),En.autosaveBound=!0},oo=()=>{if(En.initialized)return!0;let j=document.getElementById("indexing-settings-tab-content");return j?j.dataset.initialized==="true"?(En.initialized=!0,!0):(Ta(),En.saveBound||(je&&je.addEventListener("click",Ar),En.saveBound=!0),Fa(),j.dataset.initialized="true",En.initialized=!0,!0):!1},rr=()=>{nt&&(nt.classList.remove("aipkit-active"),nt.setAttribute("aria-hidden","true"),Ke&&Ke.setAttribute("aria-expanded","false"))},Ko=()=>{ae&&(ae.classList.add("aipkit-active"),ae.setAttribute("aria-hidden","false"),Se&&Se.focus())},da=()=>{ae&&(ae.classList.remove("aipkit-active"),ae.setAttribute("aria-hidden","true"))},sr=()=>bt||D,Ji=(j,te)=>{let de=sr();W(de,j,te)},On=()=>{ii&&window.clearTimeout(ii),ii=window.setTimeout(()=>{Ji("","")},3e3)},pa=j=>{if(!Pt)return;let te=w(j);Pt.textContent=te.singular},ko=(j,te={})=>{if(!Ze)return;let de=m(j),he=te.preserveValue===!0?Ze.value:"";Ze.innerHTML=`<option value="">${Yt(r("-- Select --","gpt3-ai-content-generator"))}</option>`;let $e=[];if(de==="pinecone"?$e=gn.pineconeIndexes:de==="qdrant"&&($e=gn.qdrantCollections),Array.isArray($e)&&$e.forEach(Te=>{let Ue=Te?.name||Te?.id||(typeof Te=="string"?Te:"");if(!Ue)return;let We=document.createElement("option");We.value=Ue,We.textContent=Ue,Ze.appendChild(We)}),he&&Ze.querySelector(`option[value="${Fo(he)}"]`))Ze.value=he;else if(he){let Te=document.createElement("option");Te.value=he,Te.textContent=he,Ze.appendChild(Te),Ze.value=he}},ua=()=>{if(!Qt||!Mi)return;let j=Mi.options[Mi.selectedIndex];j&&j.dataset.provider&&(Qt.value=j.dataset.provider)},wo=()=>({semantic_search_vector_provider:Je?Je.value:"",semantic_search_target_id:Ze?Ze.value:"",semantic_search_embedding_provider:Qt?Qt.value:"",semantic_search_embedding_model:Mi?Mi.value:"",semantic_search_num_results:ti?ti.value:"",semantic_search_no_results_text:gt?gt.value:""}),Zn=async(j={})=>{let te=j.mode||"auto";ua();let de=wo();if(de.semantic_search_vector_provider){te==="auto"&&Ji(r("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",de),uo.dirty=!1,Ji(r(te==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),On()}catch(ce){let he=ce&&ce.message?ce.message:r("Failed to save settings.","gpt3-ai-content-generator");Ji(`${r("Error:","gpt3-ai-content-generator")} ${he}`,"error"),On()}}},$a=async()=>{if(Ho){ta=!0;return}Ho=!0,await Zn({mode:"auto"}),Ho=!1,ta&&(ta=!1,$a())},eo=()=>{Ca&&window.clearTimeout(Ca),uo.dirty=!0,Ca=window.setTimeout(()=>{$a()},600)},di=()=>{if(uo.autosaveBound)return;let j=(te,de=["change"])=>{te&&de.forEach(ce=>te.addEventListener(ce,eo))};j(Je),j(Ze),j(Mi),j(ti,["input","change"]),j(gt,["input","change"]),uo.autosaveBound=!0},ho=()=>uo.initialized||!Je||!Ze||!Mi?!1:(pa(Je.value),ko(Je.value,{preserveValue:!0}),ua(),di(),uo.initialized=!0,!0),cr=()=>{Be&&(ho(),Be.classList.add("aipkit-active"),Be.setAttribute("aria-hidden","false"),Ve&&Ve.focus())},_a=()=>{Be&&(Be.classList.remove("aipkit-active"),Be.setAttribute("aria-hidden","true"))},Oa=j=>{if(!Jt)return;let te=Jt.querySelector(".aipkit_spinner");te&&(te.style.display=j?"inline-block":"none"),Jt.disabled=j,Jt.setAttribute("aria-disabled",j?"true":"false")},bi=(j,te="")=>{li&&(li.className="aipkit_sources_semantic_results aipkit_form-help",te&&li.classList.add(`aipkit_form-help-${te}`),li.textContent=j)},lr=async j=>{if(!li)return;let te=wo();if(!te.semantic_search_vector_provider||!te.semantic_search_target_id||!te.semantic_search_embedding_model){bi(r("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!gn.nonce){bi(r("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(uo.dirty||Ho)&&await Zn({mode:"auto"}),Oa(!0),li.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let de=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:gn.nonce,query:j});li.className="aipkit_sources_semantic_results",li.innerHTML=de.html||`<p>${Yt(te.semantic_search_no_results_text||r("No results found.","gpt3-ai-content-generator"))}</p>`}catch(de){let ce=de&&de.message?de.message:r("An error occurred while searching.","gpt3-ai-content-generator");bi(`${r("Error:","gpt3-ai-content-generator")} ${ce}`,"error")}finally{Oa(!1)}},yn=async(j=1)=>{Ne.page=j,W(D,"",""),L.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${Yt(r("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,O&&(O.innerHTML="");try{let te=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Ne.page,per_page:Ne.perPage,provider:Ne.provider,status:Ne.status,type:Ne.type,search:Ne.search,store_id:xa()});N(L,te.logs||[]),G(te.pagination||{},O,yn)}catch(te){let de=te&&te.message?te.message:r("Error loading sources.","gpt3-ai-content-generator");H(L,O,de),W(D,de,"error")}},rn=(()=>{let j=document.getElementById("aipkit_sources_training_toggle"),te=document.getElementById("aipkit_sources_training_card");if(!j||!te)return null;let de=te.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),ce=te.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),he=te.querySelector(".aipkit_training_text_input"),$e=te.querySelector("#aipkit_training_qa_question"),Te=te.querySelector("#aipkit_training_qa_answer"),Ue=te.querySelector("#aipkit_training_files_input"),We=te.querySelector(".aipkit_training_files_button"),Re=te.querySelector(".aipkit_builder_dropzone"),_t=te.querySelector("#aipkit_training_file_list"),Rt=te.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),ni=te.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),ht=te.querySelector(".aipkit_training_stop_btn"),Xi=te.querySelector(".aipkit_training_action_row"),Ai=te.querySelector("#aipkit_training_status")||D,Mt=document.getElementById("aipkit_sources_embedding_row"),_i=document.getElementById("aipkit_sources_embedding_model"),ki=te.querySelector("#aipkit_vs_wp_content_mode"),qi=te.querySelector("#aipkit_vs_wp_content_status"),Bt=te.querySelector("#aipkit_vs_wp_content_status_specific"),Tn=te.querySelector("#aipkit_vs_wp_content_list_area"),Vt=te.querySelector("#aipkit_vs_wp_content_pagination"),Na=te.querySelector("#aipkit_vs_wp_content_messages_area"),Ra=te.querySelector("#aipkit_vs_global_target_select"),un=te.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Si=te.querySelector("#aipkit_wp_content_bulk_panel"),Da=te.querySelector("#aipkit_wp_content_specific_panel"),pr=te.querySelector("#aipkit_wp_content_bulk_hint"),_n=te.querySelector("#aipkit_wp_content_specific_types_panel"),Qe=te.querySelector("#aipkit_wp_content_status_wrap_bulk"),Wa=te.querySelector("#aipkit_wp_content_status_wrap_specific"),Vi=new Map,zi={page:1,selectedIds:new Set},en=null,ao=null,$o=!1,Ui=(ue,Pe)=>{Ai&&(Ai.textContent=ue||"",Ai.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ue&&Ai.classList.add("is-visible"),Pe&&Ai.classList.add(`is-${Pe}`))},vn=(ue=2500)=>{en&&window.clearTimeout(en),en=window.setTimeout(()=>{Ui("","")},ue)},sn=(ue,Pe="")=>{if(!Na)return;W(Na,ue||"",Pe==="error"?"error":Pe==="success"?"success":"")},cn=(ue=2500)=>{ao&&window.clearTimeout(ao),ao=window.setTimeout(()=>{sn("","")},ue)},to=()=>{let ue=m(R?R.value:""),Pe=Z&&!Z.disabled&&Z.value||"";return!ue||!Pe?null:{providerKey:ue,storeId:Pe}},Ha=()=>{let ue=m(R?R.value:"");if(!ue||ue==="all")return Ui(r("Select a provider first.","gpt3-ai-content-generator"),"error"),vn(),!1;let Pe=to();if(!Pe||!Pe.storeId){let Ae=w(ue);return Ui(n(r("Select a %s first.","gpt3-ai-content-generator"),Ae.singular),"error"),vn(),!1}return!0},ma=ue=>{if(!Number.isFinite(ue))return"";let Pe=["B","KB","MB","GB"],Ae=ue,ze=0;for(;Ae>=1024&&ze<Pe.length-1;)Ae/=1024,ze+=1;let rt=ze===0?0:1;return`${Ae.toFixed(rt)} ${Pe[ze]}`},In=()=>{Re&&(Re.style.display=Vi.size>0&&$o?"none":"")},Fi=(ue=1500)=>{_t&&window.setTimeout(()=>{Vi.clear(),_t.innerHTML="",In()},ue)},vo=ue=>{if(!_t||!ue)return null;let Pe=`${ue.name}_${ue.size}_${ue.lastModified}`;if(Vi.has(Pe))return Vi.get(Pe);let Ae=document.createElement("div");Ae.className="aipkit_training_file_row",Ae.dataset.fileKey=Pe;let ze=document.createElement("div");ze.className="aipkit_training_file_meta";let rt=document.createElement("span");rt.className="aipkit_training_file_name",rt.textContent=ue.name;let Et=document.createElement("span");Et.className="aipkit_training_file_size",Et.textContent=ma(ue.size);let lt=document.createElement("span");return lt.className="aipkit_training_file_status",lt.textContent=r("Queued","gpt3-ai-content-generator"),ze.appendChild(rt),ze.appendChild(Et),Ae.appendChild(ze),Ae.appendChild(lt),_t.appendChild(Ae),Vi.set(Pe,Ae),Ae},Ti=(ue,Pe,Ae)=>{let ze=vo(ue);if(!ze)return;let rt=ze.querySelector(".aipkit_training_file_status");rt&&(rt.textContent=Pe||"",rt.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),Ae&&rt.classList.add(`is-${Ae}`))},Zi=async(ue,Pe,Ae)=>{if(!ue||!ue.name||typeof window.aipkit_apiRequest!="function")return!1;let ze=m(Pe);if(!ze)return!1;let rt=String(ue.name||"").trim();if(!rt)return!1;let Et=It=>String(It||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),lt=Et(rt),Dt=rt.replace(/\.[^/.]+$/,""),yt=[rt,lt,Dt&&Dt!==rt?Dt:""].filter(Boolean),$t=async(It,fn)=>{let oi=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:fn,provider:ze,store_id:Ae||"",type:"file",search:It||""});return Array.isArray(oi.logs)?oi.logs:[]},pt=(It,fn)=>{if(!It.length)return null;let oi=fn.map(Et).filter(Boolean);return It.find(ai=>{let nn=Et(ai.message),Gi=Et(ai.post_title),Eo=Et(ai.file_id);return oi.some(Pn=>nn&&nn.includes(Pn)||Gi&&Gi.includes(Pn)||Eo&&Eo.includes(Pn))})||null};try{for(let oi of yt){let ai=await $t(oi,10),nn=pt(ai,[oi,lt]);if(nn){let Gi=String(nn.status||"").toLowerCase();if(Gi==="indexed"||Gi==="skipped_already_indexed"||Gi==="success")return Ti(ue,r("Trained","gpt3-ai-content-generator"),"success"),!0;if(Gi==="failed")return Ti(ue,r("Failed","gpt3-ai-content-generator"),"error"),!0;if(Gi==="processing"||Gi==="queued")return Ti(ue,r("Processing","gpt3-ai-content-generator"),"loading"),!0}}let It=await $t("",20),fn=pt(It,yt);if(fn){let oi=String(fn.status||"").toLowerCase();if(oi==="indexed"||oi==="skipped_already_indexed"||oi==="success")return Ti(ue,r("Trained","gpt3-ai-content-generator"),"success"),!0;if(oi==="failed")return Ti(ue,r("Failed","gpt3-ai-content-generator"),"error"),!0;if(oi==="processing"||oi==="queued")return Ti(ue,r("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},ro=(ue,Pe,Ae,ze=0)=>{if(!ue||!Pe||!Ae)return;if(ze>=30){Zi(Ae,"openai",ue).then(lt=>{lt||Ti(Ae,r("Queued","gpt3-ai-content-generator"),"warning")});return}let Et=Li("aipkit_vector_store_nonce_openai");if(!Et||typeof window.aipkit_apiRequest!="function"){Zi(Ae,"openai",ue);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:ue,batch_id:Pe,_ajax_nonce:Et}).then(lt=>{let Dt=(lt.status||"").toLowerCase();if(Dt==="completed"){Ti(Ae,r("Trained","gpt3-ai-content-generator"),"success"),yn(1);return}if(Dt==="failed"||Dt==="cancelled"){Ti(Ae,r("Failed","gpt3-ai-content-generator"),"error");return}Ti(Ae,r("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{ro(ue,Pe,Ae,ze+1)},2500)}).catch(()=>{setTimeout(()=>{ro(ue,Pe,Ae,ze+1)},3e3)})},ur=ue=>ue?Array.isArray(ue)?ue.flatMap(Pe=>{if(Array.isArray(Pe))return Pe;if(Pe&&typeof Pe=="object"){if(Array.isArray(Pe.models))return Pe.models;if(Array.isArray(Pe.items))return Pe.items;if(Pe.id)return[Pe]}return[]}):typeof ue=="object"?Object.values(ue).flatMap(Pe=>Array.isArray(Pe)?Pe:[]):[]:[],jo=ue=>{let Pe=window.aipkit_dashboard?.embeddingModels||{};return ur(Pe[ue]||[])},ga=(ue,Pe)=>{if(!Pe)return null;let ze=jo(ue).find(lt=>lt&&lt.id===Pe),rt=ze?.dimensions||ze?.dimension||ze?.output_dimensionality||ze?.outputDimensionality||ze?.output_dimension,Et=rt?Number(rt):NaN;if(Number.isFinite(Et)&&Et>0)return Et;if(ze&&typeof ze.name=="string"){let lt=ze.name.match(/\((\d{3,5})\)/);if(lt)return Number(lt[1])}return ue==="google"?768:1536},tn=ue=>{if(!_i)return;let Pe=m(ue),Ae=Pe&&Ne.embeddingByProvider?Ne.embeddingByProvider[Pe]:"";if(!Ae)return;let ze=Fo(Ae);_i.querySelector(`option[value="${ze}"]`)&&(_i.value=Ae)},Gn=()=>{if(!_i)return;let ue=_i.value||"",Pe=["openai","google","openrouter","azure"],Ae={openai:r("OpenAI","gpt3-ai-content-generator"),google:r("Google","gpt3-ai-content-generator"),openrouter:r("OpenRouter","gpt3-ai-content-generator"),azure:r("Azure","gpt3-ai-content-generator")};_i.innerHTML="";let ze=document.createElement("option");ze.value="",ze.textContent=r("Select embedding model","gpt3-ai-content-generator"),_i.appendChild(ze);let rt=!1;if(Pe.forEach(lt=>{let Dt=jo(lt);if(!Dt.length)return;let yt=document.createElement("optgroup");yt.label=Ae[lt]||lt,Dt.forEach($t=>{let pt=$t.id||"";if(!pt)return;let It=document.createElement("option");It.value=`${lt}::${pt}`,It.textContent=$t.name||pt,It.dataset.provider=lt,It.dataset.model=pt,yt.appendChild(It)}),yt.children.length&&(_i.appendChild(yt),rt=!0)}),!rt){_i.innerHTML="";let lt=document.createElement("option");lt.value="",lt.textContent=r("No embedding models found.","gpt3-ai-content-generator"),_i.appendChild(lt),_i.disabled=!0;return}if(_i.disabled=!1,ue){let lt=Fo(ue);if(_i.querySelector(`option[value="${lt}"]`)){_i.value=ue;return}}let Et=_i.querySelector("optgroup option");Et&&(_i.value=Et.value)},Nn=()=>{if(!_i)return null;let ue=_i.options[_i.selectedIndex],Pe=ue&&ue.dataset.provider||"",Ae=ue&&ue.dataset.model||"";if(!Pe||!Ae){let ze=_i.value||"";if(ze&&ze.includes("::")){let[rt,Et]=ze.split("::");Pe=rt||"",Ae=Et||""}}return!Pe||!Ae?null:{provider:Pe,model:Ae,dimension:ga(Pe,Ae)}},Va=ue=>{!ht||!ni||(ue?(ht.hidden=!1,ht.disabled=!1,ni.disabled=!0):(ht.hidden=!0,ht.disabled=!1,ni.disabled=!1))},$i=()=>{let ue=to(),Pe=m(R?R.value:ue?.providerKey||"");if(Rt.forEach(Ae=>{Ae.disabled=!1,Ae.removeAttribute("aria-disabled")}),Mt){let Ae=Pe==="pinecone"||Pe==="qdrant";Mt.hidden=!Ae,Ae&&tn(Pe)}if(Ra){let Ae=ue?ue.storeId:"";Ra.innerHTML=Ae?`<option value="${Yt(Ae)}">${Yt(Ae)}</option>`:'<option value=""></option>',Ra.value=Ae}},st=ue=>{if(!de||!ue)return;de.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(Ae=>{let ze=Ae.dataset.aipkitTab===ue;Ae.classList.toggle("is-active",ze),Ae.setAttribute("aria-selected",ze?"true":"false")}),ce.forEach(Ae=>{let ze=Ae.dataset.aipkitPanel===ue;Ae.classList.toggle("is-active",ze),Ae.hidden=!ze}),ni&&(ni.style.display=ue==="files"?"none":""),Xi&&Xi.classList.toggle("aipkit_builder_action_row--end",ue==="files")},Oi=()=>{let ue=de?de.querySelector(".aipkit_builder_tab.is-active"):null;return ue?ue.dataset.aipkitTab:""},Oo=()=>ki&&ki.value||"bulk",Ua=ue=>{let Pe=ue==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Ae=document.getElementById(Pe);return Ae?Array.from(Ae.selectedOptions).map(ze=>ze.value).filter(Boolean):[]},Ga=ue=>{let Pe=ue==="specific"?Bt:qi;return Pe&&Pe.value||"publish"},bo=()=>Tn?Array.from(Tn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(ue=>ue.value):[],ka=(ue,Pe,Ae)=>{if(!Pe)return;Pe.innerHTML="";let ze=Number(ue?.total_posts||0),rt=Number(ue?.total_pages||0),Et=Number(ue?.current_page||1);if(!ze)return;let lt=document.createElement("span");if(lt.className="aipkit_pagination-count",lt.textContent=`${ze.toLocaleString()} ${t("item","items",ze,"gpt3-ai-content-generator")}`,Pe.appendChild(lt),rt<=1)return;let Dt=document.createElement("span");Dt.className="aipkit_pagination-links";let yt=document.createElement("button");yt.type="button",yt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",yt.textContent=r("Prev","gpt3-ai-content-generator"),yt.disabled=Et<=1,yt.addEventListener("click",()=>Ae(Et-1));let $t=document.createElement("span");$t.className="aipkit_pagination-current",$t.textContent=`${Et}/${rt}`;let pt=document.createElement("button");pt.type="button",pt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",pt.textContent=r("Next","gpt3-ai-content-generator"),pt.disabled=Et>=rt,pt.addEventListener("click",()=>Ae(Et+1)),Dt.appendChild(yt),Dt.appendChild($t),Dt.appendChild(pt),Pe.appendChild(Dt)},_r=(ue,Pe)=>{if(!Tn)return;if(Tn.innerHTML="",!Array.isArray(ue)||!ue.length){Tn.innerHTML=`<p class="aipkit_builder_help_text">${Yt(r("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,Vt&&(Vt.innerHTML="");return}let Ae=document.createElement("ul"),ze=document.createElement("div");ze.className="aipkit_wp_content_select_all_wrapper";let rt=document.createElement("label");rt.className="aipkit_training_site_option";let Et=document.createElement("input");Et.type="checkbox",Et.checked=ue.every(lt=>zi.selectedIds.has(String(lt.id))),rt.appendChild(Et),rt.appendChild(document.createTextNode(r("Select all","gpt3-ai-content-generator"))),ze.appendChild(rt),Tn.appendChild(ze),Tn.appendChild(Ae),ue.forEach(lt=>{let Dt=document.createElement("li");Dt.className="aipkit_wp_content_list_item";let yt=document.createElement("input");yt.type="checkbox",yt.name="wp_content_to_index[]",yt.value=String(lt.id),yt.checked=zi.selectedIds.has(String(lt.id)),yt.addEventListener("change",()=>{yt.checked?zi.selectedIds.add(String(lt.id)):zi.selectedIds.delete(String(lt.id)),Et.checked=ue.every(fn=>zi.selectedIds.has(String(fn.id)))});let $t=document.createElement("a");$t.className="aipkit_wp_content_title",$t.href=lt.edit_link||"#",$t.target="_blank",$t.rel="noopener noreferrer",$t.textContent=lt.title||r("Untitled","gpt3-ai-content-generator");let pt=document.createElement("span");pt.className="aipkit_wp_content_type",pt.textContent=lt.type_label||"";let It=document.createElement("span");It.className="aipkit_wp_content_indexed_status",It.textContent=lt.is_already_indexed?r("Indexed","gpt3-ai-content-generator"):"",Dt.appendChild(yt),Dt.appendChild($t),Dt.appendChild(pt),Dt.appendChild(It),Ae.appendChild(Dt)}),Et.addEventListener("change",()=>{Et.checked?ue.forEach(lt=>zi.selectedIds.add(String(lt.id))):ue.forEach(lt=>zi.selectedIds.delete(String(lt.id))),Tn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(lt=>{lt.checked=Et.checked})}),ka(Pe,Vt,so)},so=async ue=>{if(!Tn)return;let Pe=to(),Ae=Oo(),ze=Ua(Ae);if(!ze.length){Tn.innerHTML="",Vt&&(Vt.innerHTML=""),sn(r("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let rt=Li("aipkit_wp_content_fetch_nonce");if(!rt){sn(r("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let Et=Ga(Ae);try{sn(r("Loading content...","gpt3-ai-content-generator"),"");let lt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:rt,post_types:ze,post_status:Et,target_store_id:Pe?Pe.storeId:"",paged:ue});zi.page=ue,_r(lt.posts||[],lt.pagination||{}),sn("","")}catch(lt){sn(lt&&lt.message?lt.message:r("Failed to load content.","gpt3-ai-content-generator"),"error")}},zo=ue=>{ki&&(ki.value=ue),Si&&(Si.hidden=ue!=="bulk"),_n&&(_n.hidden=ue!=="specific"),Da&&(Da.hidden=ue!=="specific"),Qe&&(Qe.hidden=ue!=="bulk"),Wa&&(Wa.hidden=ue!=="specific"),pr&&(pr.hidden=ue!=="bulk"),ue==="specific"&&so(1)},Ka=()=>{te.querySelectorAll(".aipkit_training_site_dropdown").forEach(Pe=>{let Ae=Pe.querySelector(".aipkit_training_site_dropdown_btn"),ze=Pe.querySelector(".aipkit_training_site_dropdown_label"),rt=Pe.querySelector(".aipkit_training_site_dropdown_panel"),lt=Pe.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Dt=document.getElementById(lt);if(!Ae||!rt||!Dt)return;let yt=()=>{let pt=rt.querySelectorAll('input[type="checkbox"]:checked'),It=Pe.dataset.placeholder||r("Select types","gpt3-ai-content-generator"),fn=Pe.dataset.selectedLabel||r("selected","gpt3-ai-content-generator");ze&&(pt.length?ze.textContent=`${pt.length} ${fn}`:ze.textContent=It)},$t=()=>{let pt=Array.from(rt.querySelectorAll('input[type="checkbox"]:checked')).map(It=>It.value);Array.from(Dt.options).forEach(It=>{It.selected=pt.includes(It.value)})};Ae.addEventListener("click",()=>{let pt=Ae.getAttribute("aria-expanded")==="true";Ae.setAttribute("aria-expanded",pt?"false":"true"),rt.hidden=pt}),rt.addEventListener("change",()=>{$t(),yt(),Oo()==="specific"&&so(1)}),document.addEventListener("click",pt=>{Pe.contains(pt.target)||(Ae.setAttribute("aria-expanded","false"),rt.hidden=!0)}),$t(),yt()})},ja=async(ue,Pe,Ae)=>{let ze=Li("aipkit_wp_content_fetch_nonce");if(!ze)throw new Error("WP content fetch nonce missing.");let rt=[],Et=1,lt=1;do{let Dt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ze,post_types:ue,post_status:Pe,target_store_id:Ae||"",paged:Et});(Array.isArray(Dt?.posts)?Dt.posts:[]).forEach(pt=>{rt.push({id:String(pt.id),title:pt.title||n(r("Post %s","gpt3-ai-content-generator"),pt.id)})});let $t=parseInt(Dt?.pagination?.total_pages||1,10);lt=Number.isNaN($t)?1:$t,Et+=1}while(Et<=lt);return rt},za=()=>Tn?Array.from(Tn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(ue=>{let Pe=ue.closest(".aipkit_wp_content_list_item"),Ae=Pe?Pe.querySelector(".aipkit_wp_content_title"):null;return{id:String(ue.value||""),title:Ae&&Ae.textContent.trim()||n(r("Post %s","gpt3-ai-content-generator"),ue.value)}}):[],No=(ue,Pe,Ae,ze)=>{let rt=n(r("Post %s","gpt3-ai-content-generator"),ue),Et=ze&&ze.get(String(ue))||rt;return n(r("Training: %s (%d/%d)","gpt3-ai-content-generator"),Et,Pe+1,Ae)},Ro=async(ue,Pe)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(r("AJAX configuration is missing.","gpt3-ai-content-generator"));ue.set("action",Pe);let Ae=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:ue,credentials:"same-origin"}),ze=await Ae.json();if(!Ae.ok||!ze.success){let rt=ze?.data?.message||r("Upload failed.","gpt3-ai-content-generator");throw new Error(rt)}return ze.data},wa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,ha=()=>{let ue=Nn();return ue||(Ui(r("Select an embedding model.","gpt3-ai-content-generator"),"warning"),vn(),null)},fr=async(ue,Pe)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(r("Embedding nonce missing.","gpt3-ai-content-generator"));let Ae=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ue,embedding_provider:Pe.provider,embedding_model:Pe.model,_ajax_nonce:window.aipkit_dashboard.nonce}),ze=Ae.embeddings&&Ae.embeddings.length?Ae.embeddings[0]:null;if(!ze)throw new Error(r("Failed to generate embedding.","gpt3-ai-content-generator"));return ze},So=async({content:ue,indexName:Pe,embedding:Ae,metadata:ze})=>{let rt=Li("aipkit_vector_store_pinecone_nonce_management");if(!rt)throw new Error(r("Pinecone nonce missing.","gpt3-ai-content-generator"));let Et=await fr(ue,Ae);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:rt,vectors:JSON.stringify([{id:ze.vector_id,values:Et,metadata:ze}]),embedding_provider:Ae.provider,embedding_model:Ae.model,original_text_content:ue,index_name:Pe})},mr=async({content:ue,collectionName:Pe,embedding:Ae,metadata:ze,sourceContext:rt})=>{let Et=Li("aipkit_vector_store_qdrant_nonce_management");if(!Et)throw new Error(r("Qdrant nonce missing.","gpt3-ai-content-generator"));let lt=await fr(ue,Ae),Dt={_ajax_nonce:Et,vectors:JSON.stringify([{id:ze.vector_id,vector:lt,payload:ze}]),embedding_provider:Ae.provider,embedding_model:Ae.model,original_text_content:ue,collection_name:Pe,source_context:rt||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Dt)},io=async()=>{if($o)return;let ue=to();if(!ue){Ui(r("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),vn();return}let Pe=Oi(),Ae="",ze=[],rt=null,Et="text_entry_global_form",lt="file_upload_global_form";if(Pe==="text"){if(Ae=he?he.value.trim():"",!Ae){Ui(r("Add text to train.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(Pe==="qa"){let yt=$e?$e.value.trim():"",$t=Te?Te.value.trim():"";if(!yt||!$t){Ui(r("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),vn();return}Ae=`Q: ${yt}
A: ${$t}`}else if(Pe==="files"){if(ze=Ue?Array.from(Ue.files||[]):[],!ze.length){Ue&&Ue.click(),Ui(r("Choose files to upload.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(Pe==="website"){let yt=Oo(),$t=Ga(yt),pt=Ua(yt),It=bo();if(yt==="specific"&&!It.length){Ui(r("Select content to train.","gpt3-ai-content-generator"),"warning"),vn();return}if(yt==="bulk"&&!pt.length){Ui(r("Select at least one post type.","gpt3-ai-content-generator"),"warning"),vn();return}rt={mode:yt,statusValue:$t,postTypes:pt,selectedPostIds:It}}else{Ui(r("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),vn();return}let Dt=null;if(!((ue.providerKey==="pinecone"||ue.providerKey==="qdrant")&&(Dt=ha(),!Dt))){$o=!0,Va(!0),Rt.forEach(yt=>{yt.disabled=!0}),Ui(r("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(Pe==="files"){In();for(let yt=0;yt<ze.length;yt+=1){let $t=ze[yt];Ui(n(r("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),yt+1,ze.length),"loading"),Ti($t,r("Uploading","gpt3-ai-content-generator"),"loading");try{let pt=new FormData;if(ue.providerKey==="openai"){let It=Li("aipkit_vector_store_nonce_openai");if(!It)throw new Error(r("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));pt.append("aipkit_vs_global_file_to_submit",$t),pt.append("target_store_id",ue.storeId),pt.append("source_type",lt),pt.append("_ajax_nonce",It);let fn=await Ro(pt,"aipkit_upload_and_add_file_to_store_direct_openai");Ti($t,r("Processing","gpt3-ai-content-generator"),"loading");let oi=fn?.batch?.id;Zi($t,ue.providerKey,ue.storeId).then(ai=>{if(!ai){if(oi){ro(ue.storeId,oi,$t);return}Ti($t,r("Queued","gpt3-ai-content-generator"),"warning")}})}else if(ue.providerKey==="pinecone"){let It=Li("aipkit_vector_store_pinecone_nonce_management");if(!It)throw new Error(r("Pinecone nonce missing.","gpt3-ai-content-generator"));pt.append("file_to_upload",$t),pt.append("index_name",ue.storeId),pt.append("embedding_provider",Dt.provider),pt.append("embedding_model",Dt.model),pt.append("_ajax_nonce",It),await Ro(pt,"aipkit_upload_file_and_upsert_to_pinecone"),Ti($t,r("Trained","gpt3-ai-content-generator"),"success")}else if(ue.providerKey==="qdrant"){let It=Li("aipkit_vector_store_qdrant_nonce_management");if(!It)throw new Error(r("Qdrant nonce missing.","gpt3-ai-content-generator"));pt.append("file_to_upload",$t),pt.append("target_store_id",ue.storeId),pt.append("embedding_provider",Dt.provider),pt.append("embedding_model",Dt.model),pt.append("source_context","sources_module_file_upload"),pt.append("_ajax_nonce",It),await Ro(pt,"aipkit_upload_file_and_upsert_to_qdrant"),Ti($t,r("Trained","gpt3-ai-content-generator"),"success")}}catch(pt){throw Ti($t,r("Failed","gpt3-ai-content-generator"),"error"),pt}}Ue&&(Ue.value=""),In(),Ui(r("Saved","gpt3-ai-content-generator"),"success"),sn(r("Saved","gpt3-ai-content-generator"),"success"),cn(),vn(),Fi(),yn(1);return}if(Pe==="website"&&rt){let{mode:yt,statusValue:$t,postTypes:pt}=rt,It=[],fn=new Map;if(yt==="bulk"){Ui(r("Preparing website content...","gpt3-ai-content-generator"),"loading");let oi=await ja(pt,$t,ue.storeId);if(It=oi.map(ai=>ai.id),fn=new Map(oi.map(ai=>[String(ai.id),ai.title])),!It.length){sn(r("No posts found for selection.","gpt3-ai-content-generator"),"error"),Ui(r("Nothing to train.","gpt3-ai-content-generator"),"warning"),vn();return}}if(yt!=="bulk"){let oi=za();It=oi.map(ai=>ai.id),fn=new Map(oi.map(ai=>[String(ai.id),ai.title]))}if(Ui(r("Training...","gpt3-ai-content-generator"),"loading"),sn(n(r("Training %d item(s)...","gpt3-ai-content-generator"),It.length),""),ue.providerKey==="openai"){let oi=Li("aipkit_wp_content_index_nonce");if(!oi)throw new Error(r("WP content index nonce missing.","gpt3-ai-content-generator"));for(let ai=0;ai<It.length;ai+=1){let nn=It[ai];sn(No(nn,ai,It.length,fn),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:oi,post_ids:[nn],target_store_id:ue.storeId,provider:"openai"})}}else if(ue.providerKey==="pinecone")for(let oi=0;oi<It.length;oi+=1){let ai=It[oi];sn(No(ai,oi,It.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Li("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[ai]}),Gi=nn.posts_content&&nn.posts_content[ai]?nn.posts_content[ai]:null;if(!Gi||!Gi.content)continue;let Eo=Bo(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:ai,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};Pn.vector_id=Eo,await So({content:Gi.content,indexName:ue.storeId,embedding:Dt,metadata:Pn})}else if(ue.providerKey==="qdrant")for(let oi=0;oi<It.length;oi+=1){let ai=It[oi];sn(No(ai,oi,It.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Li("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[ai]}),Gi=nn.posts_content&&nn.posts_content[ai]?nn.posts_content[ai]:null;if(!Gi||!Gi.content)continue;let Eo=wa(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:ai,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};await mr({content:Gi.content,collectionName:ue.storeId,embedding:Dt,metadata:Pn,sourceContext:"sources_module_website"})}Ui(r("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1);return}if(ue.providerKey==="openai"){let yt=Li("aipkit_vector_store_nonce_openai");if(!yt)throw new Error(r("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:yt,target_store_id:ue.storeId,text_content:Ae,source_type:Et})}else if(ue.providerKey==="pinecone"){let yt=Bo(),$t={source:Et,created_at:new Date().toISOString(),original_content:Ae,vector_id:yt};await So({content:Ae,indexName:ue.storeId,embedding:Dt,metadata:$t})}else if(ue.providerKey==="qdrant"){let yt=Bo(),$t={source:Et,created_at:new Date().toISOString(),original_content:Ae,vector_id:yt};await mr({content:Ae,collectionName:ue.storeId,embedding:Dt,metadata:$t,sourceContext:"sources_module_training"})}Pe==="text"&&he&&(he.value=""),Pe==="qa"&&($e&&($e.value=""),Te&&(Te.value="")),Ui(r("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1)}catch(yt){Ui(n(r("Error: %s","gpt3-ai-content-generator"),yt?.message||r("Training failed.","gpt3-ai-content-generator")),"error")}finally{$o=!1,Va(!1),$i(),In()}}};if(j.addEventListener("click",()=>{let ue=te.hidden;te.hidden=!ue,j.setAttribute("aria-expanded",ue?"true":"false"),ue&&($i(),Gn(),tn(R?R.value:""))}),de){let ue=de.querySelector(".aipkit_builder_tab.is-active");ue&&st(ue.dataset.aipkitTab),de.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(Pe=>{Pe.addEventListener("click",()=>{st(Pe.dataset.aipkitTab)})})}return We&&Ue&&We.addEventListener("click",()=>{Ha()&&Ue.click()}),Ue&&Ue.addEventListener("change",()=>{if(!Ha()){Ue.value="";return}let ue=Array.from(Ue.files||[]);ue.length&&(ue.forEach(Pe=>{vo(Pe),Ti(Pe,r("Queued","gpt3-ai-content-generator"))}),In(),io())}),Rt.forEach(ue=>{ue.addEventListener("click",io)}),ht&&ht.addEventListener("click",()=>{$o&&(ht.disabled=!0,Ui(r("Stopping...","gpt3-ai-content-generator"),"warning"))}),_i&&_i.addEventListener("change",()=>{let ue=m(R?R.value:"");ue&&(Ne.embeddingByProvider[ue]=_i.value||"",u({provider:Ne.provider,status:Ne.status,type:Ne.type,indexByProvider:Ne.indexByProvider,embeddingByProvider:Ne.embeddingByProvider}))}),un.length&&un.forEach(ue=>{ue.addEventListener("change",()=>{ue.checked&&zo(ue.value)})}),qi&&qi.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Bt&&Bt.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Ka(),$i(),Gn(),tn(R?R.value:""),zo(Oo()),{updateTargetState:$i}})();R&&R.addEventListener("change",()=>{Ne.provider=R.value,Dn(Ne.provider),rn?.updateTargetState?.(),u({provider:Ne.provider,status:Ne.status,type:Ne.type,indexByProvider:Ne.indexByProvider,embeddingByProvider:Ne.embeddingByProvider}),yn(1)}),Di&&Di.addEventListener("click",()=>{m(R?R.value:"")&&(Ne.openIndexCreateOnOpen=!0,oa(Di))}),J&&J.addEventListener("change",()=>{Ne.status=J.value,u({provider:Ne.provider,status:Ne.status,type:Ne.type,indexByProvider:Ne.indexByProvider,embeddingByProvider:Ne.embeddingByProvider}),yn(1)}),pe&&pe.addEventListener("change",()=>{Ne.type=pe.value,u({provider:Ne.provider,status:Ne.status,type:Ne.type,indexByProvider:Ne.indexByProvider,embeddingByProvider:Ne.embeddingByProvider}),yn(1)});let fa=()=>{if(!Ce)return;let j=Ce.value.trim();j!==Ne.search&&(Ne.search=j,yn(1))},dr=()=>{Ce&&(ji&&window.clearTimeout(ji),ji=window.setTimeout(()=>{fa()},300))};if(Ce&&(Ce.addEventListener("input",dr),Ce.addEventListener("search",fa),Ce.addEventListener("keydown",j=>{j.key==="Enter"&&(j.preventDefault(),ji&&window.clearTimeout(ji),fa())})),Z&&Z.addEventListener("change",()=>{let j=m(R?R.value:"");j&&(Ne.indexByProvider[j]=Z.value||"",u({provider:Ne.provider,status:Ne.status,type:Ne.type,indexByProvider:Ne.indexByProvider,embeddingByProvider:Ne.embeddingByProvider}),Un(),rn?.updateTargetState?.(),yn(1))}),He&&He.dataset.configListenersAttached!=="true"){let j=te=>{te.target.closest("[data-aipkit-provider-config]")&&ra()};He.addEventListener("input",j),He.addEventListener("change",j),He.dataset.configListenersAttached="true"}Wt&&Wt.addEventListener("click",Jn),Wi&&Wi.addEventListener("click",Jn),xt&&!xt.dataset.bound&&(document.addEventListener("keydown",j=>{j.key==="Escape"&&xt.classList.contains("aipkit-active")&&Jn()}),xt.dataset.bound="1"),Vn&&Vn.addEventListener("click",Ia),ke&&ke.addEventListener("click",Ia),Oe&&Oe.addEventListener("click",go),qt&&qt.addEventListener("click",go),ot&&ot.addEventListener("click",async()=>{if(!Le)return;let j=Le.dataset.provider||"",te=Le.dataset.storeId||"",de=Le.dataset.vectorId||"",ce=Le.dataset.logId||"";if(!j||!te||!de||!ce){W(D,r("Missing source details.","gpt3-ai-content-generator"),"error"),Mn(),go();return}go();let he=null,$e=[];if(L){let Te=Fo(ce);if(he=L.querySelector(`tr[data-log-id="${Te}"]`),he){$e=Array.from(he.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),$e.forEach(We=>{We.disabled=!0,We.setAttribute("aria-disabled","true")});let Ue=he.querySelector(".aipkit_sources_action_delete");Ue&&(Ue.textContent=r("Deleting...","gpt3-ai-content-generator"))}}ot&&(ot.disabled=!0),W(D,r("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:j,store_id:te,vector_id:de,log_id:ce}),W(D,r("Deleted","gpt3-ai-content-generator"),"success"),Mn(),yn(Ne.page||1)}catch(Te){let Ue=Te&&Te.message?Te.message:r("Failed to delete source.","gpt3-ai-content-generator");W(D,`${r("Error:","gpt3-ai-content-generator")} ${Ue}`,"error"),Mn(),$e.forEach(Re=>{Re.disabled=!1,Re.removeAttribute("aria-disabled")});let We=he?he.querySelector(".aipkit_sources_action_delete"):null;We&&(We.textContent=r("Delete","gpt3-ai-content-generator"))}finally{ot&&(ot.disabled=!1)}}),Sn&&Sn.addEventListener("click",async()=>{if(!xt||!pi)return;let j=pi.value.trim();if(!j){W(D,r("Text cannot be empty.","gpt3-ai-content-generator"),"error"),Mn();return}let te=xt.dataset.provider||"",de=xt.dataset.storeId||"",ce=xt.dataset.vectorId||"",he=xt.dataset.logId||"",$e=xt.dataset.embeddingProvider||"",Te=xt.dataset.embeddingModel||"";if(!te||!de||!ce||!he){W(D,r("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}Jn();let Ue=[];if(L&&he){let We=Fo(he),Re=L.querySelector(`tr[data-log-id="${We}"]`);Ue=Re?Array.from(Re.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],Ue.forEach(_t=>{_t.disabled=!0,_t.setAttribute("aria-disabled","true"),_t.classList.contains("aipkit_sources_action_edit")&&(_t.textContent=r("Training...","gpt3-ai-content-generator"))})}W(D,r("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:te,store_id:de,vector_id:ce,log_id:he}),await ir(te,de,j,$e,Te),W(D,r("Trained","gpt3-ai-content-generator"),"success"),Mn(),yn(Ne.page||1)}catch(We){let Re=We&&We.message?We.message:r("Failed to save source.","gpt3-ai-content-generator");W(D,`${r("Error:","gpt3-ai-content-generator")} ${Re}`,"error"),Mn(),Ue.forEach(_t=>{_t.disabled=!1,_t.removeAttribute("aria-disabled"),_t.classList.contains("aipkit_sources_action_edit")&&(_t.textContent=r("Edit","gpt3-ai-content-generator"))})}}),F.addEventListener("click",async j=>{let te=j.target.closest(".aipkit_sources_provider_create");if(te){let Ue=te.dataset.provider||"";Ue&&Mo(Ue,te);return}let de=j.target.closest(".aipkit_sources_provider_delete_selected");if(de){let Ue=m(R?R.value:de.dataset.provider||""),We=Z?Z.value:"";if(!Ue||!We){let Rt=w(Ue);an(n(r("Select a %s to delete.","gpt3-ai-content-generator"),Rt.singular.toLowerCase()),"error"),kn();return}let Re=Z&&Z.selectedOptions?Z.selectedOptions[0]:null,_t=Re?Re.textContent:We;Po(Ue,We,_t,de);return}let ce=j.target.closest(".aipkit_sources_action_edit");if(ce){er(ce);return}let he=j.target.closest(".aipkit_sources_action_view");if(he){let Ue=he.dataset.snippet||"";if(!Ue){W(D,r("No preview available for this source.","gpt3-ai-content-generator"),"error"),Mn();return}Cn(Ue);return}let $e=j.target.closest(".aipkit_sources_action_delete");if($e){let Ue=$e.dataset.provider||"",We=$e.dataset.storeId||"",Re=$e.dataset.vectorId||"",_t=$e.dataset.logId||"";if(!Ue||!We||!Re||!_t){W(D,r("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}qo({provider:Ue,storeId:We,vectorId:Re,logId:_t});return}let Te=j.target.closest(".aipkit_sources_action_retrain");if(Te){let Ue=Te.dataset.provider||"",We=Te.dataset.storeId||"",Re=Te.dataset.vectorId||"",_t=Te.dataset.logId||"",Rt=Te.dataset.postId||"",ni=Te.dataset.embeddingProvider||"",ht=Te.dataset.embeddingModel||"";if(!Ue||!We||!Re||!_t||!Rt){W(D,r("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}let Xi=Te.closest("tr"),Ai=Xi?Array.from(Xi.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];Ai.forEach(Mt=>{Mt.disabled=!0,Mt.setAttribute("aria-disabled","true")}),Te.textContent=r("Training...","gpt3-ai-content-generator"),W(D,r("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Ue,store_id:We,vector_id:Re,log_id:_t,post_id:Rt,embedding_provider:ni,embedding_model:ht}),W(D,r("Retrained","gpt3-ai-content-generator"),"success"),Mn(),yn(Ne.page||1)}catch(Mt){let _i=Mt&&Mt.message?Mt.message:r("Failed to retrain source.","gpt3-ai-content-generator");W(D,`${r("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Mn(),Ai.forEach(ki=>{ki.disabled=!1,ki.removeAttribute("aria-disabled")}),Te.textContent=r("Retrain","gpt3-ai-content-generator")}}}),Ke&&Ke.addEventListener("click",()=>{oo()}),ge&&ge.addEventListener("click",j=>{j.preventDefault(),oo(),rr(),Ko()}),Fe&&Fe.addEventListener("click",j=>{j.preventDefault(),rr(),cr()}),Se&&Se.addEventListener("click",j=>{j.preventDefault(),da()}),ae&&ae.addEventListener("click",j=>{j.target===ae&&da()}),Ve&&Ve.addEventListener("click",j=>{j.preventDefault(),_a()}),Be&&Be.addEventListener("click",j=>{j.target===Be&&_a()}),document.addEventListener("keydown",j=>{j.key==="Escape"&&ae&&ae.classList.contains("aipkit-active")&&da(),j.key==="Escape"&&Be&&Be.classList.contains("aipkit-active")&&_a()}),Je&&Je.addEventListener("change",()=>{let j=Je.value;pa(j),ko(j),Ze&&(Ze.value=""),eo()}),Ze&&Ze.addEventListener("change",eo),Mi&&Mi.addEventListener("change",()=>{ua(),eo()}),ti&&(ti.addEventListener("input",eo),ti.addEventListener("change",eo)),gt&&(gt.addEventListener("input",eo),gt.addEventListener("change",eo)),tt&&tt.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",tt)}),Ye&&Ye.addEventListener("submit",j=>{if(j.preventDefault(),!ei)return;let te=ei.value.trim();te&&lr(te)}),bt&&re&&(re.innerHTML=""),Dn(R?R.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(F),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(F),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),yn(1)}window.aipkit_initSources=Q})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector("#aipkit_stats_settings_popover");if(!n)return;let t=Array.from(n.querySelectorAll("[data-aipkit-settings-panel]"));if(!t.length||n.dataset.panelsBound==="true")return;let a=n.querySelector(".aipkit_model_settings_popover_title"),s=n.querySelector(".aipkit_model_settings_popover_back"),l=r.querySelector("#aipkit_stats_settings_trigger"),c={root:n.dataset.titleRoot||"Log Settings","log-retention":n.dataset.titleLogRetention||"Log retention"},o=null,e=i=>{let d=i||"root",u=n.querySelector(`[data-aipkit-settings-panel="${d}"]`)||n.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let p=u.dataset.aipkitSettingsPanel||"root";p!==o&&(t.forEach(f=>{f.hidden=f!==u}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),o=p,n.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};n.addEventListener("click",i=>{let d=i.target.closest("[data-aipkit-panel-target]");if(!d)return;i.preventDefault();let u=d.dataset.aipkitPanelTarget;e(u)}),s&&s.addEventListener("click",i=>{i.preventDefault(),e("root")}),l&&l.addEventListener("click",()=>{e("root")}),e("root"),n.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=k})();(function(){"use strict";let n="aipkit_stats_overview_open",t=e=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(e):(e==null?"":String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=e=>{let i=Number(e||0);return Number.isNaN(i)?"0":i.toLocaleString()},s=e=>{let i=Number(e);if(!i)return"";let d=new Date(i*1e3);return Number.isNaN(d.getTime())?"":d.toLocaleString()},l=e=>{let i=Number(e);if(!i)return"";let d=Date.now()/1e3,u=Math.floor(d-i);if(Number.isNaN(u)||u<0)return s(i);if(u<60)return"Just now";let p=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],f=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let m of p)if(u>=m.seconds){let g=Math.floor(u/m.seconds);return f?f.format(-g,m.unit):`${g} ${m.unit}${g!==1?"s":""} ago`}return s(i)},c=e=>{if(typeof e=="string")return e;if(e==null)return"";try{return JSON.stringify(e,null,2)}catch{return String(e)}};function o(){let e=document.getElementById("aipkit_stats_container");if(!e)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(e),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(e);let i={days:parseInt(e.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},d=wp.i18n&&wp.i18n.__?wp.i18n.__:re=>re,u={page:1,search:"",botTitles:{}},p=null,f=null,m=null,g=!1,_={status:e.querySelector("#aipkit_stats_status"),overviewPanel:e.querySelector("#aipkit_stats_overview_panel"),overviewToggle:e.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:e.querySelector("#aipkit_stats_period_label"),totalConversations:e.querySelector("#aipkit_stats_total_conversations"),totalMessages:e.querySelector("#aipkit_stats_total_messages"),uniqueUsers:e.querySelector("#aipkit_stats_unique_users"),avgTokens:e.querySelector("#aipkit_stats_avg_tokens"),daysFilter:e.querySelector("#aipkit_stats_days_filter"),botFilter:e.querySelector("#aipkit_stats_bot_filter"),moduleFilter:e.querySelector("#aipkit_stats_module_filter"),searchInput:e.querySelector("#aipkit_stats_search_input"),exportBtn:e.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:e.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:e.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:e.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:e.querySelector("#aipkit_stats_table_body"),pagination:e.querySelector("#aipkit_stats_pagination"),detailPanel:e.querySelector("#aipkit_stats_detail_panel"),conversationChart:e.querySelector("#aipkit_stats_conversation_chart"),moduleChart:e.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:e.querySelector("[data-aipkit-stats-retention-row]"),cronRow:e.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:e.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:e.querySelectorAll(".aipkit_stats_shortcode_option")},w=(()=>{try{let re=e.dataset.moduleLabels||"{}";return JSON.parse(re)}catch{return{}}})(),h=e.dataset.isPro==="1",E=e.dataset.userCreditsNonce||"",x=(re,ve="")=>{if(!_.status)return;let Ee=_.status,Fe=Ee.classList.contains("aipkit_training_status");if(Ee.textContent=re||"",Ee.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),Fe){Ee.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),re&&Ee.classList.add("is-visible"),ve&&Ee.classList.add(`is-${ve}`);return}Ee.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),ve==="success"?Ee.classList.add("aipkit_form-help-success"):ve==="error"&&Ee.classList.add("aipkit_form-help-error")},v=()=>{try{return localStorage.getItem(n)==="1"}catch{return!1}},I=re=>{_.retentionRow&&(_.retentionRow.hidden=!re),_.cronRow&&(_.cronRow.hidden=!re),_.retentionSelect&&(_.retentionSelect.disabled=!re||!h)},P=re=>{!re||!_.cronStatus||(re.state&&_.cronStatus.setAttribute("data-state",re.state),_.cronText&&re.status_text&&(_.cronText.textContent=re.status_text),_.cronLastRun&&re.last_run_label&&(_.cronLastRun.textContent=re.last_run_label))},b=re=>{_.tableBody&&(_.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${t(re)}</td>
                </tr>
            `)},y=re=>{_.userTableBody&&(_.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${t(re)}</td>
                </tr>
            `,_.userNoResults&&(_.userNoResults.hidden=!0))},S=re=>{if(!re)return d("N/A","gpt3-ai-content-generator");let ve=new Date(re*1e3);return Number.isNaN(ve.getTime())?d("N/A","gpt3-ai-content-generator"):ve.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},C=(re,ve)=>{let Ee=Array.isArray(re)?re:[],Fe='<ul class="aipkit_stats_usage_list">';return Ee.length?(Ee.forEach((Be,Ve)=>{let Je=Ve>=2;Fe+=`<li class="${Je?"aipkit_stats_usage_extra":""}"${Je?" hidden":""}>${Be}</li>`}),Fe+="</ul>",{html:Fe,hasToggle:Ee.length>2}):(Fe+=`<li>${t(ve)}</li>`,Fe+="</ul>",{html:Fe,hasToggle:!1})},A=(re,ve)=>{if(!_.userTableBody)return;if(_.userTableBody.innerHTML="",!Array.isArray(re)||re.length===0){_.userNoResults&&(_.userNoResults.hidden=!1);return}_.userNoResults&&(_.userNoResults.hidden=!0);let Ee=ve||{};re.forEach(Fe=>{let Be=document.createElement("tr");Be.dataset.userId=Fe.id;let Ve=document.createElement("td");Ve.textContent=`${Fe.display_name} (${Fe.email})`,Be.appendChild(Ve);let Je=document.createElement("td"),Ze=document.createElement("input");Ze.type="number",Ze.className="aipkit_form-input aipkit_stats_credits_balance_input",Ze.value=Fe.token_balance||0,Ze.dataset.userId=Fe.id,Ze.dataset.originalValue=Fe.token_balance||0,Ze.setAttribute("min","0"),Ze.setAttribute("step","1"),Ze.title=d("Press Enter or blur to save changes","gpt3-ai-content-generator"),Je.appendChild(Ze);let Pt=document.createElement("span");Pt.className="aipkit_stats_credits_balance_status",Je.appendChild(Pt),Be.appendChild(Je);let Mi=document.createElement("td");Mi.textContent=a(Fe.total_used_all_bots||0),Be.appendChild(Mi);let Qt=document.createElement("td"),ti=[],gt=Fe.tokens_used||{},tt=Fe.image_usage||{used:0};tt.used>0&&ti.push(`<strong>${t(d("Image Generator","gpt3-ai-content-generator"))}:</strong> ${a(tt.used)}`),Object.keys(gt||{}).sort((Wt,Wi)=>Number(Wt)-Number(Wi)).forEach(Wt=>{let Wi=gt[Wt]||0;if(Wi<=0)return;let Sn=Ee[Wt]||`Bot #${Wt}`;ti.push(`<strong>${t(Sn)}:</strong> ${a(Wi)}`)});let Ye=C(ti,"-");Qt.innerHTML=Ye.html+(Ye.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${t(d("Show more","gpt3-ai-content-generator"))}...</button>`:""),Be.appendChild(Qt);let ei=document.createElement("td"),li=[],Jt=Fe.last_reset||{};tt.used>0&&li.push(`<strong>${t(d("Image Generator","gpt3-ai-content-generator"))}:</strong> ${t(S(tt.last_reset))}`);let Ut=new Set([...Object.keys(gt||{}),...Object.keys(Jt||{})]);Array.from(Ut).sort((Wt,Wi)=>Number(Wt)-Number(Wi)).forEach(Wt=>{if((gt||{})[Wt]<=0)return;let Wi=Ee[Wt]||`Bot #${Wt}`;li.push(`<strong>${t(Wi)}:</strong> ${t(S(Jt[Wt]||0))}`)});let Di=ti.length>0?d("N/A","gpt3-ai-content-generator"):"-",xt=C(li,Di);ei.innerHTML=xt.html+(xt.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${t(d("Show more","gpt3-ai-content-generator"))}...</button>`:""),Be.appendChild(ei);let pi=document.createElement("td");if(pi.className="aipkit_stats_user_actions_cell",Fe.purchase_history&&Fe.purchase_history.length){let Wt=document.createElement("button");Wt.type="button",Wt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",Wt.title=d("View purchase history","gpt3-ai-content-generator"),Wt.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',Wt.dataset.userName=Fe.display_name,Wt.dataset.history=JSON.stringify(Fe.purchase_history),pi.appendChild(Wt)}else pi.textContent="-";Be.appendChild(pi),_.userTableBody.appendChild(Be)})},M=re=>{if(!_.userPagination||!_.userTableFoot)return;_.userPagination.innerHTML="";let ve=Number(re?.total_users||0),Ee=Number(re?.total_pages||0),Fe=Number(re?.current_page||1);if(!ve){_.userTableFoot.hidden=!0;return}let Be=document.createElement("span");if(Be.className="aipkit_pagination-count",Be.textContent=`${ve.toLocaleString()} ${d("users","gpt3-ai-content-generator")}`,_.userPagination.appendChild(Be),Ee<=1){_.userTableFoot.hidden=!0;return}let Ve=document.createElement("span");Ve.className="aipkit_pagination-links";let Je=document.createElement("button");Je.type="button",Je.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Je.textContent=`\xAB ${d("Previous","gpt3-ai-content-generator")}`,Je.disabled=Fe<=1,Je.addEventListener("click",()=>$(Fe-1,u.search));let Ze=document.createElement("span");Ze.className="aipkit_pagination-current",Ze.textContent=`${d("Page","gpt3-ai-content-generator")} ${Fe} ${d("of","gpt3-ai-content-generator")} ${Ee}`;let Pt=document.createElement("button");Pt.type="button",Pt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Pt.textContent=`${d("Next","gpt3-ai-content-generator")} \xBB`,Pt.disabled=Fe>=Ee,Pt.addEventListener("click",()=>$(Fe+1,u.search)),Ve.appendChild(Je),Ve.appendChild(Ze),Ve.appendChild(Pt),_.userPagination.appendChild(Ve),_.userTableFoot.hidden=!1},$=async(re=1,ve="")=>{if(!(!_.userTableBody||typeof window.aipkit_apiRequest!="function")){y(d("Loading user credits...","gpt3-ai-content-generator")),u.page=re,u.search=ve;try{let Ee=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:re,search:ve});u.botTitles=Ee.bot_titles||{},A(Ee.users_data||[],u.botTitles),M(Ee.pagination||{})}catch(Ee){_.userTableBody&&(_.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${t(Ee.message||d("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),_.userNoResults&&(_.userNoResults.hidden=!0),_.userTableFoot&&(_.userTableFoot.hidden=!0)}}},W=()=>{_.settingsPopover&&(_.settingsPopover.classList.remove("aipkit-active"),_.settingsPopover.setAttribute("aria-hidden","true"),_.settingsTrigger&&_.settingsTrigger.setAttribute("aria-expanded","false"))},H=()=>{_.userSheet&&(_.userSheet.classList.add("aipkit-active"),_.userSheet.setAttribute("aria-hidden","false"),$(u.page,u.search),_.userSearchInput&&_.userSearchInput.focus())},N=()=>{_.userSheet&&(_.userSheet.classList.remove("aipkit-active"),_.userSheet.setAttribute("aria-hidden","true"))},G=()=>{if(!_.shortcodeSnippet||!_.shortcodeOptions)return;let re=!0,ve=!0,Ee=!0;_.shortcodeOptions.forEach(Ve=>{Ve.name==="cfg_show_chatbot"&&(re=Ve.checked),Ve.name==="cfg_show_aiforms"&&(ve=Ve.checked),Ve.name==="cfg_show_imagegenerator"&&(Ee=Ve.checked)});let Fe=[];re||Fe.push('chatbot="false"'),ve||Fe.push('aiforms="false"'),Ee||Fe.push('imagegenerator="false"');let Be="[aipkit_token_usage";Fe.length&&(Be+=` ${Fe.join(" ")}`),Be+="]",_.shortcodeSnippet.textContent=Be},Q=(re,ve)=>{let Ee=Array.isArray(re)?re:[],Fe=document.createElement("div");Fe.className="aipkit-modal-overlay aipkit-active";let Be=()=>Ee.length?Ee.map(Je=>{let Ze=Je?.date?.date?new Date(Je.date.date):null,Pt=Ze&&!Number.isNaN(Ze.getTime())?Ze.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",Mi=(Je.products||[]).map(Qt=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${t(Qt.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${Qt.quantity>1?`${Number(Qt.quantity)}x `:""}
                                        ${a(Qt.tokens_per_item)} ${t(d("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${t(Pt)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${a(Je.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${t(Je.total_amount)} ${t(Je.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${t(d("Order #","gpt3-ai-content-generator"))}${t(Je.order_id)}</div>
                                ${Mi?`<div class="aipkit_stats_purchase_products">${Mi}</div>`:""}
                            </div>
                        `}).join(""):`<p>${t(d("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;Fe.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${t(d("Purchase History for","gpt3-ai-content-generator"))} ${t(ve||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${t(d("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${Be()}</div>
                    </div>
                </div>
            `;let Ve=()=>{Fe.classList.remove("aipkit-active"),window.setTimeout(()=>{Fe.parentNode&&Fe.parentNode.removeChild(Fe)},200)};Fe.addEventListener("click",Je=>{Je.target===Fe&&Ve()}),Fe.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",Ve),document.body.appendChild(Fe)},F=re=>{if(!re)return;let ve=re.dataset.userId,Ee=re.parentElement?re.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,Fe=re.dataset.originalValue||re.defaultValue,Be=re.value;if(String(Be)!==String(Fe)){if(!E){Ee&&(Ee.textContent="ERR");return}Ee&&(Ee.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(m),m=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:E,user_id:ve,balance:Be}).then(Ve=>{Ee&&(Ee.textContent="OK"),re.dataset.originalValue=Ve.new_balance,window.setTimeout(()=>{Ee&&(Ee.textContent="")},1500)}).catch(()=>{Ee&&(Ee.textContent="ERR"),re.value=Fe,window.setTimeout(()=>{Ee&&(Ee.textContent="")},2500)})},400)}},L=re=>{if(!_.conversationChart)return;_.conversationChart.innerHTML="";let ve=Object.entries(re||{});if(!ve.length){_.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${t("No data available.")}</div>`;return}let Ee=Math.max(...ve.map(([,ti])=>Number(ti)||0),1),Fe=document.createElement("div");Fe.className="aipkit_stats_chart_wrapper";let Be=document.createElement("div");Be.className="aipkit_stats_y_axis";let Ve=4;for(let ti=Ve;ti>=0;ti--){let gt=document.createElement("span");gt.className="aipkit_stats_y_label";let tt=Math.round(Ee/Ve*ti);gt.textContent=tt>=1e3?`${(tt/1e3).toFixed(1)}k`:tt,Be.appendChild(gt)}Fe.appendChild(Be);let Je=document.createElement("div");Je.className="aipkit_stats_bars_container";for(let ti=0;ti<Ve;ti++){let gt=document.createElement("div");gt.className="aipkit_stats_grid_line",gt.style.bottom=`${(ti+1)/Ve*100}%`,Je.appendChild(gt)}let Ze=document.createElement("div");Ze.className="aipkit_stats_bars_wrapper",ve.forEach(([ti,gt])=>{let tt=document.createElement("div");tt.className="aipkit_stats_bar_group";let Ye=document.createElement("div"),ei=Math.max(2,Math.round(Number(gt)/Ee*100));Ye.className="aipkit_stats_bar",Ye.style.height=`${ei}%`,Ye.title=`${ti}: ${gt}`,tt.appendChild(Ye),Ze.appendChild(tt)}),Je.appendChild(Ze),Fe.appendChild(Je);let Pt=document.createElement("div");Pt.className="aipkit_stats_x_axis";let Mi=Math.min(ve.length,7),Qt=Math.max(1,Math.floor(ve.length/Mi));ve.forEach(([ti],gt)=>{let tt=document.createElement("span");if(tt.className="aipkit_stats_x_label",gt%Qt===0||gt===ve.length-1){let Ye=ti.split("-");tt.textContent=Ye.length>=3?`${Ye[1]}/${Ye[2]}`:ti}Pt.appendChild(tt)}),Fe.appendChild(Pt),_.conversationChart.appendChild(Fe)},O=re=>{if(_.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){_.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${t("Chart renderer unavailable.")}</p>`;return}if(!re||Object.keys(re).length===0){_.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${t("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(_.moduleChart,re)}},D=re=>re?w[re]?w[re]:re.replace(/[_-]/g," ").replace(/\b\w/g,ve=>ve.toUpperCase()):w.chatbot||"Chatbot",R=re=>{if(!_.tableBody)return;if(!Array.isArray(re)||!re.length){b("No logs found.");return}let ve=re.map(Ee=>{let Fe=Ee.last_message_content?String(Ee.last_message_content):"",Be=l(Ee.last_message_ts),Ve=s(Ee.last_message_ts),Je=a(Ee.total_conversation_tokens||0),Ze=Number(Ee.id);return`
                    <tr class="aipkit_stats_row${i.selectedLogId===Ze?" aipkit_stats_row_active":""}" data-log-id="${t(Ee.id)}">
                        <td title="${t(Ve)}">${t(Be)}</td>
                        <td>${t(Ee.user_display_name||"\u2014")}</td>
                        <td>${t(Ee.bot_name||D(Ee.module))}</td>
                        <td>${t(a(Ee.message_count||0))}</td>
                        <td>${t(Je)}</td>
                        <td><span class="aipkit_stats_preview">${t(Fe)}</span></td>
                    </tr>
                `});_.tableBody.innerHTML=ve.join("")},Z=()=>({days:i.days,bot_id:i.botId,module:i.module,search:i.search}),J=(re,ve)=>{let Ee=new Blob([re],{type:"text/csv;charset=utf-8;"}),Fe=URL.createObjectURL(Ee),Be=document.createElement("a");Be.href=Fe,Be.download=ve||"aipkit-logs.csv",document.body.appendChild(Be),Be.click(),Be.remove(),URL.revokeObjectURL(Fe)},pe=async re=>{if(!(!re||!window.confirm("Delete this conversation?"))){x("Deleting conversation...");try{let Ee=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:re});x(Ee.message||"Conversation deleted."),i.selectedLogId===Number(re)&&(i.selectedLogId=null,mt(null)),se(),window.setTimeout(()=>x(""),2e3)}catch(Ee){x(Ee.message||"Failed to delete conversation.","error")}}},Ce=async()=>{if(window.confirm("Delete all logs that match the current filters?")){x("Deleting logs...");try{let ve=await window.aipkit_apiRequest("aipkit_stats_delete_logs",Z());x(ve.message||"Logs deleted."),i.selectedLogId=null,mt(null),se(),window.setTimeout(()=>x(""),2500)}catch(ve){x(ve.message||"Failed to delete logs.","error")}}},He=async()=>{x("Preparing export...");try{let re=await window.aipkit_apiRequest("aipkit_stats_export_logs",Z());if(!re||!re.csv)throw new Error("Export failed.");J(re.csv,re.filename),x(re.message||"Export ready."),window.setTimeout(()=>x(""),2e3)}catch(re){x(re.message||"Failed to export logs.","error")}},Ke=re=>{if(!_.tableMenu||!_.tableMenuTrigger)return;let ve=re??_.tableMenu.hidden;_.tableMenu.hidden=!ve,_.tableMenuTrigger.setAttribute("aria-expanded",ve?"true":"false")},nt=re=>{if(_.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(re,_.pagination,ve=>{i.page=ve,se()});return}_.pagination.innerHTML=""}},mt=re=>{if(!_.detailPanel)return;if(!re){_.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${t("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let ve=tt=>{let Ye=(tt||"").toLowerCase();return Ye==="assistant"||Ye==="model"||Ye==="bot"?"bot":Ye==="user"?"user":Ye||"unknown"},Ee=(tt,Ye)=>{for(let ei=Ye+1;ei<tt.length;ei+=1)if(ve(tt[ei]?.role)==="bot")return tt[ei];return null},Fe=tt=>tt>=85?"is-excellent":tt>=70?"is-good":tt>=50?"is-fair":"is-poor",Be=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${t(re.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${t(re.bot_name||D(re.module))}
                        &middot; ${t(s(re.last_message_ts))}
                        &middot; ${t(a(re.message_count||0))} ${t("messages")}
                        ${re.ip_address?`&middot; ${t(`IP ${re.ip_address}`)}`:""}
                    </div>
                </div>
            `,Ve=Array.isArray(re.messages)?re.messages:[],Je=String(re.module||"").toLowerCase().replace(/[\s-]+/g,"_"),Ze=(()=>{if(typeof window.markdownit!="function")return null;let tt=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&tt.use(window.markdownitHighlight,{hljs:window.hljs}),tt})(),Pt=tt=>{let Ye=String(tt||"").trim().toLowerCase();return Ye?Ye.startsWith("generate ")||Ye.startsWith("content writer request"):!1},Mi=tt=>{if(!tt||typeof tt!="object")return null;let Ye=tt.payload_sent;if(!Ye||typeof Ye!="object")return null;let ei=Array.isArray(Ye.messages)?Ye.messages:Array.isArray(Ye.input)?Ye.input:null;if(!Array.isArray(ei))return null;let li=ei.find(Jt=>Jt&&Jt.role==="user"&&typeof Jt.content=="string"&&Jt.content.trim());return li?li.content.trim():null},Qt=(tt,Ye)=>{if(!tt||typeof tt!="object")return null;let ei={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},li=String(Ye||"").trim().toLowerCase(),Jt=ei[li];if(!Jt||typeof tt[Jt]!="string")return null;let Ut=tt[Jt].trim();return Ut||null},ti=tt=>{if(!tt||typeof tt!="object")return null;for(let Ye in tt){if(!Object.prototype.hasOwnProperty.call(tt,Ye)||!/_prompt$/i.test(Ye))continue;let ei=tt[Ye];if(typeof ei=="string"&&ei.trim())return ei.trim()}return null};if(Je==="content_writer"&&Array.isArray(Ve)&&Ve.length)for(let tt=0;tt<Ve.length;tt+=1){let Ye=Ve[tt];if(!Ye||Ye.role!=="user"||typeof Ye.content!="string")continue;let ei=Ye.content.trim();if(!ei||!Pt(ei))continue;let li=null,Jt=Ve[tt+1]?.request_payload;Jt&&(li=Mi(Jt)),!li&&Ye.request_payload&&(li=Mi(Ye.request_payload)),!li&&Ye.request_payload&&(li=Qt(Ye.request_payload,ei)),!li&&Ye.request_payload&&(li=ti(Ye.request_payload)),li&&(Ye.original_content=Ye.content,Ye.content=li)}let gt=Ve.map((tt,Ye)=>{let ei=ve(tt.role),li=s(tt.timestamp),Jt=c(tt.content),Ut=ei==="user"?"User":ei==="bot"?"Assistant":ei,xt=String(tt.message_id||`msg_${Ye}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${Ye}`,pi=[],Wt="",Wi="",Sn="";if(ei==="user"){let qt=Ee(Ve,Ye),ot=qt?.provider||"",Tt=qt?.model||"",fi=qt?.usage?.total_tokens??qt?.usage?.totalTokenCount??null;ot&&pi.push(ot),Tt&&pi.push(Tt),typeof fi=="number"&&fi>0&&pi.push(`${a(fi)} tokens`);let Ht=qt?.request_payload||null;if(pi.length||Ht)if(Ht){let hi=`aipkit_stats_payload_${xt}`,mi=pi.length?pi.join(" / "):"Request payload";Wt=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${hi}" aria-expanded="false">
                                    <span>${t(mi)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,Sn+=`
                                <div class="aipkit_stats_expandable" id="${hi}" hidden>
                                    <div class="aipkit_stats_expandable_header">${t("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${t(JSON.stringify(Ht,null,2))}</pre>
                                    </div>
                                </div>
                            `}else pi.length&&(Wt=`<div class="aipkit_stats_meta_info">${t(pi.join(" / "))}</div>`)}if(ei==="bot"){let qt=Array.isArray(tt.vector_search_scores)?tt.vector_search_scores:[];if(qt.length>0){let ot=qt.reduce((mi,Bi)=>{let gi=Number(mi?.score??0);return Number(Bi?.score??0)>gi?Bi:mi},qt[0]),Tt=ot?.score!==void 0?Math.round(Number(ot.score)*100):0,fi=Fe(Tt),Ht=`aipkit_stats_scores_${xt}`;Wi=`
                            <button type="button" class="aipkit_stats_score_badge ${fi}" data-aipkit-stats-toggle="${Ht}" aria-expanded="false">
                                ${t(`Score ${Tt}%`)}
                            </button>
                        `;let hi=qt.map(mi=>{let Bi=mi?.provider||"Unknown",gi="";if(Bi==="OpenAI")gi=mi.store_name||mi.store_id?` \xB7 ${mi.store_name||mi.store_id}`:"";else if(Bi==="Pinecone"){let ui=mi.namespace?` \xB7 ${mi.namespace}`:"";gi=mi.index_name?` \xB7 ${mi.index_name}${ui}`:ui}else Bi==="Qdrant"&&(gi=mi.collection_name?` \xB7 ${mi.collection_name}`:"");let ii=mi?.score!==void 0?Math.round(Number(mi.score)*100):null,ji=ii!==null?Fe(ii):"is-poor",Ne=mi?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${t(Bi)}${t(gi)}</div>
                                    <div class="aipkit_stats_score_value ${ji}">
                                        ${t(ii!==null?`${ii}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${t(Ne)}</div>
                                </div>
                            `}).join("");Sn+=`
                            <div class="aipkit_stats_expandable" id="${Ht}" hidden>
                                <div class="aipkit_stats_expandable_header">${t("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${hi}
                                </div>
                            </div>
                        `}}let Ki=!!Wt,ln=!!Wi,ke=Ki||ln?`
                    <div class="aipkit_stats_meta_bar${Ki&&!ln||!Ki&&ln?" aipkit_stats_meta_bar--compact":""}">
                        ${Ki?Wt:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Wi||""}
                        </div>
                    </div>
                `:"",Le=!!(Ze&&typeof Jt=="string"),Oe=Le?Ze.render(Jt):t(Jt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${t(ei)}" style="animation-delay: ${Ye*.05}s">
                        <div class="aipkit_stats_message_meta">${t(Ut)}${li?` \xB7 ${t(li)}`:""}</div>
                        <div class="aipkit_stats_message_body${Le?" aipkit_stats_message_body--markdown":""}">${Oe}</div>
                        ${ke}
                        ${Sn}
                    </div>
                `}).join("");_.detailPanel.innerHTML=`
                ${Be}
                <div class="aipkit_stats_detail_messages">
                    ${gt||`<div class="aipkit_stats_table_placeholder">${t("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${t(re.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${t("Delete")}
                        </button>
                    </div>
                </div>
            `},wt=async()=>{x("Loading stats...");try{let re=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:i.days});_.totalConversations.textContent=a(re.summary?.total_conversations||0),_.totalMessages.textContent=a(re.summary?.total_messages||0),_.uniqueUsers.textContent=a(re.summary?.unique_users||0),_.avgTokens.textContent=a(re.summary?.avg_tokens||0),_.overviewPeriod&&(_.overviewPeriod.textContent=re.summary?.period_label||""),L(re.charts?.daily_conversations||{}),O(re.charts?.daily_tokens||{}),x("")}catch(re){x(re.message||"Failed to load stats.","error")}},ge=(re,ve=!0)=>{if(_.overviewPanel){if(_.overviewPanel.hidden=!re,_.overviewToggle&&(_.overviewToggle.setAttribute("aria-expanded",re?"true":"false"),_.overviewToggle.classList.toggle("is-active",re)),ve)try{localStorage.setItem(n,re?"1":"0")}catch{}re&&wt()}},se=async()=>{b("Loading logs...");try{let re=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:i.days,page:i.page,per_page:i.perPage,bot_id:i.botId,module:i.module,search:i.search}),ve=Array.isArray(re.logs)?re.logs:[];!i.selectedLogId&&!g&&ve.length&&(i.selectedLogId=Number(ve[0].id),g=!0),R(ve),nt(re.pagination||{}),i.selectedLogId&&g&&ae(i.selectedLogId)}catch(re){b(re.message||"Failed to load logs.")}},ae=async re=>{if(!re){mt(null);return}_.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${t("Loading conversation...")}</div>`;try{let ve=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:re});mt(ve)}catch(ve){_.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${t(ve.message||"Failed to load conversation.")}</div>`}},Se=re=>{i.search=re.trim(),i.page=1,p&&clearTimeout(p),p=window.setTimeout(()=>{se()},300)},je=async()=>{if(_.cronStatus)try{let re=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});P(re)}catch{}},bt=async()=>{if(!_.settingsToggle||!_.retentionSelect)return;let re=_.settingsToggle.checked?"1":"0",ve=parseInt(_.retentionSelect.value,10)||90;x("Saving settings...","loading");try{let Ee=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:re,retention_period_days:ve});I(_.settingsToggle.checked),x(Ee.message||"Settings saved.","success"),je(),window.setTimeout(()=>x(""),2e3)}catch(Ee){x(Ee.message||"Failed to save settings.","error")}};if(_.daysFilter&&(_.daysFilter.value=String(i.days),_.daysFilter.addEventListener("change",()=>{i.days=parseInt(_.daysFilter.value,10)||30,i.page=1,_.overviewPanel&&!_.overviewPanel.hidden&&wt(),se()})),_.botFilter&&_.botFilter.addEventListener("change",()=>{i.botId=_.botFilter.value,i.page=1,se()}),_.moduleFilter&&_.moduleFilter.addEventListener("change",()=>{i.module=_.moduleFilter.value,i.page=1,se()}),_.searchInput&&_.searchInput.addEventListener("input",re=>{Se(re.target.value||"")}),_.overviewToggle&&_.overviewPanel&&_.overviewToggle.addEventListener("click",()=>{let re=!_.overviewPanel.hidden;ge(!re)}),_.tableBody&&_.tableBody.addEventListener("click",re=>{let ve=re.target.closest("tr[data-log-id]");if(!ve)return;let Ee=ve.getAttribute("data-log-id");Ee&&(i.selectedLogId=Number(Ee),_.tableBody.querySelectorAll("tr").forEach(Fe=>{Fe.classList.toggle("aipkit_stats_row_active",Fe===ve)}),ae(Ee))}),_.detailPanel&&_.detailPanel.addEventListener("click",re=>{let ve=re.target.closest(".aipkit_stats_detail_delete");if(!ve){let Ee=re.target.closest("[data-aipkit-stats-toggle]");if(!Ee)return;let Fe=Ee.getAttribute("data-aipkit-stats-toggle");if(!Fe)return;let Be=document.getElementById(Fe);if(!Be)return;let Ve=Ee.getAttribute("aria-expanded")==="true";Be.hidden=Ve,Ee.setAttribute("aria-expanded",Ve?"false":"true"),Ee.classList.toggle("is-expanded",!Ve);return}pe(ve.getAttribute("data-log-id"))}),_.tableMenuTrigger&&_.tableMenu&&_.tableMenuTrigger.addEventListener("click",re=>{re.preventDefault(),re.stopPropagation(),Ke(_.tableMenu.hidden)}),document.addEventListener("click",re=>{!_.tableMenu||_.tableMenu.hidden||re.target.closest("#aipkit_stats_table_menu")||re.target.closest("#aipkit_stats_table_menu_trigger")||Ke(!1)}),document.addEventListener("keydown",re=>{re.key!=="Escape"||!_.tableMenu||_.tableMenu.hidden||Ke(!1)}),_.deleteAllBtn&&_.deleteAllBtn.addEventListener("click",()=>{Ke(!1),Ce()}),_.exportBtn&&_.exportBtn.addEventListener("click",()=>{Ke(!1),He()}),_.settingsToggle&&_.settingsToggle.addEventListener("change",()=>{if(!h){_.settingsToggle.checked=!1,x("Upgrade to Pro to enable auto-delete.","error");return}I(_.settingsToggle.checked),bt()}),_.retentionSelect&&_.retentionSelect.addEventListener("change",()=>{h&&bt()}),_.shortcodeToggle&&_.shortcodeConfig&&_.shortcodeToggle.addEventListener("click",re=>{re.preventDefault();let ve=!_.shortcodeConfig.hidden;_.shortcodeConfig.hidden=ve,_.shortcodeToggle.setAttribute("aria-expanded",ve?"false":"true"),_.shortcodeToggle.classList.toggle("is-active",!ve)}),_.shortcodeOptions&&_.shortcodeOptions.length&&(_.shortcodeOptions.forEach(re=>{re.addEventListener("change",G)}),G()),_.shortcodeSnippet&&_.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(_.shortcodeSnippet.textContent,_.shortcodeSnippet)}),_.settingsUsersNav&&_.settingsUsersNav.addEventListener("click",re=>{re.preventDefault(),W(),H()}),_.userSheetClose&&_.userSheetClose.addEventListener("click",re=>{re.preventDefault(),N()}),_.userSheet&&_.userSheet.addEventListener("click",re=>{re.target===_.userSheet&&N()}),_.userSearchInput&&(_.userSearchInput.addEventListener("input",()=>{clearTimeout(f);let re=_.userSearchInput.value.trim();f=window.setTimeout(()=>{$(1,re)},350)}),_.userSearchInput.addEventListener("keydown",re=>{if(re.key==="Enter"){re.preventDefault(),clearTimeout(f);let ve=_.userSearchInput.value.trim();$(1,ve),_.userSearchClear&&(_.userSearchClear.hidden=ve.length===0)}})),_.userSearchClear&&_.userSearchClear.addEventListener("click",()=>{_.userSearchInput&&(_.userSearchInput.value=""),_.userSearchClear.hidden=!0,$(1,"")}),_.userTableBody){let re="data-user-credits-listeners";_.userTableBody.getAttribute(re)||(_.userTableBody.addEventListener("change",ve=>{ve.target.matches(".aipkit_stats_credits_balance_input")&&F(ve.target)}),_.userTableBody.addEventListener("keypress",ve=>{ve.key==="Enter"&&ve.target.matches(".aipkit_stats_credits_balance_input")&&(ve.preventDefault(),ve.target.blur())}),_.userTableBody.addEventListener("click",ve=>{let Ee=ve.target.closest(".aipkit_stats_usage_toggle");if(Ee){ve.preventDefault();let Be=Ee.closest("td");if(Be){let Ve=Be.querySelectorAll(".aipkit_stats_usage_extra");if(Ve.length){let Je=Ve[0].hidden;Ve.forEach(Ze=>{Ze.hidden=!Je}),Ee.textContent=Je?d("Show less","gpt3-ai-content-generator"):`${d("Show more","gpt3-ai-content-generator")}...`}}return}let Fe=ve.target.closest(".aipkit_stats_purchase_history_btn");if(Fe){ve.preventDefault();let Be=Fe.dataset.history?JSON.parse(Fe.dataset.history):[];Q(Be,Fe.dataset.userName||"")}}),_.userTableBody.setAttribute(re,"true"))}document.addEventListener("keydown",re=>{re.key==="Escape"&&_.userSheet&&_.userSheet.classList.contains("aipkit-active")&&N()}),ge(v(),!1),se(),I(!!_.settingsToggle?.checked)}window.aipkit_initStats=o})();(function(){"use strict";function k(){let r={},n=document.getElementById("aipkit_settings_container");return n&&n.querySelectorAll("input[name], select[name], textarea[name]").forEach(a=>{a.type==="checkbox"?r[a.name]=a.checked?"1":"0":a.type==="radio"?a.checked&&(r[a.name]=a.value):r[a.name]=a.value}),r}window.aipkit_getCurrentFormData=k})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function k(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let r=window.aipkit_getCurrentFormData(),n=window.aipkit_lastSavedData||{};if(JSON.stringify(r)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let t="aipkit_settings_global_messages";window.aipkit_showSavingIndicator(t,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",r),window.aipkit_showSavingIndicator(t,!1),window.aipkit_showMessage(t,"success","Settings saved!"),window.aipkit_lastSavedData=r,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(n,r)}catch(a){window.aipkit_showSavingIndicator(t,!1),window.aipkit_showMessage(t,"error","Save failed: "+a.message),console.error("AIPKit Auto-Save Error:",a)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let t="data-autosave-listener-attached";n.getAttribute(t)||(n.addEventListener("change",function(a){let s=a.target;s.matches(".aipkit_autosave_trigger")&&s.id!=="aipkit_provider"&&(s.tagName.toLowerCase()==="select"||s.type==="checkbox"||s.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),n.addEventListener("blur",function(a){let s=a.target;if(s.matches(".aipkit_autosave_trigger")&&s.id!=="aipkit_provider"){let l=s.tagName.toLowerCase();(l==="input"||l==="textarea")&&s.type!=="range"&&s.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),n.setAttribute(t,"true"))}function r(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=k,window.aipkit_updateLastSavedData=r})();(function(){"use strict";function k(n){try{return new Date(n+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return n}}function r(n){return typeof n!="number"?n:n.toLocaleString()}window.aipkit_formatChartDate=k,window.aipkit_formatChartNumber=r})();(function(){"use strict";let k=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],r="#B0BEC5",n={};function t(s){n={};let l=0;s.forEach(c=>{if(c==="Other")n[c]=r;else{let o;do o=k[l%k.length],l++;while(o===r&&k.length>1);n[c]=o}})}function a(s){return n[s]||"#cccccc"}window.aipkit_assignModuleColors=t,window.aipkit_getModuleColor=a})();(function(){"use strict";function k(a,s){if(!s||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let l=a.target,c=l.getAttribute("data-date"),o=l.getAttribute("data-module"),e=parseInt(l.getAttribute("data-value"),10),i=parseInt(l.getAttribute("data-daily-total"),10),d=window.aipkit_getModuleColor(o),u=o?r(o.replace(/[-_]/g," ")):"Unknown";s.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(c)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${d}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${u}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(e)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(i)} tokens)</span>
        `,s.classList.add("aipkit_active"),n(a,s)}function r(a){return a?a.charAt(0).toUpperCase()+a.slice(1):""}function n(a,s){if(!s)return;let l=s.parentElement;if(!l)return;let c=l.getBoundingClientRect(),o=a.clientX-c.left,e=a.clientY-c.top,i=s.offsetWidth,d=s.offsetHeight,u=o+15,p=e-d-10;u+i>c.width-5&&(u=o-i-15),u<5&&(u=5),p<5&&(p=e+15),p+d>c.height-5&&(p=c.height-d-5),s.style.left=`${u}px`,s.style.top=`${p}px`,s.style.transform="translate(0, 0)"}function t(a){a&&a.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=k,window.aipkit_moveChartTooltip=n,window.aipkit_hideChartTooltip=t})();(function(){"use strict";let k="http://www.w3.org/2000/svg";function r(t,a){if(t.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),t.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let s=Object.keys(a);if(s.length===0){t.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let l=new Set;s.forEach(S=>{Object.keys(a[S]).forEach(C=>l.add(C))});let c=Array.from(l);c.sort((S,C)=>{if(S==="Other")return 1;if(C==="Other")return-1;let A=M=>M?n(M.replace(/[-_]/g," ")):"Unknown";return A(S).localeCompare(A(C))}),window.aipkit_assignModuleColors(c);let o=1;s.forEach(S=>{let C=Object.values(a[S]).reduce((A,M)=>A+M,0);C>o&&(o=C)}),o=o*1.05;let e=s.length,i=Math.max(250,t.clientHeight||250),d=c.length>0?Math.max(40,Math.ceil(c.length/3)*20):0,u={top:20,right:20,bottom:30+d,left:50},p=t.clientWidth-u.left-u.right,f=i-u.top-u.bottom,m=Math.max(1,p/e*.8),g=Math.max(0,p/e*.2),_=document.createElementNS(k,"svg");_.setAttribute("viewBox",`0 0 ${t.clientWidth} ${i}`),_.setAttribute("preserveAspectRatio","xMidYMid meet"),_.setAttribute("class","aipkit_token_usage_chart_svg"),_.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(k,"g");w.setAttribute("transform",`translate(${u.left}, ${u.top})`),_.appendChild(w);let h=document.createElement("div");h.className="aipkit_chart_tooltip",t.style.position="relative",t.appendChild(h);let E=document.createElementNS(k,"g");E.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(E);let x=document.createElementNS(k,"line");x.setAttribute("x1",0),x.setAttribute("y1",0),x.setAttribute("x2",0),x.setAttribute("y2",f),E.appendChild(x);let v=5;for(let S=0;S<v;S++){let C=Math.round(o*(S/(v-1))),A=f-f*(S/(v-1)),M=document.createElementNS(k,"text");M.setAttribute("x",-5),M.setAttribute("y",A+3),M.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),M.textContent=window.aipkit_formatChartNumber(C),E.appendChild(M);let $=document.createElementNS(k,"line");$.setAttribute("x1",0),$.setAttribute("y1",A),$.setAttribute("x2",p),$.setAttribute("y2",A),$.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore($,w.firstChild)}let I=document.createElementNS(k,"g");I.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),I.setAttribute("transform",`translate(0, ${f})`),w.appendChild(I);let P=document.createElementNS(k,"line");P.setAttribute("x1",0),P.setAttribute("y1",0),P.setAttribute("x2",p),P.setAttribute("y2",0),I.appendChild(P);let b=Math.max(1,Math.ceil(e/(p/60)));s.forEach((S,C)=>{if(C%b===0||C===e-1){let A=C*(m+g)+m/2+g/2,M=document.createElementNS(k,"text");M.setAttribute("x",A),M.setAttribute("y",u.bottom-d-10),M.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),M.textContent=window.aipkit_formatChartDate(S),I.appendChild(M)}});let y=document.createElementNS(k,"g");if(w.appendChild(y),s.forEach((S,C)=>{let A=a[S],M=f,$=0;c.filter(N=>A[N]>0).forEach(N=>{let G=A[N]||0;$+=G;let Q=G/o*f;M-=Q;let F=C*(m+g)+g/2,L=document.createElementNS(k,"rect");L.setAttribute("x",F),L.setAttribute("y",M),L.setAttribute("width",m),L.setAttribute("height",Math.max(.1,Q)),L.setAttribute("class","aipkit_chart_bar"),L.setAttribute("fill",window.aipkit_getModuleColor(N)),L.setAttribute("data-date",S),L.setAttribute("data-module",N),L.setAttribute("data-value",G),L.setAttribute("data-daily-total",0),L.addEventListener("mouseenter",O=>window.aipkit_showStackedTooltip(O,h)),L.addEventListener("mousemove",O=>window.aipkit_moveChartTooltip(O,h)),L.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(h)),y.appendChild(L)}),y.querySelectorAll(`rect[data-date="${S}"]`).forEach(N=>N.setAttribute("data-daily-total",$))}),c.length>0){let S=document.createElementNS(k,"g");S.setAttribute("class","aipkit_chart_legend"),S.setAttribute("transform",`translate(0, ${f+u.bottom-d+5})`),w.appendChild(S);let C=0,A=0,M=20,$=p,W=35;c.forEach(H=>{let N=n(H.replace(/[-_]/g," ")),Q=N.length*7+25+W;C>0&&C+Q>$&&(C=0,A+=M);let F=document.createElementNS(k,"g");F.setAttribute("transform",`translate(${C}, ${A})`);let L=document.createElementNS(k,"rect");L.setAttribute("width",10),L.setAttribute("height",10),L.setAttribute("y",-5),L.setAttribute("fill",window.aipkit_getModuleColor(H)),F.appendChild(L);let O=document.createElementNS(k,"text");O.setAttribute("x",15),O.setAttribute("y",0),O.setAttribute("class","aipkit_chart_legend_label"),O.textContent=N,F.appendChild(O),S.appendChild(F),C+=Q})}t.appendChild(_)}function n(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}window.aipkit_renderTokenUsageChart=r})();(function(){"use strict";function k(t){let a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${a}-${s}-${l}`}function r(t){let a=Number.isFinite(t)&&t>0?t:7,s=new Date;s.setHours(0,0,0,0);let l={};for(let c=a-1;c>=0;c-=1){let o=new Date(s);o.setDate(s.getDate()-c),l[k(o)]={}}return l}function n(t){let a=document.getElementById("aipkit_token_usage_chart_container");if(!a){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let s=a.querySelector(".aipkit_chart_loading_placeholder"),l=a.querySelector(".aipkit_chart_error_placeholder"),c=a.querySelector(".aipkit_chart_nodata_placeholder");l&&(l.style.display="none"),c&&(c.style.display="none"),s&&(s.style.display="flex");let o=[3,7,14,30,90],e=parseInt(t,10);if(!e||isNaN(e)){try{let d=localStorage.getItem("aipkit_stats_period_days"),u=parseInt(d,10);d&&!isNaN(u)&&o.includes(u)&&(e=u)}catch{}let i=document.getElementById("aipkit_stats_period_select");if(i){let d=parseInt(i.value,10);(!e||isNaN(e))&&(e=!isNaN(d)&&o.includes(d)?d:3),o.includes(e)&&String(i.value)!==String(e)&&(i.value=String(e))}else a.dataset.defaultDays?e=parseInt(a.dataset.defaultDays,10)||3:e=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:e}).then(i=>{if(s&&(s.style.display="none"),i&&i.daily_token_data){let d=i.daily_token_data;if(d&&typeof d=="object"&&Object.values(d).some(p=>p&&typeof p=="object"&&Object.values(p).some(f=>Number(f)>0)))window.aipkit_renderTokenUsageChart(a,d);else{let p=Object.keys(d).length>0?d:r(e);window.aipkit_renderTokenUsageChart(a,p)}}else throw new Error("Invalid data received for chart.")}).catch(i=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",i),s&&(s.style.display="none"),l)l.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${i.message})`,l.style.display="flex";else{let d=document.createElement("div");d.className="aipkit_chart_error_placeholder",d.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${i.message})`,a.innerHTML="",a.appendChild(d)}})}window.aipkit_loadTokenUsageChart=n,document.addEventListener("change",function(t){let a=t.target;if(a&&a.id==="aipkit_stats_period_select"){let s=parseInt(a.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(s);try{[3,7,14,30,90].includes(s)&&localStorage.setItem("aipkit_stats_period_days",String(s))}catch{}}})})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=n);let t=document.getElementById("aipkit_openai_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!t&&a.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.openai||[],l=Array.isArray(s)?s:[],c=g=>{if(!g)return[];let _=k("Recommended","gpt3-ai-content-generator"),w=Array.from(g.querySelectorAll("optgroup")).find(h=>h.label===_||h.label==="Recommended");return w?Array.from(w.querySelectorAll("option")).map(h=>({id:h.value,name:h.textContent.trim()||h.value})).filter(h=>h.id):[]};if(l.length===0){let g=t||a[0];l=c(g)}let o=new Set(l.map(g=>g?.id).filter(Boolean)),e=n&&typeof n=="object"?n:{},i=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],d=Object.keys(e),u=i.filter(g=>d.includes(g)).concat(d.filter(g=>!i.includes(g)).sort()),p=g=>{let _=g.value;g.innerHTML="";let w=!1,h=!1;if(l.length>0){let E=document.createElement("optgroup");E.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(x=>{if(!x||typeof x!="object"||!x.id)return;let v=new Option(x.name||x.id,x.id);x.id===_&&(v.selected=!0,w=!0),E.appendChild(v)}),E.children.length>0&&(g.appendChild(E),h=!0)}if(u.forEach(E=>{let x=Array.isArray(e[E])?e[E].slice():[];if(x.length===0)return;x.sort((I,P)=>(I.name||I.id||"").localeCompare(P.name||P.id||""));let v=document.createElement("optgroup");v.label=E,x.forEach(I=>{let P=I?.id||"";if(!P||o.has(P))return;let b=new Option(I.name||P,P);P===_&&(b.selected=!0,w=!0),v.appendChild(b)}),v.children.length>0&&(g.appendChild(v),h=!0)}),!h){g.appendChild(new Option("No models found.",""));return}if(!w&&_&&!g.querySelector(`option[value="${CSS.escape(_)}"]`)){let E=new Option(_+"",_,!1,!0);g.insertBefore(E,g.firstChild),g.value=_,w=!0}if(g.options.length>0&&g.selectedIndex===-1){let E=-1;for(let x=0;x<g.options.length;x++)if(!g.options[x].disabled&&g.options[x].value){E=x;break}g.selectedIndex=E!==-1?E:0}};t&&p(t),a.forEach(p);let f=document.getElementById("aipkit_content_writer_provider"),m=document.getElementById("aipkit_content_writer_model");f&&m&&f.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(f,m)}window.aipkit_updateOpenAIModels=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(n)?n:[]);let t=document.getElementById("aipkit_openrouter_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!t&&a.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.openrouter||[],l=Array.isArray(s)?s:[],c=i=>{if(!i)return[];let d=k("Recommended","gpt3-ai-content-generator"),u=Array.from(i.querySelectorAll("optgroup")).find(p=>p.label===d||p.label==="Recommended");return u?Array.from(u.querySelectorAll("option")).map(p=>({id:p.value,name:p.textContent.trim()||p.value})).filter(p=>p.id):[]};if(l.length===0){let i=t||a[0];l=c(i)}let o=new Set(l.map(i=>i?.id).filter(Boolean)),e=i=>{let d=i.value;i.innerHTML="";let u=!1,p=!1;if(l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(_=>{if(_&&typeof _=="object"&&_.id){let w=new Option(_.name||_.id,_.id);_.id===d&&(w.selected=!0,u=!0),g.appendChild(w)}}),g.children.length>0&&(i.appendChild(g),p=!0)}if(!n||!n.length){p||i.appendChild(new Option("No models found.",""));return}let f={};if(n.forEach(g=>{if(!g||!g.id||o.has(g.id))return;let _=g.id.split("/"),w=(_.length>1?_[0]:"other").toLowerCase();f[w]||(f[w]=[]),f[w].push(g)}),Object.keys(f).sort().forEach(g=>{let _=document.createElement("optgroup");_.label=g.charAt(0).toUpperCase()+g.slice(1),f[g].sort((w,h)=>(w.name||"").localeCompare(h.name||"")),f[g].forEach(w=>{let h=new Option(w.name||w.id,w.id);w.id===d&&(h.selected=!0,u=!0),_.appendChild(h)}),_.children.length>0&&(i.appendChild(_),p=!0)}),!u&&d&&!i.querySelector(`option[value="${CSS.escape(d)}"]`)){let g=new Option(d+"",d,!1,!0);i.insertBefore(g,i.firstChild)}if(!u&&i.options.length>0&&i.selectedIndex===-1){let g=-1;for(let _=0;_<i.options.length;_++)if(!i.options[_].disabled&&i.options[_].value){g=_;break}i.selectedIndex=g!==-1?g:0}};t&&e(t),a.forEach(e)}window.aipkit_updateOpenRouterModels=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){let t=document.getElementById("aipkit_google_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!t&&a.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.google||[],l=Array.isArray(s)?s:[],c=d=>{if(!d)return[];let u=k("Recommended","gpt3-ai-content-generator"),p=Array.from(d.querySelectorAll("optgroup")).find(f=>f.label===u||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(l.length===0){let d=t||a[0];l=c(d)}let o=new Set(l.map(d=>d?.id).filter(Boolean)),e=Array.isArray(n)?n.slice():[];e.sort((d,u)=>(d.name||d.id||"").localeCompare(u.name||u.id||""));let i=d=>{let u=d.value;d.innerHTML="";let p=!1,f=!1,m=l.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(_=>{if(_&&typeof _=="object"&&_.id){let w=new Option(_.name||_.id,_.id);(_.id===u||`models/${_.id}`===u)&&(w.selected=!0,p=!0),g.appendChild(w)}}),g.children.length>0&&(d.appendChild(g),f=!0)}if(!e.length){f||d.appendChild(new Option("No models found.",""));return}if(e.forEach(g=>{let _=g.id||"",w=g.name||_;if(!_||o.has(_))return;let h=new Option(w,_);(_===u||`models/${_}`===u)&&(h.selected=!0,p=!0),m?m.appendChild(h):(d.appendChild(h),f=!0)}),m&&m.children.length>0&&(d.appendChild(m),f=!0),!p&&u){let g=u.startsWith("models/")?u.substring(7):u;if(!d.querySelector(`option[value="${CSS.escape(g)}"]`)){let _=g,w=new Option(_+"",u,!1,!0);d.insertBefore(w,d.firstChild),d.value=u}}if(d.options.length>0&&d.selectedIndex===-1){let g=-1;for(let _=0;_<d.options.length;_++)if(!d.options[_].disabled&&d.options[_].value){g=_;break}d.selectedIndex=g!==-1?g:0}};t&&i(t),a.forEach(i)}window.aipkit_updateGoogleModels=r})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_azure_deployment"),t=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!n&&t.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let a=s=>{let l=s.value;s.innerHTML="";let c=r&&typeof r=="object"&&!Array.isArray(r)&&(r["Chat Models"]||r["Embedding Models"]||r["Image Models"]);if(!r||Array.isArray(r)&&!r.length||c&&Object.keys(r).length===0){if(s.appendChild(new Option("No deployments found.","")),l){let e=new Option(l+"",l,!1,!0);s.appendChild(e),s.value=l}return}let o=!1;if(c)Object.keys(r).forEach(e=>{let i=r[e];if(i&&Array.isArray(i)&&i.length>0){let d=document.createElement("optgroup");d.label=e,i.sort((u,p)=>(u.id||"").localeCompare(p.id||"")),i.forEach(u=>{let p=u.id||"",f=u.name||p;if(!p)return;let m=p+(f&&f!==p?` (model: ${f})`:""),g=new Option(m,p);p===l&&(g.selected=!0,o=!0),d.appendChild(g)}),s.appendChild(d)}});else{let e=Array.isArray(r)?r:[];e.sort((i,d)=>(i.id||"").localeCompare(d.id||"")),e.forEach(i=>{let d=i.id||"",u=i.name||d;if(!d)return;let p=d+(u&&u!==d?` (model: ${u})`:""),f=new Option(p,d);d===l&&(f.selected=!0,o=!0),s.appendChild(f)})}if(!o&&s.value&&!s.querySelector(`option[value="${CSS.escape(s.value)}"]`)){let e=new Option(s.value+"",s.value,!1,!0);s.appendChild(e),o=!0}if(!o&&s.options.length>0&&s.selectedIndex===-1){let e=-1;for(let i=0;i<s.options.length;i++)if(!s.options[i].disabled&&s.options[i].value){e=i;break}s.selectedIndex=e!==-1?e:0}};n&&a(n),t.forEach(a)}window.aipkit_updateAzureDeployments=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.claude=Array.isArray(n)?n:[]);let t=document.getElementById("aipkit_claude_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_claude_model"]');if(!t&&a.length===0){console.warn("Claude Sync: No Claude model selects found (#aipkit_claude_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.claude||[],l=Array.isArray(s)?s:[],c=p=>{if(!p)return[];let f=k("Recommended","gpt3-ai-content-generator"),m=Array.from(p.querySelectorAll("optgroup")).find(g=>g.label===f||g.label==="Recommended");return m?Array.from(m.querySelectorAll("option")).map(g=>({id:g.value,name:g.textContent.trim()||g.value})).filter(g=>g.id):[]};if(l.length===0){let p=t||a[0];l=c(p)}let o=new Set(l.map(p=>p?.id).filter(Boolean)),e=Array.isArray(n)?n.slice():[];e.sort((p,f)=>(p.name||p.id||"").localeCompare(f.name||f.id||""));let i=p=>{let f=p.value;p.innerHTML="";let m=!1,g=!1,_=l.length>0?document.createElement("optgroup"):null;if(_&&(_.label=k("All models","gpt3-ai-content-generator")),l.length>0){let w=document.createElement("optgroup");w.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(h=>{if(!h||typeof h!="object"||!h.id)return;let E=new Option(h.name||h.id,h.id);h.id===f&&(E.selected=!0,m=!0),w.appendChild(E)}),w.children.length>0&&(p.appendChild(w),g=!0)}if(e.forEach(w=>{let h=w?.id||"",E=w?.name||h;if(!h||o.has(h))return;let x=new Option(E,h);h===f&&(x.selected=!0,m=!0),_?_.appendChild(x):(p.appendChild(x),g=!0)}),_&&_.children.length>0&&(p.appendChild(_),g=!0),!g){p.appendChild(new Option("No models found.",""));return}if(!m&&f&&!p.querySelector(`option[value="${CSS.escape(f)}"]`)){let w=new Option(f+"",f,!1,!0);p.insertBefore(w,p.firstChild),p.value=f}if(p.options.length>0&&p.selectedIndex===-1){let w=-1;for(let h=0;h<p.options.length;h++)if(!p.options[h].disabled&&p.options[h].value){w=h;break}p.selectedIndex=w!==-1?w:0}};t&&i(t),a.forEach(i);let d=document.getElementById("aipkit_content_writer_provider"),u=document.getElementById("aipkit_content_writer_model");d&&u&&d.value==="claude"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(d,u)}window.aipkit_updateClaudeModels=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.deepseek=Array.isArray(n)?n:[]);let t=document.getElementById("aipkit_deepseek_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!t&&a.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.deepseek||[],l=Array.isArray(s)?s:[],c=d=>{if(!d)return[];let u=k("Recommended","gpt3-ai-content-generator"),p=Array.from(d.querySelectorAll("optgroup")).find(f=>f.label===u||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(l.length===0){let d=t||a[0];l=c(d)}let o=Array.isArray(n)?n.slice():[];o.sort((d,u)=>(d.name||d.id||"").localeCompare(u.name||u.id||"")),l.length===0&&o.length>0&&(l=o.slice(0,3).map(d=>({id:d?.id||"",name:d?.name||d?.id||""})).filter(d=>d.id));let e=new Set(l.map(d=>d?.id).filter(Boolean)),i=d=>{let u=d.value;d.innerHTML="";let p=!1,f=!1,m=l.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(_=>{if(!_||typeof _!="object"||!_.id)return;let w=new Option(_.name||_.id,_.id);_.id===u&&(w.selected=!0,p=!0),g.appendChild(w)}),g.children.length>0&&(d.appendChild(g),f=!0)}if(!o.length){f||d.appendChild(new Option("No models found.",""));return}if(o.forEach(g=>{let _=g?.id||"",w=g?.name||_;if(!_||e.has(_))return;let h=new Option(w,_);_===u&&(h.selected=!0,p=!0),m?m.appendChild(h):(d.appendChild(h),f=!0)}),m&&m.children.length>0&&(d.appendChild(m),f=!0),!p&&u&&!d.querySelector(`option[value="${CSS.escape(u)}"]`)){let g=new Option(u+"",u,!1,!0);d.insertBefore(g,d.firstChild)}if(d.options.length>0&&d.selectedIndex===-1){let g=-1;for(let _=0;_<d.options.length;_++)if(!d.options[_].disabled&&d.options[_].value){g=_;break}d.selectedIndex=g!==-1?g:0}};t&&i(t),a.forEach(i)}window.aipkit_updateDeepSeekModels=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.ollama=Array.isArray(n)?n:[]);let t=document.getElementById("aipkit_ollama_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!t&&a.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.ollama||[],l=Array.isArray(s)?s:[],c=d=>{if(!d)return[];let u=k("Recommended","gpt3-ai-content-generator"),p=Array.from(d.querySelectorAll("optgroup")).find(f=>f.label===u||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(l.length===0){let d=t||a[0];l=c(d)}let o=Array.isArray(n)?n.slice():[];o.sort((d,u)=>(d.name||d.id||"").localeCompare(u.name||u.id||"")),l.length===0&&o.length>0&&(l=o.slice(0,3).map(d=>({id:d?.id||"",name:d?.name||d?.id||""})).filter(d=>d.id));let e=new Set(l.map(d=>d?.id).filter(Boolean)),i=d=>{let u=d.value;d.innerHTML="";let p=!1,f=!1,m=l.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(_=>{if(!_||typeof _!="object"||!_.id)return;let w=new Option(_.name||_.id,_.id);_.id===u&&(w.selected=!0,p=!0),g.appendChild(w)}),g.children.length>0&&(d.appendChild(g),f=!0)}if(!o.length){f||d.appendChild(new Option("No models found.",""));return}if(o.forEach(g=>{let _=g?.id||"",w=g?.name||_;if(!_||e.has(_))return;let h=new Option(w,_);_===u&&(h.selected=!0,p=!0),m?m.appendChild(h):(d.appendChild(h),f=!0)}),m&&m.children.length>0&&(d.appendChild(m),f=!0),!p&&u&&!d.querySelector(`option[value="${CSS.escape(u)}"]`)){let g=new Option(u+"",u,!1,!0);d.insertBefore(g,d.firstChild)}if(d.options.length>0&&d.selectedIndex===-1){let g=-1;for(let _=0;_<d.options.length;_++)if(!d.options[_].disabled&&d.options[_].value){g=_;break}d.selectedIndex=g!==-1?g:0}};t&&i(t),a.forEach(i)}window.aipkit_updateOllamaModels=r})();(function(){"use strict";function k(t,a){let s=Array.isArray(a)?a:[],l=JSON.stringify(s),o=`[id^="${t==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(o).forEach(e=>{t==="models"?e.dataset.models=l:e.dataset.voices=l})}function r(t,a="aipkit_elevenlabs_voice_id"){let s=Array.isArray(t)?t:[];k("voices",s);let l=document.getElementById(a);if(!l){console.warn(`ElevenLabs Sync (Voices): Select element #${a} not found.`);return}if(typeof a=="string"&&a.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(a,s,l.value||"");return}let c=l.value;if(l.innerHTML="",l.appendChild(new Option("-- Select a Voice (Optional) --","")),!s.length){c&&c!==""&&(l.appendChild(new Option(c+"",c,!1,!0)),l.value=c);return}let o=!1;if(s.sort((e,i)=>(e.name||e.id||"").localeCompare(i.name||i.id||"")),s.forEach(e=>{let i=e.id||"",d=e.name||i;if(!i)return;let u=new Option(d,i);i===c&&(u.selected=!0,o=!0),l.appendChild(u)}),!o&&c&&c!==""&&!l.querySelector(`option[value="${CSS.escape(c)}"]`)){let e=new Option(c+"",c,!1,!0);l.appendChild(e),l.value=c}}function n(t,a="aipkit_elevenlabs_tts_model_id"){let s=Array.isArray(t)?t:[];k("models",s);let l=document.getElementById(a);if(!l){console.warn(`ElevenLabs Sync (Models): Select element #${a} not found.`);return}if(typeof a=="string"&&a.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(a,s,l.value||"");return}let c=l.value;if(l.innerHTML="",l.appendChild(new Option("-- Select a Model (Optional) --","")),!s.length){c&&c!==""&&(l.appendChild(new Option(c+"",c,!1,!0)),l.value=c);return}let o=!1;if(s.sort((e,i)=>(e.name||e.id||"").localeCompare(i.name||i.id||"")),s.forEach(e=>{let i=e.id||"",d=e.name||i;if(!i)return;let u=new Option(d,i);i===c&&(u.selected=!0,o=!0),l.appendChild(u)}),!o&&c&&c!==""&&!l.querySelector(`option[value="${CSS.escape(c)}"]`)){let e=new Option(c+"",c,!1,!0);l.appendChild(e),l.value=c}}window.aipkit_updateElevenLabsVoices=r,window.aipkit_updateElevenLabsModelsSelect=n})();(function(){"use strict";function k(r,n="aipkit_pinecone_default_index"){let t=document.getElementById(n);if(!t){console.warn(`Pinecone Sync: Select element #${n} not found.`);return}let a=t.value;if(t.innerHTML="",t.appendChild(new Option("-- Select Synced Index --","")),!r||!r.length){t.appendChild(new Option("(No indexes found - Sync again)","")),a&&a!==""&&(t.appendChild(new Option(a+"",a,!1,!0)),t.value=a);return}let s=!1;if(r.sort((l,c)=>(l.name||l.id||"").localeCompare(c.name||c.id||"")),r.forEach(l=>{let c=l.name||l.id||(typeof l=="string"?l:"");if(!c)return;let o=new Option(c,c);c===a&&(o.selected=!0,s=!0),t.appendChild(o)}),!s&&a&&a!==""&&!t.querySelector(`option[value="${CSS.escape(a)}"]`)){let l=new Option(a+"",a,!1,!0);t.appendChild(l),t.value=a}}window.aipkit_updatePineconeIndexes=k})();(function(){"use strict";function k(r,n="aipkit_qdrant_default_collection"){let t=document.getElementById(n);if(!t){console.warn(`Qdrant Sync: Select element #${n} not found.`);return}let a=t.multiple,s=a?Array.from(t.selectedOptions).map(c=>c.value).filter(Boolean):[t.value];if(t.innerHTML="",a||t.appendChild(new Option("-- Select Synced Collection --","")),!r||!r.length){t.appendChild(new Option("(No collections found - Sync again)","")),s.length&&(s.forEach(c=>{c&&t.appendChild(new Option(c+"",c,!1,!0))}),!a&&s[0]&&(t.value=s[0]));return}let l=new Set;if(r.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||"")),r.forEach(c=>{let o=c.name||c.id||"";if(!o)return;let e=s.includes(o),i=new Option(o,o,!1,e);e&&l.add(o),t.appendChild(i)}),s.forEach(c=>{if(c&&!l.has(c)&&!t.querySelector(`option[value="${CSS.escape(c)}"]`)){let o=new Option(c+"",c,!1,!0);t.appendChild(o)}}),!a&&s[0]&&!t.value&&(t.value=s[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let c=t.closest(".aipkit_popover_options_list")||t.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(c)}}window.aipkit_updateQdrantCollections=k})();(function(){"use strict";function k(r,n=""){let t=n||"aipkit_replicate_model",a=document.getElementById(t);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=r),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=r),!a){n&&console.warn(`Replicate Sync: Select element #${t} not found.`);return}let s=a.value;if(a.innerHTML="",!r||!r.length){a.appendChild(new Option("(No models found - Sync again)","")),s&&s!==""&&(a.appendChild(new Option(s+"",s,!1,!0)),a.value=s);return}let l=!1;if(r.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||"")),r.forEach(c=>{let o=c.id||"",e=c.name||o;if(!o)return;let i=new Option(e,o);o===s&&(i.selected=!0,l=!0),a.appendChild(i)}),!l&&s&&s!==""&&!a.querySelector(`option[value="${CSS.escape(s)}"]`)){let c=new Option(s+"",s,!1,!0);a.insertBefore(c,a.firstChild),a.value=s}if(!a.value&&a.options.length>0){let c=-1;for(let o=0;o<a.options.length;o++)if(!a.options[o].disabled&&a.options[o].value){c=o;break}a.selectedIndex=c!==-1?c:0}}window.aipkit_updateReplicateModels=k})();(function(){"use strict";function k(m,g,_={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let w=_&&typeof _=="object"?_:{},h=!!w.silent,E=w.showErrors!==!1,x=w.showSuccess===!0,v=!!m,I=(F,L="")=>{let O=Array.isArray(F)?F:[],D=document.getElementById("aipkit_google_tts_voices_json_main");D&&(D.dataset.voices=JSON.stringify(O));let R=L||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(R&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Z=document.getElementById(R);window.aipkit_updateGoogleVoiceSelect(R,O,Z&&Z.value||"")}},P=F=>{let L=Array.isArray(F)?F:[];window.aipkit_chat_config=window.aipkit_chat_config||{},window.aipkit_chat_config.openaiVectorStores=L,typeof window.aipkit_invalidateModuleCache=="function"&&["chatbot","sources","content-writer","autogpt","ai-forms"].forEach(O=>{window.aipkit_invalidateModuleCache(O)}),typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:"openai",stores:L}}))},b={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:I,OpenAIVectorStores:P,Azure:window.aipkit_updateAzureDeployments,Claude:window.aipkit_updateClaudeModels,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof b[g]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${g}.`),alert(`AIPKit Error: Cannot update UI for ${g}.`);return}let y="aipkit_settings_global_messages",S=v?!!m.closest(".aipkit_popover_options_list")&&!m.closest("#aipkit_settings_container .aipkit_settings_advanced_panel"):!1;!h&&!S&&document.getElementById(y)&&(window.aipkit_clearStatusMessages(y),window.aipkit_showSavingIndicator(y,!1));let C=v?m.querySelector(".aipkit_btn-text"):null,A=v?m.getAttribute("data-target-select"):w.targetSelectId||"",M=null,$=F=>!F||!(F instanceof Element)?null:F.querySelector(".aipkit_builder_card--shortcode .aipkit_model_sync_status")||F.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status");if(S){let L=m.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||m.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||m.closest(".aipkit_popover_flyout_header");if(L&&(M=L.querySelector(".aipkit_popover_status_inline")),!M){let O=m.closest(".aipkit_model_settings_popover");O&&(M=O.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!M){let O=m.closest(".aipkit_popover_option_row");O&&(M=O.querySelector(".aipkit_popover_status_inline"))}if(!M){let O=m.closest(".aipkit_model_settings_panel");O&&(M=O.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let F=v?m.closest(".aipkit_chatbot_model_field"):null,L=v?m.closest(".aipkit_chatbot_builder"):null;if(!L&&A){let O=document.getElementById(A);L=O?O.closest(".aipkit_chatbot_builder"):null}L||(L=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]')),L&&L.getAttribute("data-aipkit-chatbot-layout")==="next"&&(M=$(L)),M||(M=F?F.querySelector(".aipkit_model_sync_status"):null)}if(!M){let F=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]');F&&(M=$(F))}if(!M&&g){let F=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${g}"]`);F&&(M=F.querySelector(".aipkit_model_sync_status"))}let W=(F,L,O)=>{if(!M)return;let D=M.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");D&&F&&(D.textContent="",D.className="aipkit_save_status_container"),M.textContent=F||"",M.classList.remove("success","error","loading"),L&&M.classList.add(L),O?M.setAttribute("title",O):M.removeAttribute("title"),M.classList.contains("aipkit_popover_status_inline")&&(M.style.display=F?"inline-block":"none")};W("Syncing\u2026","loading");let H=C?C.textContent:g.includes("ElevenLabs")||g.includes("Pinecone")||g.includes("Qdrant")||g.includes("VectorStores")||g.includes("Replicate")?"Sync Items":"Sync Models",N=null;return v&&(N=m.querySelector(".aipkit_spinner"),N||(N=document.createElement("span"),N.className="aipkit_spinner",m.appendChild(N)),N.style.display="inline-block",m.classList.add("aipkit_loading"),m.disabled=!0),(g==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:g})).then(F=>{g==="OpenRouter"&&Array.isArray(F?.embedding_models)&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.embeddingModels=window.aipkit_dashboard.embeddingModels||{},window.aipkit_dashboard.embeddingModels.openrouter=F.embedding_models);let L=g==="GoogleTtsVoices"?F.voices:g==="OpenAIVectorStores"?F.stores:F.models,O=Array.isArray(F?.recommended_models)?F.recommended_models:[],R={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"}[g]||"";R&&O.length>0&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.recommendedModels=window.aipkit_dashboard.recommendedModels||{},window.aipkit_dashboard.recommendedModels[R]=O),w.skipUpdate||(A?b[g](L,A):b[g](L)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(g==="PineconeIndexes"||g==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():h||console.warn("Model Sync Init: Cannot update autosave baseline.");let Z="models";g==="ElevenLabs"||g==="GoogleTtsVoices"?Z="voices":g==="ElevenLabsModels"?Z="synthesis models":g==="PineconeIndexes"?Z="indexes":g==="QdrantCollections"?Z="collections":g==="OpenAIVectorStores"&&(Z="vector stores"),(!h||x)&&!S&&document.getElementById(y)&&window.aipkit_showMessage(y,"success",`${g.replace(/Indexes|Collections|Models/,"")} ${Z} synced!`),W("Saved","success"),M&&setTimeout(()=>W("",null),2500)}).catch(F=>{let L=F?.message||"Sync failed.";if(E&&!S&&document.getElementById(y)&&window.aipkit_showMessage(y,"error",`Sync failed: ${L}`),console.error(`AIPKit Sync Error (${g}):`,F),W(L,"error",L),M&&setTimeout(()=>W("",null),5e3),w.propagateError)throw F}).finally(()=>{if(v){m.disabled=!1,m.classList.remove("aipkit_loading");let F=m.querySelector(".aipkit_spinner");F&&(F.style.display="none"),C&&(C.textContent=H)}})}function r(m){if(!m)return;let g="data-sync-listener-attached";m.getAttribute(g)||(m.addEventListener("click",function(_){let w=_.target.closest(".aipkit_sync_btn");if(!w||w.disabled)return;_.preventDefault();let h=w.getAttribute("data-provider")||"";if(!h){let E=w.closest(".aipkit_chatbot_model_field");E&&E.getAttribute("data-provider")&&(h=E.getAttribute("data-provider"))}h?k(w,h):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",w)}),m.setAttribute(g,"true"))}function n(){r(document.getElementById("aipkit_module-container")),r(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let t=[],a=!1;function s(m,g){if(!m||typeof m!="object")return"";let _=m[g];return _==null?"":String(_).trim()}function l(m,g,_){return _.some(w=>s(m,w)!==s(g,w))}function c(m){return s(m,"azure_api_key")!==""&&s(m,"azure_endpoint")!==""}function o(m,g){let _=String(m||"").trim();if(!_)return!1;if(_==="Ollama")return!0;if(_==="Azure")return c(g);let h={OpenAI:"openai_api_key",OpenRouter:"openrouter_api_key",Google:"google_api_key",Claude:"claude_api_key",DeepSeek:"deepseek_api_key"}[_];return h?s(g,h)!=="":!1}function e(m,g){return[{provider:"OpenAI",keys:["openai_api_key","openai_base_url","openai_api_version"],ready:w=>s(w,"openai_api_key")!==""},{provider:"OpenAIVectorStores",keys:["openai_api_key","openai_base_url","openai_api_version"],ready:w=>s(w,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key","openrouter_base_url","openrouter_api_version"],ready:w=>s(w,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key","google_base_url","google_api_version"],ready:w=>s(w,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key","google_base_url","google_api_version"],ready:w=>s(w,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint","azure_authoring_version","azure_inference_version"],ready:w=>c(w)},{provider:"Claude",keys:["claude_api_key","claude_base_url","claude_api_version"],ready:w=>s(w,"claude_api_key")!==""},{provider:"DeepSeek",keys:["deepseek_api_key","deepseek_base_url","deepseek_api_version"],ready:w=>s(w,"deepseek_api_key")!==""},{provider:"Ollama",keys:["ollama_base_url"],ready:w=>s(w,"ollama_base_url")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:w=>s(w,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:w=>s(w,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:w=>s(w,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:w=>s(w,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:w=>s(w,"qdrant_url")!==""&&s(w,"qdrant_api_key")!==""}].filter(w=>l(m,g,w.keys)&&w.ready(g)).map(w=>w.provider)}function i(m){return m?document.querySelector(`.aipkit_sync_btn[data-provider="${m}"]`):null}let d=null;function u(){if(a)return;let m=t.shift();if(!m)return;a=!0;let{provider:g,options:_,resolve:w,reject:h}=m,E=i(g),x=k(E,g,_);d={provider:g,promise:x},x&&typeof x.finally=="function"?x.then(v=>{typeof w=="function"&&w(v)}).catch(v=>{typeof h=="function"&&h(v)}).finally(()=>{d=null,a=!1,u()}):(d=null,typeof w=="function"&&w(null),a=!1,u())}function p(m,g={}){if(!m)return null;if(d&&d.provider===m&&d.promise)return d.promise;if(t.some(x=>x.provider===m)){let x=t.find(v=>v.provider===m);return x&&x.promise?x.promise:null}let w,h,E=new Promise((x,v)=>{w=x,h=v});return t.push({provider:m,options:g,resolve:w,reject:h,promise:E}),u(),E}function f(m,g){if(!m||!g)return;e(m,g).forEach(w=>p(w,{silent:!0,showSuccess:!0}))}window.aipkit_initSyncButtons=n,window.aipkit_syncModels=k,window.aipkit_queueProviderSync=p,window.aipkit_queueProviderAutoSync=f,window.aipkit_isProviderReadyForAutoSync=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(y){return y},r="#aipkit_settings_container #aipkit_provider, #aipkit_settings_container #aipkit_settings_integration_provider, #aipkit_settings_container .aipkit_model_field select.aipkit_form-input",n=null,t=null,a=!1,s=y=>{y&&(y.style.position="",y.style.left="",y.style.top="",y.style.bottom="",y.style.width="",y.style.maxWidth="",y.style.minWidth="")},l=(y,S)=>{if(!y||!S)return;y.classList.remove("aipkit_settings_dropdown--dropup");let C=12,A=y.getBoundingClientRect(),M=S.getBoundingClientRect().height||S.scrollHeight||0,$=window.innerHeight-A.bottom-C,W=A.top-C;M>$&&W>$&&y.classList.add("aipkit_settings_dropdown--dropup")},c=(y,S)=>{if(!y||!S)return;l(y,S);let C=12,A=y.getBoundingClientRect(),$=y.classList.contains("aipkit_settings_provider_dropdown")?220:260,W=Math.max(160,window.innerWidth-32),H=Math.min(Math.max(A.width,$),W);S.style.position="fixed",S.style.width=`${Math.round(H)}px`,S.style.minWidth=`${Math.round(Math.min($,H))}px`,S.style.maxWidth=`${Math.round(H)}px`;let N=S.getBoundingClientRect().height||S.scrollHeight||0,Q=y.classList.contains("aipkit_settings_dropdown--dropup")?A.top-N-6:A.bottom+6;Q+N>window.innerHeight-C&&(Q=window.innerHeight-C-N),Q<C&&(Q=C);let F=A.left;F+H>window.innerWidth-C&&(F=window.innerWidth-C-H),F<C&&(F=C),S.style.left=`${Math.round(F)}px`,S.style.top=`${Math.round(Q)}px`,S.style.bottom="auto"},o=y=>{if(!y)return"";let S=y.getAttribute("data-aipkit-picker-title");if(S)return S;let C=y.id&&document.querySelector(`label[for="${y.id}"]`)||y.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");if(!C)return"";let A=C.cloneNode(!0);return A.querySelectorAll(".aipkit_form-label-helper").forEach(M=>{M.remove()}),A.textContent.replace(/\s+/g," ").trim()},e=y=>{if(!y)return"";let S=y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]");if(S)return S.textContent.trim();let C=y.querySelector("option");return C?C.textContent.trim():""},i=y=>y&&(y.id==="aipkit_provider"||y.id==="aipkit_settings_integration_provider"),d=y=>!!(y&&(y.classList.contains("aipkit_settings_provider_dropdown")||y.classList.contains("aipkit_settings_model_dropdown"))),u=y=>String(y||"").trim().toLowerCase(),p=(y,S)=>{if(!y)return;let C="aipkit_settings_select_picker_icon--";y.classList.forEach(M=>{M.startsWith(C)&&y.classList.remove(M)});let A=u(S);A&&y.classList.add(`${C}${A}`)},f=y=>({buttonId:`${y}_picker_btn`,labelId:`${y}_picker_label`,popoverId:`${y}_picker_popover`,titleId:`${y}_picker_title`,searchId:`${y}_picker_search`,listId:`${y}_picker_list`}),m=y=>{if(!y||!y.id)return null;let S=f(y.id);if(!document.getElementById("aipkit_settings_container"))return null;if(i(y)){let L=document.getElementById(S.popoverId);L&&!L.classList.contains("aipkit_settings_provider_dropdown")&&(L.remove(),L=null),L||(L=document.createElement("div"),L.id=S.popoverId,L.className="aipkit_popover_multiselect aipkit_settings_provider_dropdown",y.insertAdjacentElement("beforebegin",L));let O=document.getElementById(S.buttonId);if(O&&O.parentElement!==L&&(O.remove(),O=null),!O){O=document.createElement("button"),O.type="button",O.id=S.buttonId,O.className="aipkit_popover_multiselect_btn aipkit_settings_select_picker_btn aipkit_settings_select_picker_btn--provider",O.setAttribute("aria-expanded","false");let Ce=document.createElement("span");Ce.className="aipkit_settings_select_picker_icon",Ce.setAttribute("aria-hidden","true"),O.appendChild(Ce);let He=document.createElement("span");He.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",He.id=S.labelId,He.textContent=e(y)||k("Select","gpt3-ai-content-generator"),O.appendChild(He),L.appendChild(O)}let D=L.querySelector(".aipkit_popover_multiselect_panel");D||(D=document.createElement("div"),D.className="aipkit_popover_multiselect_panel aipkit_settings_provider_dropdown_panel",D.hidden=!0,D.setAttribute("role","menu"),L.appendChild(D));let R=D.querySelector(".aipkit_settings_select_picker_list");R||(R=document.createElement("div"),R.className="aipkit_popover_multiselect_options aipkit_settings_select_picker_list",R.id=S.listId,R.setAttribute("role","listbox"),D.appendChild(R));let Z=`${S.popoverId}_panel`;D.id=Z,O.setAttribute("aria-controls",Z);let J=document.getElementById(S.labelId)||(()=>{let Ce=document.createElement("span");return Ce.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",Ce.id=S.labelId,O.appendChild(Ce),Ce})(),pe=O.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let Ce=document.createElement("span");return Ce.className="aipkit_settings_select_picker_icon",Ce.setAttribute("aria-hidden","true"),O.insertBefore(Ce,O.firstChild),Ce})();return p(pe,y.value),y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text"),{ids:S,button:O,popover:L,label:J,search:null,list:R}}let A=document.getElementById(S.popoverId);A&&!A.classList.contains("aipkit_settings_model_dropdown")&&(A.remove(),A=null),A||(A=document.createElement("div"),A.id=S.popoverId,A.className="aipkit_popover_multiselect aipkit_settings_model_dropdown",y.insertAdjacentElement("beforebegin",A));let M=document.getElementById(S.buttonId);if(M&&M.parentElement!==A&&(M.remove(),M=null),!M){M=document.createElement("button"),M.type="button",M.id=S.buttonId,M.className="aipkit_popover_multiselect_btn aipkit_settings_select_picker_btn",M.setAttribute("aria-expanded","false");let L=document.createElement("span");L.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",L.id=S.labelId,L.textContent=e(y)||k("Select","gpt3-ai-content-generator"),M.appendChild(L),A.appendChild(M)}let $=A.querySelector(".aipkit_popover_multiselect_panel");$||($=document.createElement("div"),$.className="aipkit_popover_multiselect_panel aipkit_settings_model_dropdown_panel",$.hidden=!0,$.setAttribute("role","menu"),A.appendChild($));let W=$.querySelector(".aipkit_settings_select_picker_search");W||(W=document.createElement("div"),W.className="aipkit_settings_select_picker_search",$.appendChild(W));let H=document.getElementById(S.searchId);(!H||H.parentElement!==W)&&(H=document.createElement("input"),H.type="search",H.id=S.searchId,H.className="aipkit_form-input",W.appendChild(H));let N=o(y),G=N?`Search ${N.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");H.setAttribute("placeholder",G);let Q=$.querySelector(".aipkit_settings_select_picker_list");Q||(Q=document.createElement("div"),Q.className="aipkit_popover_multiselect_options aipkit_settings_select_picker_list",Q.id=S.listId,Q.setAttribute("role","listbox"),$.appendChild(Q));let F=`${S.popoverId}_panel`;return $.id=F,M.setAttribute("aria-controls",F),y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text"),{ids:S,button:M,popover:A,label:document.getElementById(S.labelId),search:document.getElementById(S.searchId),list:document.getElementById(S.listId)}},g=y=>{let S=[];return y&&Array.from(y.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let M=Array.from(A.children).filter($=>$.tagName==="OPTION").map($=>({value:$.value,label:$.textContent.trim(),disabled:$.disabled,selected:$.selected}));S.push({groupLabel:A.label||"",options:M})}else A.tagName==="OPTION"&&S.push({groupLabel:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),S},_=(y,S,C="")=>{if(!y||!S)return;let A=C.trim().toLowerCase();if(S.innerHTML="",i(y)){let W=g(y).flatMap(H=>H.options||[]).filter(H=>A?H.label.toLowerCase().includes(A):!0);if(!W.length){let H=document.createElement("div");H.className="aipkit_popover_multiselect_empty aipkit_settings_select_picker_empty",H.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),S.appendChild(H);return}W.forEach(H=>{let N=document.createElement("button");N.type="button",N.className="aipkit_settings_select_picker_item aipkit_popover_multiselect_item aipkit_settings_provider_dropdown_item",N.setAttribute("role","option"),N.dataset.value=H.value,N.dataset.label=H.label,H.disabled&&(N.classList.add("is-disabled"),N.setAttribute("aria-disabled","true")),y.value===H.value?(N.classList.add("is-active"),N.setAttribute("aria-selected","true")):N.setAttribute("aria-selected","false");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),p(G,H.value);let Q=document.createElement("span");Q.className="aipkit_settings_select_picker_text aipkit_popover_multiselect_text",Q.textContent=H.label,N.appendChild(G),N.appendChild(Q),S.appendChild(N)});return}let M=g(y),$=!1;if(M.forEach(W=>{let H=W.options.filter(G=>A?G.label.toLowerCase().includes(A):!0);if(!H.length)return;if(W.groupLabel){let G=document.createElement("div");G.className="aipkit_settings_select_picker_group_label",G.textContent=W.groupLabel,S.appendChild(G)}let N=`aipkit_settings_picker_${y.id}`;H.forEach(G=>{let Q=document.createElement("label");Q.className="aipkit_settings_select_picker_item aipkit_popover_multiselect_item aipkit_settings_model_dropdown_item",Q.setAttribute("role","option"),Q.dataset.value=G.value,Q.dataset.label=G.label,G.disabled&&(Q.classList.add("is-disabled"),Q.setAttribute("aria-disabled","true")),y.value===G.value?(Q.classList.add("is-active"),Q.setAttribute("aria-selected","true")):Q.setAttribute("aria-selected","false");let F=document.createElement("span");F.className="aipkit_settings_model_dropdown_item_label";let L=document.createElement("input");L.type="radio",L.className="aipkit_settings_select_picker_radio",L.name=N,L.value=G.value,L.checked=y.value===G.value,L.disabled=!!G.disabled;let O=document.createElement("span");O.className="aipkit_settings_select_picker_text aipkit_popover_multiselect_text",O.textContent=G.label,F.appendChild(L),F.appendChild(O),Q.appendChild(F),S.appendChild(Q),$=!0})}),!$){let W=document.createElement("div");W.className="aipkit_settings_select_picker_empty",W.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),S.appendChild(W)}},w=(y,S)=>{if(!y||!S)return;let C=e(y);if(S.textContent=C||k("Select","gpt3-ai-content-generator"),i(y)){let A=S.closest("button"),M=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;p(M,y.value)}},h=(y,S)=>{if(!y||!S)return;if(S.closest(".aipkit_settings_provider_dropdown")||S.closest(".aipkit_settings_model_dropdown")){S.style.left="",S.style.top="";return}if(S.closest(".aipkit_settings_select_picker_popover")?.classList.contains("aipkit_settings_select_picker_popover--provider-anchor")){S.style.left="",S.style.top="";return}let C=y.getBoundingClientRect(),A=S.getBoundingClientRect(),M=A.width||320,$=A.height||0,W=window.innerWidth,H=window.innerHeight,N=12;if(y.dataset.aipkitPopoverPlacement==="bottom"){let F=C.left;F+M>W-N&&(F=C.right-M),F=Math.max(N,Math.min(F,W-M-N));let L=C.bottom+8;L+$>H-N&&(L=C.top-$-8),L=Math.max(N,Math.min(L,H-$-N)),S.style.left=`${Math.round(F)}px`,S.style.top=`${Math.round(L)}px`;return}let G=C.right+10;G+M>W-N&&(G=C.left-M-10),G=Math.max(N,Math.min(G,W-M-N));let Q=C.top;Q+$>H-N&&(Q=H-$-N),Q=Math.max(N,Q),S.style.left=`${Math.round(G)}px`,S.style.top=`${Math.round(Q)}px`},E=()=>{if(!(!n||!t||a)){if(d(n)){let y=n.querySelector(".aipkit_popover_multiselect_panel");c(n,y);return}a=!0,window.requestAnimationFrame(()=>{let y=n.querySelector(".aipkit_model_settings_popover_panel");h(t,y),a=!1})}},x=()=>{if(n){if(d(n)){n.classList.remove("is-open"),n.classList.remove("aipkit_settings_dropdown--dropup");let y=n.querySelector(".aipkit_popover_multiselect_panel");y&&(y.hidden=!0,s(y))}else n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true");t&&t.setAttribute("aria-expanded","false"),n=null,t=null}},v=(y,S,C)=>{if(!y||!S)return;n&&n!==S&&x(),n=S,t=y;let A=d(S);if(A){S.classList.add("is-open");let H=S.querySelector(".aipkit_popover_multiselect_panel");H&&(H.hidden=!1)}else S.classList.add("aipkit-active"),S.setAttribute("aria-hidden","false");y.setAttribute("aria-expanded","true");let M=S.querySelector(".aipkit_settings_select_picker_search input"),$=S.querySelector(".aipkit_settings_select_picker_list");if($&&_(C,$,M?M.value:""),A){let H=S.querySelector(".aipkit_popover_multiselect_panel");H&&window.requestAnimationFrame(()=>{c(S,H)})}if(M&&M.offsetParent!==null&&(M.focus(),M.select()),A)return;let W=S.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{h(y,W)})},I=(y,S)=>{if(!y||!S)return;let{button:C,popover:A,list:M,search:$}=S;if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",W=>{if(W.preventDefault(),n===A){x();return}v(C,A,y)}),C.dataset.pickerListenerAttached="true"),A&&!d(A)&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",H=>{H.target===A&&x()});let W=A.querySelector(".aipkit_model_settings_popover_close");W&&W.addEventListener("click",H=>{H.preventDefault(),x()}),A.dataset.overlayListenerAttached="true"}if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",W=>{let H=W.target.closest(".aipkit_settings_select_picker_item");if(!H||H.classList.contains("is-disabled"))return;let N=H.dataset.value??"";y.value=N,y.dispatchEvent(new Event("change",{bubbles:!0})),w(y,S.label),_(y,M,$?$.value:""),x()}),M.dataset.pickerListenerAttached="true"),$&&$.dataset.pickerListenerAttached!=="true"&&($.addEventListener("input",()=>{_(y,M,$.value)}),$.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("change",()=>{w(y,S.label),_(y,M,$?$.value:"")}),y.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerObserverAttached!=="true"){let W=!1;new MutationObserver(()=>{W||(W=!0,window.requestAnimationFrame(()=>{w(y,S.label),_(y,M,$?$.value:""),W=!1}))}).observe(y,{childList:!0,subtree:!0}),y.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",W=>{W.key==="Escape"&&n&&x()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerOutsideBound||(document.addEventListener("mousedown",W=>{if(!n||!d(n))return;let H=W.target;n.contains(H)||t&&t.contains(H)||x()}),document.body.dataset.aipkitSettingsPickerOutsideBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",E),window.addEventListener("scroll",E,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function P(){let y=document.getElementById("aipkit_settings_container");if(!y)return;let S=y.querySelectorAll(r);S.length&&S.forEach(C=>{if(!C.id||C.dataset.aipkitPickerInit==="true")return;let A=m(C);A&&(w(C,A.label),_(C,A.list,A.search?A.search.value:""),I(C,A),C.dataset.aipkitPickerInit="true")})}function b(){let y=document.getElementById("aipkit_settings_container");if(!y)return;y.querySelectorAll(r).forEach(C=>{if(!C.id)return;let A=m(C);A&&(w(C,A.label),_(C,A.list,A.search?A.search.value:""),I(C,A),C.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=P,window.aipkit_refreshSettingsSelectPickers=b})();(function(){"use strict";function k(n,t,a){if(!n||!t)return;t.hidden=!a,t.style.display=a?"grid":"none",n.querySelectorAll(".aipkit_settings_advanced_toggle_link").forEach(l=>{l.setAttribute("aria-expanded",a?"true":"false"),l.classList.toggle("is-open",a)})}function r(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let t=n.querySelector("#aipkit_settings_advanced_group");if(!t)return;let a=!t.hidden&&t.style.display!=="none";k(n,t,a),n.dataset.aipkitAdvancedToggleInit!=="true"&&(n.addEventListener("click",s=>{let l=s.target.closest(".aipkit_settings_advanced_toggle_link");if(!l||!n.contains(l))return;s.preventDefault();let c=t.hidden;k(n,t,c)}),n.dataset.aipkitAdvancedToggleInit="true")}window.aipkit_initSettingsAdvancedToggle=r})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let n=r.querySelectorAll("[data-aipkit-settings-page-link]"),t=r.querySelectorAll("[data-aipkit-settings-page]");if(!n.length||!t.length)return;let a=new Set(Array.from(t).map(c=>c.dataset.aipkitSettingsPage||"")),s=a.has("ai")?"ai":Array.from(a)[0]||"",l=c=>{let o=a.has(c)?c:s;o&&(n.forEach(e=>{let i=e.dataset.aipkitSettingsPageLink===o;e.classList.toggle("is-active",i),e.setAttribute("aria-current",i?"page":"false")}),t.forEach(e=>{let i=e.dataset.aipkitSettingsPage===o;e.hidden=!i}),(o==="ai"||o==="integrations")&&typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers())};n.forEach(c=>{c.dataset.aipkitSettingsPageNavBound!=="true"&&(c.addEventListener("click",o=>{o.preventDefault(),l(c.dataset.aipkitSettingsPageLink||s)}),c.dataset.aipkitSettingsPageNavBound="true")}),l(s)}window.aipkit_initSettingsPageNav=k})();(function(){"use strict";let k="elevenlabs";function r(){return document.getElementById("aipkit_settings_container")}function n(){let l=r();return l?l.querySelector("#aipkit_settings_integration_provider"):null}function t(l,c){if(l){if(c){l.hidden=!1,l.style.display=l.classList.contains("aipkit_settings_simple_row")?"grid":"block";return}l.hidden=!0,l.style.display="none"}}function a(){let l=r();if(!l)return;let c=n();if(!c)return;let o=(c.value||k).trim().toLowerCase();l.querySelectorAll("[data-aipkit-integration-provider]").forEach(i=>{let d=String(i.getAttribute("data-aipkit-integration-provider")||"").trim().toLowerCase();t(i,d===o)}),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function s(){let l=n();if(l){if(l.dataset.aipkitIntegrationToggleBound==="true"){a();return}l.addEventListener("change",()=>{a()}),l.dataset.aipkitIntegrationToggleBound="true",a()}}window.aipkit_toggleIntegrationRows=a,window.aipkit_initIntegrationsProviderToggle=s})();(function(){"use strict";let k=window.wp?.i18n?.__||(f=>f),r="aipkit_settings_global_messages";function n(){return document.getElementById("aipkit_settings_container")}function t(){let f=n();return f?f.querySelector(".aipkit_settings_simple_form--others"):null}function a(f,m){if(typeof window.aipkit_showMessage=="function"){window.aipkit_showMessage(r,f,m);return}f==="error"?console.error(m):console.log(m)}function s(f,m,g=""){if(!f)return;if(m){f.dataset.originalLabel||(f.dataset.originalLabel=f.textContent||""),f.disabled=!0,f.classList.add("aipkit_loading");let w=f.querySelector(".aipkit_spinner");w||(w=document.createElement("span"),w.className="aipkit_spinner",f.appendChild(w)),w.style.display="inline-block",g&&(f.textContent=g,f.appendChild(w));return}f.disabled=!1,f.classList.remove("aipkit_loading"),f.dataset.originalLabel&&(f.textContent=f.dataset.originalLabel,delete f.dataset.originalLabel);let _=f.querySelector(".aipkit_spinner");_&&(_.style.display="none",f.appendChild(_))}function l(f,m){let g=JSON.stringify(f,null,2),_=new Blob([g],{type:"application/json"}),w=URL.createObjectURL(_),h=document.createElement("a");h.href=w,h.download=m,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(w)}function c(f,m){if(!f||typeof f!="object")return"";let g=f[m];return g==null?"":String(g).trim()}function o(f,m){switch(f){case"OpenAI":return c(m,"openai_api_key")!=="";case"OpenRouter":return c(m,"openrouter_api_key")!=="";case"Google":return c(m,"google_api_key")!=="";case"Azure":return c(m,"azure_api_key")!==""&&c(m,"azure_endpoint")!=="";case"Claude":return c(m,"claude_api_key")!=="";case"DeepSeek":return c(m,"deepseek_api_key")!=="";case"Ollama":return c(m,"ollama_base_url")!=="";case"ElevenLabs":case"ElevenLabsModels":return c(m,"elevenlabs_api_key")!=="";case"Replicate":return c(m,"replicate_api_key")!=="";case"PineconeIndexes":return c(m,"pinecone_api_key")!=="";case"QdrantCollections":return c(m,"qdrant_url")!==""&&c(m,"qdrant_api_key")!=="";default:return!1}}async function e(f){if(typeof window.aipkit_apiRequest!="function"){a("error",k("API helper missing.","gpt3-ai-content-generator"));return}s(f,!0,k("Exporting...","gpt3-ai-content-generator"));try{let m=await window.aipkit_apiRequest("aipkit_export_settings_backup");if(!m||typeof m!="object"||!m.export_data)throw new Error(k("Export payload was empty.","gpt3-ai-content-generator"));let g=m.filename||`aipkit-settings-backup-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`;l(m.export_data,g),a("success",m.message||k("Settings export completed.","gpt3-ai-content-generator"))}catch(m){a("error",k("Export failed: ","gpt3-ai-content-generator")+(m?.message||""))}finally{s(f,!1)}}async function i(f,m){let g=f?.files?.[0];if(g){if(typeof window.aipkit_apiRequest!="function"){a("error",k("API helper missing.","gpt3-ai-content-generator"));return}s(m,!0,k("Importing...","gpt3-ai-content-generator")),a("info",k("Importing settings...","gpt3-ai-content-generator"));try{let _=await window.aipkit_apiRequest("aipkit_import_settings_backup",{settings_backup_file:g});a("success",_?.message||k("Settings imported. Reloading...","gpt3-ai-content-generator")),s(m,!1),setTimeout(()=>{window.location.reload()},750)}catch(_){a("error",k("Import failed: ","gpt3-ai-content-generator")+(_?.message||"")),s(m,!1)}finally{f&&(f.value="")}}}async function d(f,m,g){if(typeof window.aipkit_apiRequest!="function")return a("error",k("API helper missing.","gpt3-ai-content-generator")),!1;s(f,!0,k("Working...","gpt3-ai-content-generator"));try{let _=await window.aipkit_apiRequest(m);return a("success",_?.message||g),typeof window.aipkit_updateLastSavedData=="function"&&window.aipkit_updateLastSavedData(),!0}catch(_){return a("error",k("Action failed: ","gpt3-ai-content-generator")+(_?.message||"")),!1}finally{s(f,!1)}}async function u(f){if(typeof window.aipkit_queueProviderSync!="function"){a("error",k("Model sync helper is not available.","gpt3-ai-content-generator"));return}let m=typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_getCurrentFormData():{},_=[{provider:"OpenAI",label:"OpenAI"},{provider:"OpenRouter",label:"OpenRouter"},{provider:"Google",label:"Google"},{provider:"Azure",label:"Azure"},{provider:"Claude",label:"Claude"},{provider:"DeepSeek",label:"DeepSeek"},{provider:"Ollama",label:"Ollama"},{provider:"ElevenLabs",label:"ElevenLabs Voices"},{provider:"ElevenLabsModels",label:"ElevenLabs Models"},{provider:"Replicate",label:"Replicate"},{provider:"PineconeIndexes",label:"Pinecone"},{provider:"QdrantCollections",label:"Qdrant"}].filter(E=>o(E.provider,m));if(!_.length){a("info",k("No providers are ready to sync yet.","gpt3-ai-content-generator"));return}s(f,!0,k("Syncing...","gpt3-ai-content-generator")),a("info",k("Running sync for all ready providers...","gpt3-ai-content-generator"));let w=[],h=[];for(let E of _)try{await window.aipkit_queueProviderSync(E.provider,{silent:!0,showErrors:!1,showSuccess:!1,propagateError:!0}),h.push(E.label)}catch(x){w.push({label:E.label,message:x?.message||k("Unknown error","gpt3-ai-content-generator")})}if(typeof window.aipkit_updateLastSavedData=="function"&&window.aipkit_updateLastSavedData(),w.length>0){let E=w.map(x=>x.label).join(", ");a("error",k("Sync completed with errors: ","gpt3-ai-content-generator")+E)}else a("success",k("Models synced for: ","gpt3-ai-content-generator")+h.join(", "));s(f,!1)}function p(){let f=t();if(!f||f.dataset.aipkitOthersActionsBound==="true")return;let m=f.querySelector("#aipkit_settings_import_trigger"),g=f.querySelector("#aipkit_settings_import_file");f.addEventListener("click",_=>{let w=_.target.closest("[data-aipkit-settings-action]");if(!w||w.disabled)return;let h=w.getAttribute("data-aipkit-settings-action");if(h)switch(_.preventDefault(),h){case"export-backup":e(w);break;case"import-trigger":g&&g.click();break;case"create-restore-point":d(w,"aipkit_create_settings_restore_point",k("Restore point created.","gpt3-ai-content-generator"));break;case"restore-restore-point":d(w,"aipkit_restore_settings_restore_point",k("Restore point applied. Reloading...","gpt3-ai-content-generator")).then(E=>{E&&setTimeout(()=>{window.location.reload()},750)});break;case"clear-model-cache":d(w,"aipkit_clear_settings_model_cache",k("Model cache cleared.","gpt3-ai-content-generator"));break;case"clear-transients":d(w,"aipkit_clear_settings_transients",k("Transient cache cleared.","gpt3-ai-content-generator"));break;case"sync-all-models":u(w);break;default:break}}),g&&g.addEventListener("change",()=>{i(g,m)}),f.dataset.aipkitOthersActionsBound="true"}window.aipkit_initSettingsOthersActions=p})();(function(){"use strict";let k=!1,r=window.aipkit_escapeHtml||(g=>g||""),n={},t={},a=120,s="aipkit_content_writer_messages";function l(g,_){if(!g||typeof g!="string")return"";if(g.length<=_)return g;let w=g.substring(0,_-1);return w.substring(0,w.lastIndexOf(" ")).trim()+"\u2026"}function c(g){let _={"":t.use_default_position||"Default",default:t.use_default_position||"Default",replace:t.replace_selection||"Replace",after:t.insert_after||"After",before:t.insert_before||"Before"};return _[g]||_[""]}function o(g){let _=document.createElement("div");_.className="aipkit_assistant_action_card",_.dataset.actionId=g.id,_.dataset.label=g.label,_.dataset.prompt=g.prompt,_.dataset.insertPosition=g.insert_position||"";let w=r(g.prompt),h=l(w,a),E=w.length>a;return _.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${r(g.label)}</div>
        <div class="aipkit_assistant_action_prompt ${E?"":"aipkit_assistant_action_prompt--full"}">${E?h:w}</div>
        ${E?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${r(t.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${r(t.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,_}function e(g,_=!1){let w=(g.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${r(t.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${r(g.label)}" placeholder="${r(t.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${r(t.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${w===""?"selected":""}>${r(t.use_default_position||"Use default")}</option>
              <option value="replace" ${w==="replace"?"selected":""}>${r(t.replace_selection||"Replace selection")}</option>
              <option value="after" ${w==="after"?"selected":""}>${r(t.insert_after||"Insert after")}</option>
              <option value="before" ${w==="before"?"selected":""}>${r(t.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${r(t.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${r("Enter prompt. Use %s for selected text.")}">${r(g.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${r(t.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${r(t.save||"Save")}
          </button>
        </div>
      </div>
    `}function i(g){let _={id:g.dataset.actionId,label:g.dataset.label,prompt:g.dataset.prompt,insert_position:g.dataset.insertPosition||""};g.classList.add("aipkit_assistant_action_card--editing"),g.innerHTML=e(_);let w=g.querySelector(".aipkit-edit-prompt");w&&(w.value=_.prompt);let h=g.querySelector(".aipkit-edit-label");h&&(h.focus(),h.select())}function d(g,_){g.dataset.actionId=_.id,g.dataset.label=_.label,g.dataset.prompt=_.prompt,g.dataset.insertPosition=_.insert_position||"",g.classList.remove("aipkit_assistant_action_card--editing");let w=o(_);g.innerHTML=w.innerHTML}function u(g){if(g.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",t.max_actions_reached||"Maximum of 10 actions reached.");return}if(g.querySelector('[data-action-id^="new-"]'))return;let w=document.createElement("div");w.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",w.dataset.actionId=`new-${Date.now()}`,w.dataset.label="",w.dataset.prompt="",w.dataset.insertPosition="",w.innerHTML=e({id:w.dataset.actionId,label:"",prompt:"",insert_position:""},!0),g.prepend(w);let h=w.querySelector(".aipkit-edit-label");h&&h.focus()}async function p(g){if(k)return;let _=g.querySelector(".aipkit-edit-label"),w=g.querySelector(".aipkit-edit-prompt"),h=g.querySelector(".aipkit-edit-position");if(!_||!w)return;g.querySelectorAll(".aipkit_form-help-error").forEach(y=>y.remove()),_.style.borderColor="",w.style.borderColor="";let E=_.value.trim(),x=w.value.trim(),v=h?h.value:"",I=g.dataset.actionId,P=!1;if(!E){_.style.borderColor="#dc2626";let y=document.createElement("div");y.className="aipkit_form-help aipkit_form-help-error",y.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",y.textContent=t.label_required||"Label is required",_.parentNode.appendChild(y),P=!0}if(!x){w.style.borderColor="#dc2626";let y=document.createElement("div");y.className="aipkit_form-help aipkit_form-help-error",y.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",y.textContent=t.prompt_required||"Prompt is required",w.parentNode.appendChild(y),P=!0}if(P)return;k=!0;let b=g.querySelector(".aipkit-enhancer-save-action-btn");b&&(b.textContent=t.saving_action||"Saving...",b.disabled=!0);try{let y=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:I,label:E,prompt:x,insert_position:v,_ajax_nonce:n.nonce_manage_actions});d(g,y.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",t.action_saved||"Action saved successfully")}catch(y){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${t.error||"Error"}: ${y.message}`),b&&(b.textContent=t.save||"Save",b.disabled=!1)}finally{k=!1}}async function f(g){let _=g.querySelector("#aipkit_enhancer_actions_list");_.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${r(t.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let w=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:n.nonce_manage_actions});_.innerHTML="";let h=w.actions||[];h.length===0?_.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${r(t.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:h.forEach(E=>{_.appendChild(o(E))})}catch(w){_.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",w.message||t.loading_failed||"Failed to load actions.")}}function m(){let g=document.getElementById("aipkit_enhancer_actions_container");if(!g)return;let _=g.closest(".aipkit_assistant_settings_redesigned")||g;if(_.dataset.listenerAttached==="true")return;_.dataset.listenerAttached="true",g.dataset.listenerAttached="true";let w=g.closest(".aipkit_assistant_settings_redesigned")||_;n=window.aipkit_post_enhancer||{},t=n.text||{};let h=g.querySelector("#aipkit_enhancer_actions_list");if(!h)return;let E=w.querySelectorAll(".aipkit_assistant_position_option"),x=()=>{E.forEach(b=>{let y=b.querySelector("input[type=radio]");b.classList.toggle("aipkit_assistant_position_option--active",!!(y&&y.checked))})};x(),E.forEach(b=>{let y=b.querySelector("input[type=radio]");y&&y.addEventListener("change",x)});let v=null,I=null,P=async()=>{if(k)return;let b=Array.from(h.querySelectorAll(".aipkit_assistant_action_card")).map(A=>A.dataset.actionId).filter(A=>A&&!A.startsWith("new-"));if(!b.length)return;let y=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,S=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,C=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;k=!0,y&&y(t.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:b,_ajax_nonce:n.nonce_manage_actions}),S&&S(t.order_saved||"Order saved.")}catch(A){C?C(`${t.error||"Error"}: ${A.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${t.error||"Error"}: ${A.message}`)}finally{k=!1}};h.addEventListener("dragstart",b=>{let y=b.target.closest(".aipkit_assistant_action_drag");if(!y)return;let S=y.closest(".aipkit_assistant_action_card");if(!S||S.classList.contains("aipkit_assistant_action_card--editing")){b.preventDefault();return}v=S,S.classList.add("aipkit_dragging");try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",S.dataset.actionId||"")}catch{}}),h.addEventListener("dragend",async()=>{v&&v.classList.remove("aipkit_dragging"),v=null,I=null,await P()}),h.addEventListener("dragover",b=>{if(!v)return;let y=b.target.closest(".aipkit_assistant_action_card");if(!y||y===v)return;b.preventDefault();let S=y.getBoundingClientRect(),A=b.clientY<S.top+S.height/2?y:y.nextSibling;(I!==y||v.nextSibling!==A)&&(h.insertBefore(v,A),I=y)}),h.addEventListener("drop",async b=>{v&&(b.preventDefault(),await P())}),_.addEventListener("click",async b=>{let y=b.target.closest(".aipkit-enhancer-add-new-btn"),S=b.target.closest(".aipkit-enhancer-reset-actions-btn"),C=b.target.closest(".aipkit-enhancer-edit-action-btn"),A=b.target.closest(".aipkit-enhancer-delete-action-btn"),M=b.target.closest(".aipkit-enhancer-save-action-btn"),$=b.target.closest(".aipkit-enhancer-cancel-action-btn"),W=b.target.closest(".aipkit-enhancer-prompt-toggle");if(y)u(h);else if(S){if(!confirm(t.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:n.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",t.actions_reset||"Actions reset to defaults."),f(g)}catch(H){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${t.error||"Error"}: ${H.message}`)}}else if(W){let H=W.closest(".aipkit_assistant_action_card"),N=H.querySelector(".aipkit_assistant_action_prompt"),G=H.dataset.prompt;W.textContent.toLowerCase().includes("more")?(N.textContent=r(G),N.classList.add("aipkit_assistant_action_prompt--full"),W.textContent="Show less"):(N.textContent=l(r(G),a),N.classList.remove("aipkit_assistant_action_prompt--full"),W.textContent="Show more")}else if(C)i(C.closest(".aipkit_assistant_action_card"));else if(M)await p(M.closest(".aipkit_assistant_action_card"));else if($){let H=$.closest(".aipkit_assistant_action_card");H.dataset.actionId.startsWith("new-")?H.remove():d(H,{id:H.dataset.actionId,label:H.dataset.label,prompt:H.dataset.prompt,insert_position:H.dataset.insertPosition})}else if(A){if(k)return;let H=A.closest(".aipkit_assistant_action_card"),N=H.dataset.actionId;if(!confirm(t.confirm_delete_action||"Delete this action? This cannot be undone."))return;k=!0,A.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:N,_ajax_nonce:n.nonce_manage_actions}),H.style.transition="opacity 0.2s, transform 0.2s",H.style.opacity="0",H.style.transform="translateX(-10px)",setTimeout(()=>H.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",t.action_deleted||"Action deleted.")}catch(G){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${t.error||"Error"}: ${G.message}`),A.disabled=!1}finally{k=!1}}}),_.addEventListener("keydown",b=>{if(b.key==="Enter"&&b.target.matches("input[type=text]")){b.preventDefault();let y=b.target.closest(".aipkit_assistant_action_card--editing");y&&p(y)}}),window.aipkit_enhancer_reload_actions=()=>f(g),f(g)}window.aipkit_initEnhancerActionsUI=m})();(function(){"use strict";let k=[],r=[];function n(s){let l=document.getElementById("aipkit_semantic_search_target_id");if(!l)return;let c=l.value;l.innerHTML='<option value="">-- Select --</option>';let o=[];s==="pinecone"?o=k:s==="qdrant"&&(o=r),Array.isArray(o)&&o.forEach(e=>{let i=e.name||e.id||(typeof e=="string"?e:null);if(i){let d=document.createElement("option");d.value=i,d.textContent=i,l.appendChild(d)}}),l.querySelector(`option[value="${CSS.escape(c)}"]`)&&(l.value=c)}function t(s){let l=document.getElementById("aipkit_semantic_search_embedding_provider");if(!l||!s)return;let c=s.options[s.selectedIndex];c&&c.dataset.provider&&(l.value=c.dataset.provider)}function a(){let s=document.getElementById("aipkit_settings_container");if(!s)return;let l="data-semantic-search-listener-attached";if(s.getAttribute(l))return;let c=document.getElementById("aipkit_semantic_search_vector_provider"),o=document.getElementById("aipkit_pinecone_indexes_json_main"),e=document.getElementById("aipkit_qdrant_collections_json_main"),i=document.getElementById("aipkit_semantic_search_embedding_model");if(c){if(o&&o.dataset.indexes)try{k=JSON.parse(o.dataset.indexes)||[]}catch(d){console.error("Error parsing Pinecone indexes JSON:",d)}if(e&&e.dataset.collections)try{r=JSON.parse(e.dataset.collections)||[]}catch(d){console.error("Error parsing Qdrant collections JSON:",d)}c&&(c.addEventListener("change",d=>{if(n(d.target.value),typeof window.aipkit_handleAutoSave=="function"){let u=document.getElementById("aipkit_semantic_search_target_id");u&&(u.value=""),window.aipkit_handleAutoSave()}}),n(c.value)),i&&(i.addEventListener("change",d=>{t(d.target)}),t(i)),s.setAttribute(l,"true")}}window.aipkit_initSemanticSearchUI=a})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let t=n.querySelector("#aipkit_provider");if(!t)return;let a=t.value,s=n.querySelectorAll(".aipkit_api_key_field"),l=n.querySelectorAll(".aipkit_model_field"),c=n.querySelectorAll(".aipkit_advanced_settings_provider"),o=n.querySelector("#aipkit_safety_settings_accordion"),e=n.querySelectorAll(".aipkit_param_not_openai");s.forEach(p=>p.style.display="none"),l.forEach(p=>p.style.display="none"),c.forEach(p=>p.style.display="none"),o&&(o.style.display="none"),n.querySelectorAll(`.aipkit_api_key_field[data-provider="${a}"]`).forEach(p=>{p.style.display=p.classList.contains("aipkit_settings_simple_row")?"grid":"block"}),n.querySelectorAll(`.aipkit_model_field[data-provider="${a}"]`).forEach(p=>{p.style.display=p.classList.contains("aipkit_settings_simple_row")?"grid":"block"});let u=n.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${a}"]`);u&&(u.style.display="block"),a==="Google"&&o&&(o.style.display="block"),a==="OpenAI"||a==="Google"?e.forEach(p=>p.style.display="none"):e.forEach(p=>p.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function r(){let n=document.getElementById("aipkit_provider");if(n){let t="data-provider-listener-attached";if(n.getAttribute(t)==="true")return;n.addEventListener("change",function(){let a=n.value;k();let s=function(){if(typeof window.aipkit_queueProviderSync!="function"||typeof window.aipkit_getCurrentFormData!="function"||typeof window.aipkit_isProviderReadyForAutoSync!="function")return;let c=window.aipkit_getCurrentFormData();if(window.aipkit_isProviderReadyForAutoSync(a,c)){window.aipkit_queueProviderSync(a,{silent:!0,showSuccess:!0});return}typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage("aipkit_settings_global_messages","info",a+" credentials missing. Add API key.")},l=null;typeof window.aipkit_handleAutoSave=="function"?l=window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found."),l&&typeof l.finally=="function"?l.finally(s):s()}),n.setAttribute(t,"true"),k()}}window.aipkit_toggleProviderFields=k,window.aipkit_initProviderSelectListener=r})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_settings_container");!n||n.dataset.aipkitLabelClickGuard==="true"||(n.addEventListener("click",function(t){let a=t.target.closest(".aipkit_settings_simple_row > .aipkit_form-label, .aipkit_settings_advanced_label");!a||!n.contains(a)||t.preventDefault()}),n.dataset.aipkitLabelClickGuard="true")}function r(){k(),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initIntegrationsProviderToggle=="function"?window.aipkit_initIntegrationsProviderToggle():console.error("Settings Init: aipkit_initIntegrationsProviderToggle not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),typeof window.aipkit_initSettingsAdvancedToggle=="function"?window.aipkit_initSettingsAdvancedToggle():console.error("Settings Init: aipkit_initSettingsAdvancedToggle not found."),typeof window.aipkit_initSettingsPageNav=="function"?window.aipkit_initSettingsPageNav():console.error("Settings Init: aipkit_initSettingsPageNav not found."),typeof window.aipkit_initSettingsOthersActions=="function"?window.aipkit_initSettingsOthersActions():console.error("Settings Init: aipkit_initSettingsOthersActions not found."),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(t=>{t.dataset.accordionListenerAttached!=="true"&&(t.addEventListener("click",function(){let a=this.nextElementSibling;if(a){this.classList.toggle("aipkit_active"),a.classList.toggle("aipkit_active");let s=this.closest(".aipkit_accordion");s?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(s.style.display="block")}}),t.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found.")}window.aipkit_initSettings=r})();(function(){"use strict";let k=!1;function r(){let n=document.getElementById("aipkit_role_manager_container");if(!n){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let t=n.querySelector("#aipkit_save_roles_btn"),a=n.querySelector("#aipkit_role_manager_form"),s=n.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),s&&(s.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let l=window.aipkit_role_manager_config,c=l.text||{};if(!t||!a||!s){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let o="data-role-save-listener";t.getAttribute(o)||(t.addEventListener("click",function(e){if(e.preventDefault(),k)return;k=!0;let i=t.querySelector(".aipkit_btn-text"),d=t.querySelector(".aipkit_spinner");t.disabled=!0,d&&(d.style.display="inline-block"),i&&(i.textContent=c.saving||"Saving..."),s.innerHTML="",s.className="aipkit_settings_messages";let u=new FormData(a);u.append("action","aipkit_save_role_permissions"),fetch(l.ajaxurl,{method:"POST",body:u,credentials:"same-origin"}).then(p=>p.ok?p.json():p.json().then(f=>{throw new Error(f.data.message||`HTTP error! status: ${p.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${p.status}`)})).then(p=>{if(!p.success){let f=p.data&&p.data.message?p.data.message:"An unknown error occurred.";throw new Error(f)}return p.data}).then(p=>{let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-success",f.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${p.message||c.success||"Permissions saved!"}`,s.appendChild(f),setTimeout(()=>{f.remove()},4e3)}).catch(p=>{console.error("AIPKit Role Manager Save Error:",p);let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-error",f.innerHTML=`<span class="dashicons dashicons-warning"></span> ${p.message||c.fail||"Failed to save permissions."}`,s.appendChild(f),setTimeout(()=>{f.remove()},6e3)}).finally(()=>{k=!1,t.disabled=!1,d&&(d.style.display="none"),i&&(i.textContent=c.saveButton||"Save Permissions")})}),t.setAttribute(o,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&r()}),window.aipkit_initRoleManager=r})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}r.addEventListener("change",function(t){let a=t.target,s=a.closest(".aipkit_chatbot-settings-area");if(!s)return;if(a.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(s),window.aipkit_toggleOpenAISpecificSettingsVisibility(s),window.aipkit_toggleGoogleSpecificSettingsVisibility(s),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(s);return}if(a.matches('select[name$="_model"]')||a.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(s);return}let l=a.closest(".aipkit_stt_provider_select");if(l){let f=l.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f?window.aipkit_toggleSttModelFields(f):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",l);return}let c=a.closest(".aipkit_vector_store_toggle_switch");if(c){let f=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(f){window.aipkit_toggleVectorStoreSettingsVisibility(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');m&&(m.disabled=!c.checked,m.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let o=a.closest(".aipkit_vector_store_provider_select");if(o){let f=o.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&(window.aipkit_toggleVectorStoreProviderFields(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f));return}let e=a.closest(".aipkit_vector_embedding_provider_select");if(e){let f=e.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_populateVectorEmbeddingModelSelect(f);return}let i=a.closest(".aipkit_openai_web_search_enable_toggle");if(i){let f=i.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleOpenAIWebSearchSubSettings(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');m&&(m.disabled=!i.checked)}return}let d=a.closest(".aipkit_openai_web_search_loc_type_select");if(d){let f=d.closest(".aipkit_chatbot-settings-area");f&&window.aipkit_toggleOpenAIWebSearchLocationDetails(f);return}let u=a.closest(".aipkit_google_search_grounding_enable_toggle");if(u){let f=u.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleGoogleSearchGroundingSubSettings(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');m&&(m.disabled=!u.checked)}return}let p=a.closest(".aipkit_google_grounding_mode_select");if(p){let f=p.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_toggleGoogleGroundingDynamicThreshold(f);return}}),r.querySelectorAll(".aipkit_chatbot-settings-area").forEach(t=>{t.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(t),window.aipkit_toggleOpenAISpecificSettingsVisibility(t),window.aipkit_toggleGoogleSpecificSettingsVisibility(t)),t.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(t),t.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(t),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(t));let a=t.querySelector(".aipkit_openai_web_search_enable_toggle"),s=t.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');s&&a&&(s.disabled=!a.checked,s.title=a.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let l=t.querySelector(".aipkit_google_search_grounding_enable_toggle"),c=t.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');c&&l&&(c.disabled=!l.checked,c.title=l.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=k})();(function(){"use strict";function k(r){if(!r){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let n=r.querySelector(".aipkit_chatbot_provider_select");if(!n){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let t=n.value,a=["OpenAI","Google","Claude","OpenRouter","Azure","Ollama","DeepSeek"];r.querySelectorAll(".aipkit_chatbot_model_field").forEach(c=>{c.style.display="none";let o=c.querySelector(".aipkit_cb_web_search_toggle");o&&(o.style.display="none");let e=c.querySelector(".aipkit_cb_stateful_conv_toggle");e&&(e.style.display="none");let i=c.querySelector(".aipkit_cb_image_upload_toggle");i&&(i.style.display="none");let d=c.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="none")});let l=r.querySelector(`.aipkit_chatbot_model_field[data-provider="${t}"]`);if(l){l.style.display="block",r.querySelectorAll(".aipkit_feature_toggle_item").forEach(u=>{let p=(u.dataset.providers||"").trim();if(!p||p==="*"){u.style.display="";return}let f=p.split(/\s+/);u.style.display=f.includes(t)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(r),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(r);let o=l.querySelector(".aipkit_cb_web_search_toggle");o&&(o.dataset.provider||"").split(" ").includes(t)&&(o.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(r));let e=l.querySelector(".aipkit_cb_stateful_conv_toggle");e&&t==="OpenAI"&&(e.style.display="inline-flex");let i=l.querySelector(".aipkit_cb_image_upload_toggle");i&&(t==="OpenAI"||t==="Claude"?(i.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(r)):i.style.display="none");let d=l.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(r)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(r)}}window.aipkit_toggleChatbotModelFields=k})();(function(){"use strict";function k(r){r&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(r)}window.aipkit_toggleOpenAISpecificSettingsVisibility=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_chatbot_provider_select");n||(n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let t=n?.value==="OpenAI",a=r.querySelector(".aipkit_openai_web_search_enable_toggle");a||(a=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),a||(a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let s=r.querySelector(".aipkit_openai_web_search_conditional_settings");if(!a||!s)return;let l=a.tagName==="SELECT"?a.value==="1":a.checked;if(s.style.display=t&&l?"block":"none",t&&l)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(r);else{let c=r.querySelector(".aipkit_openai_web_search_location_details");c&&(c.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_openai_web_search_enable_toggle");n||(n=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),n||(n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let t=r.querySelector(".aipkit_openai_web_search_loc_type_select"),a=r.querySelector(".aipkit_openai_web_search_location_details");if(!t||!a){a&&(a.style.display="none");return}let s=n?n.tagName==="SELECT"?n.value==="1":n.checked:!1,l=(t.value||"")==="approximate";a.style.display=s&&l?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=k})();(function(){"use strict";function k(r){r&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(r)}window.aipkit_toggleGoogleSpecificSettingsVisibility=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_chatbot_provider_select");n||(n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let t=n?.value==="Google",a=r.querySelector(".aipkit_google_search_grounding_enable_toggle");a||(a=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),a||(a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let s=r.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!a||!s)return;let l=a.tagName==="SELECT"?a.value==="1":a.checked,c=t&&l;s.style.display=c?"block":"none",c?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(r):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(r,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=k})();(function(){"use strict";function k(r,n=null){if(!r)return;let t=r.querySelector(".aipkit_google_grounding_mode_select"),a=r.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),s=r.querySelector(".aipkit_google_search_grounding_enable_toggle");s||(s=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),s||(s=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let l=r.querySelector(".aipkit_google_search_grounding_conditional_settings"),c=l&&l.style.display==="none";if(!t||!a||!s){a&&(a.style.display="none");return}if(c){a.style.display="none";return}let o=n!==null?n:(s.tagName==="SELECT"?s.value==="1":s.checked)&&t.value==="MODE_DYNAMIC";a.style.display=o?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_stt_provider_select");if(!n)return;let t=n.value;r.querySelectorAll(".aipkit_stt_model_field").forEach(s=>{s.style.display=s.getAttribute("data-stt-provider")===t?"block":"none"})}window.aipkit_toggleSttModelFields=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_vector_store_toggle_switch");n||(n=r.querySelector(".aipkit_vector_store_enable_select")),n||(n=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let t=r.querySelector(".aipkit_vector_store_settings_conditional_row"),a=r.querySelector(".aipkit_context_grid"),s=r.querySelector(".aipkit_context_layout"),l=r.querySelector(".aipkit_vector_store_advanced_field"),c=r.querySelector(".aipkit_vector_store_top_k_field"),o=r.querySelector(".aipkit_vector_store_confidence_field");if(!n||!t)return;let e=n.tagName==="SELECT"?n.value==="1":n.checked;if(t.style.display=e?"block":"none",l){if(l.style.display=e?"block":"none",!e){let i=l.querySelector(".aipkit_vector_store_advanced_disclosure");i&&(i.open=!1)}c&&(c.style.display=""),o&&(o.style.display="")}else c&&(c.style.display=e?"block":"none"),o&&(o.style.display=e?"block":"none");e?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(r):(r.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(i=>i.style.display="none"),a&&a.setAttribute("data-vector-provider",""),s&&s.setAttribute("data-vector-provider",""))}window.aipkit_toggleVectorStoreSettingsVisibility=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_vector_store_provider_select"),t=r.querySelector(".aipkit_vector_store_toggle_switch");if(t||(t=r.querySelector(".aipkit_vector_store_enable_select")),t||(t=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!n||!t)return;let a=r.closest(".aipkit_chatbot_builder")||document.querySelector(".aipkit_chatbot_builder"),s=r.querySelector(".aipkit_chatbot_provider_select")||(a?a.querySelector(".aipkit_chatbot_provider_select"):null),c=(s?String(s.value||"").trim():"").toLowerCase()==="claude",o=Array.from(n.options||[]).find(P=>P&&P.value==="claude_files");if(o){let P=!!o.disabled;if(o.disabled=!c,P!==o.disabled&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),o.disabled&&n.value==="claude_files"){let b=Array.from(n.options||[]).find(y=>y&&y.value&&!y.disabled&&y.value!=="claude_files");if(b&&n.value!==b.value){n.value=b.value,n.dispatchEvent(new Event("change",{bubbles:!0}));return}}}let e=n.value,i=t.tagName==="SELECT"?t.value==="1":t.checked,d=r.querySelector(".aipkit_context_grid"),u=r.querySelector(".aipkit_context_layout"),p=r.querySelector(".aipkit_vector_store_openai_field"),f=r.querySelector(".aipkit_vector_store_pinecone_field"),m=r.querySelector(".aipkit_vector_store_pinecone_key_field"),g=r.querySelector(".aipkit_vector_store_qdrant_field"),_=r.querySelector(".aipkit_vector_store_qdrant_url_field"),w=r.querySelector(".aipkit_vector_store_qdrant_key_field"),h=r.querySelector(".aipkit_vector_store_embedding_config_row"),E=r.querySelector(".aipkit_vector_store_advanced_field"),x=r.querySelector(".aipkit_vector_store_top_k_field"),v=r.querySelector(".aipkit_vector_store_confidence_field"),I=["openai","pinecone","qdrant"].includes(e);if(p&&(p.style.display=i&&e==="openai"?"block":"none"),f&&(f.style.display=i&&e==="pinecone"?"block":"none"),m&&(m.style.display=i&&e==="pinecone"?"block":"none"),g&&(g.style.display=i&&e==="qdrant"?"block":"none"),_&&(_.style.display=i&&e==="qdrant"?"block":"none"),w&&(w.style.display=i&&e==="qdrant"?"block":"none"),h&&(h.style.display=i&&(e==="pinecone"||e==="qdrant")?"block":"none"),E){if(E.style.display=i&&I?"block":"none",!i||!I){let P=E.querySelector(".aipkit_vector_store_advanced_disclosure");P&&(P.open=!1)}x&&(x.style.display=""),v&&(v.style.display="")}else x&&(x.style.display=i&&I?"block":"none"),v&&(v.style.display=i&&I?"block":"none");d&&d.setAttribute("data-vector-provider",i?e:""),u&&u.setAttribute("data-vector-provider",i?e:""),i&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(r):i&&(e==="pinecone"||e==="qdrant")&&(e==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(r),e==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(r),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(r),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(r))}window.aipkit_toggleVectorStoreProviderFields=k})();(function(){"use strict";let k=!1,r=window.wp&&window.wp.i18n?window.wp.i18n:null,n=r&&typeof r.__=="function"?r.__:l=>l;function t(l){let c=l.querySelector('select[name="openai_vector_store_ids[]"]'),o=window.aipkit_escapeHtml||function(P){return P};if(!c)return;let e=l.querySelector("[data-aipkit-vector-stores-dropdown]"),i=e?e.querySelector(".aipkit_popover_multiselect_btn"):null,d=e?e.querySelector(".aipkit_popover_multiselect_label"):null,u=e?e.querySelector(".aipkit_popover_multiselect_panel"):null,p=e?e.querySelector(".aipkit_popover_multiselect_options"):null,f=e?.dataset.placeholder||"Select stores",m=e?.dataset.selectedLabel||"selected",g=window.aipkit_chat_config?.openaiVectorStores||[],_=a(c),w=Array.from(c.options).filter(P=>P.selected).map(P=>P.value),h=_&&_.length?_:w;if(c.innerHTML="",g.length>0){let P=1;g.forEach(b=>{if(b&&b.id){let y="(Files: N/A)";b.file_counts&&typeof b.file_counts.total=="number"?y=`(${b.file_counts.total} ${b.file_counts.total===1?"File":"Files"})`:b.file_counts&&(y="(Files: ?)");let S=b.name||`Untitled store ${P}`,C=`${o(S)} ${y}`,A=document.createElement("option");A.value=b.id,A.textContent=C,h.includes(b.id)&&(A.selected=!0),c.appendChild(A),P+=1}})}g.length>0&&h.forEach(P=>{if(!g.some(y=>y.id===P)&&!c.querySelector(`option[value="${CSS.escape(P)}"]`)){let y=document.createElement("option");y.value=P,y.textContent=P,y.selected=!0,c.appendChild(y)}}),c.options.length===0&&(c.innerHTML='<option value="" disabled>-- No vector stores found --</option>');let E=()=>{if(!d)return;let P=Array.from(c.options).filter(y=>y.selected&&y.value);if(!P.length){d.textContent=f;return}let b=P.map(y=>y.textContent.trim()).filter(Boolean);if(b.length<=2){d.textContent=b.join(", ");return}d.textContent=`${b.length} ${m}`},x=()=>{if(!p)return;let P=Array.from(p.querySelectorAll('input[type="checkbox"]:checked'));if(P.length>2){let y=P[P.length-1];y&&(y.checked=!1)}let b=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(y=>y.value);Array.from(c.options).forEach(y=>{y.selected=b.includes(y.value)}),c.dispatchEvent(new Event("change",{bubbles:!0})),E()},v=()=>{if(!p)return;p.innerHTML="";let P=Array.from(c.options),b=P.filter(y=>y.value);if(!b.length){let y=document.createElement("div");y.className="aipkit_popover_multiselect_empty",y.textContent=P[0]?.textContent||"-- No Stores Found --",p.appendChild(y),E();return}b.forEach(y=>{let S=document.createElement("label");S.className="aipkit_popover_multiselect_item";let C=document.createElement("input");C.type="checkbox",C.value=y.value,C.checked=y.selected,C.disabled=y.disabled;let A=document.createElement("span");A.className="aipkit_popover_multiselect_text",A.textContent=y.textContent,S.appendChild(C),S.appendChild(A),p.appendChild(S)}),E()},I=P=>{!e||!i||(e.classList.toggle("is-open",P),i.setAttribute("aria-expanded",P?"true":"false"),u&&(u.hidden=!P))};e&&i&&!e.dataset.listenerAttached&&(i.addEventListener("click",P=>{P.preventDefault(),I(!e.classList.contains("is-open"))}),document.addEventListener("click",P=>{e.classList.contains("is-open")&&(e.contains(P.target)||I(!1))}),i.addEventListener("keydown",P=>{P.key==="Escape"&&I(!1)}),e.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",x),p.dataset.listenerAttached="true"),v(),s(l,{selectElement:c,dropdown:e,dropdownPanel:u,dropdownOptions:p,setOpenState:I,placeholder:f})}function a(l){if(!l||!l.dataset.aipkitPendingVectorSelection)return[];let c=[];try{let o=JSON.parse(l.dataset.aipkitPendingVectorSelection);Array.isArray(o)&&(c=o.map(e=>String(e||"").trim()).filter(Boolean).slice(-2))}catch{c=[]}return delete l.dataset.aipkitPendingVectorSelection,c}function s(l,c){let{selectElement:o,dropdown:e,dropdownPanel:i,dropdownOptions:d,setOpenState:u,placeholder:p}=c||{};if(!e||!i||!d||!o)return;let f=i.querySelector(".aipkit_vector_store_dropdown_actions");f||(f=document.createElement("div"),f.className="aipkit_vector_store_dropdown_actions",f.innerHTML=`
        <div class="aipkit_vector_store_dropdown_action_list">
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_new_btn">
            <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
            ${n("New Store","gpt3-ai-content-generator")}
          </button>
        </div>
        <div class="aipkit_vector_store_dropdown_inline_form" style="display:none;">
          <input
            type="text"
            class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--framed aipkit_vector_store_dropdown_name_input"
            placeholder="${n("e.g. Product FAQ","gpt3-ai-content-generator")}"
          />
          <div class="aipkit_vector_store_dropdown_inline_actions">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_cancel_btn">
              ${n("Cancel","gpt3-ai-content-generator")}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_vector_store_dropdown_create_btn">
              ${n("Create","gpt3-ai-content-generator")}
            </button>
          </div>
        </div>
        <p class="aipkit_form-help aipkit_vector_store_dropdown_status" style="display:none;" aria-live="polite"></p>
      `,i.insertBefore(f,d));let m=f.querySelector(".aipkit_vector_store_dropdown_action_list"),g=f.querySelector(".aipkit_vector_store_dropdown_inline_form"),_=f.querySelector(".aipkit_vector_store_dropdown_create_btn"),w=f.querySelector(".aipkit_vector_store_dropdown_cancel_btn"),h=f.querySelector(".aipkit_vector_store_dropdown_new_btn"),E=f.querySelector(".aipkit_vector_store_dropdown_name_input"),x=f.querySelector(".aipkit_vector_store_dropdown_status"),v=()=>{f&&typeof f._aipkitVectorStoreStatusTimer=="number"&&f._aipkitVectorStoreStatusTimer&&(window.clearTimeout(f._aipkitVectorStoreStatusTimer),f._aipkitVectorStoreStatusTimer=0)},I=(A=3200)=>{v(),f&&(f._aipkitVectorStoreStatusTimer=window.setTimeout(()=>{P("")},A))},P=(A,M="",$=0)=>{v(),x&&(x.textContent=A||"",x.style.display=A?"block":"none",x.classList.remove("aipkit_color_notice_success","aipkit_color_notice_error","aipkit_color_notice_info"),M==="success"?x.classList.add("aipkit_color_notice_success"):M==="error"?x.classList.add("aipkit_color_notice_error"):M==="info"&&x.classList.add("aipkit_color_notice_info"),A&&Number($)>0&&I(Number($)))},b=()=>{E&&(E.value=""),m&&(m.style.display=""),g&&(g.style.display="none"),P("")},y=()=>{m&&(m.style.display="none"),g&&(g.style.display="block"),P(""),E&&(E.focus(),E.select())},S=async()=>{if(!_||!E)return;let A=String(E.value||"").trim();if(!A){P(n("Store name is required.","gpt3-ai-content-generator"),"error",3e3);return}if(typeof window.aipkit_apiRequest!="function"){P(n("API request helper is unavailable.","gpt3-ai-content-generator"),"error",3e3);return}let M=document.getElementById("aipkit_vector_store_nonce_openai"),$=M?String(M.value||"").trim():"";if(!$){P(n("OpenAI nonce is missing.","gpt3-ai-content-generator"),"error",3e3);return}let W=_.textContent;_.disabled=!0,_.textContent=n("Creating...","gpt3-ai-content-generator"),w&&(w.disabled=!0),P("");try{let H=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:$,name:A,source_type:"chatbot_training_text"}),N=H?.store||H;if(!N||!N.id)throw new Error(n("OpenAI vector store creation failed.","gpt3-ai-content-generator"));window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]);let G=window.aipkit_chat_config.openaiVectorStores;G.some(O=>O&&O.id===N.id)||G.unshift(N);let L=Array.from(o.options).filter(O=>O.selected&&O.value).map(O=>O.value).filter(O=>O&&O!==N.id).slice(-1);L.push(N.id),o.dataset.aipkitPendingVectorSelection=JSON.stringify(L),t(l),u(!0),P(H?.message||n("Vector store created.","gpt3-ai-content-generator"),"success",2800)}catch(H){let N=H&&H.message?H.message:n("Create failed.","gpt3-ai-content-generator");P(`${n("Error:","gpt3-ai-content-generator")} ${N}`,"error",3200)}finally{_.disabled=!1,_.textContent=W,w&&(w.disabled=!1)}},C=typeof window.aipkit_apiRequest=="function";h&&(h.disabled=!C,C?h.removeAttribute("title"):h.setAttribute("title",n("Creation is unavailable right now.","gpt3-ai-content-generator"))),f.dataset.listenerAttached||(h&&h.addEventListener("click",()=>{y()}),w&&w.addEventListener("click",()=>{b()}),_&&_.addEventListener("click",S),E&&E.addEventListener("keydown",A=>{if(A.key==="Enter"){A.preventDefault(),S();return}A.key==="Escape"&&(A.preventDefault(),b())}),f.dataset.listenerAttached="true"),d.children.length?(h&&(h.textContent=n("New Store","gpt3-ai-content-generator")),(!g||g.style.display==="none")&&P("")):(P(n("No stores found. Create your first one.","gpt3-ai-content-generator"),"info"),h&&(h.textContent=n("Create Store","gpt3-ai-content-generator"))),!o.value&&p&&e&&!e.classList.contains("is-open")&&u(!1)}window.aipkit_populateOpenAIVectorStoresMultiSelect=t,k||(window.addEventListener("aipkit:vector-store-list-updated",l=>{if(String(l?.detail?.provider||"").toLowerCase()!=="openai")return;Array.from(document.querySelectorAll('select[name="openai_vector_store_ids[]"]')).forEach(e=>{let i=e.closest(".aipkit_settings_accordion_body")||e.closest(".aipkit_chatbot_builder")||e.parentElement;i&&t(i)})}),k=!0)})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector('select[name="qdrant_collection_names[]"]');if(!n)return;let t=r.querySelector("[data-aipkit-qdrant-collections-dropdown]"),a=t?t.querySelector(".aipkit_popover_multiselect_btn"):null,s=t?t.querySelector(".aipkit_popover_multiselect_label"):null,l=t?t.querySelector(".aipkit_popover_multiselect_panel"):null,c=t?t.querySelector(".aipkit_popover_multiselect_options"):null;if(!t||!c)return;let o=t.dataset.placeholder||"Select collections",e=t.dataset.selectedLabel||"selected",i=()=>{if(!s)return;let f=Array.from(n.options).filter(g=>g.selected&&g.value);if(!f.length){s.textContent=o;return}let m=f.map(g=>g.textContent.trim()).filter(Boolean);if(m.length<=2){s.textContent=m.join(", ");return}s.textContent=`${m.length} ${e}`},d=()=>{let f=Array.from(c.querySelectorAll('input[type="checkbox"]:checked')).map(m=>m.value);Array.from(n.options).forEach(m=>{m.selected=f.includes(m.value)}),n.dispatchEvent(new Event("change",{bubbles:!0})),i()},u=()=>{c.innerHTML="";let f=Array.from(n.options),m=f.filter(g=>g.value);if(!m.length){let g=document.createElement("div");g.className="aipkit_popover_multiselect_empty",g.textContent=f[0]?.textContent||"-- No Collections Found --",c.appendChild(g),i();return}m.forEach(g=>{let _=document.createElement("label");_.className="aipkit_popover_multiselect_item";let w=document.createElement("input");w.type="checkbox",w.value=g.value,w.checked=g.selected,w.disabled=g.disabled;let h=document.createElement("span");h.className="aipkit_popover_multiselect_text",h.textContent=g.textContent,_.appendChild(w),_.appendChild(h),c.appendChild(_)}),i()},p=f=>{!t||!a||(t.classList.toggle("is-open",f),a.setAttribute("aria-expanded",f?"true":"false"),l&&(l.hidden=!f))};t&&a&&!t.dataset.listenerAttached&&(a.addEventListener("click",f=>{f.preventDefault(),p(!t.classList.contains("is-open"))}),document.addEventListener("click",f=>{t.classList.contains("is-open")&&(t.contains(f.target)||p(!1))}),a.addEventListener("keydown",f=>{f.key==="Escape"&&p(!1)}),t.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",d),c.dataset.listenerAttached="true"),u()}window.aipkit_populateQdrantCollectionsMultiSelect=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector('select[name="pinecone_index_name"]');if(!n)return;let t=r.querySelector("[data-aipkit-pinecone-index-dropdown]"),a=t?t.querySelector(".aipkit_popover_multiselect_btn"):null,s=t?t.querySelector(".aipkit_popover_multiselect_label"):null,l=t?t.querySelector(".aipkit_popover_multiselect_panel"):null,c=t?t.querySelector(".aipkit_popover_multiselect_options"):null,o=window.aipkit_escapeHtml||function(x){return x},e=window.aipkit_chat_config?.pineconeIndexes||[],i=String(n.value||"").trim(),d=t&&t.dataset&&t.dataset.placeholder||"Select index",u=[],p=new Set;Array.isArray(e)&&e.forEach(x=>{let v=String(x?.name||x?.id||"").trim();if(!v||p.has(v))return;p.add(v);let I=String(x?.name||v),P=x?.total_vector_count,y=P!=null&&P!=="Error"&&P!=="No Host"?` (Vectors: ${Number(P).toLocaleString()})`:P==="Error"||P==="No Host"?" (Stats Err)":" (Vectors: ?)";u.push({value:v,label:o(`${I}${y}`),disabled:!1})}),i&&!p.has(i)&&(u.push({value:i,label:o(`${i}`),disabled:!1}),p.add(i)),u.length||u.push({value:"",label:"-- No Indexes Found (Sync in AI Settings) --",disabled:!0}),n.innerHTML="";let f=new Option(d,"");f.selected=!i,n.appendChild(f);let m=!1;u.forEach(x=>{let v=new Option(x.label,x.value);x.disabled&&(v.disabled=!0),!x.disabled&&x.value&&x.value===i&&(v.selected=!0,m=!0),n.appendChild(v)}),i&&!m&&(n.value="");let g=()=>{if(!s)return;let x=n.selectedOptions&&n.selectedOptions.length?n.selectedOptions[0]:null,v=x&&x.textContent?x.textContent.trim():"";s.textContent=v||d},_=()=>{if(!c)return;c.innerHTML="";let x=Array.from(n.options).filter(I=>!I.disabled&&I.value);if(!x.length){let I=document.createElement("div");I.className="aipkit_popover_multiselect_empty",I.textContent=n.options[0]?.textContent||"-- No Indexes Found (Sync in AI Settings) --",c.appendChild(I),g();return}let v=t.dataset.pineconeRadioName||`aipkit_pinecone_index_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;t.dataset.pineconeRadioName=v,x.forEach(I=>{let P=document.createElement("label");P.className="aipkit_popover_multiselect_item aipkit_vector_store_pinecone_item";let b=document.createElement("span");b.className="aipkit_vector_store_pinecone_item_label";let y=document.createElement("input");y.type="radio",y.name=v,y.className="aipkit_vector_store_pinecone_radio",y.value=I.value,y.checked=I.selected;let S=document.createElement("span");S.className="aipkit_popover_multiselect_text",S.textContent=I.textContent,b.appendChild(y),b.appendChild(S),P.appendChild(b),c.appendChild(P)}),g()},w=()=>{if(!c)return;let x=c.querySelector(".aipkit_vector_store_pinecone_radio:checked");if(!x)return;let v=x.value||"";(n.value||"")!==v?(n.value=v,n.dispatchEvent(new Event("change",{bubbles:!0}))):g()},h=()=>{if(!c){g();return}let x=n.value||"";c.querySelectorAll(".aipkit_vector_store_pinecone_radio").forEach(v=>{v.checked=v.value===x}),g()},E=x=>{!t||!a||(t.classList.toggle("is-open",x),a.setAttribute("aria-expanded",x?"true":"false"),l&&(l.hidden=!x))};t&&a&&!t.dataset.listenerAttached&&(a.addEventListener("click",x=>{x.preventDefault(),E(!t.classList.contains("is-open"))}),document.addEventListener("click",x=>{t.classList.contains("is-open")&&(t.contains(x.target)||E(!1))}),document.addEventListener("keydown",x=>{x.key==="Escape"&&E(!1)}),t.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",x=>{x.target&&x.target.matches(".aipkit_vector_store_pinecone_radio")&&(w(),E(!1))}),c.dataset.listenerAttached="true"),n.dataset.pineconeDropdownBound!=="1"&&(n.addEventListener("change",h),n.dataset.pineconeDropdownBound="1"),_(),h()}window.aipkit_populatePineconeIndexSelect=k})();(function(){"use strict";function k(r){let n=r.querySelector('select[name="vector_embedding_provider"]');n&&(n.value===""&&(n.value="openai"),n.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=k})();(function(){"use strict";function k(r){let n=r.querySelector('select[name="vector_embedding_provider"]'),t=r.querySelector('select[name="vector_embedding_model"]'),a=window.aipkit_escapeHtml||function(o){return o};if(!n||!t)return;let s=n.value,l=t.value;t.innerHTML="",t.appendChild(new Option(a("-- Select Model --"),""));let c=[];if(s==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?c=window.aipkit_chat_config.openaiEmbeddingModels:s==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?c=window.aipkit_chat_config.googleEmbeddingModels:s==="openrouter"&&window.aipkit_chat_config?.openrouterEmbeddingModels?c=window.aipkit_chat_config.openrouterEmbeddingModels:s==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(c=window.aipkit_chat_config.azureEmbeddingModels),c.length>0&&c.forEach(o=>{if(o&&o.id){let e=new Option(a(o.name||o.id),o.id);o.id===l&&(e.selected=!0),t.appendChild(e)}}),l&&!t.querySelector(`option[value="${CSS.escape(l)}"]`)){let o=new Option(a(l)+"",l,!1,!0);t.appendChild(o),t.value=l}t.options.length<=1&&(t.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector(".aipkit_vector_store_toggle_switch");n||(n=r.querySelector(".aipkit_vector_store_enable_select")),n||(n=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let t=r.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),a=r.querySelector(".aipkit_vector_store_provider_select"),s=r.querySelector(".aipkit_chatbot_provider_select"),l=r.querySelector(".aipkit_file_upload_field_group");if(!n||!t||!l)return;let c=n.tagName==="SELECT"?n.value==="1":n.checked,o=t.dataset.isProPlan==="true",e=a?a.value:"",i=s?s.value:"",d=e==="claude_files",u=i==="Claude";if(a){let g=Array.from(a.options||[]).find(_=>_&&_.value==="claude_files");g&&(g.disabled=!u)}if(d&&!u&&a){let g=Array.from(a.options||[]).find(w=>w&&w.value&&w.value!=="claude_files"),_=g?g.value:"openai";if(a.value!==_){a.value=_,a.dispatchEvent(new Event("change",{bubbles:!0}));return}}let f=o&&c&&(!d||u),m="";o?d&&!u?m='Claude Files requires the chatbot "Provider" to be set to Claude.':c||(m='File upload requires "Enable Vector Store" to be active for this bot.'):m="File upload is a paid feature. Please upgrade.",f?(t.disabled=!1,l.classList.remove("aipkit_dimmed_row"),l.style&&(l.style.opacity=""),l.removeAttribute("title")):(t.checked&&(t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0}))),t.disabled=!0,l.classList.add("aipkit_dimmed_row"),l.style&&l.style.opacity&&(l.style.opacity=""),l.setAttribute("title",m))}window.aipkit_toggleFileUploadAvailability=k})();(function(){"use strict";function k(n){if(!n)return;let t=n.querySelector('select[name="theme"]'),a=n.querySelector('input[name="theme"]:checked'),s=()=>t?t.value:a?a.value:"",l=n.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),c=s()==="custom";l&&(l.style.display=c?"inline-flex":"none")}function r(){let n=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Theme Toggle: Module container not found.");return}n.dataset.themeSettingsListenerAttached||(n.addEventListener("click",function(t){t.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(t):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),n.addEventListener("change",function(t){let a=t.target;if(a.matches&&a.matches('select[name="theme"]')||a.matches&&a.matches('input[name="theme"]')){let s=a.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||a.closest(".aipkit_chatbot-settings-area")||n;if(s){k(s);let l=s.querySelector(".aipkit_open_custom_theme_modal_btn");if(l&&a.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let c=l.getAttribute("data-modal-target");c&&window.aipkit_openChatbotSettingsModalById(c)}}}}),n.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(t){t.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(t)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),n.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(t=>{k(t)})}window.aipkit_initChatThemeSettingsToggle=r})();(function(){"use strict";function k(r){let n=r.target.closest(".aipkit_reset_custom_theme_btn");if(!n)return;let t=n.dataset.botId,a=document.getElementById("aipkit_chatbot_main_tab_content_container"),s=document.getElementById(`aipkit_bot_${t}_custom_theme_settings_container`)||(a?a.querySelector(`#aipkit_bot_${t}_custom_theme_settings_container`):null),l=document.getElementById(`aipkit_reset_theme_status_${t}`)||(a?a.querySelector(`#aipkit_reset_theme_status_${t}`):null);if(!s||!l){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",t);return}let c=s.dataset.defaults;if(!c){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error","Error: Defaults not found.",2e3);return}try{let o=JSON.parse(c);s.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(i=>{let u=i.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(u&&u[1]){let p=u[1];if(Object.prototype.hasOwnProperty.call(o,p)){i.type==="checkbox"?i.checked=String(o[p])==="1":i.value=o[p]!==null?String(o[p]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});i.dispatchEvent(f)}else if(Object.prototype.hasOwnProperty.call(o,p+"_placeholder")){i.type==="checkbox"?i.checked=String(o[p+"_placeholder"])==="1":i.value=o[p+"_placeholder"]!==null?String(o[p+"_placeholder"]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});i.dispatchEvent(f)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"success","\u2714 Reverted.",2e3)}catch(o){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",o),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=k})();(function(){"use strict";function k(f){let m=new Event("input",{bubbles:!0,cancelable:!0}),g=new Event("change",{bubbles:!0,cancelable:!0});f.dispatchEvent(m),f.dispatchEvent(g)}function r(){document.documentElement.dataset.aipkitApplyingThemePreset="1"}function n(){window.setTimeout(()=>{delete document.documentElement.dataset.aipkitApplyingThemePreset},0)}function t(f,m,g){let _=f.querySelector(`input[name="custom_theme_settings[${m}]"], select[name="custom_theme_settings[${m}]"]`);if(_){if(_.type==="checkbox"){let w=g==="1";_.checked!==w&&(_.checked=w,k(_));return}_.value!==g&&(_.value=g,k(_))}}function a(f){let m=f.closest(".aipkit_chatbot_settings_form");if(!m)return;let g=f.dataset.presetKey||"",_=m.querySelector('select[name="theme"]');if(_&&!_.disabled){let h=-1,E=Array.from(_.options||[]);g&&(h=E.findIndex(x=>(x.value||"")==="custom"&&x.dataset&&x.dataset.presetKey===g)),h<0&&(h=E.findIndex(x=>(x.value||"")==="custom"&&!(x.dataset&&x.dataset.presetKey))),h>=0&&_.selectedIndex!==h&&(_.selectedIndex=h,k(_));return}let w=m.querySelector('input[name="theme"][value="custom"]');w&&!w.checked&&(w.checked=!0,k(w))}function s(f,m){if(!f)return;let g=f.querySelector('input[name="theme_preset_key"]');g&&!g.disabled&&(g.value=m||"")}function l(f){return f?document.getElementById(`aipkit_bot_${f}_custom_theme_settings_container`):null}function c(f){let m=f.closest(".aipkit_custom_theme_settings_container");if(m)return m;let g=f.dataset.botId||f.closest("[data-bot-id]")?.dataset.botId;return l(g)}function o(f){let m=f.closest(".aipkit_chatbot_settings_form");if(!m)return null;let g=m.querySelector(".aipkit_custom_theme_settings_container");if(g)return g;let _=m.dataset.botId||m.closest("[data-bot-id]")?.dataset.botId;return l(_)}function e(f){let m=f.closest(".aipkit_custom_theme_presets");m&&m.querySelectorAll(".aipkit_custom_theme_preset").forEach(g=>{let _=g===f;g.classList.toggle("is-selected",_),g.setAttribute("aria-pressed",_?"true":"false")})}function i(f){let m=f.dataset.primary,g=f.dataset.secondary,_=f.dataset.presetKey||"";if(!m||!g)return;let w=c(f);if(!w)return;let h=f.closest(".aipkit_chatbot_settings_form");r(),a(f),s(h,_),t(w,"primary_color",m),t(w,"secondary_color",g),t(w,"auto_text_contrast","1"),n(),e(f)}function d(f){if(!f||f.disabled)return;let m=f.selectedOptions&&f.selectedOptions.length?f.selectedOptions[0]:null;if(!m||!m.dataset)return;let g=m.dataset.presetKey||"",_=m.dataset.primary||"",w=m.dataset.secondary||"";if(!g||!_||!w){let x=f.closest(".aipkit_chatbot_settings_form");s(x,"");return}let h=o(f);if(!h)return;let E=f.closest(".aipkit_chatbot_settings_form");r(),s(E,g),t(h,"primary_color",_),t(h,"secondary_color",w),t(h,"auto_text_contrast","1"),n()}function u(f){if(!f||!f.closest||document.documentElement.dataset.aipkitApplyingThemePreset==="1")return;let m=f.closest(".aipkit_chatbot_settings_form");m&&s(m,"")}function p(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",f=>{let m=f.target.closest(".aipkit_custom_theme_preset");m&&(f.preventDefault(),i(m))}),document.addEventListener("change",f=>{let m=f.target;!m||!m.matches||!m.matches('select[name="theme"]')||d(m)}),document.addEventListener("change",f=>{let m=f.target;!m||!m.matches||!m.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')||u(m)}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=p})();(function(){"use strict";let k=".aipkit_builder_theme_row_content",r=".aipkit_builder_theme_row",n=".aipkit_theme_scroll_btn",t=".aipkit_theme_scroll_btn--prev",a=".aipkit_theme_scroll_btn--next";function s(u){let p=u.closest(r);return p?{row:p,prev:p.querySelector(t),next:p.querySelector(a)}:null}function l(u){return Math.max(180,Math.round(u.clientWidth*.75))}function c(u){let p=s(u);if(!p||!p.prev||!p.next)return;let f=Math.max(0,u.scrollWidth-u.clientWidth),m=u.scrollLeft<=1,g=u.scrollLeft>=f-1;p.prev.disabled=f===0||m,p.next.disabled=f===0||g}function o(u){let p=u.target.closest(n);if(!p||p.disabled)return;let f=p.closest(r),m=f?f.querySelector(k):null;if(!m)return;let g=p.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;m.scrollBy({left:g*l(m),behavior:"smooth"})}function e(u){let p=u.target;!(p instanceof HTMLElement)||!p.matches(k)||c(p)}function i(){document.querySelectorAll(k).forEach(u=>{c(u)})}function d(u){let p=document.documentElement;p.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",o),document.addEventListener("scroll",e,!0),window.addEventListener("resize",i),p.dataset.aipkitThemeRowScrollBound="1"),u&&i()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>d(!0)):d(!0),window.aipkit_initThemeRowScroll=function(){d(!0)}})();(function(){"use strict";function k(c){if(!c)return;let o=c.querySelector(".aipkit_chatbot_provider_select");o||(o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let e=c.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');e||(e=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let i=c.querySelector(".aipkit_reasoning_effort_field"),d=i?i.querySelector(".aipkit_reasoning_effort_slider"):null,u=i?i.querySelector('input[name="reasoning_effort"]'):null,p=i?i.querySelector(".aipkit_reasoning_effort_label"):null,f=null;if(i?f=i.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):f=c.querySelector(".aipkit_reasoning_section"),!i)return;let m=i.querySelector('select[name="reasoning_effort"]'),g=()=>{i.classList.add("aipkit_hidden"),f&&f.classList.add("aipkit_hidden"),m&&(m.disabled=!0),i.style.opacity="",i.removeAttribute("title")},_=()=>{i.classList.remove("aipkit_hidden"),f&&f.classList.remove("aipkit_hidden"),m&&(m.disabled=!1),i.style.opacity="",i.removeAttribute("title")};if(!o||!e){g();return}let w=(o.value||"").toLowerCase(),E=(e.value||"").toLowerCase();w==="openai"&&n(E)?(_(),r(d,u,p,E)):g()}function r(c,o,e,i){if(!c||!o)return;let d=a(i),u=d.allowed,p=u.map(g=>g==="medium"?"med":g);c.dataset.reasoningValues=JSON.stringify(u),c.dataset.reasoningLabels=JSON.stringify(p),c.max=String(Math.max(0,u.length-1));let f=o.value||"";f==="minimal"&&(f="low"),u.includes(f)||(f=d.defaultValue),u.includes(f)||(f=u[0]||""),f&&(o.value=f);let m=Math.max(0,u.indexOf(f));c.value=String(m),e&&(e.textContent=p[m]||p[0]||""),c.dispatchEvent(new Event("input",{bubbles:!0}))}function n(c){if(t(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return o||e}function t(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_toggleReasoningEffort=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(I){return I},r="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_vector_store_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",n=null,t=null,a=!1,s=I=>!!(I&&(I.classList.contains("aipkit_chatbot_provider_select")||I.classList.contains("aipkit_vector_store_provider_select")||I.id==="aipkit_sources_provider_filter")),l=I=>!!(I&&I.id==="aipkit_chatbot_builder_bot_select"),c=I=>{let P=String(I||"").trim().toLowerCase();return P==="claude_files"?"claude":P},o=(I,P)=>{if(!I)return;let b="aipkit_settings_select_picker_icon--";I.classList.forEach(S=>{S.startsWith(b)&&I.classList.remove(S)}),I.classList.remove("is-hidden");let y=c(P);if(!y){I.classList.add("is-hidden");return}I.classList.add(`${b}${y}`)},e=I=>{if(!I)return"";let P=I.getAttribute("data-aipkit-picker-title");if(P)return P;let b=I.id&&document.querySelector(`label[for="${I.id}"]`)||I.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return b?b.textContent.trim():""},i=I=>{if(!I)return"";let P=I.selectedOptions&&I.selectedOptions.length?I.selectedOptions[0]:I.querySelector("option[selected]");if(P)return P.textContent.trim();let b=I.querySelector("option");return b?b.textContent.trim():""},d=I=>({buttonId:`${I}_picker_btn`,labelId:`${I}_picker_label`,popoverId:`${I}_picker_popover`,titleId:`${I}_picker_title`,searchId:`${I}_picker_search`,listId:`${I}_picker_list`}),u=I=>{if(!I||!I.id)return null;let P=d(I.id),b=I.closest(".aipkit_chatbot_builder");if(!b)return null;let y=document.getElementById(P.buttonId);if(!y){if(y=document.createElement("button"),y.type="button",y.id=P.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",P.popoverId),y.setAttribute("aria-controls",P.popoverId),y.setAttribute("aria-expanded","false"),y.dataset.aipkitPopoverPlacement="bottom",s(I)){y.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),o(M,I.value),y.appendChild(M)}let C=document.createElement("span");C.className="aipkit_settings_select_picker_label",C.id=P.labelId,C.textContent=i(I)||k("Select","gpt3-ai-content-generator");let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),y.appendChild(C),y.appendChild(A),I.insertAdjacentElement("beforebegin",y)}I.classList.contains("screen-reader-text")||I.classList.add("screen-reader-text");let S=document.getElementById(P.popoverId);if(!S){S=document.createElement("div"),S.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(I)&&S.classList.add("aipkit_settings_select_picker_popover--provider"),S.id=P.popoverId,S.setAttribute("aria-hidden","true");let C=document.createElement("div");C.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",C.setAttribute("role","dialog"),C.setAttribute("aria-labelledby",P.titleId);let A=document.createElement("div");A.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=P.titleId,M.textContent=e(I)||k("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',A.appendChild(M),A.appendChild($);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let H=document.createElement("div");H.className="aipkit_settings_select_picker_search";let N=document.createElement("input");N.type="search",N.id=P.searchId,N.className="aipkit_form-input";let G=e(I),Q=G?`Search ${G.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");N.setAttribute("placeholder",Q),H.appendChild(N);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=P.listId,F.setAttribute("role","listbox"),W.appendChild(H),W.appendChild(F),C.appendChild(A),C.appendChild(W),S.appendChild(C),b.appendChild(S),(s(I)||l(I))&&(H.style.display="none")}return{ids:P,button:y,popover:S,label:document.getElementById(P.labelId),search:document.getElementById(P.searchId),list:document.getElementById(P.listId)}},p=I=>{let P=[];return I&&Array.from(I.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let S=Array.from(y.children).filter(C=>C.tagName==="OPTION").map(C=>({value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}));P.push({groupLabel:y.label||"",options:S})}else y.tagName==="OPTION"&&P.push({groupLabel:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),P},f=(I,P,b="")=>{if(!I||!P)return;let y=b.trim().toLowerCase();if(P.innerHTML="",l(I)){let A=Array.from(I.options).map(G=>({value:G.value,label:G.textContent.trim(),disabled:G.disabled,selected:G.selected})),M=G=>G.disabled&&G.value===""&&/^-+$/.test(G.label.replace(/\s+/g,"")),$=A.filter(G=>G.value==="__new__"),W=A.filter(G=>G.value!=="__new__"&&!M(G)),H=y?W.filter(G=>G.label.toLowerCase().includes(y)):W,N=G=>{let Q=document.createElement("button");Q.type="button",Q.className="aipkit_settings_select_picker_item",Q.setAttribute("role","option"),Q.dataset.value=G.value,Q.dataset.label=G.label,G.disabled&&(Q.classList.add("is-disabled"),Q.setAttribute("aria-disabled","true")),I.value===G.value?(Q.classList.add("is-active"),Q.setAttribute("aria-selected","true")):Q.setAttribute("aria-selected","false");let F=document.createElement("span");F.className="aipkit_settings_select_picker_text",F.textContent=G.label;let L=document.createElement("span");L.className="dashicons dashicons-yes aipkit_settings_select_picker_check",Q.appendChild(F),Q.appendChild(L),P.appendChild(Q)};if($.forEach(N),H.forEach(N),!$.length&&!H.length){let G=document.createElement("div");G.className="aipkit_settings_select_picker_empty",G.textContent=k(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),P.appendChild(G)}return}let S=p(I),C=!1;if(S.forEach(A=>{let M=A.options.filter($=>y?$.label.toLowerCase().includes(y):!0);if(M.length){if(A.groupLabel){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=A.groupLabel,P.appendChild($)}M.forEach($=>{let W=document.createElement("button");if(W.type="button",W.className="aipkit_settings_select_picker_item",W.setAttribute("role","option"),W.dataset.value=$.value,W.dataset.label=$.label,$.disabled&&(W.classList.add("is-disabled"),W.setAttribute("aria-disabled","true")),I.value===$.value?(W.classList.add("is-active"),W.setAttribute("aria-selected","true")):W.setAttribute("aria-selected","false"),s(I)){W.classList.add("aipkit_settings_select_picker_item--provider");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),o(G,$.value),W.appendChild(G)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=$.label;let N=document.createElement("span");N.className="dashicons dashicons-yes aipkit_settings_select_picker_check",W.appendChild(H),W.appendChild(N),P.appendChild(W),C=!0})}}),!C){let A=document.createElement("div");A.className="aipkit_settings_select_picker_empty",A.textContent=k(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),P.appendChild(A)}},m=(I,P)=>{if(!I||!P)return;let b=i(I);if(P.textContent=b||k("Select","gpt3-ai-content-generator"),s(I)){let y=P.closest("button"),S=y?y.querySelector(".aipkit_settings_select_picker_icon"):null;o(S,I.value)}},g=(I,P)=>{if(!I||!P)return;let b=I.getBoundingClientRect(),y=P.getBoundingClientRect(),S=y.width||320,C=y.height||0,A=window.innerWidth,M=window.innerHeight,$=12,W=b.left;W+S>A-$&&(W=b.right-S),W=Math.max($,Math.min(W,A-S-$));let H=b.bottom+8;H+C>M-$&&(H=b.top-C-8),H=Math.max($,Math.min(H,M-C-$)),P.style.left=`${Math.round(W)}px`,P.style.top=`${Math.round(H)}px`},_=()=>{!n||!t||a||(a=!0,window.requestAnimationFrame(()=>{let I=n.querySelector(".aipkit_model_settings_popover_panel");g(t,I),a=!1}))},w=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),t&&t.setAttribute("aria-expanded","false"),n=null,t=null)},h=(I,P,b)=>{if(!I||!P)return;n&&n!==P&&w(),n=P,t=I,P.classList.add("aipkit-active"),P.setAttribute("aria-hidden","false"),I.setAttribute("aria-expanded","true");let y=P.querySelector(".aipkit_settings_select_picker_search input"),S=P.querySelector(".aipkit_settings_select_picker_list");S&&f(b,S,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let C=P.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(I,C)})},E=(I,P)=>{if(!I||!P)return;let{button:b,popover:y,list:S,search:C}=P;if(b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("click",A=>{if(A.preventDefault(),n===y){w();return}h(b,y,I)}),b.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",M=>{M.target===y&&w()});let A=y.querySelector(".aipkit_model_settings_popover_close");A&&A.addEventListener("click",M=>{M.preventDefault(),w()}),y.dataset.overlayListenerAttached="true"}if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",A=>{let M=A.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let $=M.dataset.value??"";I.value=$,I.dispatchEvent(new Event("change",{bubbles:!0})),m(I,P.label),f(I,S,C?C.value:""),w()}),S.dataset.pickerListenerAttached="true"),C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("input",()=>{f(I,S,C.value)}),C.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerListenerAttached!=="true"&&(I.addEventListener("change",()=>{m(I,P.label),f(I,S,C?C.value:""),n===y&&w()}),I.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerObserverAttached!=="true"){let A=!1;new MutationObserver(()=>{A||(A=!0,window.requestAnimationFrame(()=>{m(I,P.label),f(I,S,C?C.value:""),A=!1}))}).observe(I,{childList:!0,subtree:!0}),I.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",A=>{A.key==="Escape"&&n&&w()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function x(){let I=document.querySelector(".aipkit_chatbot_builder");if(!I)return;let P=I.querySelectorAll(r);P.length&&P.forEach(b=>{if(!b.id||b.dataset.aipkitPickerInit==="true")return;let y=u(b);y&&(m(b,y.label),f(b,y.list,y.search?y.search.value:""),E(b,y),b.dataset.aipkitPickerInit="true")})}function v(){let I=document.querySelector(".aipkit_chatbot_builder");if(!I)return;I.querySelectorAll(r).forEach(b=>{if(!b.id)return;let y=u(b);y&&(m(b,y.label),f(b,y.list,y.search?y.search.value:""),E(b,y),b.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=x,window.aipkit_refreshChatSelectPickers=v})();(function(){"use strict";let k={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"};function r(t){let a=k[t];if(!a)return!0;let s=window.aipkit_dashboard?.providerStatus?.[a];return typeof s>"u"?!0:!!s}function n(t,a={}){return t?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):r(t)?(window.aipkit_queueProviderSync(t,a),!0):!1:!1}window.aipkit_requestChatbotModelSync=n})();(function(){"use strict";function k(n,t,a){let s=document.getElementById(n);if(!s)return;if(s.innerHTML="",!t||t.length===0){s.appendChild(new Option("(No voices found - Sync again)",""));return}s.appendChild(new Option("-- Select Voice --",""));let l={};t.forEach(o=>{let e=o.languageCodes[0]||"und";l[e]||(l[e]=[]),l[e].push(o)}),Object.keys(l).sort().forEach(o=>{let e=document.createElement("optgroup");try{let i=new Intl.DisplayNames(["en"],{type:"language"}).of(o.split("-")[0]);e.label=`${i} (${o})`}catch{e.label=o}l[o].sort((i,d)=>i.name.localeCompare(d.name)),l[o].forEach(i=>{let d=new Option(i.name,i.id);i.id===a&&(d.selected=!0),e.appendChild(d)}),s.appendChild(e)}),a&&!s.value&&(Array.from(s.options).some(e=>e.value===a)?s.value=a:console.warn(`AIPKit TTS: Saved Google voice ID "${a}" not found in synced list for ${n}.`))}function r(n){let t=n.getAttribute("data-target-select"),a=n.querySelector(".aipkit_spinner"),s=n.closest(".aipkit_popover_audio_flyout"),l=s?s.querySelector(".aipkit_tts_sync_status"):null;if(!l){let i=n.closest(".aipkit_popover_option_row");l=i?i.querySelector(".aipkit_tts_sync_status"):null}if(!l){let i=n.closest(".aipkit_form-group");l=i?i.querySelector(".aipkit_form-help"):null}if(!t){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(l||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",n),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let c=l&&l.classList.contains("aipkit_popover_status_inline"),o=(i,d)=>{!l||!c||(l.textContent=i||"",l.classList.remove("success","error","loading"),d&&l.classList.add(d),l.style.display=i?"inline-block":"none")};if(n.disabled=!0,n.classList.add("aipkit_loading"),a&&(a.style.display="inline-block"),l){let i=l.dataset.baseClass||l.className||"aipkit_form-help";l.dataset.baseClass||(l.dataset.baseClass=i),l.textContent="",l.className=i,l.style.display=i.includes("aipkit_popover_status_inline")?"none":""}c&&o("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(i=>{if(i&&i.voices){let d=document.getElementById(t),u=d?d.value:"";k(t,i.voices,u);let p=document.getElementById("aipkit_google_tts_voices_json_main");p&&(p.dataset.voices=JSON.stringify(i.voices)),l&&(c?o(i.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(l,"success",i.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(i=>{console.error("AIPKit TTS Sync Error (Google):",i),l&&(c?o(`Sync failed: ${i.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(l,"error",`Sync failed: ${i.message||"Unknown error"}`))}).finally(()=>{n.disabled=!1,n.classList.remove("aipkit_loading"),a&&(a.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=k,window.aipkit_handleSyncGoogleVoices=r})();(function(){"use strict";function k(n,t,a){let s=document.getElementById(n);if(!s){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${n} not found.`);return}if(s.innerHTML="",!t||t.length===0){if(s.appendChild(new Option("(No voices found - Sync voices to load)","")),a){let c=new Option(a+"",a,!1,!0);s.appendChild(c),s.value=a}return}s.appendChild(new Option("-- Select Voice --","")),t.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||""));let l=!1;if(t.forEach(c=>{let o=new Option(c.name,c.id);c.id===a&&(o.selected=!0,l=!0),s.appendChild(o)}),a&&!l){let c=!1;for(let o=0;o<s.options.length;o++)if(s.options[o].value===a){c=!0,s.value=a;break}if(!c){let o=new Option(a+"",a,!1,!0);s.appendChild(o),s.value=a,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${a}" not found in synced list for #${n}, added as manual.`)}}else!a&&s.options.length>0&&(s.value="")}function r(n,t,a){let s=document.getElementById(n);if(!s){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${n} not found.`);return}if(s.innerHTML="",!t||t.length===0){if(s.appendChild(new Option("(No models found - Sync models to load)","")),a){let c=new Option(a+"",a,!1,!0);s.appendChild(c),s.value=a}return}s.appendChild(new Option("-- Select Model --","")),t.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||""));let l=!1;if(t.forEach(c=>{let o=c.id||"",e=c.name||o;if(!o)return;let i=new Option(e,o);o===a&&(i.selected=!0,l=!0),s.appendChild(i)}),a&&!l){let c=!1;for(let o=0;o<s.options.length;o++)if(s.options[o].value===a){c=!0,s.value=a;break}if(!c){let o=new Option(a+"",a,!1,!0);s.appendChild(o),s.value=a,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${a}" not found in synced list for #${n}, added as manual.`)}}else!a&&s.options.length>0&&(s.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=k,window.aipkit_chatTts_updateElevenLabsModelsSelect=r})();(function(){"use strict";function k(t,a){let s=t.querySelector(".aipkit_tts_conditional_settings"),l=t.querySelector(".aipkit_tts_auto_play_container");s&&(s.style.display=a?"block":"none"),l&&(l.style.display=a?"block":"none")}function r(t){let a=t.querySelector(".aipkit_tts_provider_select");if(!a)return;let s=a.value;t.querySelectorAll(".aipkit_tts_provider_settings").forEach(c=>{if(c.getAttribute("data-provider")===s){if(c.style.display="block",s==="OpenAI"){let o=c.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');o&&(o.style.display="block")}}else c.style.display="none"})}function n(){let t=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!t){console.warn("AIPKit TTS Settings: Main content container not found.");return}let a=typeof window.aipkit_updateGoogleVoiceSelect=="function",s=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",l=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",c=typeof window.aipkit_handleSyncGoogleVoices=="function";a||console.error("AIPKit TTS Settings: Google voice update function missing."),s||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),l||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),c||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),t.addEventListener("change",function(e){let i=e.target.closest(".aipkit_tts_toggle_switch"),d=e.target.closest(".aipkit_tts_provider_select");if(i){let u=i.closest(".aipkit_accordion-content");u&&(k(u,i.checked),i.checked&&r(u))}else if(d){let u=d.closest(".aipkit_accordion-content");u&&r(u)}}),t.addEventListener("click",function(e){let i=e.target.closest(".aipkit_sync_tts_voices_btn");i&&i.getAttribute("data-provider")==="Google"&&c&&window.aipkit_handleSyncGoogleVoices(i)}),t.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(e=>{let i=e.querySelector(".aipkit_tts_toggle_switch");i&&(k(e,i.checked),i.checked&&r(e));let d=e.querySelector('select[name="tts_google_voice_id"]');d&&!a&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),d&&d.options.length<=1&&(d.innerHTML='<option value="">(Sync voices to load)</option>');let u=e.querySelector('select[name="tts_elevenlabs_voice_id"]');if(u&&s){let m="";if(u&&u.id){let w=u.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,_=g?g.dataset.voices:null;try{let w=_?JSON.parse(_):[],h=u.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(u.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),u.options.length<=1&&(u.innerHTML='<option value="">(Sync voices to load)</option>')}}else u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync voices to load)</option>');let p=e.querySelector('select[name="tts_elevenlabs_model_id"]');if(p&&l){let m="";if(p&&p.id){let w=p.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,_=g?g.dataset.models:null;try{let w=_?JSON.parse(_):[],h=p.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(p.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>')}}else p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>');let f=e.querySelector('select[name="tts_openai_model_id"]');f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=n})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}r.addEventListener("submit",function(n){let t=n.target.closest(".aipkit_chatbot_settings_form");if(!t)return;n.preventDefault();let a=t.getAttribute("data-bot-id"),s=t.querySelector(".aipkit_save_bot_settings_btn");s||(s=document.getElementById("aipkit_chatbot_header_save_btn"));let l=document.getElementById("aipkit_chatbot_global_save_status_container"),c=t.querySelector(`#aipkit_action_feedback_${a}`);if(!a||!s||!l){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",t),l||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}c&&(c.innerHTML=""),l.textContent="",l.className="aipkit_save_status_container",s.disabled=!0,s.classList.add("aipkit_loading");let o=s.querySelector(".aipkit_spinner");o||(o=document.createElement("span"),o.className="aipkit_spinner",s.appendChild(o)),o.style.display="inline-block";let e=new FormData(t),i={};for(let[u,p]of e.entries())if(u.endsWith("[]")){let f=u.slice(0,-2);i[f]=e.getAll(u)}else i.hasOwnProperty(u)||(i[u]=p);i.bot_id=a,function(){let p=document.getElementById(`aipkit_bot_${a}_custom_theme_settings_container`);if(!p)return;p.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(m=>{let g=m.getAttribute("name");if(!g)return;let _=!0;(m.type==="checkbox"||m.type==="radio")&&(_=m.checked),_?i[g]=m.value:m.type==="checkbox"&&(i[g]="0")})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_ai_params_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p;["temperature","max_completion_tokens","reasoning_effort"].forEach(g=>{let _=f.querySelector(`[name="${g}"]`);_&&(i[g]=_.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_web_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=g=>f.querySelector(`[name="${g}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(g=>{let _=m(g);_&&(i[g]=_.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(g=>{let _=m(g);_&&(i[g]=_.value)}),["claude_web_search_max_uses","claude_web_search_loc_type","claude_web_search_loc_country","claude_web_search_loc_city","claude_web_search_loc_region","claude_web_search_loc_timezone","claude_web_search_allowed_domains","claude_web_search_blocked_domains","claude_web_search_cache_ttl"].forEach(g=>{let _=m(g);_&&(i[g]=_.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_vector_store_modal`);if(!p)return;let f=x=>p.querySelector(x),m=p.querySelector(".aipkit_modal_body")||p,g=m.querySelector('input[name="enable_vector_store"]');g&&(i.enable_vector_store=g.checked?"1":"0");let _=f('select[name="vector_store_provider"]');if(_&&(i.vector_store_provider=_.value),i.vector_store_provider==="openai"){let x=f('select[name="openai_vector_store_ids[]"]');x?i.openai_vector_store_ids=Array.from(x.selectedOptions).map(v=>v.value):i.openai_vector_store_ids=[]}else delete i.openai_vector_store_ids;if(i.vector_store_provider==="pinecone"){let x=f('select[name="pinecone_index_name"]');x&&(i.pinecone_index_name=x.value)}else delete i.pinecone_index_name;if(i.vector_store_provider==="qdrant"){let x=f('select[name="qdrant_collection_names[]"]');if(x){let v=Array.from(x.selectedOptions).map(I=>I.value);i.qdrant_collection_names=v,i.qdrant_collection_name=v[0]||""}else i.qdrant_collection_names=[],i.qdrant_collection_name=""}else delete i.qdrant_collection_names,delete i.qdrant_collection_name;if(i.vector_store_provider==="pinecone"||i.vector_store_provider==="qdrant"){let x=f('select[name="vector_embedding_provider"]'),v=f('select[name="vector_embedding_model"]');x&&(i.vector_embedding_provider=x.value),v&&(i.vector_embedding_model=v.value)}else delete i.vector_embedding_provider,delete i.vector_embedding_model;let w=f('input[name="vector_store_top_k"]');w&&(i.vector_store_top_k=w.value);let h=f('input[name="vector_store_confidence_threshold"]');h&&(i.vector_store_confidence_threshold=h.value);let E=m.querySelector('input[name="content_aware_enabled"]');E&&(i.content_aware_enabled=E.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_conversations_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=f.querySelector('input[name="stream_enabled"]');m&&(i.stream_enabled=m.checked?"1":"0");let g=f.querySelector('input[name="openai_conversation_state_enabled"]');g&&(i.openai_conversation_state_enabled=g.checked?"1":"0");let _=f.querySelector('input[name="max_messages"]');_&&(i.max_messages=_.value);let w=f.querySelector('select[name="reasoning_effort"]');w&&(i.reasoning_effort=w.value)}(),function(){let p=document.getElementById(`aipkit_bot_${a}_images_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=f.querySelector('select[name="chat_image_model_id"]'),g=f.querySelector('input[name="image_triggers"]');m&&(i.chat_image_model_id=m.value),g&&(i.image_triggers=g.value);let _=f.querySelector('input[name="enable_image_upload"]');_&&(i.enable_image_upload=_.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_audio_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=w=>f.querySelector(`[name="${w}"]`);function g(w){let h=m(w);h&&(i[w]=h.checked?"1":"0")}function _(w){let h=m(w);h&&(i[w]=h.value)}g("enable_voice_input"),_("stt_provider"),_("stt_openai_model_id"),g("tts_enabled"),_("tts_provider"),_("tts_google_voice_id"),_("tts_openai_voice_id"),_("tts_openai_model_id"),_("tts_elevenlabs_voice_id"),_("tts_elevenlabs_model_id"),g("tts_auto_play"),g("enable_realtime_voice"),g("direct_voice_mode"),g("input_audio_noise_reduction"),_("realtime_model"),_("realtime_voice"),_("turn_detection"),_("input_audio_format"),_("output_audio_format"),_("speed")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_token_mgmt_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=f.querySelector('input[name="token_guest_limit"]'),g=f.querySelector('input[name="token_user_limit"]'),_=f.querySelector('select[name="token_limit_mode"]'),w=f.querySelector('select[name="token_reset_period"]'),h=f.querySelector('input[name="token_limit_message"]');m&&(i.token_guest_limit=m.value),g&&(i.token_user_limit=g.value),_&&(i.token_limit_mode=_.value),w&&(i.token_reset_period=w.value),h&&(i.token_limit_message=h.value),f.querySelectorAll('input[name^="token_role_limits["]').forEach(x=>{let v=x.getAttribute("name");v&&(i[v]=x.value)})}(),function(){let p=document.getElementById("aipkit_starters_flyout");if(!p)return;let f=p.querySelector('textarea[name="conversation_starters"]');f&&(i.conversation_starters=f.value)}(),function(){let p=document.getElementById(`aipkit_bot_${a}_popup_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p;function m(R){return f.querySelector(`[name="${R}"]`)}function g(R){return f.querySelector(`[name="${R}"]:checked`)}function _(R,Z){typeof Z<"u"&&Z!==null&&(i[R]=Z)}let w=m("popup_position");w&&_("popup_position",w.value);let h=m("popup_delay");h&&_("popup_delay",h.value);let E=m("site_wide_enabled");E&&_("site_wide_enabled",E.checked?"1":"0");let x=m("popup_icon_style");if(x)_("popup_icon_style",x.value);else{let R=g("popup_icon_style");R&&_("popup_icon_style",R.value)}let v=m("popup_icon_size");v&&_("popup_icon_size",v.value);let I=m("popup_icon_type");if(I)_("popup_icon_type",I.value);else{let R=g("popup_icon_type");R&&_("popup_icon_type",R.value)}let P=g("popup_icon_default");P&&_("popup_icon_default",P.value);let b=m("popup_icon_custom_url");b&&_("popup_icon_custom_url",b.value);let y=m("header_avatar_type");if(y)_("header_avatar_type",y.value);else{let R=g("header_avatar_type");R&&_("header_avatar_type",R.value)}let S=g("header_avatar_default");S&&_("header_avatar_default",S.value);let C=m("header_avatar_url");C&&_("header_avatar_url",C.value);let A=m("header_online_text");A&&_("header_online_text",A.value);let M=m("popup_label_enabled");M&&_("popup_label_enabled",M.checked?"1":"0");let $=m("popup_label_text");$&&_("popup_label_text",$.value);let W=m("popup_label_mode");W&&_("popup_label_mode",W.value);let H=m("popup_label_size");H&&_("popup_label_size",H.value);let N=m("popup_label_delay_seconds");N&&_("popup_label_delay_seconds",N.value);let G=m("popup_label_auto_hide_seconds");G&&_("popup_label_auto_hide_seconds",G.value);let Q=m("popup_label_dismissible");Q&&_("popup_label_dismissible",Q.checked?"1":"0");let F=m("popup_label_show_on_desktop");F&&_("popup_label_show_on_desktop",F.checked?"1":"0");let L=m("popup_label_show_on_mobile");L&&_("popup_label_show_on_mobile",L.checked?"1":"0");let O=m("popup_label_frequency");O&&_("popup_label_frequency",O.value);let D=m("popup_label_version");D&&_("popup_label_version",D.value)}();let d=i.provider;if(d==="OpenAI")i.model=i.openai_model;else if(d==="OpenRouter")i.model=i.openrouter_model;else if(d==="Google")i.model=i.google_model;else if(d==="Azure")i.model=i.azure_deployment;else if(d==="Claude")i.model=i.claude_model;else if(d==="DeepSeek")i.model=i.deepseek_model;else if(d==="Ollama"){let u=t.querySelector('select[name="ollama_model"]'),p=typeof i.ollama_model<"u"?i.ollama_model:u?u.value:"";i.model=p||""}else i.model="";delete i.openai_model,delete i.openrouter_model,delete i.google_model,delete i.azure_deployment,delete i.claude_model,delete i.deepseek_model,delete i.ollama_model,function(){let p=document.getElementById(`aipkit_bot_${a}_vector_store_modal`),f=g=>p?p.querySelector(g):null,m=g=>t.querySelector(g);if(i.vector_store_provider==="openai"){let g=f('select[name="openai_vector_store_ids[]"]')||m('select[name="openai_vector_store_ids[]"]');g?i.openai_vector_store_ids=Array.from(g.selectedOptions).map(_=>_.value):i.openai_vector_store_ids=[]}else i.hasOwnProperty("openai_vector_store_ids")&&delete i.openai_vector_store_ids;if(i.vector_store_provider==="pinecone"||i.vector_store_provider==="qdrant"){if(i.vector_store_provider==="qdrant"){let w=f('select[name="qdrant_collection_names[]"]')||m('select[name="qdrant_collection_names[]"]');if(w){let h=Array.from(w.selectedOptions).map(E=>E.value);i.qdrant_collection_names=h,i.qdrant_collection_name=h[0]||""}else i.qdrant_collection_names=[],i.qdrant_collection_name=""}else if(i.vector_store_provider==="pinecone"){let w=f('select[name="pinecone_index_name"]')||m('select[name="pinecone_index_name"]');w&&(i.pinecone_index_name=w.value)}let g=f('select[name="vector_embedding_provider"]')||m('select[name="vector_embedding_provider"]');g&&(i.vector_embedding_provider=g.value);let _=f('select[name="vector_embedding_model"]')||m('select[name="vector_embedding_model"]');_&&(i.vector_embedding_model=_.value)}else delete i.pinecone_index_name,delete i.qdrant_collection_name,delete i.qdrant_collection_names,delete i.vector_embedding_provider,delete i.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",i).then(u=>{l.textContent=u.message||"Settings Saved!",l.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(a)}).catch(u=>{l.textContent="Error: "+u.message,l.classList.add("error")}).finally(()=>{s.disabled=!1,s.classList.remove("aipkit_loading");let u=s.querySelector(".aipkit_spinner");if(u&&(u.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(s,"Save");else{let p=Array.from(s.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);p?p.textContent="Save":s.insertBefore(document.createTextNode("Save"),s.firstChild),u&&s.appendChild(u)}setTimeout(()=>{l&&(l.textContent="",l.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=k})();(function(){"use strict";function k(){let t=document.getElementById("aipkit_chatbot_main_tab_content_container");t||console.warn("AIPKit Chat Deleter: Main content container not found."),t&&t.querySelectorAll(".aipkit_delete_bot_btn").forEach(s=>{s.getAttribute("data-is-default")==="1"&&(s.disabled=!0)}),t&&t.addEventListener("click",function(s){let l=s.target.closest(".aipkit_delete_bot_btn");if(!l||l.disabled)return;let c=l.getAttribute("data-bot-id"),o=l.getAttribute("data-bot-name"),e=l.closest(".aipkit_chatbot_settings_form"),d=document.getElementById("aipkit_header_action_feedback")||(e?e.querySelector(`#aipkit_action_feedback_${c}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!d){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",l);return}let p=`aipkit_delete_confirmation_${c}`,f=d.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_delete_confirmation",f.style.display="none",d.insertBefore(f,d.firstChild));let m=`aipkit_action_status_${c}`,g=d.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",d.appendChild(g)),f.style.display!=="none"&&f.innerHTML!=="")return;u&&(u.textContent="",u.className="aipkit_save_status_container");let _=d.querySelector(".aipkit_reset_confirmation");_&&(_.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let w=f.querySelector(".aipkit_delete_confirm_btn"),h=f.querySelector(".aipkit_delete_cancel_btn"),E=()=>{f.innerHTML="",f.style.display="none",r(l,c,g,u)},x=()=>{f.innerHTML="",f.style.display="none"};w.addEventListener("click",E,{once:!0}),h.addEventListener("click",x,{once:!0})});let a=document.querySelector(".aipkit_chatbot_module_container");a&&a.addEventListener("click",function(s){let l=s.target.closest(".aipkit_header_delete_btn");if(!l)return;let c=l.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),e=o?.dataset?.botId,i=o?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",u=document.getElementById("aipkit_header_action_feedback")||(o?o.querySelector(`#aipkit_action_feedback_${e}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!e||!u)return;if(i){u.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{u.innerHTML=""},3e3);return}let f=`aipkit_delete_confirmation_${e}`,m=u.querySelector(`#${f}`);m||(m=document.createElement("div"),m.id=f,m.className="aipkit_confirmation_message aipkit_delete_confirmation",m.style.display="none",u.insertBefore(m,u.firstChild));let g=`aipkit_action_status_${e}`,_=u.querySelector(`#${g}`);_||(_=document.createElement("div"),_.id=g,_.className="aipkit_action_status_message",u.appendChild(_)),p&&(p.textContent="",p.className="aipkit_save_status_container");let w=u.querySelector(".aipkit_reset_confirmation");w&&(w.style.display="none"),_.textContent="",_.className="aipkit_action_status_message",m.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,m.style.display="block";let h=m.querySelector(".aipkit_delete_confirm_btn"),E=m.querySelector(".aipkit_delete_cancel_btn");h?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none",r(l,e,_,p)},{once:!0}),E?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none"},{once:!0})})}function r(t,a,s,l){let c=t.querySelector(".aipkit_spinner"),o=document.getElementById("aipkit_chatbot_main_selector_container");l&&(l.textContent="",l.className="aipkit_save_status_container"),s.textContent="",s.className="aipkit_action_status_message",t.disabled=!0,t.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(t,"Deleting..."):t.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:a}).then(e=>{s.textContent=e.message||"Chatbot deleted successfully.",s.classList.add("success");let i=!1;if(o){let u=o.querySelector(`.aipkit_tab_button[data-bot-id="${a}"]`),p=o.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${a}"]`);if(u)i=u.classList.contains("aipkit_active"),u.remove();else if(p){i=p.classList.contains("aipkit_active"),p.remove();let f=o.querySelector(".aipkit_tab_dropdown_menu");if(f&&f.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let g=f.closest(".aipkit_tab_dropdown_container");g&&g.remove()}}}let d=document.getElementById(`chatbot-${a}-content`);if(d&&d.remove(),setTimeout(()=>{let u=document.getElementById(`aipkit_action_status_${a}`);u&&(u.textContent="",u.className="aipkit_action_status_message")},4e3),i){let u=o?.querySelector(".aipkit_tab_button_default");if(u)u.click();else{let p=o?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(p)p.click();else{let f=o?.querySelector(".aipkit_tab_dropdown_item");if(f)f.click();else{let m=o?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let g=document.getElementById("aipkit_admin_chat_preview_container");g&&(g.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(e=>{s.textContent="Error: "+(e.message||"Failed to delete chatbot."),s.classList.add("error"),t.disabled=!1,t.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(t,"Delete"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_action_status_message")},5e3)})}function n(t){if(!t)return"";let a=document.createElement("div");return a.textContent=t,a.innerHTML}window.aipkit_initDeleteBot=k})();(function(){"use strict";function k(){let t=document.getElementById("aipkit_chatbot_main_tab_content_container");t||console.warn("AIPKit Chat Resetter: Main content container not found."),t&&t.addEventListener("click",function(s){let l=s.target.closest(".aipkit_reset_bot_btn");if(!l||l.disabled)return;let c=l.getAttribute("data-bot-id"),o=l.getAttribute("data-bot-name"),e=l.closest(".aipkit_chatbot_settings_form"),d=document.getElementById("aipkit_header_action_feedback")||(e?e.querySelector(`#aipkit_action_feedback_${c}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!d){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",l);return}let p=`aipkit_reset_confirmation_${c}`,f=d.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",d.insertBefore(f,d.firstChild));let m=`aipkit_action_status_${c}`,g=d.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",d.appendChild(g)),f.style.display!=="none"&&f.innerHTML!=="")return;u&&(u.textContent="",u.className="aipkit_save_status_container");let _=d.querySelector(".aipkit_delete_confirmation");_&&(_.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let w=f.querySelector(".aipkit_reset_confirm_btn"),h=f.querySelector(".aipkit_reset_cancel_btn"),E=()=>{f.innerHTML="",f.style.display="none",r(l,c,g,u)},x=()=>{f.innerHTML="",f.style.display="none"};w.addEventListener("click",E,{once:!0}),h.addEventListener("click",x,{once:!0})});let a=document.querySelector(".aipkit_chatbot_module_container");a&&a.addEventListener("click",function(s){let l=s.target.closest(".aipkit_header_reset_btn");if(!l)return;let c=l.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),e=o?.dataset?.botId,d=document.getElementById("aipkit_header_action_feedback")||(o?o.querySelector(`#aipkit_action_feedback_${e}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!e||!d)return;let p=`aipkit_reset_confirmation_${e}`,f=d.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",d.insertBefore(f,d.firstChild));let m=`aipkit_action_status_${e}`,g=d.querySelector(`#${m}`);g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",d.appendChild(g)),u&&(u.textContent="",u.className="aipkit_save_status_container");let _=d.querySelector(".aipkit_delete_confirmation");_&&(_.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",f.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,f.style.display="block";let w=f.querySelector(".aipkit_reset_confirm_btn"),h=f.querySelector(".aipkit_reset_cancel_btn");w?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none",r(l,e,g,u)},{once:!0}),h?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none"},{once:!0})})}function r(t,a,s,l){let c=t.querySelector(".aipkit_spinner");l&&(l.textContent="",l.className="aipkit_save_status_container"),s.textContent="",s.className="aipkit_action_status_message",t.disabled=!0,t.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(t,"Resetting..."):t.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:a}).then(o=>{s.textContent=o.message||"Chatbot reset successfully!",s.classList.add("success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),aipkit_loadModule("chatbot",{force_active_bot_id:a,aipkit_force_refresh:!0},function(e){e&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",e),s.textContent="Reset OK, but UI refresh failed. Reload page.",s.classList.add("error"))}),setTimeout(()=>{let e=document.getElementById(`aipkit_action_status_${a}`);e&&(e.textContent="",e.className="aipkit_action_status_message")},4e3)}).catch(o=>{s.textContent="Error: "+(o.message||"Failed to reset chatbot."),s.classList.add("error"),t.disabled=!1,t.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(t,"Reset"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_action_status_message")},5e3)})}function n(t){if(!t)return"";let a=document.createElement("div");return a.textContent=t,a.innerHTML}window.aipkit_initResetBot=k})();(function(){"use strict";function n(s,l=5,c=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(s)}catch(o){console.error("AIPKit Chat Preview: Error during chat initialization.",o),s.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else l>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${c}ms... (${l} retries left)`),setTimeout(()=>{n(s,l-1,c)},c)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),s.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function t(){let s=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),l=document.getElementById("aipkit_admin_chat_preview_container"),c=document.querySelector(".aipkit_chatbot-preview-column"),o=window.aipkit_dashboard?.text||{};if(!l||!c){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(l.innerHTML="",c.classList.remove("aipkit_loading"),s){let e=s.getAttribute("data-tab-type"),i=s.getAttribute("data-bot-id");e==="bot"&&i?a(i):e==="create"?l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e==="settings"?l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:l.innerHTML=`<p class="aipkit_preview_placeholder">${o.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function a(s){let l=document.getElementById("aipkit_admin_chat_preview_container"),c=document.querySelector(".aipkit_chatbot-preview-column"),o=parseInt(s,10);if(!l||!c){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}if(!Number.isFinite(o)||o<=0){let f=window.aipkit_dashboard?.text||{};l.innerHTML=`<p class="aipkit_preview_placeholder">${f.previewPlaceholderSelect||"Select a chatbot to see the preview."}</p>`,c.classList.remove("aipkit_loading");return}let e=null,i=0,d=()=>{i=Date.now(),c.classList.add("aipkit_loading")},u=()=>{if(e&&(clearTimeout(e),e=null),!i){c.classList.remove("aipkit_loading");return}let m=240-(Date.now()-i);m>0?setTimeout(()=>{c.classList.remove("aipkit_loading")},m):c.classList.remove("aipkit_loading")};e=setTimeout(d,160),l.innerHTML="";let p=new URL(window.aipkit_dashboard.ajaxurl);p.searchParams.append("action","aipkit_get_chatbot_shortcode"),p.searchParams.append("bot_id",String(o)),p.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(p).then(f=>f.json()).then(f=>{if(f.success&&f.data&&f.data.html){l.innerHTML=f.data.html;let m=l.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(m){l.classList.toggle("aipkit-preview-inline",m.classList.contains("aipkit_chat_container")),l.classList.toggle("aipkit-preview-popup",m.classList.contains("aipkit_popup_wrapper"));let _=window.getComputedStyle(m).getPropertyValue("--aipkit-chat-container-border-radius").trim();_&&_!=="initial"&&_!=="inherit"&&_!=="unset"?l.style.setProperty("--aipkit-chat-container-border-radius",_):l.style.removeProperty("--aipkit-chat-container-border-radius"),n(m)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${s} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,f.data.html),l.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let m=f.data&&f.data.message?f.data.message:"Invalid response received for shortcode preview.";throw new Error(m)}}).catch(f=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${s}:`,f),l.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${f.message}</p>`}).finally(()=>{u()})}window.aipkit_loadInitialChatPreview=t,window.aipkit_refreshChatPreview=a})();(function(){"use strict";function k(){let l=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!l)return;let c=function(e){return e?e.tagName==="SELECT"?e.value==="1":!!e.checked:!1},o=function(e){let i=e.target.closest(".aipkit_popup_toggle_switch");if(i){let _=i.closest(".aipkit_chatbot-settings-area");if(_){r(_,i.checked),t(_,i);let w=_.querySelector(".aipkit_popup_config_btn_placeholder");w&&(w.disabled=!i.checked,w.title=i.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let d=e.target.closest('input[name="popup_icon_default"]');if(d){let _=d.closest(".aipkit_chatbot-settings-area");if(_){let w=d.value==="__custom__"?"custom":"default";n(_,w)}return}let u=e.target.closest('select[name="popup_icon_type"]');if(u){let _=u.closest(".aipkit_chatbot-settings-area");_&&n(_,u.value);return}let p=e.target.closest('input[name="popup_icon_type"]');if(p){let _=p.closest(".aipkit_chatbot-settings-area");_&&n(_,p.value);return}let f=e.target.closest(".aipkit_popup_hint_toggle_switch");if(f){let _=f.closest(".aipkit_chatbot-settings-area");_&&s(_,f.checked);return}let m=e.target.closest(".aipkit_starters_toggle_switch");if(m){let _=m.closest(".aipkit_chatbot-settings-area");if(_){let w=_.querySelector(".aipkit_starters_config_btn");if(w){let h=c(m);w.disabled=!h,w.title=h?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}}return}let g=e.target.closest(".aipkit_voice_input_toggle_switch");if(g){let _=g.closest(".aipkit_chatbot-settings-area");_&&a(_,g.checked);return}};l.addEventListener("change",o),l.querySelectorAll(".aipkit_chatbot-settings-area").forEach(e=>{let i=e.querySelector(".aipkit_popup_toggle_switch");if(i){r(e,i.checked),t(e,i);let g=e.querySelector(".aipkit_popup_config_btn_placeholder");g&&(g.disabled=!i.checked,g.title=i.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let d=e.querySelector('input[name="popup_icon_default"]:checked');if(d){let g=d.value==="__custom__"?"custom":"default";n(e,g)}else{let g=e.querySelector('select[name="popup_icon_type"]');if(g)n(e,g.value);else{let _=e.querySelector('input[name="popup_icon_type"]:checked');_?n(e,_.value):n(e,"default")}}let u=e.querySelector(".aipkit_voice_input_toggle_switch");u&&a(e,u.checked);let p=e.querySelector(".aipkit_popup_hint_toggle_switch");p&&s(e,p.checked);let f=e.querySelector(".aipkit_starters_toggle_switch"),m=e.querySelector(".aipkit_starters_config_btn");if(m){let g=c(f);m.disabled=!g,m.title=g?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function r(l,c){let o=l.querySelector(".aipkit_popup_settings_accordion");if(o&&(o.style.display=c?"block":"none",!c)){let i=o.querySelector(".aipkit_accordion-header"),d=o.querySelector(".aipkit_accordion-content");i&&i.classList.remove("aipkit_active"),d&&d.classList.remove("aipkit_active")}let e=l.querySelector(".aipkit_popup_icon_options_container");e&&(e.style.display=c?"block":"none")}function n(l,c){let o=l.querySelector(".aipkit_popup_icon_default_selector_container"),e=l.querySelector(".aipkit_popup_icon_custom_input_container"),i=!!l.querySelector(".aipkit_popup_icon_default_selector .aipkit_option_card--custom-url");o&&(o.style.display=i||c==="default"?"block":"none"),e&&(e.style.display=c==="custom"?"block":"none")}function t(l,c){let o=c.checked,e=c.getAttribute("data-sidebar-target"),i=l.querySelector("#"+e);if(!i)return;let d=i.querySelector(".aipkit_sidebar_toggle_switch"),u=i.querySelector("label");if(!d||!u)return;let p=i.getAttribute("data-tooltip-disabled")||"";o?(d.getAttribute("data-original-state")===null&&d.setAttribute("data-original-state",d.checked?"checked":"unchecked"),d.checked=!1,d.disabled=!0,i.setAttribute("title",p),i.classList.add("aipkit-disabled-tooltip"),u.style.opacity="0.6"):(d.disabled=!1,i.removeAttribute("title"),i.classList.remove("aipkit-disabled-tooltip"),u.style.opacity="1",d.getAttribute("data-original-state")==="checked"&&(d.checked=!0),d.removeAttribute("data-original-state"))}function a(l,c){let o=l.querySelector(".aipkit_stt_provider_conditional_row");o&&(o.style.display=c?"block":"none")}function s(l,c){let o=l.querySelector(".aipkit_popup_hint_conditional_row");o&&(o.style.display=c?"block":"none");let e=l.querySelectorAll(".aipkit_popup_hint_extra");e&&e.length&&e.forEach(i=>{i.style.display=c?"":"none"})}window.aipkit_initAppearanceToggles=k,window.aipkit_togglePopupDependentSettingsVisibility=r,window.aipkit_toggleSidebarCheckboxState=t,window.aipkit_togglePopupIconValueInputs=n,window.aipkit_toggleSttSettingsVisibility=a,window.aipkit_togglePopupHintSettingsVisibility=s})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r)return;let n=function(t){return t?t.tagName==="SELECT"?t.value==="1":!!t.checked:!1};r.addEventListener("change",function(t){let a=t.target.closest(".aipkit_starters_toggle_switch");if(!a)return;let s=a.closest(".aipkit_chatbot-settings-area");if(!s)return;let l=s.querySelector(".aipkit_starters_conditional_row");l&&(l.style.display=n(a)?"block":"none")}),r.querySelectorAll(".aipkit_chatbot-settings-area").forEach(t=>{let a=t.querySelector(".aipkit_starters_toggle_switch"),s=t.querySelector(".aipkit_starters_conditional_row");a&&s&&(s.style.display=n(a)?"block":"none")})}window.aipkit_initConversationStartersToggle=k})();(function(){"use strict";let k="aipkit_last_selected_chatbot",r="aipkit_chatbotAccordionState",n="aipkit_last_open_chatbot_accordion",t=()=>{try{let e=localStorage.getItem(n);return typeof e=="string"?e:""}catch{return""}},a=()=>{if(window[r]&&typeof window[r]=="object"){let e=window[r].openSectionKey;if(typeof e=="string")return e}return t()},s=(e="")=>{let i=String(e||"").trim();(!window[r]||typeof window[r]!="object")&&(window[r]={}),window[r].openSectionKey=i;try{i?localStorage.setItem(n,i):localStorage.removeItem(n)}catch{}},l=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function c(e){let i=document.getElementById("aipkit_admin_chat_preview_container");if(!i)return;i.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let d=document.createElement("p");d.className="aipkit_preview_placeholder",d.textContent=e,i.innerHTML="",i.appendChild(d)}function o(){let e=document.querySelector(".aipkit_chatbot_builder");if(!e||e.dataset.aipkitContext==="sources")return;document.documentElement.classList.add("aipkit-chatbot-builder-page");let i=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:q=>q,d=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(q,T,B)=>B===1?q:T,u=window.wp&&window.wp.i18n&&window.wp.i18n.sprintf?window.wp.i18n.sprintf:(q,...T)=>{if(!q||!T.length)return q;let B=0;return String(q).replace(/%\d*\$?[sd]/g,()=>{let U=B<T.length?T[B]:"";return B+=1,String(U)})},p={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0},f=e.getAttribute("data-aipkit-chatbot-layout")||"next",m=e.dataset.openaiApiKeySet==="true",g=e.dataset.pineconeApiKeySet==="true",_=e.dataset.qdrantApiKeySet==="true",w=e.dataset.qdrantUrlSet==="true",h=e.dataset.googleApiKeySet==="true",E=e.dataset.azureApiKeySet==="true",x=e.dataset.claudeApiKeySet==="true",v=e.querySelector("#aipkit_chatbot_builder_bot_select"),I=e.getAttribute("data-active-bot-id")||v&&v.value||"",P=String(I||""),b=new Map,y=new Map,S=null,C=!1;if(I)try{localStorage.setItem(k,I)}catch{}let A=e.querySelector(".aipkit_builder_new_bot_btn"),M=e.querySelector("[data-aipkit-bot-tabs]"),$=e.querySelector(".aipkit_builder_bot_overflow"),W=e.querySelector(".aipkit_builder_bot_overflow_trigger"),H=e.querySelector(".aipkit_builder_bot_overflow_menu"),N=10,G=null,Q=null,F=document.getElementById("aipkit_builder_sheet"),L=F?F.querySelector(".aipkit_builder_sheet_panel"):null,O=document.getElementById("aipkit_model_settings_popover"),D=document.getElementById("aipkit_settings_accordion"),R=D||(O?O.querySelector(".aipkit_model_settings_popover_panel"):null),Z=O&&O.getAttribute("data-aipkit-mode")==="disabled",J=O?O.querySelector(".aipkit_model_settings_popover_close"):null,pe=O?O.querySelector(".aipkit_model_settings_popover_title"):null,Ce=O?O.querySelector(".aipkit_model_settings_popover_back"):null,He=O?O.querySelector(".aipkit_model_settings_popover_footer"):null,Ke=null,nt="root",mt=F?F.querySelector(".aipkit_builder_sheet_title"):null,wt=F?F.querySelector(".aipkit_builder_sheet_description"):null,ge=F?F.querySelector(".aipkit_builder_sheet_body"):null,se=F?F.querySelectorAll(".aipkit_builder_sheet_section"):[],ae=F?F.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,Se=F?F.querySelector(".aipkit_builder_sheet_close"):null,je=e.querySelector(".aipkit_bot_name_input"),bt=e.querySelector("[data-aipkit-chatbot-summary]"),re=e.querySelector("[data-aipkit-interface-summary]"),ve=e.querySelector("[data-aipkit-context-summary]"),Ee=e.querySelector("[data-aipkit-behavior-summary]"),Fe=e.querySelector("[data-aipkit-tools-summary]"),Be=e.querySelector("[data-aipkit-safety-summary]"),Ve=e.querySelector("[data-aipkit-limits-summary]"),Je=e.querySelector("[data-aipkit-rules-summary]"),Ze=e.querySelector("[data-aipkit-popup-summary]"),Pt=e.querySelector('textarea[name="instructions"]'),Mi=e.querySelector(".aipkit_builder_instructions_expand"),Qt=document.getElementById("aipkit_builder_instructions_modal"),ti=Qt?Qt.querySelector(".aipkit_builder_instructions_close"):null,gt=Qt?Qt.querySelector(".aipkit_builder_instructions_modal_textarea"):null,tt=Qt?Qt.querySelector(".aipkit_builder_instructions_count"):null,Ye=()=>{let q=e.querySelector(".aipkit_chatbot_provider_select");return q?q.value:""},ei=q=>{if(!q)return"";let T=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${q}"]`);if(!T)return"";let B=T.querySelector("select");return B&&B.value||""},li=q=>{let T=String(q||"").toLowerCase();return/(?:^|[-_])chat(?:[-_]|$)/.test(T)?!1:T.indexOf("gpt-5")!==-1||T.indexOf("o1")!==-1||T.indexOf("o3")!==-1||T.indexOf("o4")!==-1},Jt=()=>{let q=Ye();return q!=="OpenAI"?!1:li(ei(q))},Ut=q=>{if(!q)return"";let T=q.selectedOptions&&q.selectedOptions.length?q.selectedOptions[0]:q.options&&q.selectedIndex>=0&&q.selectedIndex<q.options.length?q.options[q.selectedIndex]:null;return T&&T.textContent?T.textContent.trim():""},Di=q=>!q||!q.selectedOptions?[]:Array.from(q.selectedOptions).map(T=>T&&T.textContent?T.textContent.trim():"").filter(Boolean),xt=q=>String(q||"").replace(/\s+\([^)]*\)\s*$/,"").trim(),pi=()=>{let q=e.querySelector(".aipkit_vector_embedding_select"),T=Ut(q);if(!T){let B=e.querySelector('[name="vector_embedding_model"]');T=B?String(B.value||""):""}return xt(T)},Wt=()=>{if(!bt)return;let q=bt.dataset.defaultSummary||"Select engine and model",T=e.querySelector(".aipkit_chatbot_provider_select"),B=T&&T.value||"",U=Ut(T),z="";if(B){let K=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${B}"]`);if(K){let V=K.querySelector("select");z=Ut(V)}}let X=[];U&&X.push(U),z&&X.push(z);let ie=X.length?X.join(" | "):q;bt.textContent=ie,bt.setAttribute("title",ie)},Wi=()=>{if(!Ze)return;let q=Ze.dataset.defaultSummary||"Popup settings",T=e.querySelector('select[name="popup_position"]'),B=e.querySelector('select[name="aipkit_deploy_popup_scope"]'),U=[],z=Ut(T),X=Ut(B);z&&U.push(z),X&&U.push(X);let ie=U.length?U.join(" | "):q;Ze.textContent=ie,Ze.setAttribute("title",ie)},Sn=()=>{let q=e.querySelector('.aipkit_custom_theme_presets .aipkit_custom_theme_preset.is-selected, .aipkit_custom_theme_presets .aipkit_custom_theme_preset[aria-pressed="true"]');if(!q)return"";let T=q.querySelector(".aipkit_custom_theme_preset_label");return T&&T.textContent?T.textContent.trim():""},Ki=()=>{let q=e.querySelector('select[name="theme"]');if(q&&!q.disabled){if((q.value||"")==="custom"){let B=Sn();if(B)return B}return Ut(q)}let T=e.querySelector('input[name="theme"]:checked');if(T&&!T.disabled){if((T.value||"")==="custom"){let X=Sn();if(X)return X}let B=T.closest(".aipkit_theme_choice_card"),U=B?B.querySelector(".aipkit_theme_choice_label"):null,z=U&&U.textContent?U.textContent.trim():"";if(z)return z}return""},ln=()=>{if(!re)return;let q=re.dataset.defaultSummary||"Select theme",B=Ki()||q;re.textContent=B,re.setAttribute("title",B)},Vn=()=>{if(!ve)return;let q=ve.dataset.defaultSummary||"",T=[],B=e.querySelector(".aipkit_vector_store_enable_select");if(B&&B.checked){let X=e.querySelector(".aipkit_vector_store_provider_select"),ie=X&&X.value||"",K=Ut(X),V=[];if(ie==="openai")V=Di(e.querySelector('select[name="openai_vector_store_ids[]"]'));else if(ie==="pinecone"){let ne=Ut(e.querySelector('select[name="pinecone_index_name"]'));ne&&(V=[ne])}else ie==="qdrant"&&(V=Di(e.querySelector('select[name="qdrant_collection_names[]"]')));let Y=Array.from(new Set(V.map(ne=>xt(ne)).filter(Boolean)));if(K){let ne=Y.length?`${K}: ${Y.join(", ")}`:K;T.push(ne)}else Y.length&&T.push(Y.join(", "));if(ie==="pinecone"||ie==="qdrant"){let ne=pi();ne&&T.push(ne)}}let U=e.querySelector(".aipkit_content_aware_enable_select");U&&U.checked&&T.push(i("Page context","gpt3-ai-content-generator"));let z=T.length?T.join(" | "):q;ve.textContent=z,ve.setAttribute("title",z)},ke=q=>{let T=String(q||"").toLowerCase(),B={none:i("None","gpt3-ai-content-generator"),low:i("Low","gpt3-ai-content-generator"),medium:i("Medium","gpt3-ai-content-generator"),high:i("High","gpt3-ai-content-generator"),xhigh:i("Very high","gpt3-ai-content-generator")};return B[T]||B.none},Le=()=>{if(!Ee)return;let q=Ee.dataset.defaultSummary||i("Response length and memory","gpt3-ai-content-generator"),T=e.querySelector('[name="max_completion_tokens"]'),B=e.querySelector('[name="max_messages"]'),U=e.querySelector('[name="reasoning_effort"]'),z=Jt(),X=T?String(T.value||"").trim():"",ie=B?String(B.value||"").trim():"",K=z?ke(U?U.value:""):"",Y=X!==""||ie!==""?z?u(i("Response length: %1$s | Memory: %2$s | Reasoning: %3$s","gpt3-ai-content-generator"),X||"-",ie||"-",K):u(i("Response length: %1$s | Memory: %2$s","gpt3-ai-content-generator"),X||"-",ie||"-"):q;Ee.textContent=Y,Ee.setAttribute("title",Y)},Oe=()=>{let q=String(Ye()||"").toLowerCase(),B={openai:".aipkit_openai_web_search_enable_toggle",google:".aipkit_google_search_grounding_enable_toggle",claude:".aipkit_claude_web_search_enable_toggle",openrouter:".aipkit_openrouter_web_search_enable_toggle"}[q]||"";return B?e.querySelector(B):null},qt=()=>{if(!Fe)return;let q=Fe.dataset.defaultSummary||"",T=[],B=kt=>kt?kt.tagName==="SELECT"?kt.value==="1":!!kt.checked:!1,U=e.querySelector(".aipkit_file_upload_toggle_select");B(U)&&T.push(i("File Upload","gpt3-ai-content-generator"));let z=String(Ye()||""),X=z==="OpenAI"||z==="Claude"||z==="OpenRouter",ie=e.querySelector(".aipkit_image_analysis_checkbox");X&&B(ie)&&T.push(i("Image Analysis","gpt3-ai-content-generator"));let K=e.querySelector(".aipkit_tools_image_generation_toggle");B(K)&&T.push(i("Image generation","gpt3-ai-content-generator"));let V=Oe();B(V)&&T.push(i("Web Search","gpt3-ai-content-generator"));let Y=e.querySelector(".aipkit_voice_input_toggle_switch");B(Y)&&T.push(i("Speech to Text","gpt3-ai-content-generator"));let ne=e.querySelector(".aipkit_tts_toggle_switch");B(ne)&&T.push(i("Text to Speech","gpt3-ai-content-generator"));let _e=e.querySelector(".aipkit_enable_realtime_voice_toggle");B(_e)&&T.push(i("Realtime Voice","gpt3-ai-content-generator"));let be=T.length,Ge=be>3?u(i("Enabled: %d","gpt3-ai-content-generator"),be):be>0?u(i("Enabled: %s","gpt3-ai-content-generator"),T.join(", ")):q;Fe.textContent=Ge,Fe.setAttribute("title",Ge)},ot=()=>{if(!Be)return;let q=Be.dataset.defaultSummary||"",T=[],B=V=>V?V.tagName==="SELECT"?V.value==="1":!!V.checked:!1,U=e.querySelector('[name="enable_ip_anonymization"]');B(U)&&T.push(i("IP anonymization","gpt3-ai-content-generator"));let z=e.querySelector('[name="enable_consent_compliance"]');B(z)&&T.push(i("Consent notice","gpt3-ai-content-generator"));let X=e.querySelector('[name="openai_moderation_enabled"]'),ie=String(Ye()||"").toLowerCase();B(X)&&ie==="openai"&&T.push(i("Moderation","gpt3-ai-content-generator"));let K=T.length?`${i("Enabled","gpt3-ai-content-generator")}: ${T.join(", ")}`:q;Be.textContent=K,Be.setAttribute("title",K)},Tt=q=>{let T=String(q||"").toLowerCase(),B={never:i("never","gpt3-ai-content-generator"),daily:i("1 day","gpt3-ai-content-generator"),weekly:i("1 week","gpt3-ai-content-generator"),monthly:i("1 month","gpt3-ai-content-generator")};return B[T]||B.monthly},fi=q=>String(q??"").trim()||i("Unlimited","gpt3-ai-content-generator"),Ht=()=>{if(!Ve)return;let q=Ve.dataset.defaultSummary||"",T=e.querySelector('[name="token_limit_mode"]'),B=T?String(T.value||""):"",U=q;if(B==="role_based"){let z=e.querySelector('[name="token_reset_period"]'),X=Tt(z?z.value:"");U=u(i("Enabled: role based limit reset period: %s.","gpt3-ai-content-generator"),X)}else if(B==="general"||B===""){let z=e.querySelector('[name="token_guest_limit"]'),X=e.querySelector('[name="token_user_limit"]');U=u(i("Guests: %1$s Users: %2$s","gpt3-ai-content-generator"),fi(z?z.value:""),fi(X?X.value:""))}Ve.textContent=U,Ve.setAttribute("title",U)},hi=q=>{if(!q)return 0;if(Array.isArray(q))return q.length;if(typeof q=="string"){let T=q.trim();if(!T)return 0;try{return hi(JSON.parse(T))}catch{return 0}}if(typeof q=="object"){if(Array.isArray(q.triggers))return q.triggers.length;if(Array.isArray(q.rules))return q.rules.length}return 0},mi=(q,T,B)=>{let U=d(T,B,q,"gpt3-ai-content-generator");return/%\d*\$?[ds]/.test(U)?U.replace(/%\d*\$?[ds]/,String(q)):`${q} ${U}`},Bi=()=>{if(!Je)return;let q=Je.dataset.defaultSummary||"",T=e.querySelector('textarea[name="triggers_json"]'),B=T?hi(T.value):0,U=T&&B>0?mi(B,"%d rule","%d rules"):q;Je.textContent=U,Je.setAttribute("title",U)};bt&&!e.dataset.chatbotSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches(".aipkit_chatbot_provider_select")||T.closest(".aipkit_chatbot_model_field select"))&&Wt()}),e.dataset.chatbotSummaryBound="1"),re&&!e.dataset.interfaceSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches('input[name="theme"]')||T.matches('select[name="theme"]'))&&ln()}),e.addEventListener("click",q=>{q.target.closest(".aipkit_custom_theme_preset")&&window.setTimeout(()=>{ln()},0)}),e.dataset.interfaceSummaryBound="1"),Ze&&!e.dataset.popupSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches('select[name="popup_position"]')||T.matches('select[name="aipkit_deploy_popup_scope"]'))&&Wi()}),e.dataset.popupSummaryBound="1"),ve&&!e.dataset.contextSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches(".aipkit_vector_store_enable_select")||T.matches(".aipkit_vector_store_provider_select")||T.matches('select[name="openai_vector_store_ids[]"]')||T.matches('select[name="pinecone_index_name"]')||T.matches('select[name="qdrant_collection_names[]"]')||T.matches(".aipkit_vector_embedding_select")||T.matches('[name="vector_embedding_provider"]')||T.matches('[name="vector_embedding_model"]')||T.matches(".aipkit_content_aware_enable_select")||T.matches('[name="content_aware_enabled"]'))&&Vn()}),e.dataset.contextSummaryBound="1"),Ee&&!e.dataset.behaviorSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches(".aipkit_chatbot_provider_select")||T.closest(".aipkit_chatbot_model_field select")||T.matches('[name="max_completion_tokens"]')||T.matches('[name="max_messages"]')||T.matches('[name="reasoning_effort"]'))&&Le()}),e.addEventListener("input",q=>{let T=q.target;T&&(T.matches('[name="max_completion_tokens"]')||T.matches('[name="max_messages"]'))&&Le()}),e.dataset.behaviorSummaryBound="1"),Fe&&!e.dataset.toolsSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches(".aipkit_file_upload_toggle_select")||T.matches(".aipkit_image_analysis_checkbox")||T.matches(".aipkit_tools_image_generation_toggle")||T.matches(".aipkit_openai_web_search_enable_toggle")||T.matches(".aipkit_google_search_grounding_enable_toggle")||T.matches(".aipkit_claude_web_search_enable_toggle")||T.matches(".aipkit_openrouter_web_search_enable_toggle")||T.matches(".aipkit_voice_input_toggle_switch")||T.matches(".aipkit_tts_toggle_switch")||T.matches(".aipkit_enable_realtime_voice_toggle")||T.matches(".aipkit_chatbot_provider_select"))&&qt()}),e.dataset.toolsSummaryBound="1"),Be&&!e.dataset.safetySummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches('[name="enable_ip_anonymization"]')||T.matches('[name="enable_consent_compliance"]')||T.matches('[name="openai_moderation_enabled"]')||T.matches(".aipkit_chatbot_provider_select"))&&ot()}),e.dataset.safetySummaryBound="1"),Ve&&!e.dataset.limitsSummaryBound&&(e.addEventListener("change",q=>{let T=q.target;T&&(T.matches('[name="token_limit_mode"]')||T.matches('[name="token_guest_limit"]')||T.matches('[name="token_user_limit"]')||T.matches('[name="token_reset_period"]'))&&Ht()}),e.addEventListener("input",q=>{let T=q.target;T&&(T.matches('[name="token_guest_limit"]')||T.matches('[name="token_user_limit"]'))&&Ht()}),e.dataset.limitsSummaryBound="1"),Je&&!e.dataset.rulesSummaryBound&&(e.addEventListener("input",q=>{let T=q.target;T&&(T.matches('textarea[name="triggers_json"]')||T.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),e.addEventListener("change",q=>{let T=q.target;T&&(T.matches('textarea[name="triggers_json"]')||T.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),e.addEventListener("click",q=>{q.target.closest(".aipkit_trigger_builder_container")&&window.setTimeout(()=>{Bi()},0)}),e.dataset.rulesSummaryBound="1"),Wt(),ln(),Wi(),Vn(),Le(),qt(),ot(),Ht(),Bi();let gi=()=>{W&&W.setAttribute("aria-expanded","false"),H&&(H.hidden=!0)},ii=(q="")=>{if(!H)return;let T=String(q||"").trim().toLowerCase(),B=Array.from(H.querySelectorAll(".aipkit_builder_bot_overflow_item")),U=0;B.forEach(X=>{let ie=String(X.dataset.botLabel||"").toLowerCase(),K=T===""||ie.includes(T);X.hidden=!K,K&&(U+=1)});let z=H.querySelector(".aipkit_builder_bot_overflow_empty");z&&(z.hidden=U>0)},ji=()=>{if(!H||!v)return;let q=String(v.value||"");H.innerHTML="";let T=Array.from(v.options||[]).filter(U=>U&&U.value&&U.value!=="__new__"&&!U.disabled),B=T.length>=N;if(B){let U=document.createElement("div");U.className="aipkit_builder_bot_overflow_search",U.setAttribute("role","none");let z=document.createElement("input");z.type="search",z.className="aipkit_builder_bot_overflow_search_input",z.autocomplete="off",z.setAttribute("placeholder",i("Search chatbots...","gpt3-ai-content-generator")),z.setAttribute("aria-label",i("Search chatbots","gpt3-ai-content-generator")),U.appendChild(z),H.appendChild(U)}if(T.forEach(U=>{let z=String(U.value||""),X=(U.textContent||"").trim(),ie=z===q,K=document.createElement("button");K.type="button",K.className="aipkit_builder_bot_overflow_item",ie&&K.classList.add("is-active"),K.dataset.botId=z,K.dataset.botLabel=X.toLowerCase(),K.setAttribute("role","menuitemradio"),K.setAttribute("aria-checked",ie?"true":"false"),K.textContent=X,H.appendChild(K)}),B){let U=document.createElement("div");U.className="aipkit_builder_bot_overflow_empty",U.textContent=i("No matching chatbots.","gpt3-ai-content-generator"),U.hidden=!0,H.appendChild(U),ii("")}},Ne=()=>{if(!M)return;Array.from(M.querySelectorAll(".aipkit_builder_bot_tab_label")).forEach(T=>{let B=T.closest(".aipkit_builder_bot_tab");if(!B||B.hidden){T.classList.remove("aipkit_is_truncated");return}let U=Math.ceil(T.scrollWidth)>T.clientWidth+1;T.classList.toggle("aipkit_is_truncated",U)})},ui=()=>{if(!M)return;let q=Array.from(M.querySelectorAll(".aipkit_builder_bot_tab"));if(!q.length){W&&(W.hidden=!0),$&&($.hidden=!0),gi(),ji();return}q.forEach(dt=>{dt.hidden=!1});let T=dt=>{if(!dt)return 0;let ye=dt.columnGap&&dt.columnGap!=="normal"?dt.columnGap:dt.gap,fe=parseFloat(ye||"0");return Number.isFinite(fe)?fe:0},B=dt=>{if(!dt)return 0;let ye=window.getComputedStyle(dt),fe=parseFloat(ye.width||"0"),Xe=parseFloat(ye.marginLeft||"0"),we=parseFloat(ye.marginRight||"0"),at=dt.getBoundingClientRect().width||dt.offsetWidth||fe,vt=Number.isFinite(at)?at:0,ri=Number.isFinite(Xe)?Xe:0,Zt=Number.isFinite(we)?we:0;return Math.ceil(vt+ri+Zt)},U=window.getComputedStyle(M),z=T(U),X=M.closest(".aipkit_builder_bot_tabs_shell"),ie=X?window.getComputedStyle(X):null,K=T(ie),V=M.closest(".aipkit_builder_bot_tabs_row"),Y=V?V.getBoundingClientRect():M.getBoundingClientRect(),ne=Math.max(0,Math.floor(Y.width)),_e=B(A),be=B(W),Ge=_e>0?_e+K:0,kt=dt=>{let ye=dt.getBoundingClientRect();return Math.ceil(ye.width||dt.offsetWidth||0)},Lt=q.findIndex(dt=>dt.classList.contains("is-active")),Ot=dt=>{let ye=0,fe=[];if(q.forEach((Xe,we)=>{let xe=kt(Xe);if(xe<=0)return;let at=fe.length===0?xe:ye+z+xe;at<=dt+.5&&(fe.push(we),ye=at)}),Lt!==-1&&!fe.includes(Lt)){let Xe=[],we=0;for(let xe=Lt;xe>=0;xe--){let at=kt(q[xe]);if(at<=0)continue;let vt=Xe.length===0?at:we+z+at;if(vt>dt+.5)break;Xe.unshift(xe),we=vt}fe=Xe.length>0?Xe:[Lt]}return fe},Ii=Math.max(0,ne-Ge),ft=Ot(Ii);if(ft.length<q.length&&be>0){let dt=be+K,ye=Math.max(0,ne-Ge-dt);ft=Ot(ye)}let Xt=new Set(ft),Ct=0;q.forEach((dt,ye)=>{let fe=Xt.has(ye);dt.hidden=!fe,fe||(Ct+=1)}),Ne();let Gt=Ct>0;W&&(W.hidden=!Gt),$&&($.hidden=!Gt),Gt||gi(),ji()},Hi=(q="")=>{if(!M||!v)return;let T=String(q||v.value||"");Array.from(M.querySelectorAll(".aipkit_builder_bot_tab")).forEach(z=>{let X=String(z.dataset.botId||""),ie=T!==""&&X===T;z.classList.toggle("is-active",ie),z.setAttribute("aria-selected",ie?"true":"false"),z.setAttribute("tabindex",ie?"0":"-1");let K=Array.from(v.options||[]).find(V=>String(V.value||"")===X);if(K){let V=(K.textContent||"").trim(),Y=z.querySelector(".aipkit_builder_bot_tab_label");Y?Y.textContent=V:z.textContent=V}}),ui();let U=M.querySelector(".aipkit_builder_bot_tab.is-active:not([hidden])");U&&typeof U.scrollIntoView=="function"&&U.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},En=q=>typeof window<"u"&&window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(q)):String(q).replace(/([ #;?%&,.+*~\\':"!^$\[\]()=>|/@])/g,"\\$1"),Do=q=>Array.isArray(q)?q.map(T=>String(T??"")):q==null||q===""?[]:[String(q)],Ao=q=>{if(Array.isArray(q))return q.some(B=>Ao(B));if(q===!0||q===1)return!0;let T=String(q??"").trim().toLowerCase();return T==="1"||T==="true"||T==="yes"||T==="on"},Wo=(q,T)=>{if(!q)return;let B=(q.tagName||"").toUpperCase(),U=(q.type||"").toLowerCase();if(U==="checkbox"){if(Array.isArray(T)){let z=T.map(X=>String(X??""));q.checked=z.includes(String(q.value||"1"));return}q.checked=Ao(T);return}if(U==="radio"){q.checked=String(q.value||"")===String(T??"");return}if(B==="SELECT"&&q.multiple){let z=Do(T);Array.from(q.options||[]).forEach(X=>{X.selected=z.includes(String(X.value||""))});return}q.value=T==null?"":String(T)},gn=(q,T,B)=>{if(!q||!T)return!1;let U=`[name="${En(T)}"]`,z=Array.from(q.querySelectorAll(U));return z.length?(z.forEach(X=>Wo(X,B)),!0):!1},uo=(q,T)=>{let B=String(q||"").trim(),U=String(T||"").trim();if(!B||!U||B===U)return;let z=["aipkit_bot_","aipkit_theme_choice_","aipkit_image_model_choice_","aipkit_embed_code_","aipkit_embed_allowed_domains_","aipkit_reset_confirmation_","aipkit_delete_confirmation_","aipkit_elevenlabs_voices_json_","aipkit_elevenlabs_models_json_"],X=V=>{if(!V||typeof V!="string")return V;let Y=V;return z.forEach(ne=>{let _e=`${ne}${B}`,be=`${ne}${U}`;Y.includes(_e)&&(Y=Y.split(_e).join(be))}),Y},ie=["id","for","aria-controls","aria-labelledby","data-target"];[e,F,O,Qt,document.getElementById("aipkit_builder_embed_modal")].filter(Boolean).forEach(V=>{[V,...Array.from(V.querySelectorAll("[id],[for],[aria-controls],[aria-labelledby],[data-target]"))].forEach(ne=>{ie.forEach(_e=>{if(!ne.hasAttribute(_e))return;let be=ne.getAttribute(_e),Ge=X(be);Ge!==be&&ne.setAttribute(_e,Ge)})})})},Ca=q=>{if(!q||typeof q!="object")return null;let T=String(q.bot_id||"").trim();return T?{bot_id:T,bot_name:String(q.bot_name||""),is_default:!!q.is_default,settings:q.settings&&typeof q.settings=="object"?{...q.settings}:{},deploy_mode:String(q.deploy_mode||"inline"),shortcode:String(q.shortcode||""),embed_code:String(q.embed_code||""),embed_allowed_domains:String(q.embed_allowed_domains||""),conversation_starters_text:String(q.conversation_starters_text||""),triggers_json:String(q.triggers_json||"[]")}:null},Ho=q=>{let T=Ca(q);return T?(b.set(T.bot_id,T),T):null},ta=(q="")=>{let T=String(q||"").trim();if(T&&b.has(T))return Promise.resolve(b.get(T));let B=T||"__all__";if(y.has(B))return y.get(B);if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Chatbot state API unavailable."));let U=T?{bot_id:T}:{},z=window.aipkit_apiRequest("aipkit_get_chatbot_switch_state",U).then(X=>(X&&X.bot&&Ho(X.bot),X&&X.bots&&typeof X.bots=="object"&&Object.keys(X.bots).forEach(ie=>{Ho(X.bots[ie])}),T?b.get(T)||null:X)).finally(()=>{y.delete(B)});return y.set(B,z),z},Vo=()=>S||(v&&Array.from(v.options||[]).filter(T=>T.value&&T.value!=="__new__"&&!T.disabled).length>1?(S=ta().catch(()=>{}).finally(()=>{S=null}),S):Promise.resolve()),ia=(q,T)=>{let B=String(q||"").trim();if(!B||!T)return!1;let U=e.querySelector("form.aipkit_chatbot_settings_form");if(!U)return!1;let z=String(P||U.dataset.botId||B).trim();z&&z!==B&&uo(z,B),P=B,e.setAttribute("data-active-bot-id",B),U.dataset.botId=B,v&&String(v.value||"")!==B&&(v.value=B),Hi(B);let X=T.settings&&typeof T.settings=="object"?T.settings:{};Object.entries(X).forEach(([ne,_e])=>{if(!ne)return;if(ne==="token_role_limits"&&_e&&typeof _e=="object"){Object.entries(_e).forEach(([Ge,kt])=>{gn(e,`token_role_limits[${Ge}]`,kt)});return}!gn(e,ne,_e)&&Array.isArray(_e)&&!ne.endsWith("[]")&&gn(e,`${ne}[]`,_e)}),je&&(je.value=T.bot_name||""),gn(e,"conversation_starters",T.conversation_starters_text),gn(e,"triggers_json",T.triggers_json),gn(e,"embed_allowed_domains",T.embed_allowed_domains);let ie=e.querySelector("[data-aipkit-top-mode-select]");ie&&T.deploy_mode&&(ie.value=T.deploy_mode),T.shortcode&&e.querySelectorAll(".aipkit_builder_shortcode_pill").forEach(_e=>{_e.setAttribute("data-shortcode",T.shortcode);let be=_e.querySelector(".aipkit_shortcode_text");be?be.textContent=T.shortcode:_e.textContent=T.shortcode});let K=document.getElementById(`aipkit_embed_code_${B}`);K&&typeof T.embed_code=="string"&&(K.value=T.embed_code);let V=e.querySelector(".aipkit_active_bot_name_display");V&&(V.textContent=T.bot_name||"");let Y=e.querySelector('.aipkit_popover_footer_btn[data-action="delete"]');if(Y){let ne=!!T.is_default;Y.disabled=ne,Y.setAttribute("aria-disabled",ne?"true":"false"),Y.setAttribute("title",i(ne?"Default bot cannot be deleted.":"Delete chatbot","gpt3-ai-content-generator"))}io(),Yo(),Pn(),Qa(),ai(),qa(),Gi(),Lr(),Br(),Fa(),nn(),Ja(D),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Wt(),ln(),Wi(),Vn(),Le(),qt(),ot(),Ht(),Bi();try{localStorage.setItem(k,B)}catch{}if(typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(B),F&&F.classList.contains("aipkit-active")&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ne=F.querySelector('.aipkit_builder_sheet_section[data-sheet="triggers"]');ne&&!ne.hidden&&window.aipkit_initTriggerBuilderUI(B)}return!0},Mn=async q=>{let T=String(q||"").trim();if(!T||T==="__new__"||C)return!1;if(b.has(T)){if(v&&String(v.value||"")!==T)return!1;C=!0;try{return ia(T,b.get(T))}finally{C=!1}}let B=await ta(T);if(!B||v&&String(v.value||"")!==T)return!1;C=!0;try{return ia(T,B)}finally{C=!1}},xr=q=>{if(!q)return p;let T=window.aipkit_dashboard&&window.aipkit_dashboard.models&&Array.isArray(window.aipkit_dashboard.models.openrouter)?window.aipkit_dashboard.models.openrouter:[],B=String(q).trim().toLowerCase();if(!B)return p;let U=T.find(z=>(z&&z.id?String(z.id):"").trim().toLowerCase()===B);return!U||!U.capabilities||typeof U.capabilities!="object"?p:{...p,...U.capabilities}},xa=q=>{if(!q||Ye()!=="OpenRouter")return!0;let B=ei("OpenRouter");return!!xr(B)[q]},Uo=(q,T,B,U)=>{if(!q||!T)return;q.classList.toggle("aipkit_popover_option_row--disabled",B),q.setAttribute("aria-disabled",B?"true":"false"),T.disabled=!!B;let z=q.querySelector(".aipkit_popover_option_label");z&&(z.dataset.defaultTooltip||(z.dataset.defaultTooltip=z.getAttribute("data-tooltip")||""),z.setAttribute("data-tooltip",B&&U||z.dataset.defaultTooltip))},Go=e.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),na=e.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),_o=e.querySelector(".aipkit_training_text_input"),oa=e.querySelector("#aipkit_training_qa_question"),aa=e.querySelector("#aipkit_training_qa_answer"),An=e.querySelector("#aipkit_training_files_input"),fo=e.querySelector(".aipkit_training_files_button"),Io=e.querySelector(".aipkit_builder_dropzone"),Lo=e.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),Rn=e.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Bn=e.querySelector(".aipkit_training_stop_btn"),Aa=e.querySelector("#aipkit_sources_training_card .aipkit_builder_action_row"),Fn=e.querySelector("#aipkit_training_status"),zn=e.querySelector("#aipkit_training_file_list"),Qn=new Map,mo=null,an={page:1,selectedIds:new Set},kn=e.querySelector(".aipkit_training_sources_btn"),Ia=e.querySelector("#aipkit_sources_training_card"),Cn=e.querySelector("[data-aipkit-context-source-dropdown]"),Jn=Cn?Cn.querySelector(".aipkit_popover_multiselect_btn"):null,er=Cn?Cn.querySelector(".aipkit_popover_multiselect_label"):null,go=Cn?Cn.querySelector(".aipkit_popover_multiselect_panel"):null,qo=Cn?Array.from(Cn.querySelectorAll(".aipkit_context_source_option")):[],Li=e.querySelector(".aipkit_vector_store_enable_select"),hn=e.querySelector(".aipkit_content_aware_enable_select"),dn=e.querySelector("[data-aipkit-tools-enabled-dropdown]"),To=dn?dn.querySelector(".aipkit_popover_multiselect_btn"):null,tr=dn?dn.querySelector(".aipkit_popover_multiselect_label"):null,ra=dn?dn.querySelector(".aipkit_popover_multiselect_panel"):null,Yn=dn?Array.from(dn.querySelectorAll(".aipkit_tools_enabled_option")):[],Un=e.querySelector("#aipkit_vs_wp_content_messages_area"),$n=e.querySelector("#aipkit_vs_wp_content_mode"),Xn=e.querySelector("#aipkit_vs_load_wp_content_btn"),pn=e.querySelector("#aipkit_vs_global_target_select"),Po=e.querySelector("#aipkit_vs_wp_content_status"),Mo=e.querySelector("#aipkit_vs_wp_content_status_specific"),Dn=e.querySelector("#aipkit_vs_wp_content_list_area"),sa=e.querySelector("#aipkit_vs_wp_content_pagination"),Bo=e.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Fo=e.querySelector("#aipkit_wp_content_bulk_panel"),ir=e.querySelector("#aipkit_wp_content_specific_panel"),Yt=e.querySelector("#aipkit_wp_content_bulk_hint"),nr=e.querySelector("#aipkit_wp_content_specific_types_panel"),La=()=>{let q=R&&R.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1":!!q.checked:!1},qa=()=>{if(!Ia)return;let q=La();Ia.hidden=!q};qa();let Ta=(q,T,B,U=2)=>{let z=q.filter(ie=>ie&&ie.checked);if(!z.length)return T?.dataset.placeholder||B;if(z.length>U)return`${z.length} selected`;let X=z.map(ie=>{let K=ie.closest("label")?.querySelector(".aipkit_popover_multiselect_text");return K?K.textContent.trim():""}).filter(Boolean);return X.length?X.join(", "):`${z.length} selected`},or=()=>{er&&(er.textContent=Ta(qo,Cn,"Select data source",2))},ca=()=>{if(!qo.length)return;let q=!!(Li&&(Li.tagName==="SELECT"&&Li.value==="1"||Li.checked)),T=!!(hn&&(hn.tagName==="SELECT"&&hn.value==="1"||hn.checked));qo.forEach(B=>{B&&(B.value==="vector"?B.checked=q:B.value==="page_context"&&(B.checked=T))}),or()},Pa=()=>{let q=qo.find(B=>B.value==="vector"),T=qo.find(B=>B.value==="page_context");if(Li&&q){let B=!!q.checked,U=Li.tagName==="SELECT"?Li.value==="1":!!Li.checked;B!==U&&(Li.tagName==="SELECT"?Li.value=B?"1":"0":Li.checked=B,Li.dispatchEvent(new Event("change",{bubbles:!0})))}if(hn&&T){let B=!!T.checked,U=hn.tagName==="SELECT"?hn.value==="1":!!hn.checked;B!==U&&(hn.tagName==="SELECT"?hn.value=B?"1":"0":hn.checked=B,hn.dispatchEvent(new Event("change",{bubbles:!0})))}or()},la=()=>{!Jn||!go||(Jn.setAttribute("aria-expanded","false"),go.hidden=!0,Cn.classList.remove("is-open"))};Cn&&Jn&&go&&!Cn.dataset.bound&&(Jn.addEventListener("click",q=>{if(q.preventDefault(),Jn.getAttribute("aria-expanded")==="true"){la();return}Jn.setAttribute("aria-expanded","true"),go.hidden=!1,Cn.classList.add("is-open")}),qo.forEach(q=>{q.addEventListener("change",()=>{Pa()})}),document.addEventListener("click",q=>{Cn.contains(q.target)||la()}),document.addEventListener("keydown",q=>{q.key==="Escape"&&la()}),Li&&Li.addEventListener("change",ca),hn&&hn.addEventListener("change",ca),ca(),Cn.dataset.bound="1");let ar=q=>q?q.tagName==="SELECT"?q.value==="1":!!q.checked:!1,Ar=(q,T)=>{if(!q||q.disabled)return;let B=!!T;ar(q)!==B&&(q.tagName==="SELECT"?q.value=B?"1":"0":q.checked=B,q.dispatchEvent(new Event("change",{bubbles:!0})))},Ma=q=>{switch(q){case"file_upload":return e.querySelector(".aipkit_file_upload_toggle_select");case"web_search":return Oe();case"image_analysis":return e.querySelector(".aipkit_image_analysis_checkbox");case"image_generation":return e.querySelector(".aipkit_tools_image_generation_toggle");case"speech_to_text":return e.querySelector(".aipkit_voice_input_toggle_switch");case"text_to_speech":return e.querySelector(".aipkit_tts_toggle_switch");case"realtime_voice":return e.querySelector(".aipkit_enable_realtime_voice_toggle");default:return null}},Ba=()=>{tr&&(tr.textContent=Ta(Yn,dn,"Select tools",2))},Fa=()=>{if(!Yn.length)return;let q={};Yn.forEach(T=>{let B=T.dataset.toolKey||T.value;q[B]=!!T.checked}),e.querySelectorAll("[data-aipkit-tool-key]").forEach(T=>{let B=T.dataset.aipkitToolKey||"";if(!B)return;let U=q[B]!==!1;T.classList.toggle("aipkit_tools_feature_row--is-hidden",!U)})},oo=()=>{Yn.length&&(Yn.forEach(q=>{if(!q)return;let T=q.dataset.toolKey||q.value,B=Ma(T);B&&(q.checked=ar(B));let z=q.dataset.staticDisabled==="1"||!B||B.disabled;q.disabled=z;let X=q.closest(".aipkit_tools_enabled_item");X&&X.classList.toggle("is-disabled",z)}),Ba(),Fa())},rr=()=>{Yn.length&&(Yn.forEach(q=>{if(!q||q.disabled)return;let T=q.dataset.toolKey||q.value,B=Ma(T);B&&Ar(B,q.checked)}),Ba(),Fa())},Ko=()=>{!To||!ra||(To.setAttribute("aria-expanded","false"),ra.hidden=!0,dn.classList.remove("is-open"),Kn())};if(dn&&To&&ra&&!dn.dataset.bound){To.addEventListener("click",T=>{if(T.preventDefault(),To.getAttribute("aria-expanded")==="true"){Ko();return}To.setAttribute("aria-expanded","true"),ra.hidden=!1,dn.classList.add("is-open"),Kn()}),Yn.forEach(T=>{T.addEventListener("change",()=>{rr()})}),document.addEventListener("click",T=>{dn.contains(T.target)||Ko()}),document.addEventListener("keydown",T=>{T.key==="Escape"&&Ko()}),[".aipkit_file_upload_toggle_select",".aipkit_openai_web_search_enable_toggle",".aipkit_google_search_grounding_enable_toggle",".aipkit_claude_web_search_enable_toggle",".aipkit_openrouter_web_search_enable_toggle",".aipkit_image_analysis_checkbox",".aipkit_tools_image_generation_toggle",".aipkit_voice_input_toggle_switch",".aipkit_tts_toggle_switch",".aipkit_enable_realtime_voice_toggle"].forEach(T=>{e.querySelectorAll(T).forEach(B=>{B.addEventListener("change",oo)})});let q=e.querySelector(".aipkit_chatbot_provider_select");q&&q.addEventListener("change",()=>{window.requestAnimationFrame(oo)}),oo(),dn.dataset.bound="1"}let da=e.querySelector("#aipkit_wp_content_status_wrap_bulk"),sr=e.querySelector("#aipkit_wp_content_status_wrap_specific"),Ji=F?F.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,On=Ji?Ji.querySelector("#aipkit_sources_table_body"):null,pa=Ji?Ji.querySelector(".aipkit_sources_search_input"):null,ko=Ji?Ji.querySelector(".aipkit_sources_filter_select"):null,ua=Ji?Ji.querySelector(".aipkit_sources_refresh_btn"):null,wo=Ji?Ji.querySelector("#aipkit_sources_pagination"):null,Zn=Ji?Ji.querySelector("#aipkit_sources_status"):null,$a=Ji?Ji.querySelector("#aipkit_sources_provider_label"):null,eo=Ji?Ji.querySelector("#aipkit_sources_store_label"):null,di=document.getElementById("aipkit_sources_editor_modal"),ho=di?di.querySelector(".aipkit_sources_editor_textarea"):null,cr=di?di.querySelector(".aipkit_sources_editor_close"):null,_a=di?di.querySelector(".aipkit_sources_editor_cancel"):null,Oa=di?di.querySelector(".aipkit_sources_editor_save"):null,bi=document.getElementById("aipkit_sources_delete_modal"),lr=bi?bi.querySelector(".aipkit_sources_delete_close"):null,yn=bi?bi.querySelector(".aipkit_sources_delete_cancel"):null,yo=bi?bi.querySelector(".aipkit_sources_delete_confirm"):null,rn=document.getElementById("aipkit_builder_embed_modal"),fa=rn?rn.querySelector(".aipkit_builder_embed_close"):null,dr=rn?rn.querySelector(".aipkit_builder_embed_done"):null,j=document.getElementById("aipkit_image_settings_flyout"),te=j?j.querySelector(".aipkit_popover_flyout_close"):null,de=null,ce=document.getElementById("aipkit_parameters_flyout"),he=ce?ce.querySelector(".aipkit_popover_flyout_close"):null,$e=null,Te=document.getElementById("aipkit_popup_hint_flyout"),Ue=Te?Te.querySelector(".aipkit_popover_flyout_close"):null,We=null,Re=document.getElementById("aipkit_security_privacy_flyout"),_t=Re?Re.querySelector(".aipkit_popover_flyout_close"):null,Rt=R?R.querySelector('[data-aipkit-settings-panel="safety"]'):null,ni=null,ht=document.getElementById("aipkit_starters_flyout"),Xi=ht?ht.querySelector(".aipkit_popover_flyout_close"):null,Ai=null,Mt=document.getElementById("aipkit_custom_theme_flyout"),_i=Mt?Mt.querySelector(".aipkit_popover_flyout_close"):null,ki=null,qi=null,Bt=document.getElementById("aipkit_builder_web_settings_modal"),Tn=Bt?Bt.querySelector(".aipkit_builder_web_settings_close"):null,Vt=document.getElementById("aipkit_builder_context_settings_modal"),Na=Vt?Vt.querySelector(".aipkit_builder_context_settings_close"):null,Ra=R?R.querySelector('[data-aipkit-settings-panel="context"]'):null,un=null,Si=document.getElementById("aipkit_builder_token_limits_modal"),Da=Si?Si.querySelector(".aipkit_builder_token_limits_close"):null,pr=R?R.querySelector('[data-aipkit-settings-panel="limits"]'):null,_n=null,Qe=document.getElementById("aipkit_builder_audio_settings_modal"),Wa=Qe?Qe.querySelector(".aipkit_builder_audio_settings_close"):null,Vi=null,zi=e.querySelector("#aipkit_builder_popup_settings_panel"),en=e.querySelector("[data-aipkit-popup-launcher-dropdown]"),ao=en?en.querySelector(".aipkit_popover_multiselect_btn"):null,$o=en?en.querySelector(".aipkit_popover_multiselect_label"):null,Ui=en?en.querySelector(".aipkit_popover_multiselect_panel"):null,vn=en?Array.from(en.querySelectorAll(".aipkit_popup_launcher_radio")):[],sn={};["popup_position","popup_icon_style","popup_icon_size"].forEach(q=>{let T=e.querySelector(`select[name="${q}"]`);T&&(sn[q]=T)});let cn=e.querySelector("[data-aipkit-theme-dropdown]"),to=cn?cn.querySelector(".aipkit_popover_multiselect_btn"):null,Ha=cn?cn.querySelector(".aipkit_popover_multiselect_label"):null,ma=cn?cn.querySelector(".aipkit_popover_multiselect_panel"):null,In=cn?Array.from(cn.querySelectorAll(".aipkit_interface_theme_radio")):[],Fi=e.querySelector('select[name="theme"]'),vo=e.querySelector('input[name="theme_preset_key"]'),Ti=e.querySelector(".aipkit_theme_config_btn"),Zi=e.querySelector("[data-aipkit-image-model-dropdown]"),ro=Zi?Zi.querySelector(".aipkit_popover_multiselect_btn"):null,ur=Zi?Zi.querySelector(".aipkit_popover_multiselect_label"):null,jo=Zi?Zi.querySelector(".aipkit_popover_multiselect_panel"):null,ga=Zi?Array.from(Zi.querySelectorAll(".aipkit_tools_image_model_radio")):[],tn=e.querySelector('select[name="chat_image_model_id"]'),Gn=e.querySelector("[data-aipkit-replicate-key-trigger]"),Nn=e.querySelector("[data-aipkit-replicate-key-popover]"),Va=Nn?Nn.querySelector("[data-aipkit-replicate-key-close]"):null,$i=document.getElementById("aipkit_chatbot_global_save_status_container"),st=(q,T)=>{if(!$i)return;let B=typeof q=="string"?q:"",U=typeof T=="string"?T.trim():"",z=!U&&/saving|syncing|deleting|duplicating|resetting|loading|refreshing/i.test(B),X=$i.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");X&&B&&(X.textContent="",X.classList.remove("success","error","loading")),$i.textContent=B,$i.className="aipkit_save_status_container",U?$i.classList.add(U):z&&$i.classList.add("loading")},Oi=()=>{$i&&setTimeout(()=>{$i.textContent="",$i.className="aipkit_save_status_container"},2500)},Oo=()=>{let q=j&&j.querySelector('input[name="replicate_api_key"]')||R&&R.querySelector('input[name="replicate_api_key"]')||F?.querySelector('input[name="replicate_api_key"]');return q?String(q.value||"").trim():""},Ua=q=>{if(!(q!==void 0?String(q||"").trim():Oo())||typeof window.aipkit_queueProviderSync!="function")return null;st("Syncing models...","loading");let B=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return B&&typeof B.then=="function"&&B.then(()=>{st("Models synced!","success"),Oi()}).catch(U=>{st(`Error: ${U?.message||"Sync failed."}`,"error"),Oi()}),B},Ga=e.dataset.modelSettingsTitle||"Settings",bo=q=>{if(!R||!q)return;let T=q.getBoundingClientRect(),B=R.getBoundingClientRect(),U=B.width||420,z=B.height||0,X=window.innerWidth,ie=window.innerHeight,K=12,V=T.right+10;V+U>X-K&&(V=T.left-U-10),V=Math.max(K,Math.min(V,X-U-K));let Y=T.top;Y+z>ie-K&&(Y=ie-z-K),Y=Math.max(K,Y),R.style.left=`${Math.round(V)}px`,R.style.top=`${Math.round(Y)}px`,ce&&ce.classList.contains("is-open")&&$e&&_r($e),j&&j.classList.contains("is-open")&&de&&so(de),Bt&&Bt.classList.contains("is-open")&&qi&&No(qi),Vt&&Vt.classList.contains("is-open")&&un&&Ro(un),Si&&Si.classList.contains("is-open")&&_n&&wa(_n),Qe&&Qe.classList.contains("is-open")&&Vi&&ha(Vi)},ka=q=>{if(!O)return;let T=Array.from(O.querySelectorAll("[data-aipkit-settings-panel]"));if(!T.length)return;let B=q||"root",U=O.querySelector(`[data-aipkit-settings-panel="${B}"]`)||O.querySelector('[data-aipkit-settings-panel="root"]');if(!U)return;let z=U.dataset.aipkitSettingsPanel||"root";if(z!==nt&&((()=>{ce&&(ce.classList.remove("is-open"),ce.setAttribute("aria-hidden","true")),$e&&($e.setAttribute("aria-expanded","false"),$e=null),j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true")),de&&(de.setAttribute("aria-expanded","false"),de=null),Re&&(Re.classList.remove("is-open"),Re.setAttribute("aria-hidden","true")),ni&&(ni.setAttribute("aria-expanded","false"),ni=null),ba(),Ko(),Bt&&(Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true")),qi&&(qi.setAttribute("aria-expanded","false"),qi=null),Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Si&&(Si.classList.remove("is-open"),Si.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Qe&&(Qe.classList.remove("is-open"),Qe.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),ht&&(ht.classList.remove("is-open"),ht.setAttribute("aria-hidden","true")),Ai&&(Ai.setAttribute("aria-expanded","false"),Ai=null),Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true")),ki&&(ki.setAttribute("aria-expanded","false"),ki=null)})(),nt=z),T.forEach(ie=>{ie.hidden=ie!==U}),pe){let ie={root:O.dataset.titleRoot||"Settings",appearance:O.dataset.titleAppearance||"Appearance",behavior:O.dataset.titleBehavior||"Behavior",context:O.dataset.titleContext||"Context",tools:O.dataset.titleTools||"Tools",safety:O.dataset.titleSafety||"Safety",limits:O.dataset.titleLimits||"Limits"};pe.textContent=ie[z]||ie.root}Ce&&(Ce.hidden=z==="root"),He&&(He.hidden=z!=="root"),z==="behavior"&&Ja(U),z==="limits"&&Gi(),O.classList.contains("aipkit-active")&&Ke&&window.requestAnimationFrame(()=>{bo(Ke)})},_r=q=>{if(!ce||!q)return;let T=q.getBoundingClientRect(),B=R?R.getBoundingClientRect():null,U=B&&B.width>0&&B.height>0,z=ce.getBoundingClientRect(),X=z.width||320,ie=z.height||260,K=window.innerWidth,V=window.innerHeight,Y=12,ne=(B?B.right:T.right)+8;ne+X>K-Y&&(ne=(B?B.left:T.left)-X-8),ne=Math.max(Y,Math.min(ne,K-X-Y));let _e=B?B.top:T.top-8;_e+ie>V-Y&&(_e=V-ie-Y),_e<Y&&(_e=Y),ce.style.left=`${Math.round(ne)}px`,ce.style.top=`${Math.round(_e)}px`},so=q=>{if(!j||!q)return;let T=q.getBoundingClientRect(),B=R?R.getBoundingClientRect():null,U=j.getBoundingClientRect(),z=U.width||340,X=U.height||220,ie=window.innerWidth,K=window.innerHeight,V=12,Y=(B?B.right:T.right)+8;Y+z>ie-V&&(Y=(B?B.left:T.left)-z-8),Y=Math.max(V,Math.min(Y,ie-z-V));let ne=B?B.top:T.top-8;ne+X>K-V&&(ne=K-X-V),ne<V&&(ne=V),j.style.left=`${Math.round(Y)}px`,j.style.top=`${Math.round(ne)}px`},zo=q=>{if(!Te||!q)return;let T=q.getBoundingClientRect(),B=q.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),U=B?B.getBoundingClientRect():T,z=q.closest(".aipkit_popover_multiselect_panel"),X=z?z.getBoundingClientRect():null,ie=X&&X.width>0&&X.height>0?X:T,K=Te.getBoundingClientRect(),V=K.width||320,Y=K.height||240,ne=window.innerWidth,_e=window.innerHeight,be=12,Ge=8,kt=Math.max(U.right,ie.right),Lt=Math.min(U.left,ie.left),Ot=kt+Ge,Ii=Lt-V-Ge,ft=ne-be-Ot,yi=Ii-be,Xt;ft>=V||ft>=yi?Xt=Ot:Xt=Ii,Xt=Math.max(be,Math.min(Xt,ne-V-be));let Ct=_e-ie.bottom+Ge;Ct<be&&(Ct=be),_e-Ct-Y<be&&(Ct=Math.max(be,_e-Y-be)),Te.style.left=`${Math.round(Xt)}px`,Te.style.top="auto",Te.style.bottom=`${Math.round(Ct)}px`},Ka=q=>{if(!ht||!q)return;let T=q.getBoundingClientRect(),B=q.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),U=B?B.getBoundingClientRect():T,z=q.closest(".aipkit_interface_cell--controls, .aipkit_interface_feature_row"),X=z?z.getBoundingClientRect():T,ie=ht.getBoundingClientRect(),K=ie.width||400,V=ie.height||240,Y=window.innerWidth,ne=window.innerHeight,_e=12,be=8,Ge=U.right+be,kt=U.left-K-be,Lt=Y-_e-Ge,Ot=kt-_e,Ii;Lt>=K||Lt>=Ot?Ii=Ge:Ii=kt,Ii=Math.max(_e,Math.min(Ii,Y-K-_e));let ft=ne-X.bottom;ft<_e&&(ft=_e),ne-ft-V<_e&&(ft=Math.max(_e,ne-V-_e)),ht.style.left=`${Math.round(Ii)}px`,ht.style.top="auto",ht.style.bottom=`${Math.round(ft)}px`},ja=q=>{if(!Re||!q)return;let T=q.getBoundingClientRect(),B=R?R.getBoundingClientRect():null,U=B&&B.width>0&&B.height>0,X=Re.getBoundingClientRect().width||400,ie=window.innerWidth,K=window.innerHeight,V=12,Y=(U?B.right:T.right)+8;Y+X>ie-V&&(Y=(U?B.left:T.left)-X-8),Y=Math.max(V,Math.min(Y,ie-X-V));let ne=U?K-B.bottom:K-T.bottom,_e=Math.max(V,ne);Re.style.left=`${Math.round(Y)}px`,Re.style.top="auto",Re.style.bottom=`${Math.round(_e)}px`},za=q=>{if(!Mt||!q)return;let T=q.getBoundingClientRect();if(T.width===0&&T.height===0&&e){let be=e.querySelector(".aipkit_theme_config_btn")||e.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||e.querySelector('select[name="theme"]')||e.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(be){let Ge=be.getBoundingClientRect();(Ge.width>0||Ge.height>0)&&(T=Ge)}}let B=R?R.getBoundingClientRect():null,U=B&&B.width>0&&B.height>0,z=Mt.getBoundingClientRect(),X=z.width||400,ie=z.height||260,K=window.innerWidth,V=window.innerHeight,Y=12,ne=(U?B.right:T.right)+8;ne+X>K-Y&&(ne=(U?B.left:T.left)-X-8),ne=Math.max(Y,Math.min(ne,K-X-Y));let _e=U?B.top:T.top-8;_e+ie>V-Y&&(_e=V-ie-Y),_e<Y&&(_e=Y),Mt.style.left=`${Math.round(ne)}px`,Mt.style.top=`${Math.round(_e)}px`},No=q=>{if(!Bt||!q)return;let T=R?R.getBoundingClientRect():null,B=T&&T.width>0&&T.height>0,U=q.getBoundingClientRect(),z=Bt.querySelector(".aipkit-modal-content"),X=z?z.getBoundingClientRect():null,ie=X?X.width:520,K=X?X.height:420,V=window.innerWidth,Y=window.innerHeight,ne=12,_e=(B?T.right:U.right)+10;_e+ie>V-ne&&(_e=(B?T.left:U.left)-ie-10),_e=Math.max(ne,Math.min(_e,V-ie-ne));let be=U.top-8;be+K>Y-ne&&(be=Y-K-ne),be<ne&&(be=ne),Bt.style.left=`${Math.round(_e)}px`,Bt.style.top=`${Math.round(be)}px`,Bt.style.bottom="auto"},Ro=q=>{if(!Vt||!q)return;let T=R?R.getBoundingClientRect():null,B=q.getBoundingClientRect(),U=Vt.querySelector(".aipkit-modal-content"),z=U?U.getBoundingClientRect():null,X=z?z.width:560,ie=window.innerWidth,K=12,V=(T?T.right:B.right)+8;V+X>ie-K&&(V=(T?T.left:B.left)-X-8),V=Math.max(K,Math.min(V,ie-X-K));let Y=T?T.top:K;Vt.style.left=`${Math.round(V)}px`,Vt.style.top=`${Math.round(Y)}px`},wa=q=>{if(!Si||!q)return;let T=R?R.getBoundingClientRect():null,B=q.getBoundingClientRect(),U=Si.querySelector(".aipkit-modal-content"),z=U?U.getBoundingClientRect():null,X=z?z.width:620,ie=z?z.height:400,K=window.innerWidth,V=12,Y=(T?T.right:B.right)+8;Y+X>K-V&&(Y=(T?T.left:B.left)-X-8),Y=Math.max(V,Math.min(Y,K-X-V));let ne=T?T.bottom-ie:B.top-12;ne<V&&(ne=V),Si.style.left=`${Math.round(Y)}px`,Si.style.top=`${Math.round(ne)}px`},ha=q=>{if(!Qe||!q)return;let T=R?R.getBoundingClientRect():null,B=T&&T.width>0&&T.height>0,U=q.getBoundingClientRect(),z=Qe.querySelector(".aipkit-modal-content"),X=z?z.getBoundingClientRect():null,ie=X?X.width:520,K=X?X.height:460,V=window.innerWidth,Y=12,ne=(B?T.right:U.right)+10;ne+ie>V-Y&&(ne=(B?T.left:U.left)-ie-10),ne=Math.max(Y,Math.min(ne,V-ie-Y));let _e=window.innerHeight,be=U.top-8;be+K>_e-Y&&(be=_e-K-Y),be<Y&&(be=Y),Qe.style.left=`${Math.round(ne)}px`,Qe.style.top=`${Math.round(be)}px`,Qe.style.bottom="auto"},fr=q=>{Z||!O||!R||!q||(F&&F.classList.contains("aipkit-active")&&(F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true")),ka("root"),Ke=q,O.classList.add("aipkit-active"),O.setAttribute("aria-hidden","false"),q.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),Ja(R),io(),Yo(),nn(),window.requestAnimationFrame(()=>{bo(q)}))},So=()=>{O&&(ka("root"),Bt&&(Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true")),qi&&(qi.setAttribute("aria-expanded","false"),qi=null),Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Si&&(Si.classList.remove("is-open"),Si.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Qe&&(Qe.classList.remove("is-open"),Qe.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),ce&&(ce.classList.remove("is-open"),ce.setAttribute("aria-hidden","true")),$e&&($e.setAttribute("aria-expanded","false"),$e=null),j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true")),de&&(de.setAttribute("aria-expanded","false"),de=null),Re&&(Re.classList.remove("is-open"),Re.setAttribute("aria-hidden","true")),ni&&(ni.setAttribute("aria-expanded","false"),ni=null),va(),ba(),Ko(),O.classList.remove("aipkit-active"),O.setAttribute("aria-hidden","true"),Ke&&Ke.setAttribute("aria-expanded","false"),Ke=null)},mr=()=>{if(!R)return;let q=e.querySelector(".aipkit_chatbot_provider_select"),T=q?q.value:"",B=xa("web_search_plugin"),U=ie=>ie?ie.tagName==="SELECT"?ie.value==="1":ie.type==="checkbox"?ie.checked:ie.value==="1":!1,z={OpenAI:{row:R.querySelector(".aipkit_web_search_toggle_openai"),toggle:R.querySelector(".aipkit_openai_web_search_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]')},Google:{row:R.querySelector(".aipkit_web_search_toggle_google"),toggle:R.querySelector(".aipkit_google_search_grounding_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]')},Claude:{row:R.querySelector(".aipkit_web_search_toggle_claude"),toggle:R.querySelector(".aipkit_claude_web_search_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="claude"]')},OpenRouter:{row:R.querySelector(".aipkit_web_search_toggle_openrouter"),toggle:R.querySelector(".aipkit_openrouter_web_search_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="openrouter"]')}};Object.entries(z).forEach(([ie,K])=>{if(K.row&&(K.row.style.display=T===ie?"":"none"),K.button){let Y=ie==="OpenRouter"?B:!0;K.button.style.display=Y&&U(K.toggle)?"":"none"}}),Bt&&qi&&Bt.classList.contains("is-open")&&(qi.offsetParent!==null&&qi.style.display!=="none"&&!qi.hidden||(Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true"),qi.setAttribute("aria-expanded","false"),qi=null));let X=z.OpenRouter;if(X.row&&X.toggle){let ie=T==="OpenRouter"&&!B;ie&&U(X.toggle)&&(X.toggle.tagName==="SELECT"?X.toggle.value="0":X.toggle.type==="checkbox"?X.toggle.checked=!1:X.toggle.value="0",X.toggle.dispatchEvent(new Event("change",{bubbles:!0}))),Uo(X.row,X.toggle,ie,i("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"))}oo()},io=()=>{let q=K=>K?K.tagName==="SELECT"?K.value==="1":K.type==="checkbox"?K.checked:K.value==="1":!1,T=K=>{if(!K)return;let V=R&&R.querySelector(".aipkit_claude_web_search_enable_toggle")||K.querySelector(".aipkit_claude_web_search_enable_toggle"),Y=q(V),ne=K.querySelector(".aipkit_claude_web_search_conditional_settings");ne&&(ne.style.display=Y?"":"none");let _e=K.querySelector(".aipkit_claude_web_search_loc_type_select"),be=K.querySelector(".aipkit_claude_web_search_location_details");be&&(be.style.display=Y&&_e&&_e.value==="approximate"?"":"none")},B=(K,V)=>{if(!K)return;let Y=R&&R.querySelector(".aipkit_openrouter_web_search_enable_toggle")||K.querySelector(".aipkit_openrouter_web_search_enable_toggle"),ne=V&&q(Y);!V&&Y&&q(Y)&&(Y.tagName==="SELECT"?Y.value="0":Y.type==="checkbox"?Y.checked=!1:Y.value="0",Y.dispatchEvent(new Event("change",{bubbles:!0})));let _e=K.querySelector(".aipkit_openrouter_web_search_conditional_settings");_e&&(_e.style.display=ne?"":"none")},U=e.querySelector(".aipkit_chatbot_provider_select"),z=U?U.value:"",X=xa("web_search_plugin"),ie=Bt||F;if(ie){let K=ie.querySelector(".aipkit_web_modal_section_openai"),V=ie.querySelector(".aipkit_web_modal_section_google"),Y=ie.querySelector(".aipkit_web_modal_section_claude"),ne=ie.querySelector(".aipkit_web_modal_section_openrouter");K&&(K.style.display=z==="OpenAI"?"":"none"),V&&(V.style.display=z==="Google"?"":"none"),Y&&(Y.style.display=z==="Claude"?"":"none"),ne&&(ne.style.display=z==="OpenRouter"&&X?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(ie),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(ie),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(ie),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(ie),T(ie),B(ie,X)}mr()},ue=()=>{let q=R&&R.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0":"0"},Pe=()=>{if(!R)return"0";let q=R.querySelector(".aipkit_file_upload_toggle_select");return!q||q.disabled?"0":q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0"},Ae=()=>Ra||Vt,ze=()=>pr||Si,rt=()=>{let q=Ae();return q?{providerSelect:q.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:q.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:q.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:q.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:q.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:q.querySelector('[name="qdrant_url"]'),qdrantKeyInput:q.querySelector('[name="qdrant_api_key"]')}:{}},Et=q=>q?Array.from(q.options).filter(T=>!T.disabled&&T.value):[],lt=q=>q?(q.selectedOptions?Array.from(q.selectedOptions):[]).some(B=>!B.disabled&&B.value):!1,Dt=q=>{if(!q)return!1;let T=q.options[q.selectedIndex];if(T&&!T.disabled&&T.value)return!0;let B=Et(q)[0];return B?(q.value=B.value,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},yt=q=>{if(!q)return!1;if(lt(q))return!0;let T=Et(q)[0];return T?(T.selected=!0,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},$t=q=>{if(!R)return;let T=R.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(T){if(!q){T.classList.remove("is-visible"),T.setAttribute("aria-hidden","true"),T.setAttribute("data-tooltip",""),T.removeAttribute("aria-label");return}T.classList.add("is-visible"),T.setAttribute("aria-hidden","false"),T.setAttribute("data-tooltip",q),T.setAttribute("aria-label",q)}},pt=()=>{if(Pe()!=="1"){$t("");return}let{providerSelect:q,openaiStoresSelect:T,pineconeIndexSelect:B,qdrantCollectionsSelect:U,pineconeKeyInput:z,qdrantUrlInput:X,qdrantKeyInput:ie}=rt(),K=q?q.value:"",V=e.querySelector(".aipkit_chatbot_provider_select"),Y=V?V.value:"",ne=!!(z&&z.value.trim()),_e=!!(X&&X.value.trim()),be=!!(ie&&ie.value.trim()),Ge=lt(T),kt=lt(B),Lt=lt(U),Ot="";K?K==="openai"?m?Ge||(Ot="No OpenAI vector stores found. Create a vector store."):Ot="Add your OpenAI API key to enable OpenAI vector stores.":K==="pinecone"?ne?kt||(Ot="No Pinecone indexes found. Create an index."):Ot="Add your Pinecone API key to enable Pinecone.":K==="qdrant"?!_e&&!be?Ot="Add your Qdrant URL and API key to enable Qdrant.":_e?be?Lt||(Ot="No Qdrant collections found. Create a collection."):Ot="Add your Qdrant API key to enable Qdrant.":Ot="Add your Qdrant URL to enable Qdrant.":K==="claude_files"?Y!=="Claude"?Ot="Claude Files requires the chatbot provider to be Claude.":x||(Ot="Add your Claude API key to enable Claude Files."):Ot="Select and configure a vector provider to use file uploads.":Ot="Select and configure a vector provider to use file uploads.",$t(Ot)},It=()=>{let q=Ae();if(!R||!q)return;let T=R.querySelector(".aipkit_vector_store_enable_select");T&&!T.checked&&(T.checked=!0,T.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:B,openaiStoresSelect:U,pineconeIndexSelect:z,qdrantCollectionsSelect:X,pineconeKeyInput:ie,qdrantUrlInput:K,qdrantKeyInput:V}=rt(),Y=!!(ie&&ie.value.trim()),ne=!!(K&&K.value.trim()),_e=!!(V&&V.value.trim()),be="";m?be="openai":Y?be="pinecone":(_e||ne)&&(be="qdrant"),B&&be&&B.value!==be&&(B.value=be,B.dispatchEvent(new Event("change",{bubbles:!0}))),be==="openai"?yt(U):be==="pinecone"?Dt(z):be==="qdrant"&&yt(X),pt()},fn=()=>{let q=Ae();if(!q)return!1;let T=q.querySelector('[name="vector_store_provider"]');if(!T)return!1;let B=e.querySelector(".aipkit_chatbot_provider_select"),z=(B?B.value:"")==="Claude",X=Array.from(T.options||[]).find(V=>V&&V.value==="claude_files");if(!X)return!1;let ie=!z,K=!1;if(X.disabled!==ie&&(X.disabled=ie,K=!0),ie&&T.value==="claude_files"){let V=Array.from(T.options||[]).find(ne=>ne&&ne.value&&!ne.disabled&&ne.value!=="claude_files"),Y=V?V.value:"openai";if(T.value!==Y)return T.value=Y,T.dispatchEvent(new Event("change",{bubbles:!0})),!0}return K&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),!1},oi=()=>{if(!R)return;let q=R.querySelector(".aipkit_file_upload_toggle_select");if(!q)return;let T=q.closest(".aipkit_popover_option_row"),B=T?T.querySelector(".aipkit_popover_option_label"):null,U=q.dataset.isProPlan==="true",z=U,X=q.dataset.tooltipDefault||"",ie=Ae(),K=ie?ie.querySelector('[name="vector_store_provider"]'):null,V=K?K.value:"",Y=e.querySelector(".aipkit_chatbot_provider_select"),ne=Y?Y.value:"";if(fn())return;U?V==="claude_files"&&ne!=="Claude"&&(X="Claude Files requires the chatbot provider to be Claude.",z=!1):(X=q.dataset.tooltipUpgrade||X,z=!1),T&&T.classList.toggle("aipkit_popover_option_row--disabled",!z),q.disabled=!z,B&&B.setAttribute("data-tooltip",X);let _e=q.tagName==="SELECT"?q.value==="1":q.checked;!z&&_e&&(q.tagName==="SELECT"?q.value="0":q.checked=!1,q.dispatchEvent(new Event("change",{bubbles:!0}))),oo()},ai=()=>{let q=Ae();q&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(q),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(q))},nn=()=>{if(!R)return;let q=ue()==="1",T=R.querySelector(".aipkit_file_upload_toggle_select");!q&&T&&!T.disabled&&(T.tagName==="SELECT"?T.value==="1":T.checked)&&(T.tagName==="SELECT"?T.value="0":T.checked=!1,T.dispatchEvent(new Event("change",{bubbles:!0}))),ai(),oi(),pt(),qa()},Gi=()=>{let q=ze();if(!q)return;let T=q.querySelector(".aipkit_token_limit_mode_select"),B=q.querySelector(".aipkit_limits_primary_grid"),U=q.querySelector(".aipkit_token_general_user_limit_field"),z=q.querySelector(".aipkit_token_role_limits_container");if(!T||!U||!z)return;let X=T.value;B&&B.classList.toggle("aipkit_limits_primary_grid--role-based",X==="role_based"),U.style.display=X==="general"?"block":"none",z.style.display=X==="role_based"?"block":"none"},Eo=()=>{if(!Qe)return;let q=(Qe.dataset.activeAudioFeature||"").trim(),T=Qe.querySelectorAll(".aipkit_audio_feature_group");T.length&&T.forEach(B=>{if(!q){B.style.display="";return}B.style.display=B.classList.contains(`aipkit_audio_feature_group--${q}`)?"":"none"})},Pn=()=>{if(!Qe)return;let q=ft=>ft?ft.tagName==="SELECT"?ft.value==="1":ft.type==="checkbox"?ft.checked:ft.value==="1":!1,T=ft=>q(e.querySelector(ft)),B=(ft,yi)=>{e.querySelectorAll(`.aipkit_audio_settings_config_btn[data-audio-feature="${ft}"]`).forEach(Xt=>{Xt.style.display=yi?"":"none"})},U=T(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch"),z=T(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch"),X=T(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"),ie=Qe.querySelector(".aipkit_stt_provider_conditional_row"),K=Qe.querySelector(".aipkit_stt_provider_row"),V=K&&K.dataset.sttControlsHidden==="1";if(K&&(K.style.display=U&&!V?"block":"none"),ie&&(ie.style.display=U&&!V?"flex":"none"),U&&V&&K){let ft=K.dataset.sttDefaultProvider,yi=K.dataset.sttDefaultModel,Xt=Qe.querySelector(".aipkit_stt_provider_select"),Ct=Qe.querySelector('[name="stt_openai_model_id"]'),Gt=(dt,ye,fe)=>{if(!dt||!ye)return;if(!Array.from(dt.options).some(we=>we.value===ye)){let we=new Option(fe||ye,ye,!0,!0);dt.add(we)}dt.value=ye};Gt(Xt,ft),Gt(Ct,yi,"whisper-1")}B("stt",U&&!V),typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Qe);let Y=Qe.querySelector(".aipkit_tts_conditional_settings"),ne=Qe.querySelector(".aipkit_tts_provider_row"),_e=Qe.querySelector(".aipkit_tts_auto_play_container");ne&&(ne.style.display=z?"block":"none"),Y&&(Y.style.display=z?"flex":"none"),_e&&(_e.style.display=z?"block":"none");let be=Qe.querySelector(".aipkit_tts_provider_select");if(be){let ft=be.value;Qe.querySelectorAll(".aipkit_tts_field").forEach(ye=>{let fe=ye.getAttribute("data-provider");ye.style.display=z&&fe===ft?"block":"none"});let yi=Qe.querySelector(".aipkit_tts_google_voice_inline"),Xt=Qe.querySelector(".aipkit_tts_openai_voice_inline"),Ct=Qe.querySelector(".aipkit_tts_openai_model_inline"),Gt=Qe.querySelector(".aipkit_tts_elevenlabs_voice_inline"),dt=Qe.querySelector(".aipkit_tts_elevenlabs_model_inline");yi&&(yi.style.display=z&&ft==="Google"?"block":"none"),Xt&&(Xt.style.display=z&&ft==="OpenAI"?"block":"none"),Ct&&(Ct.style.display=z&&ft==="OpenAI"?"block":"none"),Gt&&(Gt.style.display=z&&ft==="ElevenLabs"?"block":"none"),dt&&(dt.style.display=z&&ft==="ElevenLabs"?"block":"none")}else if(z===!1){Qe.querySelectorAll(".aipkit_tts_field").forEach(dt=>{dt.style.display="none"});let ft=Qe.querySelector(".aipkit_tts_google_voice_inline");ft&&(ft.style.display="none");let yi=Qe.querySelector(".aipkit_tts_openai_voice_inline");yi&&(yi.style.display="none");let Xt=Qe.querySelector(".aipkit_tts_openai_model_inline");Xt&&(Xt.style.display="none");let Ct=Qe.querySelector(".aipkit_tts_elevenlabs_voice_inline");Ct&&(Ct.style.display="none");let Gt=Qe.querySelector(".aipkit_tts_elevenlabs_model_inline");Gt&&(Gt.style.display="none")}B("tts",z);let Ge=Qe.querySelector(".aipkit_realtime_voice_settings_container"),kt=Qe.querySelector(".aipkit_realtime_voice_inline_controls"),Lt=Qe.querySelector(".aipkit_realtime_voice_inline_row"),Ii=Ge&&Ge.getAttribute("data-force-visible")==="1"?!0:X;if(Ge&&(Ge.style.display=Ii?"block":"none"),Lt&&(Lt.style.display=Ii?"block":"none"),kt&&(kt.style.display=Ii?"flex":"none"),Qe.querySelectorAll(".aipkit_rt_dependent").forEach(ft=>{ft.style.display=Ii?"":"none"}),B("realtime",X),Qe.classList.contains("is-open")){let ft=String(Qe.dataset.activeAudioFeature||"").trim().toLowerCase();if(ft&&!(ft==="stt"&&U||ft==="tts"&&z||ft==="realtime"&&X)){Qe.classList.remove("is-open"),Qe.setAttribute("aria-hidden","true"),delete Qe.dataset.activeAudioFeature,Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null);let Xt=Qe.querySelector("#aipkit_builder_audio_settings_title");Xt&&Xt.dataset.defaultTitle&&(Xt.textContent=Xt.dataset.defaultTitle)}}oo(),Eo()};function Kn(){if(!D)return;let q=en&&en.classList.contains("is-open")||cn&&cn.classList.contains("is-open")||dn&&dn.classList.contains("is-open")||Zi&&Zi.classList.contains("is-open")||Nn&&Nn.classList.contains("is-open")||!!e.querySelector("[data-aipkit-interface-controls-dropdown].is-open");D.classList.toggle("aipkit_settings_accordion--allow-overflow",q)}let ya=()=>{!ao||!Ui||(ao.setAttribute("aria-expanded","false"),Ui.hidden=!0,en.classList.remove("is-open"),Kn())},Qo=()=>{!to||!ma||!cn||(to.setAttribute("aria-expanded","false"),ma.hidden=!0,cn.classList.remove("is-open"),Kn())},va=()=>{!ro||!jo||!Zi||(ro.setAttribute("aria-expanded","false"),jo.hidden=!0,Zi.classList.remove("is-open"),Kn())},ba=()=>{!Gn||!Nn||(Gn.setAttribute("aria-expanded","false"),Nn.hidden=!0,Nn.classList.remove("is-open"),Kn())},Br=()=>{if(!Ti||!Fi||!In.length)return;let q=In.find(B=>{let U=B.getAttribute("data-theme-value")||B.value||"",z=B.getAttribute("data-preset-key")||"";return U==="custom"&&z===""}),T=!!(q&&!q.disabled);Ti.hidden=!T,Ti.disabled=!T,Ti.setAttribute("aria-disabled",T?"false":"true"),!T&&ki===Ti&&Jo()},Ir=()=>{if(!Ha||!Fi)return;let q=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,T=q&&q.textContent?q.textContent.trim():"",B=(Fi.value||"")==="custom"?Sn():"";Ha.textContent=B||T||cn.dataset.placeholder||"Select theme",Br()},Fr=q=>{!vo||vo.disabled||(vo.value=q||"")},$r=(q,T)=>{if((q||"")!=="custom"){Fr("");return}Fr(T||"")},Yr=()=>{if($r("custom",""),e.querySelectorAll(".aipkit_custom_theme_preset").forEach(q=>{q.classList.remove("is-selected"),q.setAttribute("aria-pressed","false")}),Fi&&!Fi.disabled&&Fi.value==="custom"){let q=Array.from(Fi.options||[]).findIndex(T=>(T.value||"")==="custom"&&!(T.dataset&&T.dataset.presetKey));q>=0&&Fi.selectedIndex!==q&&(Fi.selectedIndex=q)}if(In.length){let q=In.find(T=>{let B=T.getAttribute("data-theme-value")||T.value||"",U=T.getAttribute("data-preset-key")||"";return B==="custom"&&U===""});q&&(q.checked=!0)}Ir()},gr=()=>{if(!Fi||!In.length){Ir();return}let q=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,T=Fi.value||"",B=q&&q.dataset&&q.dataset.presetKey?q.dataset.presetKey:"",U=!1;if(In.forEach(K=>{let V=K.getAttribute("data-theme-value")||K.value||"",Y=K.getAttribute("data-preset-key")||"",ne=V===T&&Y===B;K.checked=ne,ne&&(U=!0)}),!U&&T){let K=In.find(V=>(V.getAttribute("data-theme-value")||V.value||"")===T);K&&(K.checked=!0)}let z=In.find(K=>K.checked),X=z?z.getAttribute("data-theme-value")||z.value||"":T,ie=z?z.getAttribute("data-preset-key")||"":B;$r(X,ie),Ir()},Or=q=>{if(!q||!Fi)return;let T=q.getAttribute("data-theme-value")||q.value||"",B=q.getAttribute("data-preset-key")||"";if(!T)return;let U=-1,z=Array.from(Fi.options||[]);if(z.forEach((ie,K)=>{if(U!==-1||(ie.value||"")!==T)return;(ie.dataset&&ie.dataset.presetKey?ie.dataset.presetKey:"")===B&&(U=K)}),U===-1&&(U=z.findIndex(ie=>(ie.value||"")===T)),U<0||!z[U])return;let X=Fi.selectedIndex!==U;Fi.selectedIndex=U,X?Fi.dispatchEvent(new Event("change",{bubbles:!0})):gr()},Nr=()=>{if(!ur||!tn)return;let q=tn.selectedOptions&&tn.selectedOptions.length?tn.selectedOptions[0]:null,T=q&&q.textContent?q.textContent.trim():"";ur.textContent=T||Zi.dataset.placeholder||"Select model"},kr=()=>{if(!tn||!ga.length){Nr();return}let q=tn.value||"",T=!1;if(ga.forEach(B=>{let U=B.value===q;B.checked=U,U&&(T=!0)}),!T&&q){let B=ga.find(U=>U.value===q);B&&(B.checked=!0)}Nr()},Xr=q=>{if(!q||!tn)return;let T=q.value||"";if(!T)return;let U=Array.from(tn.options||[]).findIndex(X=>(X.value||"")===T);if(U<0){let X=new Option(T,T,!0,!0);tn.add(X),U=tn.options.length-1}let z=tn.selectedIndex!==U;tn.selectedIndex=U,z?tn.dispatchEvent(new Event("change",{bubbles:!0})):kr()},wr=()=>{if(!$o)return;let q=[],T=Ut(sn.popup_position),B=Ut(sn.popup_icon_style),U=Ut(sn.popup_icon_size);T&&q.push(T),B&&q.push(B),U&&q.push(U),$o.textContent=q.length>0?q.join(" \u2022 "):en.dataset.placeholder||"Position, style, size"},hr=()=>{if(!vn.length){wr();return}vn.forEach(q=>{let T=q.getAttribute("data-target-name");!T||!sn[T]||(q.checked=sn[T].value===q.value)}),wr()},Zr=q=>{if(!q)return;let T=q.getAttribute("data-target-name");if(!T)return;let B=sn[T];if(!(!B||B.disabled)){if(B.value===q.value){wr();return}B.value=q.value,B.dispatchEvent(new Event("change",{bubbles:!0})),wr()}},Qa=()=>{if(!zi)return;let q=kt=>{let Lt=zi.querySelector(kt);if(!Lt)return;let Ot=(Lt.getAttribute("data-default-url")||"").trim();if(!Ot)return;let Ii=(Lt.value||"").trim(),ft=Ii.toLowerCase();(!Ii||(ft==="spark"||ft==="chat-bubble"||ft==="openai"||ft==="plus"||ft==="question-mark"))&&(Lt.value=Ot)},T=zi.querySelector('input[name="popup_icon_default"]:checked'),B=T&&T.value==="__custom__"?"custom":"default",U=zi.querySelector(".aipkit_popup_icon_custom_input_container");U&&(B==="custom"?(U.removeAttribute("hidden"),q('[name="popup_icon_custom_url"]')):U.setAttribute("hidden",""));let z=zi.querySelector('[name="popup_icon_type"]');z&&z.value!==B&&(z.value=B);let X=zi.querySelector('input[name="header_avatar_default"]:checked'),ie=X&&X.value==="__custom__"?"custom":"default",K=zi.querySelector(".aipkit_header_avatar_custom_input_container");K&&(ie==="custom"?(K.removeAttribute("hidden"),q('[name="header_avatar_url"]')):K.setAttribute("hidden",""));let V=zi.querySelector('[name="header_avatar_type"]');V&&V.value!==ie&&(V.value=ie);let Y=zi.querySelector('select[name="popup_icon_style"]');if(Y){let kt=zi.querySelectorAll('input[name="popup_icon_style"]');kt.length&&kt.forEach(Lt=>{Lt.checked=Lt.value===Y.value})}let ne=e.querySelector(".aipkit_popup_hint_toggle_switch"),_e=ne?ne.checked:!1;e.querySelectorAll(".aipkit_popup_hint_config_btn").forEach(kt=>{kt.hidden=!_e,_e||kt.setAttribute("aria-expanded","false")}),!_e&&Te&&Te.classList.contains("is-open")&&yr();let Ge=Te||zi;if(Ge){Ge.querySelectorAll(".aipkit_popup_hint_extra").forEach(Lt=>{_e?Lt.removeAttribute("hidden"):Lt.setAttribute("hidden","")});let kt=Ge.querySelector(".aipkit_popup_hint_conditional_row");kt&&(_e?kt.removeAttribute("hidden"):kt.setAttribute("hidden",""))}hr()},yr=()=>{Te&&(Te.classList.remove("is-open"),Te.setAttribute("aria-hidden","true"),We&&(We.setAttribute("aria-expanded","false"),We=null))},Rr=()=>{Re&&(Re.classList.remove("is-open"),Re.setAttribute("aria-hidden","true"),ni&&(ni.setAttribute("aria-expanded","false"),ni=null))},Dr=()=>{let q=Rt||Re;if(!q)return;let T=q.querySelector('[name="enable_consent_compliance"]'),B=T?T.tagName==="SELECT"?T.value==="1":T.checked:!1;q.querySelectorAll(".aipkit_consent_field_row").forEach(U=>{B?U.removeAttribute("hidden"):U.setAttribute("hidden","")}),O&&O.classList.contains("aipkit-active")&&Ke&&requestAnimationFrame(()=>{bo(Ke)})},Wr=()=>{let q=Rt||Re;if(!q)return;let T=q.querySelector('[name="openai_moderation_enabled"]'),B=T?T.tagName==="SELECT"?T.value==="1":T.checked:!1;q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(U=>{B?U.removeAttribute("hidden"):U.setAttribute("hidden","")}),O&&O.classList.contains("aipkit-active")&&Ke&&requestAnimationFrame(()=>{bo(Ke)})},Lr=()=>{let q=Rt||Re;if(!q)return;let T=e.querySelector(".aipkit_chatbot_provider_select"),U=(T?T.value:"")==="OpenAI";if(q.querySelectorAll(".aipkit_openai_moderation_row").forEach(X=>{X.style.display=U?"":"none"}),U){Wr();return}q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(X=>{X.setAttribute("hidden","")})},qr=()=>{ht&&(ht.classList.remove("is-open"),ht.setAttribute("aria-hidden","true"),Ai&&(Ai.setAttribute("aria-expanded","false"),Ai=null))},Jo=()=>{Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true"),ki&&(ki.setAttribute("aria-expanded","false"),ki=null))},Hr=q=>{if(!Mt||!q)return;Mt.classList.contains("is-open")||(Mt.classList.add("is-open"),Mt.setAttribute("aria-hidden","false")),ki&&ki!==q&&ki.setAttribute("aria-expanded","false"),q.setAttribute&&q.setAttribute("aria-expanded","true"),ki=q,window.requestAnimationFrame(()=>{za(q)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},Ja=q=>{if(!q)return;let T=q.querySelector(".aipkit_reasoning_effort_slider"),B=q.querySelector(".aipkit_reasoning_effort_label"),U=q.querySelector('input[name="reasoning_effort"]');if(!T||!B||!U)return;let z=()=>{let X=[],ie=[];try{T.dataset.reasoningValues&&(X=JSON.parse(T.dataset.reasoningValues)),T.dataset.reasoningLabels&&(ie=JSON.parse(T.dataset.reasoningLabels))}catch{X=[],ie=[]}(!Array.isArray(X)||X.length===0)&&(X=["none","low","medium","high","xhigh"]),(!Array.isArray(ie)||ie.length===0)&&(ie=X.slice());let K=parseInt(T.value,10),V=Number.isNaN(K)?0:Math.min(X.length-1,Math.max(0,K)),Y=X[V]||X[0],ne=ie[V]||Y;U.value=Y,B.textContent=ne};z(),T.dataset.reasoningBound||(T.addEventListener("input",z),T.addEventListener("change",z),T.dataset.reasoningBound="1")},Yo=()=>{if(!R)return;let q=()=>{let Ge=R.querySelector(".aipkit_behavior_compact_row");if(!Ge)return;if(window.innerWidth<=960){Ge.style.gridTemplateColumns="";return}let kt=Array.from(Ge.querySelectorAll(".aipkit_behavior_compact_cell")).filter(Ot=>!Ot||Ot.hidden?!1:window.getComputedStyle(Ot).display!=="none"),Lt=Math.max(1,kt.length);Ge.style.gridTemplateColumns=`repeat(${Lt}, minmax(0, 1fr))`},T=e.querySelector(".aipkit_chatbot_provider_select"),B=T?T.value:"",U=B==="OpenAI",z=Jt(),X=xa("image_input"),ie=B==="OpenAI"||B==="Claude"||B==="OpenRouter"&&X,K=R.querySelector(".aipkit_stateful_convo_checkbox"),V=R.querySelector(".aipkit_stateful_convo_group");K&&(K.disabled=!U),V&&(V.style.display=U?"":"none",V.removeAttribute("title"));let Y=R&&R.querySelector(".aipkit_reasoning_effort_field")||ce&&ce.querySelector(".aipkit_reasoning_effort_field");Y&&(Y.style.display=z?"":"none"),Le();let ne=R&&R.querySelector(".aipkit_image_analysis_popover_row")||j&&j.querySelector(".aipkit_image_analysis_popover_row");if(ne&&(ne.style.display=ie?"":"none"),B==="OpenRouter"&&!X){let Ge=j&&j.querySelector(".aipkit_image_analysis_select")||R&&R.querySelector(".aipkit_image_analysis_select")||F.querySelector(".aipkit_image_analysis_select"),kt=j&&j.querySelector(".aipkit_image_analysis_checkbox")||R&&R.querySelector(".aipkit_image_analysis_checkbox")||F.querySelector(".aipkit_image_analysis_checkbox");Ge&&Ge.value!=="0"?(Ge.value="0",Ge.dispatchEvent(new Event("change",{bubbles:!0}))):kt&&kt.checked&&(kt.checked=!1,kt.dispatchEvent(new Event("change",{bubbles:!0})))}oo(),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(ce||R),q(),window.requestAnimationFrame(q);let _e=R.querySelector(".aipkit_model_settings_panel:not([hidden])"),be=_e?_e.querySelector(".aipkit_popover_options_list"):R.querySelector(".aipkit_popover_options_list");if(be){let Ge=be.querySelectorAll(".aipkit_popover_option_row");Ge.forEach(Lt=>Lt.classList.remove("aipkit_last_visible_row"));let kt=null;Ge.forEach(Lt=>{Lt.style.display!=="none"&&(kt=Lt)}),kt&&kt.classList.add("aipkit_last_visible_row")}O&&O.classList.contains("aipkit-active")&&Ke&&bo(Ke),e.dataset.behaviorCompactLayoutBound||(window.addEventListener("resize",q),e.dataset.behaviorCompactLayoutBound="1")};if(e.dataset.shortcodeCopyBound||(e.addEventListener("click",q=>{let T=q.target.closest(".aipkit_shortcode_pill");if(!T)return;let B=T.dataset.shortcode||T.querySelector(".aipkit_shortcode_text")?.textContent||"";B&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(B,T)}),e.dataset.shortcodeCopyBound="1"),e.dataset.embedCopyBound||(e.addEventListener("click",q=>{let T=q.target.closest(".aipkit_copy_embed_code_btn");if(!T)return;let B=T.dataset.target;if(!B)return;let U=document.getElementById(B);if(!U)return;let z=U.value||U.textContent||"";z&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(z,T)}),e.dataset.embedCopyBound="1"),D&&!e.dataset.accordionBound){let q=Array.from(D.querySelectorAll(".aipkit_accordion_section")),T=z=>{if(!z)return;let X=z.querySelector(".aipkit_accordion_header"),ie=z.querySelector(".aipkit_accordion_body");!X||!ie||(X.setAttribute("aria-expanded","false"),ie.hidden=!0)},B=(z,X)=>{if(!z)return;let ie=z.querySelector(".aipkit_accordion_header"),K=z.querySelector(".aipkit_accordion_body");if(!(!ie||!K)&&(ie.setAttribute("aria-expanded","true"),K.hidden=!1,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),X==="rules"&&typeof window.aipkit_initTriggerBuilderUI=="function")){let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&V!=="__new__"&&window.aipkit_initTriggerBuilderUI(V)}};q.forEach(z=>{let X=z.querySelector(".aipkit_accordion_header"),ie=z.querySelector(".aipkit_accordion_body");if(!X||!ie)return;let K=z.getAttribute("data-aipkit-accordion")||"";X.setAttribute("aria-expanded","false"),ie.hidden=!0,!(K==="rules"&&X.classList.contains("aipkit_builder_sheet_trigger"))&&X.addEventListener("click",()=>{if(X.getAttribute("aria-expanded")==="true"){T(z),s("");return}q.forEach(Y=>{Y!==z&&T(Y)}),B(z,K),s(K)})});let U=a();if(U&&U!=="rules"){let z=q.find(X=>(X.getAttribute("data-aipkit-accordion")||"")===U);z&&!z.hidden?B(z,U):s("")}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Ja(D),io(),Yo(),nn(),e.dataset.accordionBound="1"}if(O&&!Z&&e.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(T=>{T.classList.add("aipkit_model_settings_popover_trigger"),T.setAttribute("aria-haspopup","dialog"),T.setAttribute("aria-expanded","false"),T.setAttribute("aria-controls","aipkit_model_settings_popover"),T.setAttribute("aria-label",Ga),T.setAttribute("title",Ga)}),M&&v&&!e.dataset.botTabsBound&&(M.addEventListener("click",q=>{let T=q.target.closest(".aipkit_builder_bot_tab");if(!T)return;gi();let B=String(T.dataset.botId||"");if(!B||B===String(v.value||"")){Hi(v.value||"");return}v.value=B,v.dispatchEvent(new Event("change",{bubbles:!0}))}),W&&H&&(W.addEventListener("click",q=>{if(q.preventDefault(),W.hidden)return;if(W.getAttribute("aria-expanded")==="true"){gi();return}ji(),H.hidden=!1,W.setAttribute("aria-expanded","true");let B=H.querySelector(".aipkit_builder_bot_overflow_search_input");B&&typeof B.focus=="function"&&window.requestAnimationFrame(()=>{B.focus(),typeof B.select=="function"&&B.select()})}),H.addEventListener("click",q=>{let T=q.target.closest(".aipkit_builder_bot_overflow_item");if(!T)return;let B=String(T.dataset.botId||"");if(!B){gi();return}B!==String(v.value||"")?(v.value=B,v.dispatchEvent(new Event("change",{bubbles:!0}))):Hi(B),gi()}),H.addEventListener("input",q=>{let T=q.target.closest(".aipkit_builder_bot_overflow_search_input");T&&ii(T.value||"")}),document.addEventListener("click",q=>{!H||H.hidden||!$||q.target.closest(".aipkit_builder_bot_overflow")||gi()}),document.addEventListener("keydown",q=>{q.key==="Escape"&&gi()})),typeof ResizeObserver=="function"?(Q=new ResizeObserver(()=>{ui()}),Q.observe(M)):window.addEventListener("resize",ui),e.dataset.botTabsBound="1"),v){let q=v.value||"";Hi(q),v.addEventListener("change",async()=>{let T=v.value;if(!T){Hi(q);return}if(T==="__new__"){typeof G=="function"&&G();let U=q||e.getAttribute("data-active-bot-id")||"";if(U)v.value=U;else{let z=Array.from(v.options).find(X=>X.value&&X.value!=="__new__"&&!X.disabled);z&&(v.value=z.value,q=z.value)}Hi(v.value||q);return}q=T,Hi(T);try{localStorage.setItem(k,T)}catch(U){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",U)}let B=!1;try{B=await Mn(T)}catch{B=!1}!B&&typeof window.aipkit_loadModule=="function"&&(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.aipkit_loadModule("chatbot",{force_active_bot_id:T,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}))}),Vo()}if((A||v)&&!e.dataset.newBotActionBound){let q=!1;G=()=>{if(q||typeof window.aipkit_apiRequest!="function")return;let T=i("New Chatbot","gpt3-ai-content-generator");q=!0,A&&(A.disabled=!0),st(i("Creating chatbot...","gpt3-ai-content-generator"),""),window.aipkit_apiRequest("aipkit_create_chatbot",{bot_name:T}).then(B=>{let U=B&&B.bot_id?String(B.bot_id):"";if(!U)throw new Error(i("Chatbot created but no bot ID was returned.","gpt3-ai-content-generator"));try{localStorage.setItem(k,U)}catch{}st(B.message||i("Chatbot created successfully.","gpt3-ai-content-generator"),"success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:U,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(U),Oi()}).catch(B=>{st(`Error: ${B.message||i("Failed to create chatbot.","gpt3-ai-content-generator")}`,"error"),Oi()}).finally(()=>{q=!1,A&&(A.disabled=!1)})},A&&A.addEventListener("click",G),e.dataset.newBotActionBound="1"}if(F&&!e.dataset.sheetBound){let q=B=>{if(!F)return;O&&O.classList.contains("aipkit-active")&&So();let U=B.dataset.sheetTitle||"Sheet",z=B.dataset.sheetDescription||"Settings will appear here.",X=B.dataset.sheetContent||"placeholder";if(mt&&(mt.textContent=U),wt&&(wt.textContent=z),se.length){let ie=!1;se.forEach(K=>{let V=K.dataset.sheet===X;K.hidden=!V,V&&(ie=!0)}),!ie&&ae&&(ae.hidden=!1)}if(Wn&&(Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"),F.classList.add("aipkit-active"),F.setAttribute("aria-hidden","false"),Se&&Se.focus(),X==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),X==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ie=v&&v.value||e.getAttribute("data-active-bot-id");ie&&ie!=="__new__"&&window.aipkit_initTriggerBuilderUI(ie)}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),io(),Pn(),Yo(),Qa()},T=()=>{F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true")};e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_builder_sheet_trigger");U&&(B.preventDefault(),U.closest('[data-aipkit-accordion="rules"]')&&s(""),q(U))}),Se&&Se.addEventListener("click",T),F.addEventListener("click",B=>{B.target===F&&T()}),document.addEventListener("keydown",B=>{B.key==="Escape"&&F.classList.contains("aipkit-active")&&T()}),e.dataset.sheetBound="1"}if(R&&!e.dataset.modelPopoverBound){O&&(e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_model_settings_popover_trigger");if(U){if(B.preventDefault(),B.stopPropagation(),O.classList.contains("aipkit-active")&&Ke===U){So();return}fr(U)}}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_style_settings_trigger");if(!U)return;B.preventDefault(),B.stopPropagation();let z=U.dataset.aipkitPanelTarget||"appearance";ka(z)})),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_popover_params_config_btn");if(!U||(B.preventDefault(),!ce))return;let z=!ce.classList.contains("is-open");ce.classList.toggle("is-open",z),ce.setAttribute("aria-hidden",z?"false":"true"),$e&&$e!==U&&$e.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),$e=z?U:null,z&&(window.requestAnimationFrame(()=>{_r(U)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),Ja(ce),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(ce))}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_image_settings_config_btn");if(!U||(B.preventDefault(),!j))return;let z=!j.classList.contains("is-open");j.classList.toggle("is-open",z),j.setAttribute("aria-hidden",z?"false":"true"),de&&de!==U&&de.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),de=z?U:null,z&&(window.requestAnimationFrame(()=>{so(U)}),Ua())}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_popup_hint_config_btn");if(!U||(B.preventDefault(),!Te))return;let z=!Te.classList.contains("is-open");Te.classList.toggle("is-open",z),Te.setAttribute("aria-hidden",z?"false":"true"),We&&We!==U&&We.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),We=z?U:null,z&&window.requestAnimationFrame(()=>{zo(U)})}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_starters_config_btn");if(!U||(B.preventDefault(),!ht))return;let z=!ht.classList.contains("is-open");ht.classList.toggle("is-open",z),ht.setAttribute("aria-hidden",z?"false":"true"),Ai&&Ai!==U&&Ai.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),Ai=z?U:null,z&&window.requestAnimationFrame(()=>{Ka(U)})}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_security_privacy_config_btn");if(!U||(B.preventDefault(),!Re))return;let z=!Re.classList.contains("is-open");Re.classList.toggle("is-open",z),Re.setAttribute("aria-hidden",z?"false":"true"),ni&&ni!==U&&ni.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),ni=z?U:null,z&&(window.requestAnimationFrame(()=>{ja(U)}),Dr(),Lr())});let q=()=>{j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true"),de&&(de.setAttribute("aria-expanded","false"),de=null))};te&&te.addEventListener("click",B=>{B.preventDefault(),q()}),Ue&&Ue.addEventListener("click",B=>{B.preventDefault(),yr()}),_t&&_t.addEventListener("click",B=>{B.preventDefault(),Rr()}),Xi&&Xi.addEventListener("click",B=>{B.preventDefault(),qr()}),_i&&_i.addEventListener("click",B=>{B.preventDefault(),Jo()}),document.addEventListener("click",B=>{!j||!j.classList.contains("is-open")||B.target.closest(".aipkit_image_settings_config_btn")||B.target.closest("#aipkit_image_settings_flyout")||q()}),document.addEventListener("click",B=>{!Te||!Te.classList.contains("is-open")||B.target.closest(".aipkit_popup_hint_config_btn")||B.target.closest("#aipkit_popup_hint_flyout")||yr()}),document.addEventListener("click",B=>{!Re||!Re.classList.contains("is-open")||B.target.closest(".aipkit_security_privacy_config_btn")||B.target.closest("#aipkit_security_privacy_flyout")||Rr()}),document.addEventListener("click",B=>{!ht||!ht.classList.contains("is-open")||B.target.closest(".aipkit_starters_config_btn")||B.target.closest("#aipkit_starters_flyout")||qr()}),document.addEventListener("click",B=>{!Mt||!Mt.classList.contains("is-open")||B.target.closest(".aipkit_theme_config_btn")||B.target.closest("[data-aipkit-theme-dropdown]")||B.target.closest('select[name="theme"]')||B.target.closest(".aipkit_builder_theme_select")||B.target.closest(".aipkit_theme_choice_group")||B.target.closest("#aipkit_custom_theme_flyout")||Jo()});let T=()=>{ce&&(ce.classList.remove("is-open"),ce.setAttribute("aria-hidden","true"),$e&&($e.setAttribute("aria-expanded","false"),$e=null))};if(he&&he.addEventListener("click",B=>{B.preventDefault(),T()}),document.addEventListener("click",B=>{!ce||!ce.classList.contains("is-open")||B.target.closest(".aipkit_popover_params_config_btn")||B.target.closest("#aipkit_parameters_flyout")||T()}),J&&J.addEventListener("click",So),Ce&&Ce.addEventListener("click",()=>{ka("root")}),O&&O.addEventListener("click",B=>{B.target===O&&So()}),document.addEventListener("keydown",B=>{B.key==="Escape"&&O&&O.classList.contains("aipkit-active")&&So()}),R&&!R.dataset.footerActionsBound){let B=e.getAttribute("data-default-bot-id")||"",U=!1,z=K=>{R.querySelectorAll(".aipkit_popover_footer_btn").forEach(Y=>{Y.disabled=!!K})},X=()=>{let K=Array.from(v&&v.options||[]).map(Y=>String(Y&&Y.value||"").trim()).filter(Y=>Y&&Y!=="__new__"),V=[v?String(v.value||"").trim():"",String(e.getAttribute("data-active-bot-id")||"").trim(),String((e.querySelector("form.aipkit_chatbot_settings_form")||{}).dataset?.botId||"").trim(),String((e.querySelector(".aipkit_builder_bot_tab.is-active[data-bot-id]")||{}).dataset?.botId||"").trim()];for(let Y of V)if(!(!Y||Y==="__new__")&&/^\d+$/.test(Y)&&(!K.length||K.includes(Y)))return Y;return K[0]||""},ie=K=>{let V=String(K||""),Y=Array.from(v&&v.options||[]).map(_e=>String(_e&&_e.value||"")).filter(_e=>_e&&_e!=="__new__");if(!Y.length)return"";let ne=Y.indexOf(V);if(ne===-1)return B&&String(B)!==V?String(B):Y[0]||"";for(let _e=ne-1;_e>=0;_e-=1){let be=Y[_e];if(be&&be!==V)return be}for(let _e=ne+1;_e<Y.length;_e+=1){let be=Y[_e];if(be&&be!==V)return be}return B&&String(B)!==V?String(B):""};R.addEventListener("click",K=>{let V=K.target.closest(".aipkit_popover_footer_btn");if(!V||(K.preventDefault(),U))return;let Y=V.getAttribute("data-action"),ne=X();if(!Y||!ne||typeof window.aipkit_apiRequest!="function"){Y&&typeof window.aipkit_apiRequest=="function"&&(st(i("Error: Invalid chatbot selected.","gpt3-ai-content-generator"),"error"),Oi());return}if(Y==="delete"){if(V.disabled||ne===B)return;let _e=ie(ne);U=!0,z(!0),st("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:ne}).then(be=>{st(be.message||"Deleted","success");try{_e?localStorage.setItem(k,_e):localStorage.removeItem(k)}catch{}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let Ge=String(_e||B||""),kt={layout:f,aipkit_silent:!0,aipkit_force_refresh:!0};Ge&&Ge!==String(ne)?kt.force_active_bot_id=Ge:kt.force_active_tab="create",window.aipkit_loadModule("chatbot",kt)}else if(typeof window.aipkit_refreshChatPreview=="function"){let Ge=String(_e||B||"");window.aipkit_refreshChatPreview(Ge||ne)}Oi()}).catch(be=>{st(`Error: ${be.message||"Failed to delete."}`,"error"),Oi()}).finally(()=>{U=!1,z(!1)});return}if(Y==="duplicate"){U=!0,z(!0),st("Duplicating...",""),window.aipkit_apiRequest("aipkit_duplicate_chatbot",{bot_id:ne}).then(_e=>{let be=String(_e&&_e.bot_id||"");if(st(_e.message||"Duplicated","success"),be)try{localStorage.setItem(k,be)}catch{}typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:be||ne,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(be||ne),Oi()}).catch(_e=>{st(`Error: ${_e.message||"Failed to duplicate."}`,"error"),Oi()}).finally(()=>{U=!1,z(!1)});return}Y==="reset"&&(U=!0,z(!0),st("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:ne}).then(_e=>{st(_e.message||"Saved","success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:ne,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),Oi()}).catch(_e=>{st(`Error: ${_e.message||"Failed to reset."}`,"error"),Oi()}).finally(()=>{U=!1,z(!1)}))}),R.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{O&&O.classList.contains("aipkit-active")&&Ke&&bo(Ke),Bt&&Bt.classList.contains("is-open")&&qi&&No(qi),Vt&&Vt.classList.contains("is-open")&&un&&Ro(un),Si&&Si.classList.contains("is-open")&&_n&&wa(_n),Qe&&Qe.classList.contains("is-open")&&Vi&&ha(Vi),j&&j.classList.contains("is-open")&&de&&so(de),Te&&Te.classList.contains("is-open")&&We&&zo(We),Re&&Re.classList.contains("is-open")&&ni&&ja(ni),ht&&ht.classList.contains("is-open")&&Ai&&Ka(Ai),Mt&&Mt.classList.contains("is-open")&&ki&&za(ki)}),window.addEventListener("scroll",()=>{O&&O.classList.contains("aipkit-active")&&Ke&&bo(Ke),Bt&&Bt.classList.contains("is-open")&&qi&&No(qi),Vt&&Vt.classList.contains("is-open")&&un&&Ro(un),Si&&Si.classList.contains("is-open")&&_n&&wa(_n),Qe&&Qe.classList.contains("is-open")&&Vi&&ha(Vi),j&&j.classList.contains("is-open")&&de&&so(de),Te&&Te.classList.contains("is-open")&&We&&zo(We),Re&&Re.classList.contains("is-open")&&ni&&ja(ni),ht&&ht.classList.contains("is-open")&&Ai&&Ka(Ai),Mt&&Mt.classList.contains("is-open")&&ki&&za(ki)},!0),e.dataset.modelPopoverBound="1"}if(Pt&&$i&&!Pt.dataset.autosaveBound){let q=Pt.value,T=!1,B=null,U=V=>{tt&&(tt.textContent=`${V.length.toLocaleString()} characters`)},z=V=>{gt&&(gt.value=V,U(V))},X=V=>{let Y=v&&v.value||e.getAttribute("data-active-bot-id");Y&&(T=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:Y,instructions:V}).then(ne=>{q=V,Pt.dataset.dirty="0",st(ne.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Y),Oi()}).catch(ne=>{st(`Error: ${ne.message||"Failed to save."}`,"error"),Pt.dataset.dirty="1"}).finally(()=>{if(T=!1,B!==null&&B!==q){let ne=B;B=null,X(ne)}else B=null}))},ie=()=>{!Qt||!gt||(z(Pt.value),Qt.classList.add("aipkit-active"),Qt.setAttribute("aria-hidden","false"),setTimeout(()=>gt.focus(),0))},K=V=>{if(!Qt||(Qt.classList.remove("aipkit-active"),Qt.setAttribute("aria-hidden","true"),!V||!gt))return;let Y=gt.value;if(Y!==Pt.value&&(Pt.value=Y,Pt.dataset.dirty="1"),Pt.dataset.dirty==="1"){if(T){B=Pt.value;return}X(Pt.value)}};gt&&!gt.dataset.bound&&(gt.addEventListener("input",()=>{U(gt.value),Pt.dataset.dirty="1"}),gt.dataset.bound="1"),Qt&&!Qt.dataset.bound&&(Mi&&Mi.addEventListener("click",ie),ti&&ti.addEventListener("click",()=>{K(!0)}),document.addEventListener("keydown",V=>{V.key==="Escape"&&Qt.classList.contains("aipkit-active")&&K(!0)}),Qt.dataset.bound="1"),Pt.addEventListener("input",()=>{Pt.dataset.dirty="1"}),Pt.addEventListener("blur",()=>{let V=Pt.value;if(Pt.dataset.dirty==="1"){if(V===q){Pt.dataset.dirty="0";return}if(T){B=V;return}X(V)}}),Pt.dataset.autosaveBound="1"}if(Go){let q=Go.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),T=U=>{U&&(q.forEach(z=>{let X=z.dataset.aipkitTab===U;z.classList.toggle("is-active",X),z.setAttribute("aria-selected",X?"true":"false")}),na.forEach(z=>{let X=z.dataset.aipkitPanel===U;z.classList.toggle("is-active",X),z.hidden=!X}),Rn&&(Rn.style.display=U==="files"?"none":""),Aa&&Aa.classList.toggle("aipkit_builder_action_row--end",U==="files"))},B=Go.querySelector(".aipkit_builder_tab.is-active");B&&T(B.dataset.aipkitTab),q.forEach(U=>{U.addEventListener("click",()=>{T(U.dataset.aipkitTab)})})}let co=e.querySelector('textarea[name="triggers_json"]'),Ya=e.querySelector(".aipkit_trigger_builder_container"),Wn=e.querySelector(".aipkit_triggers_status");if((co||Ya)&&$i&&!e.dataset.triggersAutosaveBound){let q=co?co.value:"[]",T=!1,B=null,U=null,z=()=>{let _e=v&&v.value||e.getAttribute("data-active-bot-id");if(!_e)return null;let be="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let Ge=window.aipkit_getTriggerBuilderState(_e);Ge&&Array.isArray(Ge.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(_e,Ge.triggers),be=co?co.value:JSON.stringify(Ge.triggers,null,2))}return!be&&co&&(be=co.value),be||(be="[]"),{botId:_e,triggersJson:be}},X=(_e,be)=>{Wn&&(Wn.textContent=_e||"",Wn.classList.remove("success","error","loading"),be&&Wn.classList.add(be),Wn.style.display=_e?"inline-block":"none")},ie=()=>{Wn&&setTimeout(()=>{Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"},2500)},K=(_e,be)=>{be&&(T=!0,st("Auto-saving...",""),X("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:be,triggers_json:_e}).then(Ge=>{q=_e,st(Ge.message||"Saved","success"),X("Saved","success"),Oi(),ie()}).catch(Ge=>{st(`Error: ${Ge.message||"Failed to save."}`,"error"),X("Error","error"),ie()}).finally(()=>{if(T=!1,B!==null&&B!==q){let Ge=B;B=null;let kt=z();kt&&K(Ge,kt.botId)}else B=null}))},V=_e=>{if(_e===q)return;if(T){B=_e;return}let be=z();be&&K(_e,be.botId)},Y=()=>{U&&clearTimeout(U),U=setTimeout(()=>{let _e=z();_e&&V(_e.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=Y);let ne=_e=>{_e.target&&_e.target.closest(".aipkit_trigger_builder_container")&&Y()};Ya&&(Ya.addEventListener("input",ne),Ya.addEventListener("change",ne),Ya.addEventListener("click",ne)),co&&(co.addEventListener("input",Y),co.addEventListener("blur",Y)),e.dataset.triggersAutosaveBound="1"}if(Bt&&!Bt.dataset.bound){let q=Bt.querySelector("#aipkit_builder_web_settings_title"),T=q?q.textContent.trim():i("Web search","gpt3-ai-content-generator"),B={openai:i("Web options (OpenAI)","gpt3-ai-content-generator"),google:i("Web options (Google)","gpt3-ai-content-generator"),claude:i("Web options (Claude)","gpt3-ai-content-generator"),openrouter:i("Web options (OpenRouter)","gpt3-ai-content-generator")},U=(ie="")=>{if(!q)return;let K=String(ie||"").trim().toLowerCase();q.textContent=B[K]||T},z=ie=>{if(!Bt||!ie)return;let K=String(ie.dataset.webProvider||"").trim().toLowerCase();Bt.dataset.activeWebProvider=K,U(K),Bt.classList.add("is-open"),Bt.setAttribute("aria-hidden","false"),ie.setAttribute("aria-expanded","true"),qi=ie,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),io(),window.requestAnimationFrame(()=>{No(ie)})},X=()=>{Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true"),delete Bt.dataset.activeWebProvider,U(""),qi&&(qi.setAttribute("aria-expanded","false"),qi=null)};e.addEventListener("click",ie=>{let K=ie.target.closest(".aipkit_web_search_config_btn");if(K){if(ie.preventDefault(),Bt.classList.contains("is-open")&&qi===K){X();return}z(K)}}),Tn&&Tn.addEventListener("click",X),document.addEventListener("click",ie=>{Bt.classList.contains("is-open")&&(ie.target.closest(".aipkit_web_search_config_btn")||ie.target.closest("#aipkit_builder_web_settings_modal")||X())}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&Bt.classList.contains("is-open")&&X()}),Bt.dataset.bound="1"}if(Vt&&!Vt.dataset.bound){let q=B=>{!Vt||!B||(Vt.classList.add("is-open"),Vt.setAttribute("aria-hidden","false"),B.setAttribute("aria-expanded","true"),un=B,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),ai(),window.requestAnimationFrame(()=>{Ro(B)}))},T=()=>{Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true"),un&&(un.setAttribute("aria-expanded","false"),un=null)};e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_vector_store_config_btn");if(U){if(B.preventDefault(),Vt.classList.contains("is-open")&&un===U){T();return}q(U)}}),Na&&Na.addEventListener("click",T),document.addEventListener("click",B=>{Vt.classList.contains("is-open")&&(B.target.closest(".aipkit_vector_store_config_btn")||B.target.closest("#aipkit_builder_context_settings_modal")||T())}),document.addEventListener("keydown",B=>{B.key==="Escape"&&Vt.classList.contains("is-open")&&T()}),Vt.dataset.bound="1"}if(Si&&!Si.dataset.bound){let q=B=>{!Si||!B||(Si.classList.add("is-open"),Si.setAttribute("aria-hidden","false"),B.setAttribute("aria-expanded","true"),_n=B,Gi(),window.requestAnimationFrame(()=>{wa(B)}))},T=()=>{Si.classList.remove("is-open"),Si.setAttribute("aria-hidden","true"),_n&&(_n.setAttribute("aria-expanded","false"),_n=null)};e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_limit_usage_config_btn");if(U){if(B.preventDefault(),Si.classList.contains("is-open")&&_n===U){T();return}q(U)}}),Da&&Da.addEventListener("click",T),document.addEventListener("click",B=>{Si.classList.contains("is-open")&&(B.target.closest(".aipkit_limit_usage_config_btn")||B.target.closest("#aipkit_builder_token_limits_modal")||T())}),document.addEventListener("keydown",B=>{B.key==="Escape"&&Si.classList.contains("is-open")&&T()}),Si.dataset.bound="1"}if(Qe&&!Qe.dataset.bound){let q=Qe.querySelector("#aipkit_builder_audio_settings_title"),T=q?q.textContent.trim():i("Audio","gpt3-ai-content-generator");q&&!q.dataset.defaultTitle&&(q.dataset.defaultTitle=T);let B={stt:i("Speech to Text options","gpt3-ai-content-generator"),tts:i("Text to Speech options","gpt3-ai-content-generator"),realtime:i("Realtime voice options","gpt3-ai-content-generator")},U=(ie="")=>{if(!q)return;let K=String(ie||"").trim().toLowerCase();q.textContent=B[K]||T},z=ie=>{if(!Qe||!ie)return;let K=String(ie.dataset.audioFeature||"").trim().toLowerCase();Qe.dataset.activeAudioFeature=K,U(K),Qe.classList.add("is-open"),Qe.setAttribute("aria-hidden","false"),ie.setAttribute("aria-expanded","true"),Vi=ie,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),Pn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{ha(ie)})},X=()=>{Qe.classList.remove("is-open"),Qe.setAttribute("aria-hidden","true"),delete Qe.dataset.activeAudioFeature,U(""),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null)};e.addEventListener("click",ie=>{let K=ie.target.closest(".aipkit_audio_settings_config_btn");if(K){if(ie.preventDefault(),Qe.classList.contains("is-open")&&Vi===K){X();return}z(K)}}),Wa&&Wa.addEventListener("click",X),document.addEventListener("click",ie=>{Qe.classList.contains("is-open")&&(ie.target.closest(".aipkit_audio_settings_config_btn")||ie.target.closest("#aipkit_builder_audio_settings_modal")||X())}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&Qe.classList.contains("is-open")&&X()}),Qe.dataset.bound="1"}if(je&&$i&&!je.dataset.autosaveBound){let q=je.value.trim(),T=!1,B=null,U=X=>{if(!v)return;let ie=v.options[v.selectedIndex];ie&&(ie.text=X),Hi(v.value||"")},z=X=>{let ie=v&&v.value||e.getAttribute("data-active-bot-id");ie&&(T=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:ie,new_name:X}).then(K=>{let V=(K.new_name||X).trim();q=V,je.value=V,U(V),st("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ie),Oi()}).catch(K=>{st(`Error: ${K.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,B!==null&&B!==q){let K=B;B=null,z(K)}else B=null}))};je.addEventListener("keydown",X=>{X.key==="Enter"&&(X.preventDefault(),je.blur())}),je.addEventListener("blur",()=>{let X=je.value.trim();if(!X){je.value=q,st("Name cannot be empty.","error");return}if(X!==q){if(T){B=X;return}z(X)}}),je.dataset.autosaveBound="1"}if($i&&!e.dataset.modelAutosaveBound){let q=e.querySelector(".aipkit_chatbot_provider_select");if(q){let T=!1,B=null,U=V=>{if(!V)return"";let Y=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${V}"]`);if(!Y)return"";let ne=Y.querySelector("select");return ne?ne.value:""},z=q.value||"",X=U(z),ie=(V,Y)=>{let ne=v&&v.value||e.getAttribute("data-active-bot-id");ne&&(T=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:ne,provider:V,model:Y}).then(_e=>{if(z=V,X=Y,st(_e.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),Oi(),typeof window.aipkit_requestChatbotModelSync=="function"){let be=q?q.value||"":V,Ge=U(be);be===V&&Ge===Y&&window.aipkit_requestChatbotModelSync(V,{silent:!0})}}).catch(_e=>{st(`Error: ${_e.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,B){let{provider:_e,model:be}=B;B=null,(_e!==z||be!==X)&&ie(_e,be)}}))},K=(V,Y)=>{if(!(V===z&&Y===X)){if(T){B={provider:V,model:Y};return}ie(V,Y)}};e.addEventListener("change",V=>{let Y=V.target;if(!Y)return;if(Y.matches(".aipkit_chatbot_provider_select")){let _e=Y.value||"",be=U(_e);K(_e,be),O&&O.classList.contains("aipkit-active")&&So(),io(),Yo(),Lr(),oi(),pt();return}let ne=Y.closest(".aipkit_chatbot_model_field select");if(ne){let _e=q.value||"",be=ne.value||"";K(_e,be),io(),Yo()}})}e.dataset.modelAutosaveBound="1"}if($i&&!e.dataset.deployWizardBound){let q=e.querySelector("[data-aipkit-top-mode-select]"),T=e.querySelector('textarea[name="embed_allowed_domains"]'),B=e.querySelector("[data-aipkit-appearance-popup-select]"),U=e.querySelector('select[name="aipkit_deploy_popup_scope"]'),z=Array.from(e.querySelectorAll("[data-aipkit-popup-options]")),X=Array.from(e.querySelectorAll(".aipkit_interface_popup_scope_row")),ie=e.querySelector("[data-aipkit-popup-launcher-cell]"),K=ie?ie.closest(".aipkit_interface_theme_top_row--primary"):null;if(q||B||U||z.length){let V=fe=>fe==="popup"||fe==="external"?fe:"inline",Y=()=>B?B.value==="1"?"popup":"inline":z.some(fe=>!fe.hidden)?"popup":"inline",ne=()=>q?V(q.value):Y(),_e=()=>U&&U.value==="sitewide"?"sitewide":"page",be=fe=>{let Xe=e.querySelector(".aipkit_sidebar_toggle_group");if(!Xe)return;let we=Xe.querySelector(".aipkit_sidebar_toggle_switch"),xe=Xe.querySelector(".aipkit_interface_toggle_label");if(!we)return;let at=Xe.getAttribute("data-tooltip-disabled")||"";if(fe){if(we.getAttribute("data-original-state")===null){let vt=we.tagName==="SELECT"?we.value==="1"?"checked":"unchecked":we.checked?"checked":"unchecked";we.setAttribute("data-original-state",vt)}we.tagName==="SELECT"?we.value="0":we.checked=!1,we.disabled=!0,Xe.setAttribute("title",at),we.setAttribute("title",at),xe&&xe.setAttribute("title",at),Xe.classList.add("aipkit-disabled-tooltip"),xe&&(xe.style.opacity="0.6")}else we.disabled=!1,Xe.removeAttribute("title"),we.removeAttribute("title"),xe&&xe.removeAttribute("title"),Xe.classList.remove("aipkit-disabled-tooltip"),xe&&(xe.style.opacity="1"),we.getAttribute("data-original-state")==="checked"&&(we.tagName==="SELECT"?we.value="1":we.checked=!0),we.removeAttribute("data-original-state")},Ge=fe=>{let Xe=O||F;if(!Xe)return;let we=Xe.querySelectorAll('[data-popup-only="header-identity"]');we.length&&we.forEach(xe=>{xe.hidden=!fe})},kt=fe=>{let Xe=e.querySelector(".aipkit_popup_status_text_group");if(!Xe)return;let we=Xe.querySelector('input[name="header_online_text"]');if(!we)return;let xe=Xe.querySelector(".aipkit_popover_option_label"),at=Xe.getAttribute("data-tooltip-disabled")||"";if(fe){we.disabled=!1,Xe.removeAttribute("title"),we.removeAttribute("title"),xe&&xe.removeAttribute("title"),Xe.classList.remove("aipkit-disabled-tooltip");return}we.disabled=!0,at&&(Xe.setAttribute("title",at),we.setAttribute("title",at),xe&&xe.setAttribute("title",at)),Xe.classList.add("aipkit-disabled-tooltip")},Lt=fe=>{ie&&(ie.hidden=!fe,ie.setAttribute("aria-hidden",fe?"false":"true"),K&&K.classList.toggle("aipkit_interface_theme_top_row--no-launcher",!fe),fe||ya())},Ot=()=>{let fe=ne(),Xe=fe==="popup";B&&fe!=="external"&&(B.value=fe==="popup"?"1":"0"),z.forEach(we=>{if(we.hidden=!Xe,!Xe){let xe=we.querySelector(".aipkit_accordion_header"),at=we.querySelector(".aipkit_accordion_body");xe&&at&&(xe.setAttribute("aria-expanded","false"),at.hidden=!0),(we.getAttribute("data-aipkit-accordion")||"")==="popup"&&a()==="popup"&&s("")}}),X.forEach(we=>{we.hidden=!Xe}),U&&(U.disabled=!Xe),be(Xe),Ge(Xe),kt(Xe),Lt(Xe),Te&&Te.classList.contains("is-open")&&(Xe&&We?window.requestAnimationFrame(()=>{zo(We)}):yr())},Ii=()=>{if(!rn)return;rn.classList.add("aipkit-active"),rn.setAttribute("aria-hidden","false");let fe=rn.querySelector('textarea[name="embed_allowed_domains"]')||rn.querySelector(".aipkit_copy_embed_code_btn");fe&&typeof fe.focus=="function"&&window.setTimeout(()=>fe.focus(),0)},ft=()=>{rn&&(rn.classList.remove("aipkit-active"),rn.setAttribute("aria-hidden","true"))},yi=null,Xt=!1,Ct=null,Gt=()=>{let fe=ne(),Xe=Y(),xe=(fe==="external"?Xe:fe)==="popup"?"1":"0",at=xe==="1"&&_e()==="sitewide"?"1":"0",vt={popup_enabled:xe,site_wide_enabled:at};return T&&(vt.embed_allowed_domains=T.value||""),vt};yi=Gt();let dt=fe=>{let Xe=v&&v.value||e.getAttribute("data-active-bot-id");if(!Xe||!fe)return;Xt=!0,st("Auto-saving...","");let we={bot_id:Xe,popup_enabled:fe.popup_enabled,site_wide_enabled:fe.site_wide_enabled};Object.prototype.hasOwnProperty.call(fe,"embed_allowed_domains")&&(we.embed_allowed_domains=fe.embed_allowed_domains),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",we).then(xe=>{yi=fe,st(xe.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Xe),Oi()}).catch(xe=>{st(`Error: ${xe.message||"Failed to save."}`,"error")}).finally(()=>{if(Xt=!1,Ct){let xe=Ct;Ct=null,(!yi||JSON.stringify(xe)!==JSON.stringify(yi))&&dt(xe)}})},ye=fe=>{if(fe&&!(yi&&JSON.stringify(fe)===JSON.stringify(yi))){if(Xt){Ct=fe;return}dt(fe)}};if(q&&q.addEventListener("change",()=>{q.value=V(q.value),B&&q.value!=="external"&&(B.value=q.value==="popup"?"1":"0"),q.value==="external"?Ii():ft(),Ot(),ye(Gt())}),B&&B.addEventListener("change",()=>{B.value=B.value==="1"?"1":"0",q&&q.value!=="external"&&(q.value=B.value==="1"?"popup":"inline"),Ot(),ye(Gt())}),U&&U.addEventListener("change",()=>{U.value=U.value==="sitewide"?"sitewide":"page",Ot(),ye(Gt())}),T){let fe=null,Xe=()=>{fe&&clearTimeout(fe),fe=setTimeout(()=>{ye(Gt())},350)};T.addEventListener("input",Xe),T.addEventListener("change",()=>{fe&&(clearTimeout(fe),fe=null),ye(Gt())}),T.addEventListener("blur",()=>{fe&&(clearTimeout(fe),fe=null),ye(Gt())})}rn&&rn.dataset.bound!=="1"&&(fa&&fa.addEventListener("click",ft),dr&&dr.addEventListener("click",ft),rn.addEventListener("click",fe=>{fe.target===rn&&ft()}),document.addEventListener("keydown",fe=>{fe.key==="Escape"&&rn.classList.contains("aipkit-active")&&ft()}),rn.dataset.bound="1"),Ot(),e.dataset.deployWizardBound="1"}}if(R&&$i&&!e.dataset.aiParamsAutosaveBound){let q=!1,T=null,B=()=>{let Y=Ge=>ce&&ce.querySelector(Ge)||R.querySelector(Ge),ne=Y('[name="temperature"]'),_e=Y('[name="max_completion_tokens"]'),be=Y('[name="max_messages"]');return{temperature:ne?ne.value:"",maxTokens:_e?_e.value:"",maxMessages:be?be.value:""}},{temperature:U,maxTokens:z,maxMessages:X}=B(),ie=(Y,ne,_e)=>{let be=v&&v.value||e.getAttribute("data-active-bot-id");!be||Y===""||ne===""||_e===""||(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:be,temperature:Y,max_completion_tokens:ne,max_messages:_e}).then(Ge=>{U=Y,z=ne,X=_e,st(Ge.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(be),Oi()}).catch(Ge=>{st(`Error: ${Ge.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let{temperature:Ge,maxTokens:kt,maxMessages:Lt}=T;T=null,(Ge!==U||kt!==z||Lt!==X)&&ie(Ge,kt,Lt)}}))},K=(Y,ne,_e)=>{if(!(Y===U&&ne===z&&_e===X)){if(q){T={temperature:Y,maxTokens:ne,maxMessages:_e};return}ie(Y,ne,_e)}},V=Y=>{let ne=Y.target;if(ne&&(ne.matches('[name="temperature"]')||ne.matches('[name="max_completion_tokens"]')||ne.matches('[name="max_messages"]'))){let{temperature:_e,maxTokens:be,maxMessages:Ge}=B();K(_e,be,Ge)}};R.addEventListener("change",V),ce&&ce.addEventListener("change",V),e.dataset.aiParamsAutosaveBound="1"}if((Bt||R)&&$i&&!e.dataset.webSettingsAutosaveBound){let q=!1,T=null,B=()=>{let K=Y=>{let ne=Bt?Bt.querySelector(Y):null;return ne?ne.value:""},V=Y=>{let ne=R&&R.querySelector(Y)||e&&e.querySelector(Y)||Bt&&Bt.querySelector(Y);return ne?ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0":"0"};return{openai_web_search_enabled:V(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:K('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:K('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:K('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:K('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:K('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:K('[name="openai_web_search_loc_timezone"]'),claude_web_search_enabled:V(".aipkit_claude_web_search_enable_toggle"),claude_web_search_max_uses:K('[name="claude_web_search_max_uses"]'),claude_web_search_loc_type:K('[name="claude_web_search_loc_type"]'),claude_web_search_loc_country:K('[name="claude_web_search_loc_country"]'),claude_web_search_loc_city:K('[name="claude_web_search_loc_city"]'),claude_web_search_loc_region:K('[name="claude_web_search_loc_region"]'),claude_web_search_loc_timezone:K('[name="claude_web_search_loc_timezone"]'),claude_web_search_allowed_domains:K('[name="claude_web_search_allowed_domains"]'),claude_web_search_blocked_domains:K('[name="claude_web_search_blocked_domains"]'),claude_web_search_cache_ttl:K('[name="claude_web_search_cache_ttl"]'),openrouter_web_search_enabled:V(".aipkit_openrouter_web_search_enable_toggle"),openrouter_web_search_engine:K('[name="openrouter_web_search_engine"]'),openrouter_web_search_max_results:K('[name="openrouter_web_search_max_results"]'),openrouter_web_search_search_prompt:K('[name="openrouter_web_search_search_prompt"]'),google_search_grounding_enabled:V(".aipkit_google_search_grounding_enable_toggle"),web_toggle_default_on:V(".aipkit_web_toggle_default_on"),google_grounding_mode:K('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:K('[name="google_grounding_dynamic_threshold"]')}},U=B(),z=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:V,...K}).then(Y=>{U=K,st(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{st(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&z(Y)}}))},X=K=>{if(JSON.stringify(K)!==JSON.stringify(U)){if(q){T=K;return}z(K)}},ie=K=>{let V=K.target;V&&(V.matches(".aipkit_openai_web_search_enable_toggle")||V.matches(".aipkit_openai_web_search_loc_type_select")||V.matches('[name="openai_web_search_context_size"]')||V.matches('[name="openai_web_search_loc_country"]')||V.matches('[name="openai_web_search_loc_city"]')||V.matches('[name="openai_web_search_loc_region"]')||V.matches('[name="openai_web_search_loc_timezone"]')||V.matches(".aipkit_claude_web_search_enable_toggle")||V.matches(".aipkit_claude_web_search_loc_type_select")||V.matches('[name="claude_web_search_max_uses"]')||V.matches('[name="claude_web_search_loc_country"]')||V.matches('[name="claude_web_search_loc_city"]')||V.matches('[name="claude_web_search_loc_region"]')||V.matches('[name="claude_web_search_loc_timezone"]')||V.matches('[name="claude_web_search_allowed_domains"]')||V.matches('[name="claude_web_search_blocked_domains"]')||V.matches('[name="claude_web_search_cache_ttl"]')||V.matches(".aipkit_openrouter_web_search_enable_toggle")||V.matches('[name="openrouter_web_search_engine"]')||V.matches('[name="openrouter_web_search_max_results"]')||V.matches('[name="openrouter_web_search_search_prompt"]')||V.matches(".aipkit_google_search_grounding_enable_toggle")||V.matches(".aipkit_web_toggle_default_on")||V.matches(".aipkit_google_grounding_mode_select")||V.matches('[name="google_grounding_dynamic_threshold"]'))&&(io(),X(B()))};R&&R.addEventListener("change",ie),Bt&&(!R||!R.contains(Bt))&&Bt.addEventListener("change",ie),e.dataset.webSettingsAutosaveBound="1"}if((Vt||R)&&$i&&!e.dataset.contextSettingsAutosaveBound){let q=!1,T=null,B=()=>{let ee=me=>{let Ie=Ae(),Me=Ie?Ie.querySelector(me):null;return Me?Me.value:""},oe=me=>{let Ie=R&&R.querySelector(me)||e&&e.querySelector(me)||Vt&&Vt.querySelector(me);return Ie?Ie.tagName==="SELECT"?Ie.value==="1"?"1":"0":Ie.checked?"1":"0":"0"},le=me=>{let Ie=Ae(),Me=Ie?Ie.querySelector(me):null;return Me?Array.from(Me.selectedOptions).map(qe=>qe.value).filter(Boolean):[]};return{enable_vector_store:oe(".aipkit_vector_store_enable_select"),vector_store_provider:ee('[name="vector_store_provider"]'),openai_vector_store_ids:le('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:ee('[name="pinecone_index_name"]'),qdrant_collection_names:le('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:ee('[name="vector_embedding_provider"]'),vector_embedding_model:ee('[name="vector_embedding_model"]'),vector_store_top_k:ee('[name="vector_store_top_k"]'),vector_store_confidence_threshold:ee('[name="vector_store_confidence_threshold"]'),content_aware_enabled:oe(".aipkit_content_aware_enable_select")}},U=B(),z=R&&R.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||Vt&&Vt.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||Vt&&Vt.querySelector(".aipkit_popover_status_inline")||R&&R.querySelector(".aipkit_popover_status_inline")||null,X=(ee,oe)=>{z&&(z.textContent=ee||"",z.classList.remove("success","error","loading"),oe&&z.classList.add(oe),z.style.display=ee?"inline-block":"none")},ie=()=>{z&&setTimeout(()=>{z.textContent="",z.classList.remove("success","error","loading"),z.style.display="none"},2500)},K=!1,V=null,Y={},ne=Ae();ne&&ne.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(ee=>{Y[ee.name]=ee.value});let _e=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:oe,qdrantKeyInput:le}=rt(),me=!!(ee&&ee.value.trim()||g),Ie=!!(oe&&oe.value.trim()||w),Me=!!(le&&le.value.trim()||_);return{pinecone:me,qdrant:Ie&&Me}},be=0,Ge=(ee,oe)=>ee?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(ee,{silent:!0,showErrors:!1,targetSelectId:oe,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,ee,{silent:!0,showErrors:!1,targetSelectId:oe,propagateError:!0}):null:null,kt=(ee,oe)=>{let le=++be;X("Syncing...","loading");let me=Ge(ee,oe);if(me&&typeof me.then=="function"){me.then(()=>{be===le&&(X("Synced","success"),ie())}).catch(Ie=>{be===le&&X(`Error: ${Ie.message||"Sync failed."}`,"error")});return}ie()},Lt=ee=>{let oe=_e();if(ee==="pinecone"&&oe.pinecone){let{pineconeIndexSelect:le}=rt();kt("PineconeIndexes",le?le.id:"")}else if(ee==="qdrant"&&oe.qdrant){let{qdrantCollectionsSelect:le}=rt();kt("QdrantCollections",le?le.id:"")}},Ot=ee=>{!ee||!Object.keys(ee).length||(K=!0,X("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",ee).then(oe=>{Object.keys(ee).forEach(le=>{Y[le]=ee[le]}),Object.prototype.hasOwnProperty.call(ee,"pinecone_api_key")&&Lt("pinecone"),(Object.prototype.hasOwnProperty.call(ee,"qdrant_url")||Object.prototype.hasOwnProperty.call(ee,"qdrant_api_key"))&&Lt("qdrant"),X(oe.message||"Saved","success"),ie()}).catch(oe=>{X(`Error: ${oe.message||"Failed to save."}`,"error")}).finally(()=>{if(K=!1,V){let oe=V;V=null,Ot(oe)}}))},Ii=ee=>{if(!ee)return;let oe=Object.keys(ee).reduce((le,me)=>(ee[me]!==Y[me]&&(le[me]=ee[me]),le),{});if(Object.keys(oe).length){if(K){V={...V||{},...oe};return}Ot(oe)}},ft=ee=>{let oe=v&&v.value||e.getAttribute("data-active-bot-id");oe&&(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:oe,...ee}).then(le=>{U=ee,st(le.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(oe),Oi()}).catch(le=>{st(`Error: ${le.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let le=T;T=null,JSON.stringify(le)!==JSON.stringify(U)&&ft(le)}}))},yi=ee=>{if(JSON.stringify(ee)!==JSON.stringify(U)){if(q){T=ee;return}ft(ee)}},Xt=ee=>{let oe=ee.target;if(oe){if(oe.matches('[name="pinecone_api_key"]')||oe.matches('[name="qdrant_url"]')||oe.matches('[name="qdrant_api_key"]')){let le=oe.value||"";Ii({[oe.name]:le}),pt(),Ln(B());return}if(oe.matches(".aipkit_vector_store_enable_select")||oe.matches(".aipkit_vector_store_provider_select")||oe.matches('select[name="openai_vector_store_ids[]"]')||oe.matches('select[name="qdrant_collection_names[]"]')||oe.matches('[name="pinecone_index_name"]')||oe.matches(".aipkit_vector_embedding_select")||oe.matches('[name="vector_embedding_provider"]')||oe.matches('[name="vector_embedding_model"]')||oe.matches('[name="vector_store_top_k"]')||oe.matches('[name="vector_store_confidence_threshold"]')||oe.matches('[name="content_aware_enabled"]')){if(oe.matches(".aipkit_vector_embedding_select")&&rs(oe),oe.matches(".aipkit_vector_store_enable_select")&&(nn(),Lt(B().vector_store_provider)),oe.matches(".aipkit_vector_store_provider_select")&&(ai(),Lt(oe.value||""),oi(),pt()),oe.matches('[name="vector_embedding_provider"]')){let me=Ae();me&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(me),Pr(me)}if(oe.matches('[name="vector_embedding_model"]')){let me=Ae();Pr(me)}let le=B();yi(le),pt(),Ln(le),ye(le),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};R&&R.addEventListener("change",Xt),Vt&&Vt.addEventListener("change",Xt);let Ct=(ee,oe)=>{Fn&&(Fn.textContent=ee||"",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ee&&Fn.classList.add("is-visible"),oe&&Fn.classList.add(`is-${oe}`))},Gt=(ee=2500)=>{Fn&&setTimeout(()=>{Fn.textContent="",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},ee)},dt=(ee,oe="info")=>{if(Un){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(ee||"",oe,Un.id);return}Un.textContent=ee||""}},ye=(ee=null)=>{if(!pn)return;let oe=ee||B();if(!oe||oe.enable_vector_store!=="1"){pn.innerHTML='<option value=""></option>',pn.value="";return}let le="";oe.vector_store_provider==="openai"?le=(Array.isArray(oe.openai_vector_store_ids)?oe.openai_vector_store_ids.filter(Boolean):[])[0]||"":oe.vector_store_provider==="pinecone"?le=oe.pinecone_index_name||"":oe.vector_store_provider==="qdrant"&&(le=(Array.isArray(oe.qdrant_collection_names)?oe.qdrant_collection_names.filter(Boolean):[])[0]||""),pn.innerHTML=le?`<option value="${le}">${le}</option>`:'<option value=""></option>',pn.value=le,pn.dispatchEvent(new Event("change"))},fe=()=>$n&&$n.value||"bulk",Xe=ee=>{let oe=ee==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",le=document.getElementById(oe);return le?Array.from(le.selectedOptions).map(me=>me.value).filter(Boolean):[]},we=ee=>{let oe=ee==="specific"?Mo:Po;return oe&&oe.value||"publish"},xe=()=>{let ee=document.getElementById("aipkit_vs_wp_content_list_area");return ee?Array.from(ee.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(oe=>oe.value):[]},at=(ee,oe,le)=>{if(!oe)return;oe.innerHTML="";let me=Number(ee?.total_posts||0),Ie=Number(ee?.total_pages||0),Me=Number(ee?.current_page||1);if(!me)return;let qe=document.createElement("span");if(qe.className="aipkit_pagination-count",qe.textContent=`${me.toLocaleString()} ${d("item","items",me,"gpt3-ai-content-generator")}`,oe.appendChild(qe),Ie<=1)return;let et=document.createElement("span");et.className="aipkit_pagination-links";let ut=document.createElement("button");ut.type="button",ut.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",ut.textContent=i("Prev","gpt3-ai-content-generator"),ut.disabled=Me<=1,ut.addEventListener("click",()=>le(Me-1));let wi=document.createElement("span");wi.className="aipkit_pagination-current",wi.textContent=`${Me}/${Ie}`;let Nt=document.createElement("button");Nt.type="button",Nt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Nt.textContent=i("Next","gpt3-ai-content-generator"),Nt.disabled=Me>=Ie,Nt.addEventListener("click",()=>le(Me+1)),et.appendChild(ut),et.appendChild(wi),et.appendChild(Nt),oe.appendChild(et)},vt=(ee,oe)=>{if(!Dn)return;if(Dn.innerHTML="",!Array.isArray(ee)||!ee.length){let qe=document.createElement("p");qe.className="aipkit_builder_help_text",qe.textContent=i("No posts found for selection.","gpt3-ai-content-generator"),Dn.appendChild(qe),sa&&(sa.innerHTML="");return}let le=document.createElement("ul"),me=document.createElement("div");me.className="aipkit_wp_content_select_all_wrapper";let Ie=document.createElement("label");Ie.className="aipkit_training_site_option";let Me=document.createElement("input");Me.type="checkbox",Me.checked=ee.every(qe=>an.selectedIds.has(String(qe.id))),Ie.appendChild(Me),Ie.appendChild(document.createTextNode(i("Select all","gpt3-ai-content-generator"))),me.appendChild(Ie),Dn.appendChild(me),Dn.appendChild(le),ee.forEach(qe=>{let et=document.createElement("li");et.className="aipkit_wp_content_list_item";let ut=document.createElement("input");ut.type="checkbox",ut.name="wp_content_to_index[]",ut.value=String(qe.id),ut.checked=an.selectedIds.has(String(qe.id)),ut.addEventListener("change",()=>{ut.checked?an.selectedIds.add(String(qe.id)):an.selectedIds.delete(String(qe.id)),Me.checked=ee.every(wn=>an.selectedIds.has(String(wn.id)))});let wi=document.createElement("a");wi.className="aipkit_wp_content_title",wi.href=qe.edit_link||"#",wi.target="_blank",wi.rel="noopener noreferrer",wi.textContent=qe.title||i("Untitled","gpt3-ai-content-generator");let Nt=document.createElement("span");Nt.className="aipkit_wp_content_type",Nt.textContent=qe.type_label||"";let vi=document.createElement("span");vi.className="aipkit_wp_content_indexed_status",vi.textContent=qe.is_already_indexed?i("Indexed","gpt3-ai-content-generator"):"",et.appendChild(ut),et.appendChild(wi),et.appendChild(Nt),et.appendChild(vi),le.appendChild(et)}),Me.addEventListener("change",()=>{Me.checked?ee.forEach(qe=>an.selectedIds.add(String(qe.id))):ee.forEach(qe=>an.selectedIds.delete(String(qe.id))),Dn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(qe=>{qe.checked=Me.checked})}),at(oe,sa,ri)},ri=async ee=>{if(!Dn)return;let oe=fe(),le=Xe(oe);if(!le.length){Dn.innerHTML="",sa&&(sa.innerHTML=""),dt(i("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let me=Ri("aipkit_wp_content_fetch_nonce");if(!me){dt(i("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let Ie=we(oe),Me=pn&&pn.value||"";try{dt(i("Loading content...","gpt3-ai-content-generator"),"");let qe=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:me,post_types:le,post_status:Ie,target_store_id:Me,paged:ee});an.page=ee,vt(qe.posts||[],qe.pagination||{}),dt("","")}catch(qe){dt(qe&&qe.message?qe.message:i("Failed to load content.","gpt3-ai-content-generator"),"error")}},Zt=ee=>{$n&&($n.value=ee),Fo&&(Fo.hidden=ee!=="bulk"),nr&&(nr.hidden=ee!=="specific"),ir&&(ir.hidden=ee!=="specific"),da&&(da.hidden=ee!=="bulk"),sr&&(sr.hidden=ee!=="specific"),Yt&&(Yt.hidden=ee!=="bulk"),ee==="specific"&&ri(1)},si=()=>{e.querySelectorAll(".aipkit_training_site_dropdown").forEach(oe=>{let le=oe.querySelector(".aipkit_training_site_dropdown_btn"),me=oe.querySelector(".aipkit_training_site_dropdown_label"),Ie=oe.querySelector(".aipkit_training_site_dropdown_panel"),qe=oe.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",et=document.getElementById(qe);if(!le||!Ie||!et)return;let ut=()=>{let Nt=Ie.querySelectorAll('input[type="checkbox"]:checked'),vi=oe.dataset.placeholder||i("Select types","gpt3-ai-content-generator"),wn=oe.dataset.selectedLabel||i("selected","gpt3-ai-content-generator");me&&(Nt.length?me.textContent=`${Nt.length} ${wn}`:me.textContent=vi)},wi=()=>{let Nt=Array.from(Ie.querySelectorAll('input[type="checkbox"]:checked')).map(vi=>vi.value);Array.from(et.options).forEach(vi=>{vi.selected=Nt.includes(vi.value)})};le.addEventListener("click",()=>{let Nt=le.getAttribute("aria-expanded")==="true";le.setAttribute("aria-expanded",Nt?"false":"true"),Ie.hidden=Nt}),Ie.addEventListener("change",()=>{wi(),ut(),fe()==="specific"&&ri(1)}),document.addEventListener("click",Nt=>{oe.contains(Nt.target)||(le.setAttribute("aria-expanded","false"),Ie.hidden=!0)}),wi(),ut()})},zt=async(ee,oe,le)=>{let me=Ri("aipkit_wp_content_fetch_nonce");if(!me||!ee.length)return{total:0};let Ie=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:me,post_types:ee,post_status:oe,target_store_id:le||"",paged:1}),Me=parseInt(Ie?.pagination?.total_posts||0,10);return{total:Number.isNaN(Me)?0:Me,totalPages:parseInt(Ie?.pagination?.total_pages||1,10)}},Pi=async(ee,oe,le)=>{let me=Ri("aipkit_wp_content_fetch_nonce");if(!me)throw new Error("WP content fetch nonce missing.");let Ie=[],Me=1,qe=1;do{let et=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:me,post_types:ee,post_status:oe,target_store_id:le||"",paged:Me}),ut=Array.isArray(et?.posts)?et.posts:[];ut.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},ut.forEach(Nt=>{Nt&&Nt.id&&(window.aipkit_wpContentTitleMap[String(Nt.id)]=Nt.title||window.aipkit_wpContentTitleMap[String(Nt.id)]||"")})),Ie.push(...ut.map(Nt=>String(Nt.id)));let wi=parseInt(et?.pagination?.total_pages||1,10);qe=Number.isNaN(wi)?1:wi,dt(`Preparing... collected ${Ie.length} item(s).`,"info"),Me+=1}while(Me<=qe);return Ie},Ei=(ee,oe)=>ee<=200||oe!=="publish"?Promise.resolve(!1):new Promise(le=>{let me=document.getElementById("aipkit_background_indexing_confirm"),Ie=document.getElementById("aipkit_background_indexing_message"),Me=document.getElementById("aipkit_background_indexing_yes"),qe=document.getElementById("aipkit_background_indexing_no"),et=document.getElementById("aipkit_wp_content_bulk_hint");if(!me||!Ie||!Me||!qe){le(window.confirm(`You're about to index ${ee} items. Run in the background?`));return}Ie.textContent=`You're about to index ${ee} items. Run in the background?`,et&&(et.hidden=!0),me.hidden=!1;let ut=()=>{me.hidden=!0,et&&(et.hidden=!1),Me.removeEventListener("click",wi),qe.removeEventListener("click",Nt)},wi=()=>{ut(),le(!0)},Nt=()=>{ut(),le(!1)};Me.addEventListener("click",wi),qe.addEventListener("click",Nt)}),Yi=async({botId:ee,postTypes:oe,provider:le,targetStoreId:me,embeddingProvider:Ie,embeddingModel:Me})=>{let qe=window.aipkit_chat_config?.automationsNonce||"";if(!qe)throw new Error("Automations nonce missing.");let et=`Chatbot ${ee} website indexing`,ut={_ajax_nonce:qe,task_id:0,task_name:et,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:oe,target_store_provider:le,target_store_id:me};return(le==="pinecone"||le==="qdrant")&&(ut.embedding_provider=Ie||"",ut.embedding_model=Me||""),window.aipkit_apiRequest("aipkit_save_automated_task",ut)};if($n&&!e.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),Xn&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!Xn.dataset.listenerAttached&&(Xn.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),Xn.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),Po&&!Po.dataset.listenerAttached&&(Po.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),Po.dataset.listenerAttached="true"),pn&&!pn.dataset.listenerAttached&&(pn.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),pn.dataset.listenerAttached="true")),ye(B()),si(),Bo.length){Bo.forEach(oe=>{oe.dataset.listenerAttached||(oe.addEventListener("change",()=>{Zt(oe.value)}),oe.dataset.listenerAttached="true")});let ee=Array.from(Bo).find(oe=>oe.checked);Zt(ee?ee.value:fe())}else Zt(fe());Mo&&!Mo.dataset.listenerAttached&&(Mo.addEventListener("change",()=>{fe()==="specific"&&ri(1)}),Mo.dataset.listenerAttached="true"),pn&&!pn.dataset.websiteListenerAttached&&(pn.addEventListener("change",()=>{fe()==="specific"&&ri(1)}),pn.dataset.websiteListenerAttached="true"),e.dataset.trainingWebsiteBound="1"}let Co=ee=>`${ee.name}::${ee.size}::${ee.lastModified}`,lo=ee=>{if(!Number.isFinite(ee)||ee<=0)return"0 KB";let oe=["B","KB","MB","GB"],le=ee,me=0;for(;le>=1024&&me<oe.length-1;)le/=1024,me+=1;let Ie=me===0?0:1;return`${le.toFixed(Ie)} ${oe[me]}`},jn=()=>zn&&zn.dataset.upgradeUrl||"",Hn=()=>{if(!Io)return;let ee=Qn.size>0;Io.style.display=ee?"none":""},Xa=(ee=1500)=>{zn&&(mo&&window.clearTimeout(mo),mo=window.setTimeout(()=>{Qn.clear(),zn.innerHTML="",An&&(An.value=""),Hn(),mo=null},ee))},br=()=>Qn.size?Array.from(Qn.values()).every(ee=>{let oe=ee.querySelector(".aipkit_training_file_status");return oe?oe.classList.contains("is-success")||oe.classList.contains("is-error"):!1}):!1,Sr=()=>{mo&&!br()&&(window.clearTimeout(mo),mo=null),br()&&Xa(),Hn()},Sa=ee=>{if(!zn)return null;let oe=Co(ee);if(Qn.has(oe))return Qn.get(oe);let le=document.createElement("div");le.className="aipkit_training_file_row",le.dataset.fileKey=oe;let me=document.createElement("div");me.className="aipkit_training_file_meta";let Ie=document.createElement("span");Ie.className="aipkit_training_file_name",Ie.textContent=ee.name;let Me=document.createElement("span");Me.className="aipkit_training_file_size",Me.textContent=lo(ee.size);let qe=document.createElement("span");return qe.className="aipkit_training_file_status",qe.textContent="Queued",me.appendChild(Ie),me.appendChild(Me),le.appendChild(me),le.appendChild(qe),zn.appendChild(le),Qn.set(oe,le),le},on=(ee,oe,le)=>{let me=Sa(ee);if(!me)return;let Ie=me.querySelector(".aipkit_training_file_status");if(Ie){if(Ie.textContent="",Ie.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),le&&Ie.classList.add(`is-${le}`),oe==="Upgrade"&&jn()){Ie.classList.add("is-upgrade");let Me=document.createElement("a");Me.className="aipkit_training_file_upgrade",Me.href=jn(),Me.textContent=oe,Ie.appendChild(Me)}else Ie.textContent=oe;Sr()}},Xo=async(ee,oe=null)=>{if(!ee||!ee.name||typeof window.aipkit_apiRequest!="function")return!1;let le=v&&v.value||e.getAttribute("data-active-bot-id");if(!le)return!1;let me=oe||B();if(!me||me.enable_vector_store!=="1")return!1;let Ie=String(ee.name||"").trim();if(!Ie)return!1;let Me=vi=>String(vi||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),qe=Me(Ie),et=Ie.replace(/\.[^/.]+$/,""),ut=[Ie,qe,et&&et!==Ie?et:""].filter(Boolean),wi=async(vi,wn)=>{let mn=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:le,page:1,per_page:wn,search:vi||"",enable_vector_store:me.enable_vector_store,vector_store_provider:me.vector_store_provider,openai_vector_store_ids:me.openai_vector_store_ids||[],pinecone_index_name:me.pinecone_index_name,qdrant_collection_names:me.qdrant_collection_names||[]});return Array.isArray(mn.logs)?mn.logs:[]},Nt=(vi,wn)=>{if(!vi.length)return null;let mn=wn.map(Me).filter(Boolean);return vi.find(qn=>{let xo=Me(qn.message),Ni=Me(qn.post_title),it=Me(qn.file_id);return mn.some(St=>xo&&xo.includes(St)||Ni&&Ni.includes(St)||it&&it.includes(St))})||null};try{for(let mn of ut){let qn=await wi(mn,10),xo=Nt(qn,[mn,qe]);if(xo){let Ni=String(xo.status||"").toLowerCase();if(Ni==="indexed"||Ni==="skipped_already_indexed")return on(ee,"Trained","success"),!0;if(Ni==="failed")return on(ee,"Failed","error"),!0;if(Ni==="processing"||Ni==="queued")return on(ee,"Processing","loading"),!0}}let vi=await wi("",20),wn=Nt(vi,ut);if(wn){let mn=String(wn.status||"").toLowerCase();if(mn==="indexed"||mn==="skipped_already_indexed")return on(ee,"Trained","success"),!0;if(mn==="failed")return on(ee,"Failed","error"),!0;if(mn==="processing"||mn==="queued")return on(ee,"Processing","loading"),!0}}catch{}return!1},Zo=(ee,oe,le,me=0)=>{if(!ee||!oe||!le)return;if(me>=30){Xo(le,B()).then(qe=>{qe||on(le,"Queued","warning")});return}let Me=Ri("aipkit_vector_store_nonce_openai");if(!Me||typeof window.aipkit_apiRequest!="function"){Xo(le,B());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:ee,batch_id:oe,_ajax_nonce:Me}).then(qe=>{let et=(qe.status||"").toLowerCase();if(et==="completed"){on(le,"Trained","success"),Ln(B()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(et==="failed"||et==="cancelled"){on(le,"Failed","error");return}on(le,"Processing","loading"),setTimeout(()=>{Zo(ee,oe,le,me+1)},2500)}).catch(()=>{setTimeout(()=>{Zo(ee,oe,le,me+1)},3e3)})},po=ee=>{if(!kn)return;let oe=kn.dataset.baseLabel||kn.querySelector(".aipkit_training_sources_label")?.textContent.trim()||kn.textContent.replace(/\(\d+\)/,"").trim(),le=Number.isFinite(ee)?ee:0,me=kn.querySelector(".aipkit_training_sources_count");me?(me.textContent=String(le),kn.setAttribute("aria-label",`${oe} (${le})`)):kn.textContent=`${oe} (${le})`},Ln=async(ee=null)=>{if(!kn||typeof window.aipkit_apiRequest!="function")return;if(ee&&ee.enable_vector_store!=="1"){po(0);return}let oe=ee?ee.vector_store_provider:"";if(oe==="openai"&&!(Array.isArray(ee.openai_vector_store_ids)?ee.openai_vector_store_ids:[]).length){po(0);return}if(oe==="pinecone"&&!ee.pinecone_index_name){po(0);return}if(oe==="qdrant"&&!(Array.isArray(ee.qdrant_collection_names)?ee.qdrant_collection_names:[]).length){po(0);return}let le=v&&v.value||e.getAttribute("data-active-bot-id");if(!le){po(0);return}try{let me={bot_id:le};ee&&(me.enable_vector_store=ee.enable_vector_store,me.vector_store_provider=ee.vector_store_provider,me.openai_vector_store_ids=ee.openai_vector_store_ids||[],me.pinecone_index_name=ee.pinecone_index_name,me.qdrant_collection_names=ee.qdrant_collection_names||[]);let Ie=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",me),Me=Number(Ie.count||0);po(Number.isNaN(Me)?0:Me)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{Ln(B())};let Za=()=>{if(!kn||e.dataset.trainingAutoSync)return;let ee=()=>{document.visibilityState==="visible"&&Ln(B())},oe=window.setInterval(ee,6e4);e.dataset.trainingAutoSync="1",e.dataset.trainingAutoSyncInterval=String(oe),document.addEventListener("visibilitychange",ee)},Ri=ee=>{let oe=document.getElementById(ee);return oe?oe.value:""},Ea=ee=>{let oe=String(ee),le=window.aipkit_wpContentTitleMap||{};if(le&&le[oe])return le[oe];if(Dn){let me=Dn.querySelector(`input[name="wp_content_to_index[]"][value="${oe}"]`);if(me){let Ie=me.closest(".aipkit_wp_content_list_item"),Me=Ie?Ie.querySelector(".aipkit_wp_content_title"):null,qe=Me?Me.textContent.trim():"";if(qe)return qe}}return`${i("Post","gpt3-ai-content-generator")} ${oe}`},Tr=(ee,oe,le)=>{let me=Ea(ee);return`${i("Training","gpt3-ai-content-generator")}: ${me} (${oe+1}/${le})`},Gr=async ee=>{let oe=Ri("aipkit_wp_content_fetch_nonce");if(!oe)throw new Error("WP content fetch nonce missing.");let le=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:oe,get_content_for_ids:[String(ee)]});return(le&&le.posts_content?le.posts_content:{})[String(ee)]||null},Kr=async(ee,oe,le)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let me=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ee,embedding_provider:oe,embedding_model:le,_ajax_nonce:window.aipkit_dashboard.nonce}),Ie=me.embeddings&&me.embeddings.length?me.embeddings[0]:null;if(!Ie)throw new Error("Failed to generate embedding.");return Ie},ts=async(ee,oe)=>{let le=Array.isArray(ee)?ee:[];if(le.length)for(let me=0;me<le.length;me+=1){if(window.aipkit_isIndexingStopped){dt(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let Ie=le[me];dt(Tr(Ie,me,le.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...oe,post_ids:[Ie]})}},is=async(ee,oe)=>{let le=Array.isArray(ee)?ee:[];if(le.length)for(let me=0;me<le.length;me+=1){if(window.aipkit_isIndexingStopped){dt(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let Ie=le[me]||{},Me=Ie.postId||Ie.id;if(!Me)continue;dt(Tr(Me,me,le.length),"info");let qe=await Gr(Me);if(!qe||!qe.content)continue;let et=Ie.metadata&&Ie.metadata.vector_id||`wp_post_${Me}`,ut={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Me,title:qe.title||"",url:qe.edit_link||"",vector_id:et},wi=await Kr(qe.content,oe.embedding_provider,oe.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:oe._ajax_nonce,vectors:JSON.stringify([{id:et,values:wi,metadata:ut}]),embedding_provider:oe.embedding_provider,embedding_model:oe.embedding_model,original_text_content:qe.content,index_name:oe.index_name})}},ns=async(ee,oe)=>{let le=Array.isArray(ee)?ee:[];if(le.length)for(let me=0;me<le.length;me+=1){if(window.aipkit_isIndexingStopped){dt(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let Ie=le[me]||{},Me=Ie.postId||Ie.id;if(!Me)continue;dt(Tr(Me,me,le.length),"info");let qe=await Gr(Me);if(!qe||!qe.content)continue;let et=l(),ut={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Me,title:qe.title||"",url:qe.edit_link||"",vector_id:et},wi=await Kr(qe.content,oe.embedding_provider,oe.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:oe._ajax_nonce,vectors:JSON.stringify([{id:et,vector:wi,payload:ut}]),embedding_provider:oe.embedding_provider,embedding_model:oe.embedding_model,original_text_content:qe.content,collection_name:oe.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=ts),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=is),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=ns);let Er=ee=>ee?Array.isArray(ee)?ee.flatMap(oe=>{if(Array.isArray(oe))return oe;if(oe&&typeof oe=="object"){if(Array.isArray(oe.models))return oe.models;if(Array.isArray(oe.items))return oe.items;if(oe.id)return[oe]}return[]}):typeof ee=="object"?Object.values(ee).flatMap(oe=>Array.isArray(oe)?oe:[]):[]:[],jr=ee=>{let oe=window.aipkit_chat_config||{};return ee==="openai"?Er(oe.openaiEmbeddingModels):ee==="google"?Er(oe.googleEmbeddingModels):ee==="openrouter"?Er(oe.openrouterEmbeddingModels):ee==="azure"?Er(oe.azureEmbeddingModels):[]},os=(ee,oe)=>!ee||!oe?"":`${ee}::${oe}`,as=ee=>{let oe=(ee||"").split("::"),le=oe.shift()||"",me=oe.join("::")||"";return{provider:le,model:me}},Pr=ee=>{if(!ee)return;let oe=ee.querySelector(".aipkit_vector_embedding_select");if(!oe)return;let le=ee.querySelector('[name="vector_embedding_provider"]'),me=ee.querySelector('[name="vector_embedding_model"]'),Ie=le?le.value:"",Me=me?me.value:"",qe=os(Ie,Me);if(!qe||oe.value===qe)return;let et=typeof CSS<"u"&&CSS.escape?CSS.escape(qe):qe.replace(/"/g,'\\"');oe.querySelector(`option[value="${et}"]`)&&(oe.value=qe)},rs=ee=>{let oe=Ae();if(!oe||!ee)return;let le=oe.querySelector('[name="vector_embedding_provider"]'),me=oe.querySelector('[name="vector_embedding_model"]'),Ie=ee.selectedOptions[0],Me=as(ee.value||""),qe=Me.provider||Ie&&Ie.dataset.provider||"",et=Me.model||"";le&&(le.value=qe),me&&(me.value=et),le&&me&&qe&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(me.value=et,window.aipkit_populateVectorEmbeddingModelSelect(oe),et&&(me.value=et))},zr=(ee,oe)=>{if(!oe)return null;let me=jr(ee).find(qe=>qe&&qe.id===oe),Ie=me?.dimensions||me?.dimension||me?.output_dimensionality||me?.outputDimensionality||me?.output_dimension,Me=Ie?Number(Ie):NaN;if(Number.isFinite(Me)&&Me>0)return Me;if(me&&typeof me.name=="string"){let qe=me.name.match(/\((\d{3,5})\)/);if(qe)return Number(qe[1])}return ee==="google"?768:1536},Mr=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:oe,qdrantKeyInput:le}=rt(),me=!!(ee&&ee.value.trim()||g),Ie=!!(oe&&oe.value.trim()||w),Me=!!(le&&le.value.trim()||_);return{openai:m,pinecone:me,qdrant:Ie&&Me}},ss=()=>{let ee=Mr();return ee.openai?"openai":ee.pinecone?"pinecone":ee.qdrant?"qdrant":""},cs=()=>m?"openai":h?"google":E?"azure":"",Qr=()=>{let ee=Ae();if(!ee)return{provider:"",model:""};let oe=ee.querySelector('[name="vector_embedding_provider"]'),le=ee.querySelector('[name="vector_embedding_model"]'),me=oe?oe.value:"";me||(me=cs(),oe&&me&&(oe.value=me,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ee)));let Ie=le?le.value:"";if(!Ie&&me){let Me=jr(me);Ie=Me.length?Me[0].id:"",le&&Ie&&(le.value=Ie)}return Pr(ee),{provider:me,model:Ie}},Cr=ee=>{if(!ee)return"";let le=(ee.selectedOptions?Array.from(ee.selectedOptions):[]).find(me=>me&&me.value);return le?le.value:""},Jr=(ee,oe)=>{!ee||!oe||Array.from(ee.options).forEach(le=>{le.selected=le.value===oe})},ls=async ee=>{let{openaiStoresSelect:oe}=rt(),le=Cr(oe);if(!le&&oe&&(yt(oe),le=Cr(oe)),!le){let me=Ri("aipkit_vector_store_nonce_openai");if(!me)throw new Error("OpenAI vector store nonce missing.");let Ie=`Chatbot ${ee} ${Date.now()}`,Me=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:me,name:Ie,source_type:"chatbot_training_text"}),qe=Me.store||Me;if(!qe||!qe.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(ut=>ut&&ut.id===qe.id)||window.aipkit_chat_config.openaiVectorStores.push(qe),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let ut=Ae();ut&&window.aipkit_populateOpenAIVectorStoresMultiSelect(ut)}oe&&Jr(oe,qe.id),le=qe.id}return le},ds=async(ee,oe)=>{let{pineconeIndexSelect:le}=rt(),me=le?le.value:"";if(!me&&le&&(Dt(le),me=le.value),!me){let Ie=Ri("aipkit_vector_store_pinecone_nonce_management");if(!Ie)throw new Error("Pinecone nonce missing.");let Me=`chatbot-${ee}-${Date.now()}`,qe=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:Ie,name:Me,dimension:oe,metric:"cosine"}),et=qe.index||qe,ut=et?.name||Me;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some(Nt=>Nt&&Nt.name===ut||Nt===ut)||window.aipkit_chat_config.pineconeIndexes.push(et||ut),typeof window.aipkit_populatePineconeIndexSelect=="function"){let Nt=Ae();Nt&&window.aipkit_populatePineconeIndexSelect(Nt)}le&&(le.value=ut),me=ut}return me},ps=async(ee,oe)=>{let{qdrantCollectionsSelect:le}=rt(),me=Cr(le);if(!me&&le&&(yt(le),me=Cr(le)),!me){let Ie=Ri("aipkit_vector_store_qdrant_nonce_management");if(!Ie)throw new Error("Qdrant nonce missing.");let Me=`chatbot-${ee}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:Ie,name:Me,dimension:oe,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(et=>et&&et.name===Me||et===Me||et?.id===Me)||window.aipkit_chat_config.qdrantCollections.push({name:Me}),le){if(!Array.from(le.options).some(ut=>ut.value===Me)){let ut=document.createElement("option");ut.value=Me,ut.textContent=Me,le.appendChild(ut)}Jr(le,Me)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let et=Ae();et&&window.aipkit_populateQdrantCollectionsMultiSelect(et)}me=Me}return me};if(Lo.length&&!e.dataset.trainingTextBound){let ee=!1,oe=qe=>{!Bn||!Rn||(qe?(Bn.hidden=!1,Bn.disabled=!1,Rn.disabled=!0):(Bn.hidden=!0,Bn.disabled=!1,Rn.disabled=!1))},le=()=>{let qe=Go?Go.querySelector(".aipkit_builder_tab.is-active"):null;return qe?qe.dataset.aipkitTab:""},me=()=>{let qe=R?R.querySelector(".aipkit_file_upload_toggle_select"):null;return qe?qe.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};fo&&An&&fo.addEventListener("click",()=>{An.click()});let Ie=async()=>{if(ee)return;let qe=le(),et="",ut="chatbot_training_text",wi=[],Nt=null;if(qe==="text"){if(et=_o?_o.value.trim():"",!et){Ct("Add text to train.","warning"),Gt();return}}else if(qe==="qa"){let it=oa?oa.value.trim():"",St=aa?aa.value.trim():"";if(!it||!St){Ct("Add a question and answer to train.","warning"),Gt();return}et=`Q: ${it}
A: ${St}`,ut="chatbot_training_qa"}else if(qe==="files"){if(!me()){Ct("Upgrade to use file uploads.","warning");return}if(wi=An?Array.from(An.files||[]):[],!wi.length){An&&An.click(),Ct("Choose files to upload.","warning"),Gt();return}ut="chatbot_training_file"}else if(qe==="website"){let it=fe(),St=we(it),Ft=Xe(it),De=xe();if(it==="specific"){if(!De.length){Ct("Select content to train.","warning"),Gt();return}}else if(!Ft.length){Ct("Select at least one post type.","warning"),Gt();return}Nt={mode:it,statusValue:St,postTypes:Ft,selectedPostIds:De}}else{Ct("Select a training tab to continue.","warning"),Gt();return}let vi=v&&v.value||e.getAttribute("data-active-bot-id");if(!vi){Ct("Select a chatbot before training.","error"),Gt();return}let wn=rt(),mn=wn?wn.providerSelect:null,qn=mn?mn.value:"";if(qn==="claude_files"){Ct("Claude Files is available for frontend chat upload only. Use OpenAI, Pinecone, or Qdrant for training.","warning"),Gt();return}let xo=["openai","pinecone","qdrant"],Ni="";if(qn&&xo.includes(qn)?Ni=qn:Ni=ss(),!Ni){Ct("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}ee=!0,oe(!0),Lo.forEach(it=>{it.disabled=!0}),Ct("Preparing training...","loading");try{let it=R&&R.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");it&&(it.tagName==="SELECT"?it.value="1":it.checked=!0),mn&&(mn.value=Ni),nn(),ai();let St="",Ft="",De="",Kt="",Ci="";if(Ni==="openai"){if(!m)throw new Error("OpenAI API key missing.");De=await ls(vi)}else if(Ni==="pinecone"){if(!Mr().pinecone)throw new Error("Pinecone API key missing.");let At=Qr();if(St=At.provider,Ft=At.model,!St||!Ft)throw new Error("Select an embedding provider and model.");let ct=zr(St,Ft);Kt=await ds(vi,ct)}else if(Ni==="qdrant"){if(!Mr().qdrant)throw new Error("Qdrant URL and API key are required.");let At=Qr();if(St=At.provider,Ft=At.model,!St||!Ft)throw new Error("Select an embedding provider and model.");let ct=zr(St,Ft);Ci=await ps(vi,ct)}if(yi(B()),pt(),ye(B()),qe==="files"){Hn();for(let ci=0;ci<wi.length;ci+=1){let At=wi[ci];Ct(`Uploading ${ci+1} of ${wi.length}...`,"loading"),on(At,"Uploading","loading");try{let ct=new FormData;if(Ni==="openai"){let jt=Ri("aipkit_vector_store_nonce_openai");if(!jt)throw new Error("OpenAI vector store nonce missing.");ct.append("aipkit_vs_global_file_to_submit",At),ct.append("target_store_id",De),ct.append("source_type",ut),ct.append("_ajax_nonce",jt);let xi=await window.aipkit_api_upsertFile(ct,"aipkit_upload_and_add_file_to_store_direct_openai");on(At,"Processing","loading");let Qi=xi?.batch?.id;Xo(At,B()).then(xn=>{if(!xn){if(Qi){Zo(De,Qi,At);return}on(At,"Queued","warning")}})}else if(Ni==="pinecone"){let jt=Ri("aipkit_vector_store_pinecone_nonce_management");if(!jt)throw new Error("Pinecone nonce missing.");ct.append("file_to_upload",At),ct.append("index_name",Kt),ct.append("embedding_provider",St),ct.append("embedding_model",Ft),ct.append("_ajax_nonce",jt),await window.aipkit_api_upsertFile(ct,"aipkit_upload_file_and_upsert_to_pinecone"),on(At,"Trained","success")}else if(Ni==="qdrant"){let jt=Ri("aipkit_vector_store_qdrant_nonce_management");if(!jt)throw new Error("Qdrant nonce missing.");ct.append("file_to_upload",At),ct.append("target_store_id",Ci),ct.append("embedding_provider",St),ct.append("embedding_model",Ft),ct.append("source_context","chatbot_settings_file_upload"),ct.append("_ajax_nonce",jt),await window.aipkit_api_upsertFile(ct,"aipkit_upload_file_and_upsert_to_qdrant"),on(At,"Trained","success")}}catch(ct){throw on(At,"Failed","error"),ct}}An&&(An.value=""),Hn(),Ct("Saved","success"),Gt(),Ln(),ee=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if(qe==="website"&&Nt){let{mode:ci,statusValue:At,postTypes:ct,selectedPostIds:jt}=Nt,xi=jt,Qi=xi.length;if(ci==="bulk"){if(Ct("Preparing website content...","loading"),Qi=(await zt(ct,At,De)).total,!Qi){dt("No posts found for selection.","error"),Ct("Nothing to train.","warning"),Gt();return}if(await Ei(Qi,At)){await Yi({botId:vi,postTypes:ct,provider:Ni,targetStoreId:Ni==="openai"?De:Ni==="pinecone"?Kt:Ci,embeddingProvider:St,embeddingModel:Ft}),dt("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),Ct("Queued","success"),Gt(),Ln(B()),ee=!1,oe(!1);return}if(Qi>200&&At!=="publish"&&dt("Background indexing supports published content only.","info"),xi=await Pi(ct,At,De),!xi.length){dt("No posts found for selection.","error"),Ct("Nothing to train.","warning"),Gt();return}}Ct("Training...","loading"),dt(`Training ${Qi||xi.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let xn=Un?Un.id:"aipkit_training_wp_status";if(Ni==="openai"){let bn=Ri("aipkit_wp_content_index_nonce");if(!bn)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(xi,{_ajax_nonce:bn,target_store_id:De,provider:"openai",source_type:"wordpress_content"},xn)}else if(Ni==="pinecone"){let bn=Ri("aipkit_vector_store_pinecone_nonce_management");if(!bn)throw new Error("Pinecone nonce missing.");let no=xi.map(ea=>({id:`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexPineconeBatch(no,{_ajax_nonce:bn,index_name:Kt,embedding_provider:St,embedding_model:Ft,source_type:"wordpress_content"},xn)}else if(Ni==="qdrant"){let bn=Ri("aipkit_vector_store_qdrant_nonce_management");if(!bn)throw new Error("Qdrant nonce missing.");let no=xi.map(ea=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexQdrantBatch(no,{_ajax_nonce:bn,collection_name:Ci,embedding_provider:St,embedding_model:Ft,source_type:"wordpress_content"},xn)}Ct("Saved","success"),Gt(),Ln(B()),ee=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(Ct("Training...","loading"),Ni==="openai"){let ci=Ri("aipkit_vector_store_nonce_openai");if(!ci)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:ci,target_store_id:De,text_content:et,source_type:ut})}else if(Ni==="pinecone"){let ci=Ri("aipkit_vector_store_pinecone_nonce_management");if(!ci)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let At=`text_${Date.now()}`,ct={source:ut,created_at:new Date().toISOString(),original_content:et,vector_id:At},jt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:et,embedding_provider:St,embedding_model:Ft,_ajax_nonce:window.aipkit_dashboard.nonce}),xi=jt.embeddings&&jt.embeddings.length?jt.embeddings[0]:null;if(!xi)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:ci,vectors:JSON.stringify([{id:At,values:xi,metadata:ct}]),embedding_provider:St,embedding_model:Ft,original_text_content:et,index_name:Kt})}else if(Ni==="qdrant"){let ci=Ri("aipkit_vector_store_qdrant_nonce_management");if(!ci)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let At=l(),ct={source:ut,created_at:new Date().toISOString(),original_content:et,vector_id:At},jt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:et,embedding_provider:St,embedding_model:Ft,_ajax_nonce:window.aipkit_dashboard.nonce}),xi=jt.embeddings&&jt.embeddings.length?jt.embeddings[0]:null;if(!xi)throw new Error("Failed to generate embedding.");let Qi={_ajax_nonce:ci,vectors:JSON.stringify([{id:At,vector:xi,payload:ct}]),embedding_provider:St,embedding_model:Ft,original_text_content:et,collection_name:Ci,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Qi)}qe==="text"&&_o&&(_o.value=""),qe==="qa"&&(oa&&(oa.value=""),aa&&(aa.value="")),Ct("Saved","success"),Gt(),Ln(),ee=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(it){Ct(`Error: ${it.message||"Training failed."}`,"error")}finally{ee=!1,oe(!1),Lo.forEach(it=>{it.disabled=!1}),Hn()}},Me=()=>{if(!An)return;let qe=Array.from(An.files||[]);if(qe.length){if(qe.forEach(et=>{Sa(et),on(et,"Queued")}),Hn(),!me()){Ct("Upgrade to use file uploads.","warning"),qe.forEach(et=>{on(et,"Upgrade","warning")});return}Ie()}};An&&An.addEventListener("change",Me),Lo.forEach(qe=>{qe.addEventListener("click",Ie)}),Bn&&!Bn.dataset.listenerAttached&&(Bn.addEventListener("click",()=>{ee&&(window.aipkit_isIndexingStopped=!0,Bn.disabled=!0,Ct("Stopping...","warning"))}),Bn.dataset.listenerAttached="true"),Ln(),Za(),e.dataset.trainingTextBound="1"}if(Ji&&!e.dataset.sourcesSheetBound){let ee=window.aipkit_escapeHtml||function(it){return it},oe={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant",claude_files:"Claude Files"},le={page:1,search:"",status:""},me=null,Ie=(it,St)=>{Zn&&(Zn.textContent=it||"",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),St==="success"&&Zn.classList.add("aipkit_form-help-success"),St==="error"&&Zn.classList.add("aipkit_form-help-error"))},Me=()=>{Zn&&setTimeout(()=>{Zn.textContent="",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},qe=(it,St)=>{$a&&($a.textContent=it||"\u2014"),eo&&(eo.textContent=St||"\u2014")},et=()=>{let it=B(),St=it.vector_store_provider||"",Ft=oe[St]||"",De=[],Kt="",Ci=Ae(),ci=Ci?Ci.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(St==="openai"){if(De=Array.isArray(it.openai_vector_store_ids)?it.openai_vector_store_ids.filter(Boolean):[],ci){let At=Array.from(ci.selectedOptions).map(ct=>ct.textContent.trim()).filter(Boolean);At.length&&(Kt=At.join(", "))}Kt||(Kt=De.join(", "))}else St==="pinecone"?it.pinecone_index_name&&(De=[it.pinecone_index_name],Kt=it.pinecone_index_name):St==="qdrant"&&(De=Array.isArray(it.qdrant_collection_names)?it.qdrant_collection_names.filter(Boolean):[],Kt=De.join(", "));return{contextSettings:it,providerKey:St,providerLabel:Ft,storeIds:De,storeLabel:Kt}},ut=it=>{On&&(On.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${ee(it)}</td></tr>`,wo&&(wo.innerHTML=""))},wi=(it,St)=>{if(!On)return;if(!it.length){ut("No sources found.");return}let Ft=it.map(De=>{let Kt=(De.provider||St||"").toLowerCase(),Ci=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(De.message||"",De.file_id||"",Kt,De):"N/A",ci=Ci==="Text"?"aipkit_type-text":Ci==="File Upload"?"aipkit_type-file":Ci==="Site Content"?"aipkit_type-site":"aipkit_type-na",At=De.status==="indexed"||De.status==="skipped_already_indexed"||De.status==="success"?"aipkit_status-success":De.status==="failed"?"aipkit_status-warning":"aipkit_status-info",ct="\u2014";De.status&&(ct=De.status==="indexed"||De.status==="skipped_already_indexed"||De.status==="success"?"Trained":De.status.replace(/_/g," "));let jt=De.status==="processing"||De.status==="queued",xi=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(De.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(De.timestamp):De.timestamp||"\u2014",Qi=De.indexed_content||"",xn=De.post_title||(De.post_id?`Post #${De.post_id}`:"")||Qi||De.message||De.file_id||"\u2014",bn=xn.length>60?`${xn.substring(0,60)}...`:xn,no=[];return Ci==="Site Content"&&De.post_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${ee(De.provider||St)}"
                    data-store-id="${ee(De.vector_store_id||"")}"
                    data-vector-id="${ee(De.file_id||"")}"
                    data-log-id="${ee(De.id||"")}"
                    data-post-id="${ee(De.post_id||"")}"
                    data-embedding-provider="${ee(De.embedding_provider||"")}"
                    data-embedding-model="${ee(De.embedding_model||"")}"
                    ${jt?'disabled aria-disabled="true"':""}
                  >${jt?"Training...":"Retrain"}</button>`),Ci==="Text"&&Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${ee(De.provider||St)}"
                    data-store-id="${ee(De.vector_store_id||"")}"
                    data-vector-id="${ee(De.file_id||"")}"
                    data-log-id="${ee(De.id||"")}"
                    data-embedding-provider="${ee(De.embedding_provider||"")}"
                    data-embedding-model="${ee(De.embedding_model||"")}"
                    data-content="${encodeURIComponent(Qi)}"
                    ${jt?'disabled aria-disabled="true"':""}
                  >${jt?"Training...":"Edit"}</button>`),Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${ee(De.id||"")}"
                    data-snippet="${ee(Qi)}"
                    ${De.batch_id?`data-batch-id="${ee(De.batch_id)}" data-store-id="${ee(De.vector_store_id||"")}"`:""}
                    ${jt?'disabled aria-disabled="true"':""}
                  >View</button>`),De.file_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${ee(De.provider||St)}"
                    data-store-id="${ee(De.vector_store_id||"")}"
                    data-vector-id="${ee(De.file_id||"")}"
                    data-log-id="${ee(De.id||"")}"
                    ${jt?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${ee(De.id||"")}">
                <td style="white-space: nowrap;">${ee(xi)}</td>
                <td><span class="aipkit_content-type-tag ${ci}">${ee(Ci)}</span></td>
                <td title="${ee(xn)}">${ee(bn)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${At}">${ee(ct)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${no.join("")}</div>
                </td>
              </tr>`}).join("");On.innerHTML=Ft,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(On,St)},Nt=async(it=1)=>{if(!On||typeof window.aipkit_apiRequest!="function")return;let St=v&&v.value||e.getAttribute("data-active-bot-id");if(!St){ut("Select a chatbot to view sources.");return}let{contextSettings:Ft,providerKey:De,providerLabel:Kt,storeIds:Ci,storeLabel:ci}=et();if(qe(Kt,ci),Ft.enable_vector_store!=="1"){ut("Enable a knowledge base to view sources.");return}if(!De||!Ci.length){ut("Select a knowledge base store to view sources.");return}On.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',wo&&(wo.innerHTML="");try{let At={bot_id:St,page:it,search:le.search,status:le.status,enable_vector_store:Ft.enable_vector_store,vector_store_provider:Ft.vector_store_provider,openai_vector_store_ids:Ft.openai_vector_store_ids||[],pinecone_index_name:Ft.pinecone_index_name,qdrant_collection_names:Ft.qdrant_collection_names||[]},ct=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",At);le.page=it,wi(ct.logs||[],Kt),typeof window.aipkit_renderLogsPagination=="function"&&ct.pagination&&wo&&window.aipkit_renderLogsPagination(ct.pagination,wo,jt=>Nt(jt))}catch(At){ut(`Error loading sources: ${ee(At.message||"Unknown error")}`)}},vi=(it=1)=>{!F||!F.classList.contains("aipkit-active")||Ji.hidden||Nt(it)};window.aipkit_refreshSourcesSheet=vi;let wn=()=>{di&&(di.classList.remove("aipkit-active"),di.setAttribute("aria-hidden","true"),di.dataset.provider="",di.dataset.storeId="",di.dataset.vectorId="",di.dataset.logId="",di.dataset.embeddingProvider="",di.dataset.embeddingModel="",ho&&(ho.value=""))},mn=it=>{!di||!ho||(di.dataset.provider=it.dataset.provider||"",di.dataset.storeId=it.dataset.storeId||"",di.dataset.vectorId=it.dataset.vectorId||"",di.dataset.logId=it.dataset.logId||"",di.dataset.embeddingProvider=it.dataset.embeddingProvider||"",di.dataset.embeddingModel=it.dataset.embeddingModel||"",ho.value=it.dataset.content?decodeURIComponent(it.dataset.content):"",di.classList.add("aipkit-active"),di.setAttribute("aria-hidden","false"),setTimeout(()=>ho.focus(),0))},qn=()=>{bi&&(bi.classList.remove("aipkit-active"),bi.setAttribute("aria-hidden","true"),bi.dataset.provider="",bi.dataset.storeId="",bi.dataset.vectorId="",bi.dataset.logId="")},xo=it=>{bi&&(bi.dataset.provider=it.providerLabel||"",bi.dataset.storeId=it.storeId||"",bi.dataset.vectorId=it.vectorId||"",bi.dataset.logId=it.logId||"",bi.classList.add("aipkit-active"),bi.setAttribute("aria-hidden","false"),yo&&(yo.disabled=!1))},Ni=async(it,St,Ft,De,Kt)=>{let Ci=it.toLowerCase();if(Ci==="openai"){let ct=Ri("aipkit_vector_store_nonce_openai");if(!ct)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:ct,target_store_id:St,text_content:Ft,source_type:"chatbot_training_text"});return}if(!De||!Kt){let ct=B();De=De||ct.vector_embedding_provider,Kt=Kt||ct.vector_embedding_model}if(!De||!Kt)throw new Error("Select an embedding provider and model.");let ci=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Ft,embedding_provider:De,embedding_model:Kt}),At=ci.embeddings&&ci.embeddings.length?ci.embeddings[0]:null;if(!At)throw new Error("Failed to generate embedding.");if(Ci==="pinecone"){let ct=Ri("aipkit_vector_store_pinecone_nonce_management");if(!ct)throw new Error("Pinecone nonce missing.");let jt=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:ct,vectors:JSON.stringify([{id:jt,values:At,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Ft,vector_id:jt}}]),embedding_provider:De,embedding_model:Kt,original_text_content:Ft,index_name:St});return}if(Ci==="qdrant"){let ct=Ri("aipkit_vector_store_qdrant_nonce_management");if(!ct)throw new Error("Qdrant nonce missing.");let jt=l(),xi={_ajax_nonce:ct,vectors:JSON.stringify([{id:jt,vector:At,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Ft,vector_id:jt}}]),embedding_provider:De,embedding_model:Kt,original_text_content:Ft,collection_name:St,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",xi)}};pa&&pa.addEventListener("input",()=>{me&&window.clearTimeout(me),me=window.setTimeout(()=>{le.search=pa.value.trim(),vi(1)},300)}),ko&&ko.addEventListener("change",()=>{le.status=ko.value,vi(1)}),ua&&ua.addEventListener("click",()=>{vi(le.page||1)}),cr&&cr.addEventListener("click",wn),_a&&_a.addEventListener("click",wn),di&&!di.dataset.bound&&(document.addEventListener("keydown",it=>{it.key==="Escape"&&di.classList.contains("aipkit-active")&&wn()}),di.dataset.bound="1"),Oa&&Oa.addEventListener("click",async()=>{if(!di||!ho)return;let it=ho.value.trim();if(!it){Ie("Text cannot be empty.","error"),Me();return}let St=di.dataset.provider||"",Ft=di.dataset.storeId||"",De=di.dataset.vectorId||"",Kt=di.dataset.logId||"",Ci=di.dataset.embeddingProvider||"",ci=di.dataset.embeddingModel||"";if(!St||!Ft||!De||!Kt){Ie("Missing source details.","error"),Me();return}if(wn(),On&&Kt){let At=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Kt)):String(Kt).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),ct=On.querySelector(`tr[data-log-id="${At}"]`),jt=ct?ct.querySelector(".aipkit_sources_action_edit"):null,xi=ct?ct.querySelector(".aipkit_view_snippet_icon"):null,Qi=ct?ct.querySelector(".aipkit_sources_action_delete"):null;jt&&(jt.disabled=!0,jt.setAttribute("aria-disabled","true"),jt.textContent="Training..."),xi&&(xi.disabled=!0,xi.setAttribute("aria-disabled","true")),Qi&&(Qi.disabled=!0,Qi.setAttribute("aria-disabled","true"))}Ie("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:St,store_id:Ft,vector_id:De,log_id:Kt}),await Ni(St,Ft,it,Ci,ci),Ie("Trained","success"),Me(),wn(),vi(le.page||1),Ln(B())}catch(At){Ie(`Error: ${At.message||"Failed to save."}`,"error")}}),lr&&lr.addEventListener("click",qn),yn&&yn.addEventListener("click",qn),yo&&yo.addEventListener("click",async()=>{if(!bi)return;let it=bi.dataset.provider||"",St=bi.dataset.storeId||"",Ft=bi.dataset.vectorId||"",De=bi.dataset.logId||"";if(!it||!St||!Ft||!De){Ie("Missing source details.","error"),Me(),qn();return}qn();let Kt=null,Ci=null,ci=null,At=null,ct=null;if(On&&De){let jt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(De)):String(De).replace(/[^a-zA-Z0-9_-]/g,"\\$&");Kt=On.querySelector(`tr[data-log-id="${jt}"]`),Kt&&(Ci=Kt.querySelector(".aipkit_sources_action_edit"),ci=Kt.querySelector(".aipkit_sources_action_retrain"),At=Kt.querySelector(".aipkit_view_snippet_icon"),ct=Kt.querySelector(".aipkit_sources_action_delete"),[Ci,ci,At,ct].forEach(xi=>{xi&&(xi.disabled=!0,xi.setAttribute("aria-disabled","true"))}),ct&&(ct.textContent="Deleting..."))}yo&&(yo.disabled=!0),Ie("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:it,store_id:St,vector_id:Ft,log_id:De}),Ie("Deleted","success"),Me(),vi(le.page||1),Ln(B())}catch(jt){Ie(`Error: ${jt.message||"Failed to delete."}`,"error"),[Ci,ci,At,ct].forEach(xi=>{xi&&(xi.disabled=!1,xi.removeAttribute("aria-disabled"))}),ct&&(ct.textContent="Delete")}finally{yo&&(yo.disabled=!1)}}),bi&&!bi.dataset.bound&&(document.addEventListener("keydown",it=>{it.key==="Escape"&&bi.classList.contains("aipkit-active")&&qn()}),bi.dataset.bound="1"),Ji.addEventListener("click",async it=>{let St=it.target.closest(".aipkit_sources_action_edit");if(St){mn(St);return}let Ft=it.target.closest(".aipkit_sources_action_delete");if(Ft){let Kt=Ft.dataset.provider||"",Ci=Ft.dataset.storeId||"",ci=Ft.dataset.vectorId||"",At=Ft.dataset.logId||"";if(!Kt||!Ci||!ci||!At){Ie("Missing source details.","error"),Me();return}xo({providerLabel:Kt,storeId:Ci,vectorId:ci,logId:At});return}let De=it.target.closest(".aipkit_sources_action_retrain");if(De){let Kt=De.dataset.provider||"",Ci=De.dataset.storeId||"",ci=De.dataset.vectorId||"",At=De.dataset.logId||"",ct=De.dataset.postId||"",jt=De.dataset.embeddingProvider||"",xi=De.dataset.embeddingModel||"";if(!Kt||!Ci||!ci||!At||!ct){Ie("Missing source details.","error"),Me();return}De.disabled=!0,De.setAttribute("aria-disabled","true"),De.textContent="Training...";let Qi=De.closest("tr"),xn=Qi?Qi.querySelector(".aipkit_view_snippet_icon"):null,bn=Qi?Qi.querySelector(".aipkit_sources_action_delete"):null;xn&&(xn.disabled=!0,xn.setAttribute("aria-disabled","true")),bn&&(bn.disabled=!0,bn.setAttribute("aria-disabled","true")),Ie("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Kt,store_id:Ci,vector_id:ci,log_id:At,post_id:ct,embedding_provider:jt,embedding_model:xi}),Ie("Retrained","success"),Me(),vi(le.page||1),Ln(B())}catch(no){Ie(`Error: ${no.message||"Failed to retrain."}`,"error"),De.disabled=!1,De.removeAttribute("aria-disabled"),De.textContent="Retrain",xn&&(xn.disabled=!1,xn.removeAttribute("aria-disabled")),bn&&(bn.disabled=!1,bn.removeAttribute("aria-disabled"))}}}),e.dataset.sourcesSheetBound="1"}e.dataset.contextSettingsAutosaveBound="1"}let vr=ze();if(vr&&$i&&!e.dataset.tokenLimitsAutosaveBound){let q=!1,T=null,B=()=>{let K=vr.querySelectorAll('input[name^="token_role_limits["]'),V={};return K.forEach(Y=>{let ne=Y.getAttribute("name");ne&&(V[ne]=Y.value)}),V},U=()=>{let K=V=>{let Y=vr.querySelector(V);return Y?Y.value:""};return{token_guest_limit:K('[name="token_guest_limit"]'),token_user_limit:K('[name="token_user_limit"]'),token_limit_mode:K('[name="token_limit_mode"]'),token_reset_period:K('[name="token_reset_period"]'),token_limit_message:K('[name="token_limit_message"]'),role_limits:B()}},z=U(),X=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");if(!V)return;q=!0,st("Auto-saving...","");let Y={bot_id:V,token_guest_limit:K.token_guest_limit,token_user_limit:K.token_user_limit,token_limit_mode:K.token_limit_mode,token_reset_period:K.token_reset_period,token_limit_message:K.token_limit_message};Object.entries(K.role_limits).forEach(([ne,_e])=>{Y[ne]=_e}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",Y).then(ne=>{z=K,st(ne.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(ne=>{st(`Error: ${ne.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let ne=T;T=null,JSON.stringify(ne)!==JSON.stringify(z)&&X(ne)}})},ie=K=>{if(JSON.stringify(K)!==JSON.stringify(z)){if(q){T=K;return}X(K)}};vr.addEventListener("change",K=>{let V=K.target;if(V){if(V.matches(".aipkit_token_limit_mode_select")){Gi(),ie(U());return}(V.matches('[name="token_guest_limit"]')||V.matches('[name="token_user_limit"]')||V.matches('[name="token_reset_period"]')||V.matches('[name="token_limit_message"]')||V.matches('input[name^="token_role_limits["]'))&&ie(U())}}),e.dataset.tokenLimitsAutosaveBound="1"}let Vr=(D?D.querySelector('[data-aipkit-settings-panel="appearance"]'):null)||(O?O.querySelector('[data-aipkit-settings-panel="appearance"]'):null);if(Vr&&$i&&!e.dataset.styleSettingsAutosaveBound){let q=Vr;if(q){let T=!1,B=null,U=()=>{let ye=q.querySelector('[name="enable_conversation_starters"]'),fe=q.querySelector(".aipkit_starters_config_btn");if(!ye||!fe)return;let Xe=!ye.disabled&&(ye.tagName==="SELECT"?ye.value==="1":!!ye.checked);fe.hidden=!Xe,fe.disabled=!Xe,fe.setAttribute("aria-disabled",Xe?"false":"true"),Xe||(fe.setAttribute("aria-expanded","false"),qr())},z=q.querySelector("[data-aipkit-interface-controls-dropdown]"),X=z?z.querySelector(".aipkit_popover_multiselect_btn"):null,ie=z?z.querySelector(".aipkit_popover_multiselect_label"):null,K=z?z.querySelector(".aipkit_popover_multiselect_panel"):null,V=z?Array.from(z.querySelectorAll(".aipkit_interface_control_option")):[],Y={};Array.from(q.querySelectorAll(".aipkit_interface_control_hidden_select")).forEach(ye=>{let fe=ye.getAttribute("name");fe&&(Y[fe]=ye)});let ne=q.querySelector(".aipkit_interface_control_option--sidebar"),_e=ne?ne.closest(".aipkit_interface_control_item--sidebar"):null,be=e.querySelector("[data-aipkit-top-mode-select]"),Ge=ye=>ye?ye.tagName==="SELECT"?ye.value==="1":!!ye.checked:!1,kt=(ye,fe)=>{if(!ye||ye.disabled)return;let Xe=!!fe;Ge(ye)!==Xe&&(ye.tagName==="SELECT"?ye.value=Xe?"1":"0":ye.checked=Xe,ye.dispatchEvent(new Event("change",{bubbles:!0})))},Lt=()=>{ie&&(ie.textContent=Ta(V,z,"Select controls",2))},Ot=()=>{V.forEach(ye=>{if(!ye)return;let fe=Y[ye.value];fe&&(ye.checked=Ge(fe))}),Lt()},Ii=()=>{V.forEach(ye=>{if(!ye||ye.disabled)return;let fe=Y[ye.value];fe&&kt(fe,ye.checked)}),Lt()},ft=()=>{if(!ne||!_e)return;let ye=Y.enable_conversation_sidebar,fe=ye?ye.disabled:be?be.value==="popup"||be.value==="external":!1,Xe=_e.getAttribute("data-tooltip-disabled")||"";fe?(ne.disabled=!0,_e.classList.add("is-disabled"),Xe&&_e.setAttribute("title",Xe)):(ne.disabled=!1,_e.classList.remove("is-disabled"),_e.removeAttribute("title"))},yi=()=>{!X||!K||(X.setAttribute("aria-expanded","false"),K.hidden=!0,z.classList.remove("is-open"),Kn())};z&&X&&K&&!z.dataset.bound&&(X.addEventListener("click",ye=>{if(ye.preventDefault(),X.getAttribute("aria-expanded")==="true"){yi();return}X.setAttribute("aria-expanded","true"),K.hidden=!1,z.classList.add("is-open"),Kn()}),V.forEach(ye=>{ye.addEventListener("change",()=>{Ii()})}),document.addEventListener("click",ye=>{z.contains(ye.target)||yi()}),document.addEventListener("keydown",ye=>{ye.key==="Escape"&&yi()}),Object.values(Y).forEach(ye=>{ye.addEventListener("change",()=>{ft(),Ot()})}),be&&be.dataset.interfaceControlsBound!=="1"&&(be.addEventListener("change",()=>{window.requestAnimationFrame(()=>{ft(),Ot()})}),be.dataset.interfaceControlsBound="1"),ft(),Ot(),z.dataset.bound="1"),cn&&to&&ma&&Fi&&!cn.dataset.bound&&(to.addEventListener("click",ye=>{if(ye.preventDefault(),to.getAttribute("aria-expanded")==="true"){Qo();return}to.setAttribute("aria-expanded","true"),ma.hidden=!1,cn.classList.add("is-open"),Kn(),gr()}),In.forEach(ye=>{ye.addEventListener("change",()=>{ye.checked&&(Or(ye),Qo())})}),document.addEventListener("click",ye=>{cn&&!cn.contains(ye.target)&&Qo()}),document.addEventListener("keydown",ye=>{ye.key==="Escape"&&Qo()}),cn.dataset.bound="1"),Fi&&Fi.dataset.themeDropdownBound!=="1"&&(Fi.addEventListener("change",()=>{gr()}),Fi.dataset.themeDropdownBound="1"),Ti&&Ti.dataset.bound!=="1"&&(Ti.addEventListener("click",ye=>{if(ye.preventDefault(),Ti.hidden||Ti.disabled)return;let fe=In.find(xe=>{let at=xe.getAttribute("data-theme-value")||xe.value||"",vt=xe.getAttribute("data-preset-key")||"";return at==="custom"&&vt===""});if(fe&&!fe.disabled&&(fe.checked||(fe.checked=!0,Or(fe))),Qo(),Mt&&Mt.classList.contains("is-open")&&ki===Ti){Jo();return}Hr(Ti)}),Ti.dataset.bound="1"),gr();let Xt=()=>{let ye={},fe=Ei=>{let Yi=q.querySelector(Ei);return!Yi||Yi.disabled?null:Yi.value||""},Xe=Ei=>!Ei||Ei.disabled?null:Ei.tagName==="SELECT"?Ei.value==="1"?"1":"0":Ei.checked?"1":"0",we=q.querySelector('select[name="theme"]');if(we&&!we.disabled)ye.theme=we.value||"light";else{let Ei=q.querySelector('input[name="theme"]:checked');if(Ei&&!Ei.disabled)ye.theme=Ei.value||"light";else{let Yi=e.querySelector('input[name="theme"]:checked, select[name="theme"]');Yi&&!Yi.disabled&&(ye.theme=Yi.value||"light")}}let xe="";if((ye.theme||"")==="custom"&&(vo&&!vo.disabled&&(xe=vo.value||""),!xe&&we&&!we.disabled)){let Ei=we.selectedOptions&&we.selectedOptions.length?we.selectedOptions[0]:null;xe=Ei&&Ei.dataset&&Ei.dataset.presetKey?Ei.dataset.presetKey:""}ye.theme_preset_key=xe;let at=fe('input[name="greeting"]');at!==null&&(ye.greeting=at);let vt=fe('input[name="subgreeting"]');vt!==null&&(ye.subgreeting=vt);let ri=fe('input[name="input_placeholder"]');ri!==null&&(ye.input_placeholder=ri);let Zt=fe('input[name="footer_text"]');Zt!==null&&(ye.footer_text=Zt);let si=fe('input[name="custom_typing_text"]');si!==null&&(ye.custom_typing_text=si);let zt=Ei=>{let Yi=q.querySelector(`[name="${Ei}"]`);if(!(!Yi||Yi.disabled)){if(Yi.tagName==="SELECT"){ye[Ei]=Yi.value==="1"?"1":"0";return}ye[Ei]=Yi.checked?"1":"0"}};zt("enable_download"),zt("enable_copy_button"),zt("enable_fullscreen"),zt("enable_feedback"),zt("enable_conversation_sidebar"),zt("enable_conversation_starters");let Pi=v&&v.value||e.getAttribute("data-active-bot-id");if(Pi){let Ei=document.getElementById(`aipkit_bot_${Pi}_enable_consent_compliance`),Yi=Xe(Ei);Yi!==null&&(ye.enable_consent_compliance=Yi);let Co=document.getElementById(`aipkit_bot_${Pi}_enable_ip_anonymization`),lo=Xe(Co);lo!==null&&(ye.enable_ip_anonymization=lo);let jn=document.getElementById(`aipkit_bot_${Pi}_consent_title`);jn&&!jn.disabled&&(ye.consent_title=jn.value||"");let Hn=document.getElementById(`aipkit_bot_${Pi}_consent_message`);Hn&&!Hn.disabled&&(ye.consent_message=Hn.value||"");let Xa=document.getElementById(`aipkit_bot_${Pi}_consent_button`);Xa&&!Xa.disabled&&(ye.consent_button=Xa.value||"");let br=document.getElementById(`aipkit_bot_${Pi}_openai_moderation_enabled`),Sr=Xe(br);Sr!==null&&(ye.openai_moderation_enabled=Sr);let Sa=document.getElementById(`aipkit_bot_${Pi}_openai_moderation_message`);Sa&&!Sa.disabled&&(ye.openai_moderation_message=Sa.value||"");let on=document.getElementById(`aipkit_bot_${Pi}_banned_words`);on&&!on.disabled&&(ye.banned_words=on.value||"");let Xo=document.getElementById(`aipkit_bot_${Pi}_banned_words_message`);Xo&&!Xo.disabled&&(ye.banned_words_message=Xo.value||"");let Zo=document.getElementById(`aipkit_bot_${Pi}_banned_ips`);Zo&&!Zo.disabled&&(ye.banned_ips=Zo.value||"");let po=document.getElementById(`aipkit_bot_${Pi}_banned_ips_message`);po&&!po.disabled&&(ye.banned_ips_message=po.value||"");let Ln=document.getElementById(`aipkit_bot_${Pi}_custom_theme_settings_container`);Ln&&Ln.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(Ri=>{let Ea=Ri.getAttribute("name");Ea&&(Ri.type==="checkbox"?ye[Ea]=Ri.checked?"1":"0":Ri.type==="radio"?Ri.checked&&(ye[Ea]=Ri.value):ye[Ea]=Ri.value)});let Za=document.getElementById(`aipkit_bot_${Pi}_conversation_starters`);Za&&!Za.disabled&&(ye.conversation_starters=Za.value||"")}return ye},Ct=Xt(),Gt=ye=>{let fe=v&&v.value||e.getAttribute("data-active-bot-id");fe&&(T=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:fe,...ye}).then(Xe=>{Ct=ye,st(Xe.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(fe),Oi()}).catch(Xe=>{st(`Error: ${Xe.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,B){let Xe=B;B=null,JSON.stringify(Xe)!==JSON.stringify(Ct)&&Gt(Xe)}}))},dt=ye=>{if(JSON.stringify(ye)!==JSON.stringify(Ct)){if(T){B=ye;return}Gt(ye)}};q.addEventListener("change",ye=>{let fe=ye.target;if(fe&&((fe.matches('input[name="enable_conversation_starters"]')||fe.matches('select[name="enable_conversation_starters"]'))&&U(),fe.matches('input[name="greeting"]')||fe.matches('input[name="subgreeting"]')||fe.matches('input[name="input_placeholder"]')||fe.matches('input[name="footer_text"]')||fe.matches('input[name="custom_typing_text"]')||fe.matches('input[name="enable_download"]')||fe.matches('input[name="enable_copy_button"]')||fe.matches('input[name="enable_fullscreen"]')||fe.matches('input[name="enable_feedback"]')||fe.matches('input[name="enable_conversation_sidebar"]')||fe.matches('input[name="enable_conversation_starters"]')||fe.matches('select[name="enable_download"]')||fe.matches('select[name="enable_copy_button"]')||fe.matches('select[name="enable_fullscreen"]')||fe.matches('select[name="enable_feedback"]')||fe.matches('select[name="enable_conversation_sidebar"]')||fe.matches('select[name="enable_conversation_starters"]')||fe.matches('select[name="theme"]')||fe.matches('input[name="theme"]'))){if((fe.matches('select[name="theme"]')||fe.matches('input[name="theme"]'))&&typeof Jo=="function")if(fe.value!=="custom")Jo();else{let we=fe.matches&&fe.matches('select[name="theme"]')&&fe.selectedOptions&&fe.selectedOptions.length?fe.selectedOptions[0]:null;if(!!(we&&we.dataset&&we.dataset.presetKey))Jo();else{let at=q.querySelector(".aipkit_theme_config_btn:not([hidden])")||q.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||fe.closest(".aipkit_theme_choice_card")||fe;Hr(at)}}dt(Xt())}}),U(),e.addEventListener("change",ye=>{let fe=ye.target;!fe||!fe.matches||!fe.matches('select[name="theme"]')&&!fe.matches('input[name="theme"]')||q.contains(fe)||dt(Xt())}),e.dataset.customThemeAutosaveBound||(document.addEventListener("change",ye=>{let fe=ye.target;fe&&fe.matches&&fe.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&(!(document.documentElement.dataset.aipkitApplyingThemePreset==="1")&&(Fi?.value||"")==="custom"&&Yr(),dt(Xt()))}),e.dataset.customThemeAutosaveBound="1"),q.addEventListener("blur",ye=>{let fe=ye.target;fe&&(fe.matches('input[name="greeting"]')||fe.matches('input[name="subgreeting"]')||fe.matches('input[name="input_placeholder"]')||fe.matches('input[name="footer_text"]')||fe.matches('input[name="custom_typing_text"]'))&&dt(Xt())},!0),document.addEventListener("change",ye=>{let fe=ye.target;fe&&fe.matches('textarea[name="conversation_starters"], [name="enable_consent_compliance"], [name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], [name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&(fe.matches('[name="enable_consent_compliance"]')&&Dr(),fe.matches('[name="openai_moderation_enabled"]')&&Wr(),dt(Xt()))}),document.addEventListener("blur",ye=>{let fe=ye.target;fe&&fe.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&dt(Xt())},!0),e.dataset.styleSettingsAutosaveBound="1"}}if(F&&$i&&!e.dataset.imageSettingsAutosaveBound){let q=!1,T=null;Zi&&ro&&jo&&tn&&!Zi.dataset.bound&&(ro.addEventListener("click",K=>{if(K.preventDefault(),ro.getAttribute("aria-expanded")==="true"){va();return}Qo(),ya(),ro.setAttribute("aria-expanded","true"),jo.hidden=!1,Zi.classList.add("is-open"),Kn(),kr()}),ga.forEach(K=>{K.addEventListener("change",()=>{K.checked&&(Xr(K),va())})}),document.addEventListener("click",K=>{Zi&&!Zi.contains(K.target)&&va()}),document.addEventListener("keydown",K=>{K.key==="Escape"&&va()}),Zi.dataset.bound="1"),tn&&tn.dataset.imageModelDropdownBound!=="1"&&(tn.addEventListener("change",()=>{kr()}),tn.dataset.imageModelDropdownBound="1"),kr(),Gn&&Nn&&!Gn.dataset.bound&&(Gn.addEventListener("click",K=>{if(K.preventDefault(),Gn.getAttribute("aria-expanded")==="true"){ba();return}Qo(),ya(),va(),Gn.setAttribute("aria-expanded","true"),Nn.hidden=!1,Nn.classList.add("is-open"),Kn()}),Va&&Va.addEventListener("click",K=>{K.preventDefault(),ba()}),document.addEventListener("click",K=>{Nn.classList.contains("is-open")&&(Gn.contains(K.target)||Nn.contains(K.target)||ba())}),document.addEventListener("keydown",K=>{K.key==="Escape"&&ba()}),Gn.dataset.bound="1");let B=()=>{let K=j&&j.querySelector('select[name="chat_image_model_id"]')||R&&R.querySelector('select[name="chat_image_model_id"]')||F.querySelector('select[name="chat_image_model_id"]'),V=j&&j.querySelector('input[name="image_triggers"]')||j&&j.querySelector('textarea[name="image_triggers"]')||R&&R.querySelector('input[name="image_triggers"]')||R&&R.querySelector('textarea[name="image_triggers"]')||F.querySelector('input[name="image_triggers"]')||F.querySelector('textarea[name="image_triggers"]');if(!K||!V)return null;let Y=j&&j.querySelector(".aipkit_image_analysis_select")||R&&R.querySelector(".aipkit_image_analysis_select")||F.querySelector(".aipkit_image_analysis_select"),ne=j&&j.querySelector(".aipkit_image_analysis_checkbox")||R&&R.querySelector(".aipkit_image_analysis_checkbox")||F.querySelector(".aipkit_image_analysis_checkbox"),_e=Y&&Y.value!==""?Y.value:ne&&ne.checked?"1":"0";return{chat_image_model_id:K.value||"",image_triggers:V.value||"",enable_image_upload:_e}},U=B()||{},z=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:V,...K}).then(Y=>{U=K,st(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{st(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&z(Y)}}))},X=K=>{if(K&&JSON.stringify(K)!==JSON.stringify(U)){if(q){T=K;return}z(K)}},ie=K=>{let V=K.target;V&&(V.matches('select[name="chat_image_model_id"]')||V.matches('input[name="image_triggers"]')||V.matches('textarea[name="image_triggers"]')||V.matches(".aipkit_image_analysis_checkbox")||V.matches(".aipkit_image_analysis_select"))&&X(B())};F.addEventListener("change",ie),R&&R.addEventListener("change",ie),j&&j.addEventListener("change",ie),e.dataset.imageSettingsAutosaveBound="1"}if(F&&$i&&!e.dataset.replicateKeyAutosaveBound){let T=j&&j.querySelector('input[name="replicate_api_key"]')||R&&R.querySelector('input[name="replicate_api_key"]')||F.querySelector('input[name="replicate_api_key"]');if(T){let B=!1,U=null,z=T.value||"",X=V=>{B=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:V}).then(Y=>{z=V,st(Y.message||"Saved","success"),Oi(),Ua(V)}).catch(Y=>{st(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(B=!1,U!==null){let Y=U;U=null,Y!==z&&X(Y)}})},ie=V=>{if(V!==z){if(B){U=V;return}X(V)}},K=V=>{let Y=V.target;!Y||!Y.matches('input[name="replicate_api_key"]')||ie(Y.value||"")};F.addEventListener("change",K),F.addEventListener("blur",K,!0),R&&(R.addEventListener("change",K),R.addEventListener("blur",K,!0)),j&&(j.addEventListener("change",K),j.addEventListener("blur",K,!0)),e.dataset.replicateKeyAutosaveBound="1"}}if(Qe&&$i&&!e.dataset.audioSettingsAutosaveBound){let q=!1,T=null,B=()=>{let we=zt=>{let Pi=Qe.querySelector(zt);return Pi?Pi.value:null},xe=zt=>zt?zt.tagName==="SELECT"?zt.value:zt.type==="checkbox"?zt.checked?"1":"0":zt.value?zt.value:"0":null,at=zt=>xe(e.querySelector(zt)),vt={},ri=at(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch");if(ri!==null){vt.enable_voice_input=ri;let zt=we('[name="stt_provider"]');zt!==null&&(vt.stt_provider=zt);let Pi=we('[name="stt_openai_model_id"]');Pi!==null&&(vt.stt_openai_model_id=Pi)}let Zt=at(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch");if(Zt!==null){vt.tts_enabled=Zt;let zt=xe('[name="tts_auto_play"]');zt!==null&&(vt.tts_auto_play=zt);let Pi=we('[name="tts_provider"]');Pi!==null&&(vt.tts_provider=Pi);let Ei=we('[name="tts_google_voice_id"]');Ei!==null&&(vt.tts_google_voice_id=Ei);let Yi=we('[name="tts_openai_voice_id"]');Yi!==null&&(vt.tts_openai_voice_id=Yi);let Co=we('[name="tts_openai_model_id"]');Co!==null&&(vt.tts_openai_model_id=Co);let lo=we('[name="tts_elevenlabs_voice_id"]');lo!==null&&(vt.tts_elevenlabs_voice_id=lo);let jn=we('[name="tts_elevenlabs_model_id"]');jn!==null&&(vt.tts_elevenlabs_model_id=jn)}let si=at(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle");if(si!==null){vt.enable_realtime_voice=si;let zt=xe('[name="direct_voice_mode"]');zt!==null&&(vt.direct_voice_mode=zt);let Pi=xe('[name="input_audio_noise_reduction"]');Pi!==null&&(vt.input_audio_noise_reduction=Pi);let Ei=we('[name="realtime_model"]');Ei!==null&&(vt.realtime_model=Ei);let Yi=we('[name="realtime_voice"]');Yi!==null&&(vt.realtime_voice=Yi);let Co=we('[name="turn_detection"]');Co!==null&&(vt.turn_detection=Co);let lo=we('[name="input_audio_format"]');lo!==null&&(vt.input_audio_format=lo);let jn=we('[name="output_audio_format"]');jn!==null&&(vt.output_audio_format=jn);let Hn=we('[name="speed"]');Hn!==null&&(vt.speed=Hn)}return vt},U=B(),X=(()=>{let we=Qe.querySelector('[name="elevenlabs_api_key"]');return we?we.value:""})(),ie=!1,K=null,V=!1,Y=Qe.querySelector(".aipkit_tts_sync_status"),ne=(we,xe,at)=>{Y&&(Y.textContent=we||"",Y.classList.remove("success","error","loading"),xe&&Y.classList.add(xe),at?Y.setAttribute("title",at):Y.removeAttribute("title"),Y.style.display=we?"inline-block":"none")},_e=(we=2500)=>{Y&&setTimeout(()=>{ne("")},we)},be=()=>{let we=Qe.querySelector('[name="tts_provider"]');return we?we.value:""},Ge=()=>{let we=Qe.querySelector(".aipkit_tts_toggle_switch");return we?we.tagName==="SELECT"?we.value==="1":!!we.checked:!1},kt=()=>{let we=Qe.querySelector('select[name="tts_google_voice_id"]');return!we||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||V?Promise.resolve():(V=!0,ne("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(xe=>{if(!xe||!xe.voices)throw new Error("Invalid response received from voice sync.");let at=we.value||"";window.aipkit_updateGoogleVoiceSelect(we.id,xe.voices,at);let vt=document.getElementById("aipkit_google_tts_voices_json_main");vt&&(vt.dataset.voices=JSON.stringify(xe.voices)),ne(xe.message||"Synced","success"),_e()}).catch(xe=>{let at=xe?.message||"Sync failed.";throw ne(at,"error",at),_e(5e3),xe}).finally(()=>{V=!1}))},Lt=()=>{let we=dt();if(!we||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let xe=Qe.querySelector('select[name="tts_elevenlabs_voice_id"]'),at=Qe.querySelector('select[name="tts_elevenlabs_model_id"]');if(!xe&&!at||V)return Promise.resolve();V=!0,ne("Syncing...","loading");let vt=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(Zt=>{let si=Zt?.models||[];xe&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(xe.id,si,xe.value||"");let zt=document.getElementById(`aipkit_elevenlabs_voices_json_${we}`);zt&&(zt.dataset.voices=JSON.stringify(si))}),ri=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(Zt=>{let si=Zt?.models||[];at&&window.aipkit_chatTts_updateElevenLabsModelsSelect(at.id,si,at.value||"");let zt=document.getElementById(`aipkit_elevenlabs_models_json_${we}`);zt&&(zt.dataset.models=JSON.stringify(si))});return Promise.allSettled([vt,ri]).then(Zt=>{let si=Zt.find(zt=>zt.status==="rejected");if(si){let zt=si.reason?.message||"Sync failed.";throw ne(zt,"error",zt),_e(5e3),si.reason}return ne("Synced","success"),_e(),Zt}).finally(()=>{V=!1})},Ot=we=>{try{let xe=we?JSON.parse(we):[];return Array.isArray(xe)&&xe.length>0}catch{return!1}},Ii=we=>we?!!(we.options&&we.options.length>1):!1,ft=()=>{let we=Qe.querySelector('select[name="tts_google_voice_id"]'),xe=document.getElementById("aipkit_google_tts_voices_json_main");return!Ot(xe?.dataset?.voices)||!Ii(we)},yi=()=>{let we=dt();if(!we)return!1;let xe=Qe.querySelector('select[name="tts_elevenlabs_voice_id"]'),at=Qe.querySelector('select[name="tts_elevenlabs_model_id"]'),vt=document.getElementById(`aipkit_elevenlabs_voices_json_${we}`),ri=document.getElementById(`aipkit_elevenlabs_models_json_${we}`),Zt=Ot(vt?.dataset?.voices),si=Ot(ri?.dataset?.models);return!Zt||!si||!Ii(xe)||!Ii(at)},Xt=()=>{if(!Ge())return Promise.resolve();let we=be();return we==="Google"?ft()?kt():Promise.resolve():we==="ElevenLabs"&&yi()?Lt():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=Xt;let Ct=we=>{we!=null&&(ie=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:we}).then(xe=>{X=we,st(xe.message||"Saved","success"),Oi(),be()==="ElevenLabs"&&Ge()&&Lt().catch(()=>{})}).catch(xe=>{st(`Error: ${xe.message||"Failed to save."}`,"error")}).finally(()=>{if(ie=!1,K!==null){let xe=K;K=null,xe!==X&&Ct(xe)}}))},Gt=we=>{if(we!=null&&we!==X){if(ie){K=we;return}Ct(we)}},dt=()=>v&&v.value||e.getAttribute("data-active-bot-id"),ye=()=>{let we=dt();Qe.querySelectorAll(".aipkit_audio_format_combo_select").forEach(Zt=>{let si=Zt.closest(".aipkit_popover_option_row"),zt=si?.querySelector('[name="input_audio_format"]'),Pi=si?.querySelector('[name="output_audio_format"]'),Ei=Zt.querySelector('option[value="current"]');!zt||!Pi||!Ei||(Ei.textContent=`In: ${zt.value} / Out: ${Pi.value}`,Zt.value="current")});let at=Qe.querySelector('select[name="tts_google_voice_id"]');if(at&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Zt=document.getElementById("aipkit_google_tts_voices_json_main");try{let si=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(at.id,si,at.value||"")}catch(si){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",si)}}let vt=Qe.querySelector('select[name="tts_elevenlabs_voice_id"]');if(we&&vt&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_voices_json_${we}`);try{let si=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(vt.id,si,vt.value||"")}catch(si){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",si)}}let ri=Qe.querySelector('select[name="tts_elevenlabs_model_id"]');if(we&&ri&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_models_json_${we}`);try{let si=Zt?.dataset?.models?JSON.parse(Zt.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(ri.id,si,ri.value||"")}catch(si){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",si)}}},fe=we=>{let xe=dt();xe&&(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:xe,...we}).then(at=>{U=we,st(at.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(xe),Oi()}).catch(at=>{st(`Error: ${at.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let at=T;T=null,JSON.stringify(at)!==JSON.stringify(U)&&fe(at)}}))},Xe=we=>{if(!(!we||Object.keys(we).length===0)&&JSON.stringify(we)!==JSON.stringify(U)){if(q){T=we;return}fe(we)}};e.addEventListener("change",we=>{let xe=we.target;!xe||!(xe.matches(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch")||xe.matches(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch")||xe.matches(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"))||(Pn(),Xe(B()))}),Qe.addEventListener("change",we=>{let xe=we.target;if(xe){if(xe.matches(".aipkit_audio_format_combo_select")){let at=xe.closest(".aipkit_popover_option_row"),vt=at?.querySelector('[name="input_audio_format"]'),ri=at?.querySelector('[name="output_audio_format"]'),Zt=xe.querySelector('option[value="current"]'),si=xe.value||"";if(!vt||!ri||!Zt||!si)return;si.startsWith("in:")?vt.value=si.replace("in:",""):si.startsWith("out:")&&(ri.value=si.replace("out:","")),Zt.textContent=`In: ${vt.value} / Out: ${ri.value}`,xe.value="current",vt.dispatchEvent(new Event("change",{bubbles:!0})),ri.dispatchEvent(new Event("change",{bubbles:!0}));return}if(xe.matches('[name="elevenlabs_api_key"]')){Gt(xe.value);return}if((xe.matches(".aipkit_voice_input_toggle_switch")||xe.matches(".aipkit_stt_provider_select")||xe.matches('[name="stt_openai_model_id"]')||xe.matches(".aipkit_tts_toggle_switch")||xe.matches('[name="tts_auto_play"]')||xe.matches(".aipkit_tts_provider_select")||xe.matches('[name="tts_google_voice_id"]')||xe.matches('[name="tts_openai_voice_id"]')||xe.matches('[name="tts_openai_model_id"]')||xe.matches('[name="tts_elevenlabs_voice_id"]')||xe.matches('[name="tts_elevenlabs_model_id"]')||xe.matches(".aipkit_enable_realtime_voice_toggle")||xe.matches('[name="direct_voice_mode"]')||xe.matches('[name="input_audio_noise_reduction"]')||xe.matches('[name="realtime_model"]')||xe.matches('[name="realtime_voice"]')||xe.matches('[name="turn_detection"]')||xe.matches('[name="input_audio_format"]')||xe.matches('[name="output_audio_format"]')||xe.matches('[name="speed"]'))&&(Pn(),Xe(B()),xe.matches(".aipkit_tts_provider_select")&&Ge())){let at=be();at==="Google"?kt().catch(()=>{}):at==="ElevenLabs"&&Lt().catch(()=>{})}}}),Pn(),ye(),e.dataset.audioSettingsAutosaveBound="1"}if(zi&&$i&&!e.dataset.popupSettingsAutosaveBound){let q=!1,T=null;en&&ao&&Ui&&!en.dataset.bound&&(ao.addEventListener("click",K=>{if(K.preventDefault(),ao.getAttribute("aria-expanded")==="true"){ya();return}ao.setAttribute("aria-expanded","true"),Ui.hidden=!1,en.classList.add("is-open"),Kn(),hr()}),vn.forEach(K=>{K.addEventListener("change",()=>{K.checked&&Zr(K)})}),Object.values(sn).forEach(K=>{K.addEventListener("change",()=>{hr()})}),document.addEventListener("click",K=>{en&&!en.contains(K.target)&&ya()}),document.addEventListener("keydown",K=>{K.key==="Escape"&&ya()}),hr(),en.dataset.bound="1");let B=()=>{let K=ri=>zi&&zi.querySelector(ri)||Te&&Te.querySelector(ri)||e.querySelector(ri),V=ri=>{let Zt=K(ri);return Zt?Zt.value:null},Y=ri=>{let Zt=K(ri);return Zt?Zt.checked?"1":"0":null},ne={},_e=V('[name="popup_position"]');_e!==null&&(ne.popup_position=_e);let be=V('[name="popup_delay"]');be!==null&&(ne.popup_delay=be);let Ge=V('[name="popup_icon_style"]');Ge!==null&&(ne.popup_icon_style=Ge);let kt=V('[name="popup_icon_size"]');kt!==null&&(ne.popup_icon_size=kt);let Lt=V('[name="popup_icon_default"]:checked');if(Lt!==null)Lt==="__custom__"?ne.popup_icon_type="custom":(ne.popup_icon_type="default",ne.popup_icon_default=Lt);else{let ri=V('[name="popup_icon_type"]');ri!==null&&(ne.popup_icon_type=ri)}let Ot=V('[name="popup_icon_custom_url"]');Ot!==null&&(ne.popup_icon_custom_url=Ot);let Ii=V('[name="header_avatar_default"]:checked');if(Ii!==null)Ii==="__custom__"?ne.header_avatar_type="custom":(ne.header_avatar_type="default",ne.header_avatar_default=Ii);else{let ri=V('[name="header_avatar_type"]');ri!==null&&(ne.header_avatar_type=ri)}let ft=V('[name="header_avatar_url"]');ft!==null&&(ne.header_avatar_url=ft);let yi=V('[name="header_online_text"]');yi!==null&&(ne.header_online_text=yi);let Xt=Y('[name="popup_label_enabled"]');Xt!==null&&(ne.popup_label_enabled=Xt);let Ct=V('[name="popup_label_text"]');Ct!==null&&(ne.popup_label_text=Ct);let Gt=V('[name="popup_label_mode"]');Gt!==null&&(ne.popup_label_mode=Gt);let dt=V('[name="popup_label_size"]');dt!==null&&(ne.popup_label_size=dt);let ye=V('[name="popup_label_delay_seconds"]');ye!==null&&(ne.popup_label_delay_seconds=ye);let fe=V('[name="popup_label_auto_hide_seconds"]');fe!==null&&(ne.popup_label_auto_hide_seconds=fe);let Xe=Y('[name="popup_label_dismissible"]');Xe!==null&&(ne.popup_label_dismissible=Xe);let we=Y('[name="popup_label_show_on_desktop"]');we!==null&&(ne.popup_label_show_on_desktop=we);let xe=Y('[name="popup_label_show_on_mobile"]');xe!==null&&(ne.popup_label_show_on_mobile=xe);let at=V('[name="popup_label_frequency"]');at!==null&&(ne.popup_label_frequency=at);let vt=V('[name="popup_label_version"]');return vt!==null&&(ne.popup_label_version=vt),ne},U=B(),z=()=>v&&v.value||e.getAttribute("data-active-bot-id"),X=K=>{let V=z();V&&(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:V,...K}).then(Y=>{U=K,st(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{st(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&X(Y)}}))},ie=K=>{if(!(!K||Object.keys(K).length===0)&&JSON.stringify(K)!==JSON.stringify(U)){if(q){T=K;return}X(K)}};zi.addEventListener("change",K=>{let V=K.target;V&&((V.matches('[name="popup_icon_default"]')||V.matches('select[name="popup_icon_style"]')||V.matches('[name="header_avatar_default"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),(V.matches('[name="popup_position"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_icon_style"]')||V.matches('[name="popup_icon_size"]')||V.matches('[name="popup_icon_default"]')||V.matches('[name="popup_icon_custom_url"]')||V.matches('[name="header_avatar_default"]')||V.matches('[name="header_avatar_url"]')||V.matches('[name="header_online_text"]')||V.matches('[name="popup_label_enabled"]')||V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&ie(B()))}),e.addEventListener("change",K=>{let V=K.target;!V||!V.matches||!(V.matches('[name="header_online_text"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch")||V.matches('select[name="popup_position"]')||V.matches('select[name="popup_icon_style"]')||V.matches('select[name="popup_icon_size"]'))||((V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),!zi.contains(V)&&ie(B()))}),Te&&Te.addEventListener("change",K=>{let V=K.target;V&&(V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&ie(B())}),Qa(),e.dataset.popupSettingsAutosaveBound="1"}if(R&&$i&&!e.dataset.conversationSettingsAutosaveBound){let q=!1,T=null,B=()=>{let K=Y=>{let ne=R&&R.querySelector(Y)||ce&&ce.querySelector(Y);return ne?ne.value:""},V=Y=>{let ne=R.querySelector(Y);return ne?ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0":"0"};return{stream_enabled:V(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:V(".aipkit_stateful_convo_checkbox"),reasoning_effort:K('[name="reasoning_effort"]')}},U=B(),z=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:V,...K}).then(Y=>{U=K,st(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{st(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&z(Y)}}))},X=K=>{if(JSON.stringify(K)!==JSON.stringify(U)){if(q){T=K;return}z(K)}},ie=K=>{let V=K.target;V&&(V.matches(".aipkit_stream_enable_toggle")||V.matches(".aipkit_stateful_convo_checkbox")||V.matches(".aipkit_reasoning_effort_slider")||V.matches('[name="reasoning_effort"]'))&&(Yo(),X(B()))};R.addEventListener("change",ie),ce&&ce.addEventListener("change",ie),e.dataset.conversationSettingsAutosaveBound="1"}if(R&&$i&&!e.dataset.fileUploadAutosaveBound){let q=!1,T=null,B=()=>{let ie=R.querySelector('[name="enable_file_upload"]');return!ie||ie.disabled?"":ie.tagName==="SELECT"?ie.value==="1"?"1":"0":ie.checked?"1":"0"},U=B(),z=ie=>{let K=v&&v.value||e.getAttribute("data-active-bot-id");!K||ie===""||(q=!0,st("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:K,enable_file_upload:ie}).then(V=>{U=ie,st(V.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(K),Oi()}).catch(V=>{st(`Error: ${V.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,T!==null&&T!==U){let V=T;T=null,z(V)}else T=null}))},X=ie=>{if(!(ie===""||ie===U)){if(q){T=ie;return}z(ie)}};R.addEventListener("change",ie=>{let K=ie.target;K&&K.matches('[name="enable_file_upload"]')&&(X(B()),Pe()==="1"?It():pt())}),e.dataset.fileUploadAutosaveBound="1"}let Ur=v&&v.value||e.getAttribute("data-active-bot-id");if(Ur&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(Ur);return}let es=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";c(es)}window.aipkit_initChatbotBuilder=o})();(function(){"use strict";function k(n){if(!n)return;let t=n.querySelector(".aipkit_token_limit_mode_select"),a=n.querySelector(".aipkit_token_general_user_limit_field"),s=n.querySelector(".aipkit_token_role_limits_container");if(!t||!a||!s){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let l=t.value;a.style.display=l==="general"?"block":"none",s.style.display=l==="role_based"?"block":"none"}function r(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Token Management JS: Main content container not found.");return}n.addEventListener("change",function(a){let s=a.target.closest(".aipkit_token_limit_mode_select");if(!s)return;let l=s.closest(".aipkit_accordion-content");l?k(l):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",s)}),n.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(a=>{let s=a.querySelector(".aipkit_accordion-content");s&&k(s)})}window.aipkit_initTokenManagementUI=r})();(function(){"use strict";function k(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let n=document.querySelector(".aipkit_chatbot_module_container");n&&(n.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(r){let n=r.dataset.botId,t=document.getElementById(`aipkit_trigger_builder_${n}`);n&&t&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(n):n&&t&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${n}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let t=document.querySelector(".aipkit_chatbot_module_container");t&&t.addEventListener("click",function(a){if(a.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(a.target.closest("#aipkit_chatbot_header_save_btn")){let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");o&&(typeof o.requestSubmit=="function"?o.requestSubmit():o.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(a.target.closest(".aipkit_header_reset_btn")){let o=t.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");o&&(o.style.display="none");let i=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,d=t.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",u=t.querySelector("#aipkit_header_action_feedback");if(!i||!u)return;u.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${i}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,u.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{u.innerHTML=""},{once:!0}),u.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{u.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:i}).then(p=>{u.innerHTML=`<span class="aipkit_action_status_message success">${p.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:i,aipkit_silent:!0,aipkit_force_refresh:!0}),setTimeout(()=>{u.innerHTML=""},3e3)}).catch(p=>{u.innerHTML=`<span class="aipkit_action_status_message error">Error: ${p.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{u.innerHTML=""},4e3)})},{once:!0});return}if(a.target.closest(".aipkit_header_delete_btn")){let o=t.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");o&&(o.style.display="none");let e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),i=e?.dataset.botId,d=e?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",u=t.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",p=t.querySelector("#aipkit_header_action_feedback");if(!i||!p)return;if(d){p.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{p.innerHTML=""},3e3);return}p.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${i}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,p.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{p.innerHTML=""},{once:!0}),p.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{p.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:i}).then(f=>{p.innerHTML=`<span class="aipkit_action_status_message success">${f.message||"Chatbot deleted successfully."}</span>`;let m=null,g=document.getElementById("aipkit_chatbot_main_selector_container");if(g){let _=Array.from(g.querySelectorAll(".aipkit_tab_dropdown_item[data-bot-id]")),w=_.filter(E=>{let x=E.getAttribute("data-bot-id");return x&&x!==String(i)}),h=_.findIndex(E=>E.getAttribute("data-bot-id")===String(i));if(h>0){let E=_[h-1],x=E?E.getAttribute("data-bot-id"):null;x&&x!==String(i)&&(m=x)}!m&&w.length>0&&(m=w[0].getAttribute("data-bot-id"))}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let _=m?{force_active_bot_id:m}:{};_.aipkit_silent=!0,_.aipkit_force_refresh=!0,window.aipkit_loadModule("chatbot",_)}setTimeout(()=>{p.innerHTML=""},3e3)}).catch(f=>{p.innerHTML=`<span class="aipkit_action_status_message error">Error: ${f.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{p.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=k})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_ai_forms_list_tbody"),t=document.getElementById("aipkit_ai_forms_container"),a=window.aipkit_escapeHtml||(o=>o),s=wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o,l=wp.i18n&&wp.i18n._n?wp.i18n._n:null,c=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;n&&(n.innerHTML="",!(!r||r.length===0)&&r.forEach(o=>{let e=window.aipkit_dashboard?.isProPlan??!1,i=window.aipkit_dashboard?.upgradeUrl||"#",d="",u="";if(e)d=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${s("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let C=s("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");d=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${a(C)}">${s("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,u=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${s("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${a(i)}" target="_blank" rel="noopener noreferrer">
                        ${s("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let p=n.insertRow(),f=p.insertCell();f.classList.add("aipkit_ai_form_title_cell");let m=a(o.title||s("Untitled","gpt3-ai-content-generator")),g=o.updated_at||o.updatedAt||o.updated||"",_="",w="";g&&(typeof window.aipkit_formatRelativeDateTime=="function"?_=window.aipkit_formatRelativeDateTime(g):typeof window.aipkit_formatUtcDateTime=="function"?_=window.aipkit_formatUtcDateTime(g):_=g,typeof window.aipkit_formatUtcDateTime=="function"&&(w=window.aipkit_formatUtcDateTime(g)));let h=o.submissions_count??o.submission_count??o.submissionsCount??0,E=Number.isFinite(Number(h))?Number(h):0,x=[];if(_){let C=c?c(s("Updated %s","gpt3-ai-content-generator"),_):`${s("Updated","gpt3-ai-content-generator")} ${_}`,A=w?` title="${a(w)}"`:"";x.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${A}>${a(C)}</span>`)}if(E>0){let C=`${E} ${s(E===1?"submission":"submissions","gpt3-ai-content-generator")}`;l&&c&&(C=c(l("%s submission","%s submissions",E,"gpt3-ai-content-generator"),E)),x.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${a(C)}</span>`)}let v=x.length?`
          <span class="aipkit_ai_form_meta">
            ${x.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";f.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${m}">${m}</span>
        ${v}
      `;let I=p.insertCell();I.classList.add("aipkit_ai_form_model_cell");let P=o.model||s("Default","gpt3-ai-content-generator");I.textContent=P,I.title=P;let b=p.insertCell();b.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let y=`aipkit_ai_form_theme_${o.id}`;b.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${o.id}" readonly value="${a(o.shortcode)}" data-aipkit-shortcode-display="${o.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${o.id}" title="${s("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${s("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${s("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${o.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${o.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${o.id}">
                  ${s("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${s("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${d}
                    ${u}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${y}">
                              ${s("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${y}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="theme">
                                    <option value="light">${s("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${s("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${s("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${a(o.shortcode)}" data-aipkit-shortcode-display="${o.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${s("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${s("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,t&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(o.id,t);let S=p.insertCell();S.classList.add("aipkit_form_actions_cell"),S.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${o.id}" title="${s("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${s("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${o.id}" data-form-title="${a(o.title||"")}" title="${s("Preview","gpt3-ai-content-generator")}" aria-label="${s("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${s("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${s("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${o.id}" title="${s("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${s("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${o.id}" title="${s("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${s("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${o.id}" data-form-title="${a(o.title)}" title="${s("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${s("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=k})();(function(){"use strict";function k(r){let n=window.aipkitAIFormsListState,t=document.getElementById("aipkit_ai_forms_pagination"),a=document.getElementById("aipkit_ai_forms_count_summary");if(!t||!r||!n)return;let s=wp.i18n&&wp.i18n.__?wp.i18n.__:i=>i,l=wp.i18n&&wp.i18n._n?wp.i18n._n:(i,d,u)=>u===1?i:d;t.innerHTML="";let{total_forms:c,total_pages:o}=r,e=n.currentPage;if(a){let i=l("form","forms",c,"gpt3-ai-content-generator");a.textContent=`${c.toLocaleString()} ${i}`}if(!(c<=0)&&o>1){let i=document.createElement("span");i.className="aipkit_pagination-links";let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",d.innerHTML=`\xAB ${s("Previous","gpt3-ai-content-generator")}`,d.disabled=e<=1,i.appendChild(d);let u=document.createElement("span");u.className="aipkit_pagination-current",u.textContent=`${s("Page","gpt3-ai-content-generator")} ${e} ${s("of","gpt3-ai-content-generator")} ${o}`,i.appendChild(u);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",p.innerHTML=`${s("Next","gpt3-ai-content-generator")} \xBB`,p.disabled=e>=o,i.appendChild(p),t.appendChild(i)}}window.aipkitForms_renderPagination=k})();(function(){"use strict";function k(){let r=window.aipkitAIFormsListState;if(!r||r.isLoading)return;r.isLoading=!0;let n=document.getElementById("aipkit_ai_forms_list_tbody"),t=document.getElementById("aipkit_no_ai_forms_message"),a=document.getElementById("aipkit_ai_forms_pagination");n&&(n.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),t&&(t.style.display="none"),a&&(a.innerHTML="");let l={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:r.currentPage,search:r.searchQuery,sort_by:r.sortColumn,sort_order:r.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",l).then(c=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(c.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(c.pagination||{}),t&&(!c.forms||c.forms.length===0)){t.style.display="block";let o=!!r.searchQuery&&r.searchQuery.trim().length>0;t.textContent=o?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(c=>{n&&(n.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${c.message}</td></tr>`)}).finally(()=>{r.isLoading=!1})}window.aipkitForms_fetchForms=k})();(function(){"use strict";let k;function r(){let n=document.getElementById("aipkit_ai_forms_list_container");if(!n||n.dataset.listListenersAttached)return;n.dataset.listListenersAttached="true";let t=window.aipkitAIFormsListState;if(!t){console.error("AI Forms Events: List state object is not available.");return}n.addEventListener("click",function(s){let l=s.target,c=l.closest(".aipkit-sortable-col");if(c){let o=c.dataset.sortKey;t.sortColumn===o?t.sortDirection=t.sortDirection==="asc"?"desc":"asc":(t.sortColumn=o,t.sortDirection="asc"),t.currentPage=1,n.querySelectorAll(".aipkit-sortable-col").forEach(e=>e.removeAttribute("data-sort-direction")),c.setAttribute("data-sort-direction",t.sortDirection),window.aipkitForms_fetchForms();return}if(l.matches(".aipkit_pagination_prev")){t.currentPage>1&&(t.currentPage--,window.aipkitForms_fetchForms());return}if(l.matches(".aipkit_pagination_next")){t.currentPage++,window.aipkitForms_fetchForms();return}});let a=n.querySelector("#aipkit_ai_forms_search_input");a&&a.addEventListener("input",function(){clearTimeout(k),k=setTimeout(()=>{t.searchQuery=this.value,t.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=r})();(function(){"use strict";function k(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=k})();(function(){"use strict";function k(r){let n=window.aipkitAIFormsState;if(!r){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_ai_form_elements_palette"),a=r.querySelector("#aipkit_ai_form_designer_area"),s=r.querySelector("#aipkit_form_designer_placeholder");if(!t||!a){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(t.dataset.dragListenersAttached==="true"&&a.dataset.dragListenersAttached==="true")return;t.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",o=>{n.draggedElementType=o.target.dataset.elementType,o.dataTransfer.setData("text/plain",n.draggedElementType),o.dataTransfer.effectAllowed="copy",o.target.classList.add("aipkit-dragging"),n.draggedElement=null}),c.addEventListener("dragend",o=>{o.target.classList.remove("aipkit-dragging"),n.draggedElementType=null}),c.dataset.dragStartListenerAttached="true")}),t.dataset.dragListenersAttached="true",a.dataset.dragListenersAttached!=="true"&&(a.addEventListener("dragstart",c=>{c.target.classList.contains("aipkit_dropped_element")&&(n.draggedElement=c.target,c.dataTransfer.setData("text/element-id",c.target.id),c.dataTransfer.effectAllowed="move",setTimeout(()=>{n.draggedElement&&(n.draggedElement.style.opacity="0.5")},0),n.draggedElementType=null)}),a.addEventListener("dragend",c=>{n.draggedElement&&(n.draggedElement.style.opacity="1",n.draggedElement=null)}),a.addEventListener("dragover",c=>{c.preventDefault();let o=c.target.closest(".aipkit_dropped_element");a.classList.add("aipkit-drag-over"),n.draggedElement&&o&&n.draggedElement!==o?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),a.addEventListener("dragleave",c=>{a.contains(c.relatedTarget)||a.classList.remove("aipkit-drag-over")}),a.addEventListener("drop",c=>{c.preventDefault(),a.classList.remove("aipkit-drag-over");let o=c.dataTransfer.getData("text/element-id");if(n.draggedElement&&o===n.draggedElement.id){let e=c.target.closest(".aipkit_dropped_element"),i=null;if(e&&e!==n.draggedElement){let d=e.getBoundingClientRect();i=c.clientY>d.top+d.height/2?e.nextSibling:e}a.insertBefore(n.draggedElement,i),n.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(n.draggedElementType){if(s&&s.style.display!=="none"&&(s.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let e=window.aipkitForms_createNewFormElementData(n.draggedElementType);n.formStructure.push(e),window.aipkitForms_renderDroppedElement(a,e,null)}n.draggedElementType=null,n.draggedElement=null}),a.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=k})();(function(){"use strict";function k(){let r=window.aipkitAIFormsState,n=document.getElementById("aipkit_ai_form_designer_area");if(!n)return;let t=[];n.querySelectorAll(".aipkit_layout_row").forEach(s=>{let l=s.id,c=r.formStructure.find(i=>i.internalId===l);if(!c)return;let o={internalId:l,type:"layout-row",columns:[]};s.querySelectorAll(".aipkit_layout_column").forEach(i=>{let d=i.id,u=c.columns.find(m=>m.internalId===d);if(!u)return;let p={internalId:d,width:u.width,elements:[]};i.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let g=m.id,_=null;r.formStructure.forEach(w=>{w.columns.forEach(h=>{let E=h.elements.find(x=>x.internalId===g);E&&(_=E)})}),_&&p.elements.push(_)}),o.columns.push(p)}),t.push(o)}),r.formStructure=t,typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(document.getElementById("aipkit_ai_forms_container"))}window.aipkitForms_updateFormStructureOrder=k})();(function(){"use strict";function k(n){let t=window.aipkitAIFormsState;t.droppedElementCounter++;let a=`field_${n.replace(/-/g,"_")}_${t.droppedElementCounter}`;switch(n){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${t.droppedElementCounter}`,type:n,label:`New ${n.replace(/-/g," ").replace(/\b\w/g,c=>c.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:a,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let s,l;return n==="select"?(s="New Dropdown",l="select"):n==="radio-button"?(s="New Radio Buttons",l="radio"):(s="New Checkbox Group",l="checkbox"),{internalId:`el-${Date.now()}-${t.droppedElementCounter}`,type:n,label:s,fieldId:`${l}_${t.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${t.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${t.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function r(n){let t=Date.now(),a=[];switch(n){case"1-col":a=[{internalId:`col-${t}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":a=[{internalId:`col-${t}-1`,width:"50%",elements:[]},{internalId:`col-${t}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":a=[{internalId:`col-${t}-1`,width:"33.33%",elements:[]},{internalId:`col-${t}-2`,width:"33.33%",elements:[]},{internalId:`col-${t}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":a=[{internalId:`col-${t}-1`,width:"30%",elements:[]},{internalId:`col-${t}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":a=[{internalId:`col-${t}-1`,width:"70%",elements:[]},{internalId:`col-${t}-2`,width:"30%",elements:[]}];break;default:a=[{internalId:`col-${t}-1`,width:"100%",elements:[]}]}return{internalId:`row-${t}`,type:"layout-row",columns:a}}window.aipkitForms_createNewFormElementData=k,window.aipkitForms_createNewLayoutData=r})();(function(){"use strict";function k(r,n,t=null){let a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,s=window.aipkit_escapeHtml||function(p){return p},l=document.createElement("div");l.className="aipkit_dropped_element",l.id=n.internalId,l.dataset.elementType=n.type;let c=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${a("Drag to reorder","gpt3-ai-content-generator")}"></span>`,o="",e=`${n.internalId}-field`,i="";switch(n.helpText&&(i=`<p class="aipkit_dropped_element_help_text">${s(n.helpText)}</p>`),n.type){case"text-input":o=`<label class="aipkit_dropped_element_label" for="${e}">${s(n.label)} ${n.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${e}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${s(n.placeholder)}" readonly>
                    ${i}`;break;case"textarea":o=`<label class="aipkit_dropped_element_label" for="${e}">${s(n.label)} ${n.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${e}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${s(n.placeholder)}" readonly></textarea>
                    ${i}`;break;case"select":let p="";n.options&&n.options.length>0?n.options.forEach(g=>{p+=`<option value="${s(g.value)}">${s(g.text)}</option>`}):p=`<option>${a("No options configured","gpt3-ai-content-generator")}</option>`,o=`<label class="aipkit_dropped_element_label" for="${e}">${s(n.label)} ${n.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${e}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${p}</select>
                    ${i}`;break;case"radio-button":let f="";n.options&&n.options.length>0?n.options.forEach((g,_)=>{let w=`${e}-${_}`;f+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${n.internalId}" disabled>
                                    <label for="${w}">${s(g.text)}</label>
                                </div>`}):f=`<p class="aipkit-no-options-note">${a("No options configured","gpt3-ai-content-generator")}</p>`,o=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${s(n.label)} ${n.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${f}
                    </fieldset>
                    ${i}`;break;case"checkbox":let m="";n.options&&n.options.length>0?n.options.forEach((g,_)=>{let w=`${e}-${_}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${n.internalId}-${_}" disabled>
                                    <label for="${w}">${s(g.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${a("No options configured","gpt3-ai-content-generator")}</p>`,o=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${s(n.label)} ${n.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${i}`;break;case"file-upload":o=`<label class="aipkit_dropped_element_label" for="${e}">${s(n.label)} ${n.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${e}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${i}`;break;default:o=`<p>${s(n.label)}</p>${i}`}let d=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${a("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,u=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${a("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;l.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${o}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${c}
            ${d}
            ${u}
        </div>
    `,t?r.insertBefore(l,t):r.appendChild(l)}window.aipkitForms_renderFieldInColumn=k,window.aipkitForms_renderDroppedElement=k})();(function(){"use strict";function k(r,n){let t=window.aipkitAIFormsState,a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c;if(!n){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let s=n.querySelector("#aipkit_ai_form_designer_area");if(!s){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let l=s.querySelector(`#${CSS.escape(r)}`);if(l){if(l.remove(),t.formStructure.forEach(c=>{c.columns.forEach(o=>{o.elements=o.elements.filter(e=>e.internalId!==r)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(n),t.selectedDesignerElementId===r&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(n):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),s.querySelectorAll(".aipkit_dropped_element").length===0&&s.querySelectorAll(".aipkit_layout_row").length===0){let c=s.querySelector("#aipkit_form_designer_placeholder");c||(c=document.createElement("div"),c.className="aipkit_form_designer_placeholder",c.id="aipkit_form_designer_placeholder",c.innerHTML=`<span class="dashicons dashicons-layout"></span>${a("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,s.appendChild(c)),c.style.display="flex"}typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(n)}}window.aipkitForms_deleteDroppedElement=k})();(function(){"use strict";function k(){let r=window.aipkitAIFormsState,n=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,t=document.getElementById("aipkit_form_editor_container");if(!t)return;let a=t.querySelector("#aipkit_ai_form_prompt_template"),s=t.querySelector("#aipkit_prompt_validation_results");if(!a||!s)return;let l=a.value,c=[],o=[],e=new Set;r.formStructure.forEach(m=>{m.columns.forEach(g=>{g.elements.forEach(_=>{_.fieldId&&e.add(_.fieldId)})})});let i=/{[a-zA-Z0-9_]+}/g,d=(l.match(i)||[]).map(m=>m.slice(1,-1)),u=new Set(d);d.forEach(m=>{e.has(m)||c.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),e.forEach(m=>{u.has(m)||o.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let p=l;if(d.forEach(m=>{let g=new RegExp(`\\{${m}\\}`,"g");p=p.replace(g,"")}),/[{}]/.test(p)&&c.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),s.className="aipkit_form-help",s.innerHTML="",c.length>0){s.classList.add("aipkit-validation-error");let m=`<strong>${n("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;c.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>",s.innerHTML=m}else{s.classList.add("aipkit-validation-success");let m=`<strong>${n("Validation Passed!","gpt3-ai-content-generator")}</strong> (${d.length} of ${e.size} fields used).`;o.length>0&&(m+=`<br><strong>${n("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,o.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>"),s.innerHTML=m}s.style.display="block",s.dismissTimer&&clearTimeout(s.dismissTimer);let f=c.length>0?8e3:5e3;s.dismissTimer=setTimeout(()=>{s.style.display="none",s.innerHTML=""},f)}window.aipkitForms_validatePrompt=k})();(function(){"use strict";function k(r,n){let t=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,l=window.aipkit_escapeHtml||function(p){return p};if(!n){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}n.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(p=>p.classList.remove("aipkit-element-selected"));let c=n.querySelector(`#${CSS.escape(r)}`);c&&c.classList.add("aipkit-element-selected"),t.selectedDesignerElementId=r;let o=null;for(let p of t.formStructure){for(let f of p.columns){let m=f.elements.find(g=>g.internalId===r);if(m){o=m;break}}if(o)break}if(!o){console.error(`showSettingsPanel: Could not find element data for ID ${r} in state.`,t.formStructure);return}let e=n.querySelector("#aipkit_ai_form_elements_palette"),i=n.querySelector("#aipkit_ai_form_element_settings_panel"),d=i?i.querySelector("#aipkit_settings_panel_fields"):null,u=i?i.querySelector("#aipkit_settings_panel_element_type"):null;if(!e||!i||!d||!u){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(u.textContent=`(${o.type.replace(/-/g," ").replace(/\b\w/g,p=>p.toUpperCase())})`,d.innerHTML="",d.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${o.internalId}">${s(a.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${l(o.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${o.internalId}">${s(a.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${l(o.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${s("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${s(a.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(o.type==="text-input"||o.type==="textarea")&&(d.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${o.internalId}">${s(a.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${l(o.placeholder||"")}">
                </div>`),d.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${o.internalId}">
                    <input type="checkbox" id="setting-required-${o.internalId}" class="aipkit-setting-field" data-setting="required" ${o.required?"checked":""}>
                    ${s(a.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${o.internalId}">${s("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${o.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${l(s("This text will appear under the field.","gpt3-ai-content-generator"))}">${l(o.helpText||"")}</textarea>
            </div>
        `,o.type==="select"||o.type==="radio-button"||o.type==="checkbox"){let p=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${s(a.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(o.options||[]).forEach((f,m)=>{p+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${l(f.value)}" placeholder="${s(a.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${l(f.text)}" placeholder="${s(a.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${s(a.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),p+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${s(a.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,d.innerHTML+=p}e.style.display="none",i.style.display="block"}window.aipkitForms_showSettingsPanel=k})();(function(){"use strict";function k(r){let n=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!r){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let a=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!a){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let s=a.querySelector("#aipkit_select_options_container");if(!s){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let l=s.querySelectorAll(".aipkit_select_option_row").length,c=document.createElement("div");c.className="aipkit_select_option_row",c.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${l}" placeholder="${t(n.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${l}" placeholder="${t(n.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${t(n.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,s.appendChild(c)}window.aipkitForms_addSelectOptionRow=k})();(function(){"use strict";function k(r){let n=window.aipkitAIFormsState;if(!r){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(s=>s.classList.remove("aipkit-element-selected")),n.selectedDesignerElementId=null;let t=r.querySelector("#aipkit_ai_form_elements_palette"),a=r.querySelector("#aipkit_ai_form_element_settings_panel");t&&(t.style.display="block"),a&&(a.style.display="none")}window.aipkitForms_hideSettingsPanel=k})();(function(){"use strict";function k(r,n){let t=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f;if(!n){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let l=null;for(let f of t.formStructure){for(let m of f.columns){let g=m.elements.find(_=>_.internalId===r);if(g){l=g;break}}if(l)break}if(!l){console.error(`updateElementFromSettingsPanel: Element data for ID ${r} not found.`);return}let c=n.querySelector("#aipkit_ai_form_element_settings_panel");if(!c){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let o=c.querySelector('input[data-setting="label"]');o&&(l.label=o.value);let e=c.querySelector('input[data-setting="fieldId"]');if(e){let f=e.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!f){let g=l.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");g||(g=l.type.replace(/-/g,"_")),f=`${g}_${r.split("-").pop()}`}let m=!0;e:for(let g of t.formStructure)for(let _ of g.columns)if(_.elements.some(w=>w.internalId!==r&&w.fieldId===f)){m=!1;break e}m&&f.length>0?(l.fieldId=f,e.value=f,e.classList.remove("aipkit_input_error")):f.length>0&&e.classList.add("aipkit_input_error")}let i=c.querySelector('input[data-setting="required"]');i&&(l.required=i.checked);let d=c.querySelector('textarea[data-setting="helpText"]');if(d&&(l.helpText=d.value),l.type==="text-input"||l.type==="textarea"){let f=c.querySelector('input[data-setting="placeholder"]');f&&(l.placeholder=f.value)}(l.type==="select"||l.type==="radio-button"||l.type==="checkbox")&&(l.options=[],c.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let g=m.querySelector('input[data-setting="option-value"]'),_=m.querySelector('input[data-setting="option-text"]');g&&_&&g.value.trim()!==""?l.options.push({value:g.value,text:_.value}):g&&_&&g.value.trim()===""&&_.value.trim()!==""&&l.options.push({value:_.value,text:_.value})}));let u=n.querySelector("#aipkit_ai_form_designer_area"),p=u?u.querySelector(`#${CSS.escape(r)}`):null;if(p&&u){let f=p.parentElement,m=u.scrollTop,g=p.classList.contains("aipkit-element-selected"),_=p.nextElementSibling;if(p.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(f,l,_):console.error("AI Forms updateElement: renderFieldInColumn function missing."),g){let w=u.querySelector(`#${CSS.escape(r)}`);w&&w.classList.add("aipkit-element-selected")}u.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(n),typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(n)}window.aipkitForms_updateElementFromSettingsPanel=k})();(function(){"use strict";function k(a){let s=window.aipkitAIFormsState;if(!a)return;let l=a.querySelector("#aipkit_prompt_snippets_container");if(!l)return;l.innerHTML="";let c=new Set;if(s.formStructure.forEach(o=>{o.columns.forEach(e=>{e.elements.forEach(i=>{i.fieldId&&c.add(i.fieldId)})})}),c.size>0){let o=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;c.forEach(e=>{let i=document.createElement("button");i.type="button",i.className="aipkit_prompt_snippet",i.dataset.fieldId=e,i.title=o("Click to copy","gpt3-ai-content-generator"),i.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${e}}`,l.appendChild(i)})}}function r(a){if(!a)return;let s=a.querySelector("#aipkit_form_editor_container");if(!s){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let l=s.querySelector("#aipkit_prompt_snippets_container");if(!l){console.warn("AI Forms: Prompt snippets container not found for init.");return}l.dataset.listenerAttached!=="true"&&(l.addEventListener("click",function(c){let o=c.target.closest(".aipkit_prompt_snippet");if(!o)return;let e=o.dataset.fieldId;e&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${e}}`,o)}),l.dataset.listenerAttached="true")}function n(a,s){if(!a)return;let l=a.querySelector("#aipkit_ai_form_ai_provider");l&&(l.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(s?l.dataset.aipkitProviderNoticeArmed="true":delete l.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(a))}function t(a=null,s){let l=window.aipkitAIFormsState,c=window.aipkit_ai_forms_config||{text:{}},o=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,e=window.aipkit_escapeHtml||function(m){return m};if(!s){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}l.currentFormId=a,l.droppedElementCounter=0,l.formStructure=[],l.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(s):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let i=s.querySelector("#aipkit_form_editor_container"),d=s.querySelector("#aipkit_ai_forms_list_container"),u=s.querySelector("#aipkit_ai_forms_editor_actions"),p=s.querySelector("#aipkit_create_new_ai_form_btn"),f=s.querySelector("#aipkit_ai_forms_settings_trigger");d.style.display="none",i.style.display="block",u&&(u.style.display="flex"),p&&(p.style.display="none"),f&&(f.style.display="none"),requestAnimationFrame(()=>{let m=()=>{typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(s)},g=s.querySelector("#aipkit_ai_form_title"),_=i.querySelector("#aipkit_ai_form_prompt_template"),w=i.querySelector("#aipkit_ai_form_id"),h=i.querySelector("#aipkit_ai_form_designer_area"),E=i.querySelector("#aipkit_ai_form_ai_provider"),x=i.querySelector("#aipkit_ai_form_ai_model"),v=i.querySelector("#aipkit_ai_form_temperature"),I=i.querySelector("#aipkit_ai_form_temperature_value"),P=i.querySelector("#aipkit_ai_form_max_tokens"),b=i.querySelector("#aipkit_ai_form_max_tokens_value"),y=i.querySelector("#aipkit_ai_form_top_p"),S=i.querySelector("#aipkit_ai_form_top_p_value"),C=i.querySelector("#aipkit_ai_form_frequency_penalty"),A=i.querySelector("#aipkit_ai_form_frequency_penalty_value"),M=i.querySelector("#aipkit_ai_form_presence_penalty"),$=i.querySelector("#aipkit_ai_form_presence_penalty_value"),W=s.querySelector("#aipkit_preview_ai_form_btn"),H=()=>{let J=document.createElement("div");return J.className="aipkit_form_designer_placeholder",J.id="aipkit_form_designer_placeholder",J.innerHTML=`<span class="dashicons dashicons-layout"></span>${o("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,J};if(!i||!d||!g||!_||!w||!h||!E||!x||!v||!P||!W||!I||!b||!y||!S||!C||!A||!M||!$){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:s.innerHTML.substring(0,500)});return}let N=s.querySelector("#aipkit_ai_forms_header_title_default"),G=s.querySelector("#aipkit_ai_forms_header_title_editor"),Q=s.querySelector("#aipkit_ai_forms_title_display"),F=s.querySelector("#aipkit_ai_forms_title_text"),L=o("New Form","gpt3-ai-content-generator"),O=()=>{if(!F||!Q||!g)return;let pe=g.value.trim()||L;F.textContent=pe,Q.setAttribute("title",pe)},D=()=>{!Q||!g||(Q.style.display="none",g.style.display="inline-block",g.focus(),g.select())},R=()=>{!Q||!g||(g.style.display="none",Q.style.display="inline-flex",O())};N&&(N.style.display="none"),G&&(G.style.display="flex"),G&&G.dataset.inlineTitleBound!=="true"&&Q&&g&&(Q.addEventListener("click",D),g.addEventListener("blur",R),g.addEventListener("keydown",J=>{J.key==="Enter"&&(J.preventDefault(),g.blur())}),g.addEventListener("input",O),G.dataset.inlineTitleBound="true"),g.value="",_.value="",w.value="",h.innerHTML="",h.appendChild(H()),R(),k(s);let Z={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(i.querySelectorAll('input[name^="labels["]').forEach(J=>{let pe=J.name.match(/labels\[(.+)\]/),Ce=pe?pe[1]:null;Ce&&Z[Ce]!==void 0?J.value=Z[Ce]:J.value=""}),!a){if(E.value="OpenAI",v&&I){let J=window.aipkit_dashboard?.ai_params?.temperature||1;v.value=J,I.textContent=J}if(P&&b){let J=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;P.value=J,b.textContent=J}if(y&&S){let J=window.aipkit_dashboard?.ai_params?.top_p||1;y.value=J,S.textContent=J}if(C&&A){let J=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;C.value=J,A.textContent=J}if(M&&$){let J=window.aipkit_dashboard?.ai_params?.presence_penalty||0;M.value=J,$.textContent=J}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(i)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(E.value,i),m(),n(i,!0),typeof window.aipkitForms_onEditorReady=="function"&&window.aipkitForms_onEditorReady(s)}a?(W.disabled=!1,w.value=a,h.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${o("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:a,_ajax_nonce:c.nonce_manage_forms}).then(J=>{if(J.form){g.value=J.form.title||"",R(),_.value=J.form.prompt_template||"",E.value=J.form.ai_provider||"OpenAI",v&&I&&(v.value=J.form.temperature,I.textContent=J.form.temperature),P&&b&&(P.value=J.form.max_tokens,b.textContent=J.form.max_tokens),y&&S&&(y.value=J.form.top_p,S.textContent=J.form.top_p),C&&A&&(C.value=J.form.frequency_penalty,A.textContent=J.form.frequency_penalty),M&&$&&(M.value=J.form.presence_penalty,$.textContent=J.form.presence_penalty);let pe=J.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(Jt=>{let Ut=i.querySelector(`input[name="labels[${Jt}]"]`);Ut&&(Ut.value=pe[Jt]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(E.value,J.form.ai_model);let He=i.querySelector("#aipkit_ai_form_reasoning_effort");He&&(He.value=J.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(i);let Ke=i.querySelector('input[name="enable_vector_store"]'),nt=Ke?Ke.closest('[data-aipkit-settings-panel="context"]'):null;if(nt){let Jt=nt.querySelector('select[name="vector_store_provider"]'),Ut=nt.querySelector('select[name="openai_vector_store_ids[]"]'),Di=nt.querySelector('select[name="pinecone_index_name"]'),xt=nt.querySelector('select[name="qdrant_collection_name"]'),pi=nt.querySelector(".aipkit_vector_embedding_select"),Wt=nt.querySelector('select[name="vector_embedding_provider"]'),Wi=nt.querySelector('select[name="vector_embedding_model"]'),Sn=nt.querySelector('input[name="vector_store_top_k"]'),Ki=nt.querySelector("#aipkit_ai_form_vector_store_top_k_value"),ln=nt.querySelector('input[name="vector_store_confidence_threshold"]'),Vn=nt.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(Ke.checked=J.form.enable_vector_store==="1",Jt&&(Jt.value=J.form.vector_store_provider||"openai"),Di&&(Di.value=J.form.pinecone_index_name||""),Di&&J.form.pinecone_index_name&&!Array.from(Di.options).some(ke=>ke.value===J.form.pinecone_index_name)){let ke=new Option(`${J.form.pinecone_index_name}`,J.form.pinecone_index_name,!1,!0);Di.appendChild(ke),Di.value=J.form.pinecone_index_name}if(xt){let ke=Array.isArray(J.form.qdrant_collection_names)?J.form.qdrant_collection_names[0]:J.form.qdrant_collection_name||"";if(ke&&!Array.from(xt.options).some(Le=>Le.value===ke)){let Le=new Option(`${ke}`,ke,!1,!0);xt.appendChild(Le)}ke&&(xt.value=ke)}if(Wt&&(Wt.value=J.form.vector_embedding_provider||"openai"),Sn&&Ki){let ke=J.form.vector_store_top_k||3;Sn.value=ke,Ki.textContent=ke}if(ln&&Vn){let ke=J.form.vector_store_confidence_threshold||20;ln.value=ke,Vn.textContent=ke+"%"}if(Ut&&J.form.openai_vector_store_ids&&Array.isArray(J.form.openai_vector_store_ids)){let ke=new Set(Array.from(Ut.options).map(Le=>Le.value));J.form.openai_vector_store_ids.forEach((Le,Oe)=>{if(Le&&!ke.has(Le)){let qt=new Option(Le,Le,!1,!0);Ut.appendChild(qt),ke.add(Le)}}),Array.from(Ut.options).forEach(Le=>{Le.selected=J.form.openai_vector_store_ids.includes(Le.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(nt),Wi&&(Wi.value=J.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs(nt,pi),Ke.dispatchEvent(new Event("change",{bubbles:!0}))}let mt=i.querySelector('input[name="openai_web_search_enabled"]'),wt=i.querySelector('input[name="claude_web_search_enabled"]'),ge=i.querySelector('input[name="openrouter_web_search_enabled"]'),se=i.querySelector('input[name="google_search_grounding_enabled"]');mt&&(mt.checked=J.form.openai_web_search_enabled==="1"),wt&&(wt.checked=J.form.claude_web_search_enabled==="1"),ge&&(ge.checked=J.form.openrouter_web_search_enabled==="1"),se&&(se.checked=J.form.google_search_grounding_enabled==="1");let ae=i.querySelector('select[name="openai_web_search_context_size"]'),Se=i.querySelector('select[name="openai_web_search_loc_type"]'),je=i.querySelector('input[name="openai_web_search_loc_country"]'),bt=i.querySelector('input[name="openai_web_search_loc_city"]'),re=i.querySelector('input[name="openai_web_search_loc_region"]'),ve=i.querySelector('input[name="openai_web_search_loc_timezone"]');ae&&(ae.value=J.form.openai_web_search_context_size||"medium"),Se&&(Se.value=J.form.openai_web_search_loc_type||"none"),je&&(je.value=J.form.openai_web_search_loc_country||""),bt&&(bt.value=J.form.openai_web_search_loc_city||""),re&&(re.value=J.form.openai_web_search_loc_region||""),ve&&(ve.value=J.form.openai_web_search_loc_timezone||"");let Ee=i.querySelector('input[name="claude_web_search_max_uses"]'),Fe=i.querySelector('select[name="claude_web_search_loc_type"]'),Be=i.querySelector('input[name="claude_web_search_loc_country"]'),Ve=i.querySelector('input[name="claude_web_search_loc_city"]'),Je=i.querySelector('input[name="claude_web_search_loc_region"]'),Ze=i.querySelector('input[name="claude_web_search_loc_timezone"]'),Pt=i.querySelector('input[name="claude_web_search_allowed_domains"]'),Mi=i.querySelector('input[name="claude_web_search_blocked_domains"]'),Qt=i.querySelector('select[name="claude_web_search_cache_ttl"]');Ee&&(Ee.value=J.form.claude_web_search_max_uses||"5"),Fe&&(Fe.value=J.form.claude_web_search_loc_type||"none"),Be&&(Be.value=J.form.claude_web_search_loc_country||""),Ve&&(Ve.value=J.form.claude_web_search_loc_city||""),Je&&(Je.value=J.form.claude_web_search_loc_region||""),Ze&&(Ze.value=J.form.claude_web_search_loc_timezone||""),Pt&&(Pt.value=J.form.claude_web_search_allowed_domains||""),Mi&&(Mi.value=J.form.claude_web_search_blocked_domains||""),Qt&&(Qt.value=J.form.claude_web_search_cache_ttl||"none");let ti=i.querySelector('select[name="openrouter_web_search_engine"]'),gt=i.querySelector('input[name="openrouter_web_search_max_results"]'),tt=i.querySelector('input[name="openrouter_web_search_search_prompt"]');ti&&(ti.value=J.form.openrouter_web_search_engine||"auto"),gt&&(gt.value=J.form.openrouter_web_search_max_results||"5"),tt&&(tt.value=J.form.openrouter_web_search_search_prompt||"");let Ye=i.querySelector('select[name="google_grounding_mode"]'),ei=i.querySelector('input[name="google_grounding_dynamic_threshold"]'),li=i.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(Ye&&(Ye.value=J.form.google_grounding_mode||"DEFAULT_MODE"),ei){let Jt=J.form.google_grounding_dynamic_threshold||.3;ei.value=Jt,li&&(li.textContent=Jt)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(E.value,i),mt&&mt.dispatchEvent(new Event("change",{bubbles:!0})),wt&&wt.dispatchEvent(new Event("change",{bubbles:!0})),ge&&ge.dispatchEvent(new Event("change",{bubbles:!0})),se&&se.dispatchEvent(new Event("change",{bubbles:!0})),J.form.structure&&Array.isArray(J.form.structure))if(l.formStructure=J.form.structure,h.innerHTML="",l.formStructure.length===0)h.appendChild(H());else{l.formStructure.forEach(Ut=>{window.aipkitForms_renderLayoutRow(h,Ut,null,s)});let Jt=0;l.formStructure.forEach(Ut=>{Ut.columns.forEach(Di=>{Di.elements.forEach(xt=>{let pi=xt.internalId.split("-"),Wt=parseInt(pi[pi.length-1],10)||0;Wt>Jt&&(Jt=Wt)})})}),l.droppedElementCounter=Jt}else h.innerHTML="",h.appendChild(H());m(),n(i,!0),k(s),typeof window.aipkitForms_onEditorReady=="function"&&window.aipkitForms_onEditorReady(s)}else throw new Error(J.message||o("Could not load form data.","gpt3-ai-content-generator"))}).catch(J=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(s,"error",J.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(s):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):(W.disabled=!0,R())})}window.aipkitForms_showFormEditor=t,window.aipkitForms_updatePromptSnippets=k,window.aipkitForms_initPromptSnippets=r})();(function(){"use strict";function k(r){let n=window.aipkitAIFormsState,t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p;if(!r){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}n.currentFormId=null,n.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let a=r.querySelector("#aipkit_form_editor_container"),s=r.querySelector("#aipkit_ai_forms_list_container"),l=r.querySelector("#aipkit_ai_forms_editor_actions"),c=r.querySelector("#aipkit_create_new_ai_form_btn"),o=r.querySelector("#aipkit_ai_forms_settings_trigger"),e=r.querySelector("#aipkit_ai_forms_header_title_default"),i=r.querySelector("#aipkit_ai_forms_header_title_editor");if(a&&(a.style.display="none"),s&&(s.style.display="block"),l&&(l.style.display="none"),c&&(c.style.display=""),o&&(o.style.display=""),e&&(e.style.display=""),i&&(i.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(r),a){let p=a.querySelector("#aipkit_ai_form_ai_provider");p&&delete p.dataset.aipkitProviderNoticeArmed}let d=document.getElementById("aipkit_provider_notice_ai_forms");if(d&&d.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(r),a){let p=a.querySelector("#aipkit_ai_form_preview_container");p&&(p.style.display="none",p.innerHTML="");let f=r.querySelector("#aipkit_preview_ai_form_btn");if(f&&f.classList.contains("aipkit-preview-active")){f.classList.remove("aipkit-preview-active");let m=f.querySelector(".aipkit_btn-text");m&&(m.textContent=t("Preview","gpt3-ai-content-generator"))}}let u=r.querySelector("#aipkit_ai_forms_messages");u&&(u.innerHTML=""),typeof window.aipkitForms_onEditorHidden=="function"&&window.aipkitForms_onEditorHidden(r)}window.aipkitForms_hideFormEditor=k})();(function(){"use strict";let k=null,r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:i=>i,n=i=>{if(!Array.isArray(i)||i.length===0)return!1;for(let d of i)if(!(!d||!Array.isArray(d.columns))){for(let u of d.columns)if(!(!u||!Array.isArray(u.elements))&&u.elements.length>0)return!0}return!1},t=i=>i?i.querySelector("#aipkit_ai_forms_status"):null,a=(i,d,u)=>{let p=t(i);if(!p)return;let f=p.classList.contains("aipkit_training_status");if(p.textContent=d||"",f){p.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),d&&p.classList.add("is-visible"),u&&p.classList.add(`is-${u}`);return}p.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),u==="success"?p.classList.add("aipkit_form-help-success"):u==="error"&&p.classList.add("aipkit_form-help-error")},s=(i,d=2500)=>{k&&window.clearTimeout(k),k=window.setTimeout(()=>{a(i,"","")},d)},l=(i,d={})=>{let u=r();return new Promise(p=>{if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(i,{title:d.title||u("Confirm","gpt3-ai-content-generator"),confirmText:d.confirmText||u("Confirm","gpt3-ai-content-generator"),cancelText:d.cancelText||u("Cancel","gpt3-ai-content-generator"),onConfirm:()=>p(!0),onCancel:()=>p(!1)});return}p(window.confirm(i))})};function c(i,d={}){let u=window.aipkitAIFormsState,p=window.aipkit_ai_forms_config||{text:{}},f=r();if(!i)return{error:{code:"missing_container",message:"AI Forms saveForm: formsContainerElement not provided."}};let m=i.querySelector("#aipkit_form_editor_container");if(!m)return{error:{code:"missing_editor",message:"AI Forms saveForm: editorContainer not found in provided formsContainerElement."}};let g=i.querySelector("#aipkit_ai_form_title"),_=m.querySelector("#aipkit_ai_form_prompt_template"),w=m.querySelector("#aipkit_ai_form_id"),h=m.querySelector("#aipkit_ai_form_ai_provider"),E=m.querySelector("#aipkit_ai_form_ai_model"),x=m.querySelector("#aipkit_ai_form_temperature"),v=m.querySelector("#aipkit_ai_form_max_tokens"),I=m.querySelector("#aipkit_ai_form_top_p"),P=m.querySelector("#aipkit_ai_form_frequency_penalty"),b=m.querySelector("#aipkit_ai_form_presence_penalty"),y=m.querySelector("#aipkit_ai_form_reasoning_effort"),S=m.querySelector('input[name="enable_vector_store"]'),C=m.querySelector('select[name="vector_store_provider"]'),A=m.querySelector('select[name="openai_vector_store_ids[]"]'),M=m.querySelector('select[name="pinecone_index_name"]'),$=m.querySelector('select[name="qdrant_collection_name"]'),W=m.querySelector('select[name="vector_embedding_provider"]'),H=m.querySelector('select[name="vector_embedding_model"]'),N=m.querySelector('input[name="vector_store_top_k"]'),G=m.querySelector('input[name="vector_store_confidence_threshold"]'),Q=m.querySelector('input[name="openai_web_search_enabled"]'),F=m.querySelector('input[name="claude_web_search_enabled"]'),L=m.querySelector('input[name="openrouter_web_search_enabled"]'),O=m.querySelector('input[name="google_search_grounding_enabled"]'),D=m.querySelector('select[name="openai_web_search_context_size"]'),R=m.querySelector('select[name="openai_web_search_loc_type"]'),Z=m.querySelector('input[name="openai_web_search_loc_country"]'),J=m.querySelector('input[name="openai_web_search_loc_city"]'),pe=m.querySelector('input[name="openai_web_search_loc_region"]'),Ce=m.querySelector('input[name="openai_web_search_loc_timezone"]'),He=m.querySelector('input[name="claude_web_search_max_uses"]'),Ke=m.querySelector('select[name="claude_web_search_loc_type"]'),nt=m.querySelector('input[name="claude_web_search_loc_country"]'),mt=m.querySelector('input[name="claude_web_search_loc_city"]'),wt=m.querySelector('input[name="claude_web_search_loc_region"]'),ge=m.querySelector('input[name="claude_web_search_loc_timezone"]'),se=m.querySelector('input[name="claude_web_search_allowed_domains"]'),ae=m.querySelector('input[name="claude_web_search_blocked_domains"]'),Se=m.querySelector('select[name="claude_web_search_cache_ttl"]'),je=m.querySelector('select[name="openrouter_web_search_engine"]'),bt=m.querySelector('input[name="openrouter_web_search_max_results"]'),re=m.querySelector('input[name="openrouter_web_search_search_prompt"]'),ve=m.querySelector('select[name="google_grounding_mode"]'),Ee=m.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!g||!_||!w||!h||!E||!x||!v||!I||!P||!b)return{error:{code:"missing_inputs",message:"AI Forms saveForm: One or more critical form editor inputs not found in editorContainer."}};let Fe=g.value.trim(),Be=_.value.trim(),Ve=w.value;if(Fe||(Fe=f("New Form","gpt3-ai-content-generator"),g.value=Fe,d.skipSyntheticInputEvent||g.dispatchEvent(new Event("input",{bubbles:!0}))),!Be)return{error:{code:"prompt_required",message:p.text.promptTemplateRequired||"Prompt template is required."}};let Je=new Set;if(Array.isArray(u?.formStructure)){for(let gt of u.formStructure)if(!(!gt||!Array.isArray(gt.columns))){for(let tt of gt.columns)if(!(!tt||!Array.isArray(tt.elements))){for(let Ye of tt.elements)if(Ye){if(!Ye.fieldId||!/^[a-zA-Z0-9_]+$/.test(Ye.fieldId))return{error:{code:"invalid_field_id",message:f(`Invalid Field Variable Name: "${Ye.fieldId||""}" for element "${Ye.label||""}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator"),elementInternalId:Ye.internalId}};if(Je.has(Ye.fieldId))return{error:{code:"duplicate_field_id",message:f(`Duplicate Field Variable Name: "${Ye.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator"),elementInternalId:Ye.internalId}};Je.add(Ye.fieldId)}}}}let Ze=Array.isArray(u?.formStructure)?u.formStructure:[];if(Ve&&!d.allowEmptyStructure&&!n(Ze))return{error:{code:"empty_structure_confirmation_required",message:f(p.text.confirmSaveEmptyForm||"This form currently has no fields. Saving now will remove previously configured fields. Do you want to continue?","gpt3-ai-content-generator")}};let Pt=A?Array.from(A.selectedOptions).map(gt=>gt.value):[],Mi=m.querySelectorAll('input[name^="labels["]'),Qt={};Mi.forEach(gt=>{let tt=gt.name.match(/\[(.*?)\]/);tt&&tt[1]&&(Qt[tt[1]]=gt.value)});let ti={_ajax_nonce:p.nonce_manage_forms,form_id:Ve||null,title:Fe,prompt_template:Be,form_structure:JSON.stringify(Ze),ai_provider:h.value,ai_model:E.value,temperature:x.value,max_tokens:v.value,top_p:I.value,frequency_penalty:P.value,presence_penalty:b.value,reasoning_effort:y?.value||"",enable_vector_store:S?.checked?"1":"0",vector_store_provider:C?.value,openai_vector_store_ids:Pt,pinecone_index_name:M?.value||"",qdrant_collection_name:$?.value||"",vector_embedding_provider:W?.value,vector_embedding_model:H?.value||"",vector_store_top_k:N?.value||3,vector_store_confidence_threshold:G?.value||20,openai_web_search_enabled:Q?.checked?"1":"0",claude_web_search_enabled:F?.checked?"1":"0",openrouter_web_search_enabled:L?.checked?"1":"0",google_search_grounding_enabled:O?.checked?"1":"0",openai_web_search_context_size:D?.value||"medium",openai_web_search_loc_type:R?.value||"none",openai_web_search_loc_country:Z?.value||"",openai_web_search_loc_city:J?.value||"",openai_web_search_loc_region:pe?.value||"",openai_web_search_loc_timezone:Ce?.value||"",claude_web_search_max_uses:He?.value||"5",claude_web_search_loc_type:Ke?.value||"none",claude_web_search_loc_country:nt?.value||"",claude_web_search_loc_city:mt?.value||"",claude_web_search_loc_region:wt?.value||"",claude_web_search_loc_timezone:ge?.value||"",claude_web_search_allowed_domains:se?.value||"",claude_web_search_blocked_domains:ae?.value||"",claude_web_search_cache_ttl:Se?.value||"none",openrouter_web_search_engine:je?.value||"auto",openrouter_web_search_max_results:bt?.value||"5",openrouter_web_search_search_prompt:re?.value||"",google_grounding_mode:ve?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:Ee?.value||"0.30",labels:JSON.stringify(Qt)};return d.allowEmptyStructure&&(ti.allow_empty_structure="1"),{data:ti,formIdInput:w,currentFormIdValue:Ve,formStructure:Ze,editorContainer:m}}function o(i,d,u){if(!i||!u)return;typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(u,d);let p=i.querySelector(`#setting-field-id-${u}`);p&&p.focus()}function e(i,d,u={}){let p=window.aipkit_ai_forms_config||{text:{}},f=r(),m=u.isAutosave===!0;if(!d)return console.error("AI Forms saveForm: formsContainerElement not provided."),Promise.reject(new Error("AI Forms saveForm: formsContainerElement not provided."));if(typeof window.aipkit_apiRequest!="function"){let P=new Error("AI Forms saveForm: aipkit_apiRequest not found.");return a(d,f("Error saving form.","gpt3-ai-content-generator"),"error"),Promise.reject(P)}let g=c(d,{suppressValidationAlerts:u.suppressValidationAlerts===!0,allowEmptyStructure:u.allowEmptyStructure===!0,skipSyntheticInputEvent:m});if(g.error){let P=new Error(g.error.message||"Unable to save form.");return P.code=g.error.code||"save_validation_failed",P.elementInternalId=g.error.elementInternalId||"",P.code==="invalid_field_id"||P.code==="duplicate_field_id"?(u.suppressValidationAlerts!==!0&&!m&&(alert(P.message),o(d.querySelector("#aipkit_form_editor_container"),d,P.elementInternalId)),m&&a(d,f("Unsaved changes","gpt3-ai-content-generator"),"warning"),Promise.reject(P)):P.code==="prompt_required"||P.code==="missing_inputs"||P.code==="missing_editor"||P.code==="missing_container"?(u.suppressValidationAlerts!==!0&&!m&&alert(P.message),m&&a(d,f("Unsaved changes","gpt3-ai-content-generator"),"warning"),Promise.reject(P)):P.code==="empty_structure_confirmation_required"&&!m&&u.allowEmptyStructure!==!0?l(P.message,{title:f("Confirm","gpt3-ai-content-generator"),confirmText:f("Save Empty Form","gpt3-ai-content-generator"),cancelText:f("Cancel","gpt3-ai-content-generator")}).then(b=>{if(!b){let y=new Error(f("Save cancelled.","gpt3-ai-content-generator"));return y.code="save_cancelled",Promise.reject(y)}return e(i,d,{...u,allowEmptyStructure:!0})}):(m?a(d,f("Unsaved changes","gpt3-ai-content-generator"),"warning"):u.suppressValidationAlerts!==!0&&alert(P.message),Promise.reject(P))}let{data:_,currentFormIdValue:w,formIdInput:h}=g,E=i&&i.nodeType===1?i:null,x=E?.querySelector(".aipkit_btn-text")||null,v=E?.querySelector(".aipkit_spinner")||null,I=x?x.textContent:E?E.textContent:"";return E&&!m&&(E.disabled=!0,v&&(v.style.display="inline-block"),x&&(x.textContent=f(p.text.savingForm||"Saving...","gpt3-ai-content-generator"))),a(d,f(m?"Auto-saving...":"Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",_).then(P=>{if(!w&&P.form_id){h&&(h.value=P.form_id),window.aipkitAIFormsState&&(window.aipkitAIFormsState.currentFormId=P.form_id);let y=d.querySelector("#aipkit_preview_ai_form_btn");y&&(y.disabled=!1)}if(typeof window.aipkitForms_onFormSaveSuccess=="function")try{window.aipkitForms_onFormSaveSuccess(d,P,{isAutosave:m,requestData:_})}catch(y){console.warn("AI Forms save hook failed:",y)}let b=m?f("All changes saved","gpt3-ai-content-generator"):P.message||f(p.text.formSaved||"Form saved!","gpt3-ai-content-generator");return a(d,b,"success"),s(d,m?1600:2500),!m&&u.skipFetchList!==!0&&typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms(),P}).catch(P=>{let b=P?.message||f(p.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator");throw a(d,b,"error"),s(d,4e3),P}).finally(()=>{E&&!m&&(E.disabled=!1,v&&(v.style.display="none"),x?x.textContent=I:E&&(E.textContent=I))})}window.aipkitForms_buildSavePayload=c,window.aipkitForms_saveForm=e,window.aipkitForms_setHeaderStatus=a})();(function(){"use strict";function k(r,n,t){let a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!t){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let l={_ajax_nonce:a.nonce_manage_forms,form_id:r},c=n.textContent;n.disabled=!0,n.textContent=s(a.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",l).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(t,"success",o.message||s(a.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(t,"error",o.message||s(a.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let e=t.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${r}"]`);e&&(e.disabled=!1,e.textContent=c)})}window.aipkitForms_deleteForm=k})();(function(){"use strict";function k(r,n){let t=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!n){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let s={_ajax_nonce:t.nonce_manage_forms},l=r.querySelector(".aipkit_btn-text")?.textContent||a("Delete All Forms","gpt3-ai-content-generator"),c=r.querySelector(".aipkit_spinner");r.disabled=!0,r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${a(t.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",s).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",o.message||a(t.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",o.message||a(t.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=l),c&&(c.style.display="none"),r.disabled=!1})}window.aipkitForms_deleteAllForms=k})();(function(){"use strict";function k(r,n,t){let a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!t){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let l={_ajax_nonce:a.nonce_manage_forms,form_id:r},c=n.textContent;n.disabled=!0,n.textContent=s(a.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",l).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(t,"success",o.message||s("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(t,"error",o.message||s(a.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let o=t.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${r}"]`);o&&(o.disabled=!1,o.textContent=c)})}window.aipkitForms_duplicateForm=k})();(function(){"use strict";async function k(r){let n=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s,a=r.textContent;r.disabled=!0,r.textContent=t("Exporting...","gpt3-ai-content-generator");try{let s=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:n.nonce_manage_forms});if(s.forms&&Array.isArray(s.forms)&&s.forms.length>0){let l=s.forms.map(p=>(delete p.id,delete p.status,p)),o=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,e=JSON.stringify(l,null,2),i=new Blob([e],{type:"application/json"}),d=URL.createObjectURL(i),u=document.createElement("a");u.href=d,u.download=o,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)}else throw new Error(t("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(s){alert(t("Error exporting forms: ","gpt3-ai-content-generator")+s.message)}finally{r.disabled=!1,r.textContent=a}}window.aipkitForms_exportAllForms=k})();(function(){"use strict";async function k(r,n){let t=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,s=n.textContent;n.disabled=!0,n.textContent=a("Exporting...","gpt3-ai-content-generator");try{let l=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:r,_ajax_nonce:t.nonce_manage_forms});if(l.form){let c=l.form,o=c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),e=`aipkit-form-${r}-${o}.json`;delete c.id,delete c.status;let i=JSON.stringify(c,null,2),d=new Blob([i],{type:"application/json"}),u=URL.createObjectURL(d),p=document.createElement("a");p.href=u,p.download=e,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(u)}else throw new Error(a("Form data not found in response.","gpt3-ai-content-generator"))}catch(l){alert(a("Error exporting form: ","gpt3-ai-content-generator")+l.message)}finally{n.disabled=!1,n.textContent=s}}window.aipkitForms_exportForm=k})();(function(){"use strict";let k=document.getElementById("aipkit_ai_forms_import_messages"),r;function n(s,l){if(!k)return;let c=window.aipkit_escapeHtml||(o=>o);k.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${s}">${c(l)}</div>`,r&&clearTimeout(r),r=setTimeout(()=>{k.innerHTML=""},8e3)}function t(){k&&(k.innerHTML=""),r&&clearTimeout(r)}async function a(s){let l=window.aipkit_ai_forms_config||{text:{}},c=window.wp?.i18n?.__||(d=>d),o=s.files;if(!o.length)return;let e=o[0];t(),n("info",c("Reading file...","gpt3-ai-content-generator"));let i=new FileReader;i.onload=async function(d){try{let u=d.target.result,p=JSON.parse(u);if(typeof p=="object"&&p!==null&&!Array.isArray(p)&&(p=[p]),!Array.isArray(p))throw new Error(c("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(p.length===0){n("warning",c("File contains no forms to import.","gpt3-ai-content-generator"));return}n("info",c("Importing...","gpt3-ai-content-generator"));let f=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:l.nonce_manage_forms,forms_json:JSON.stringify(p)});n(f.failed_count>0?"warning":"success",f.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(u){n("error",c("Error processing import file: ","gpt3-ai-content-generator")+u.message)}},i.onerror=function(){n("error",c("Error reading the selected file.","gpt3-ai-content-generator"))},i.readAsText(e)}window.aipkitForms_importForms=a})();(function(){"use strict";let k="aipkit_ai_forms_status",r=!1,n=null,t=null,a=null;function s(){return document.getElementById(k)}function l(w,h){let E=s();if(!E)return;let x=E.classList.contains("aipkit_training_status");if(E.textContent=w||"",x){E.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),w&&E.classList.add("is-visible"),h&&E.classList.add(`is-${h}`);return}E.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),h==="success"?E.classList.add("aipkit_form-help-success"):h==="error"&&E.classList.add("aipkit_form-help-error")}function c(w=2500){a&&window.clearTimeout(a),a=window.setTimeout(()=>{l("","")},w)}function o(){return document.getElementById("aipkit_ai_forms_settings_form")}function e(){let w=o();if(!w)return console.error("AI Forms Save Settings: Settings form not found."),null;let h=new FormData(w),E={};return h.forEach((x,v)=>{E[v]=x}),E}function i(w){if(!w)return"";let h={};return Object.keys(w).sort().forEach(E=>{h[E]=w[E]}),JSON.stringify(h)}function d(w){t=i(w)}function u(w){return i(w)!==t}async function p(w,h){let E=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:I=>I;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}l(E("Saving...","gpt3-ai-content-generator"),"loading");let x="",v=null;h&&(x=h.querySelector(".aipkit_btn-text")?.textContent||E("Save AI Forms Settings","gpt3-ai-content-generator"),v=h.querySelector(".aipkit_spinner"),h.disabled=!0,v&&(v.style.display="inline-block"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=E("Saving...","gpt3-ai-content-generator")));try{let I=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",w);return l(I.message||E("Settings saved!","gpt3-ai-content-generator"),"success"),c(),d(w),I}catch(I){throw l(I.message||E("Failed to save settings.","gpt3-ai-content-generator"),"error"),c(4e3),console.error("AI Forms Save Settings Error:",I),I}finally{h&&(h.disabled=!1,v&&(v.style.display="none"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=x))}}function f(w,h){if(w){if(r){n=w;return}r=!0,p(w,h).catch(()=>{}).finally(()=>{if(r=!1,n){let E=n;n=null,u(E)&&f(E,null)}})}}function m(w){let h=e();f(h,w)}function g(){let w=e();!w||!u(w)||f(w,null)}function _(){let w=e();w&&d(w)}window.aipkitForms_saveAiFormsSettings=m,window.aipkitForms_handleSettingsAutosave=g,window.aipkitForms_updateSettingsAutosaveBaseline=_})();(function(){"use strict";let k="aipkit_ai_forms_editor_draft_v1_",n={activeContainer:null,baselineSignature:"",isDirty:!1,autosaveTimer:null,autosaveInFlight:!1,pendingAutosave:!1,suppressTracking:!1,activeDraftKey:"",restorePromptedKey:"",unloadBound:!1},t=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:ge=>ge,a=ge=>ge&&ge.nodeType===1?ge:document.getElementById("aipkit_ai_forms_container"),s=ge=>ge?ge.querySelector("#aipkit_form_editor_container"):null,l=ge=>{let se=s(ge);return se?window.getComputedStyle(se).display!=="none":!1},c=ge=>{let ae=s(ge)?.querySelector("#aipkit_ai_form_id");return ae?.value?String(ae.value):""},o=()=>{let ge=window.aipkit_ai_forms_config||{};return String(ge.current_user_id||0)},e=(ge,se=null)=>{let ae=se!=null?String(se):c(ge),Se=ae?`form_${ae}`:"new";return`${k}${o()}_${Se}`},i=()=>{try{return window.localStorage}catch{return null}},d=ge=>{let se=i();if(!ge||!se)return null;try{return se.getItem(ge)}catch{return null}},u=(ge,se)=>{let ae=i();if(!(!ge||!ae))try{ae.setItem(ge,se)}catch{}},p=ge=>{let se=i();if(!(!ge||!se))try{se.removeItem(ge)}catch{}},f=ge=>{try{return JSON.parse(JSON.stringify(ge))}catch{return Array.isArray(ge)?[]:{}}},m=ge=>Array.isArray(ge)?`[${ge.map(se=>m(se)).join(",")}]`:ge&&typeof ge=="object"?`{${Object.keys(ge).sort().map(ae=>`${JSON.stringify(ae)}:${m(ge[ae])}`).join(",")}}`:JSON.stringify(ge),g=ge=>{if(!ge||typeof ge!="object")return"";let se={...ge,savedAt:0};return m(se)},_=ge=>{let se=0;return Array.isArray(ge)&&ge.forEach(ae=>{!ae||!Array.isArray(ae.columns)||ae.columns.forEach(Se=>{!Se||!Array.isArray(Se.elements)||Se.elements.forEach(je=>{if(!je||typeof je.internalId!="string")return;let bt=je.internalId.split("-"),re=parseInt(bt[bt.length-1],10)||0;re>se&&(se=re)})})}),se},w=ge=>{let se={};return ge&&ge.querySelectorAll("input[name], select[name], textarea[name]").forEach(Se=>{if(!(!Se||!Se.name)&&!Se.closest(".aipkit_dropped_element")&&Se.type!=="file"){if(Se.tagName==="SELECT"&&Se.multiple){se[Se.name]=Array.from(Se.selectedOptions).map(je=>je.value);return}if(Se.type==="checkbox"){se[Se.name]=Se.checked?"1":"0";return}if(Se.type==="radio"){Se.checked&&(se[Se.name]=Se.value);return}se[Se.name]=Se.value}}),se},h=ge=>{let se=a(ge);if(!se)return null;let ae=s(se);if(!ae)return null;let Se=window.aipkitAIFormsState||{},je=se.querySelector("#aipkit_ai_form_title"),bt=ae.querySelector("#aipkit_ai_form_prompt_template"),re=ae.querySelector("#aipkit_ai_form_id");return{version:1,formId:re?.value?String(re.value):"",title:je?.value||"",promptTemplate:bt?.value||"",structure:f(Se.formStructure||[]),controls:w(ae),savedAt:Date.now()}},E=(ge,se,ae)=>{if(typeof window.aipkitForms_setHeaderStatus=="function"){window.aipkitForms_setHeaderStatus(ge,se,ae);return}let Se=ge?.querySelector("#aipkit_ai_forms_status");Se&&(Se.textContent=se||"",Se.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),se&&Se.classList.add("is-visible"),ae&&Se.classList.add(`is-${ae}`))},x=ge=>{let se=d(ge);if(!se)return null;try{let ae=JSON.parse(se);return!ae||typeof ae!="object"||!ae.snapshot||typeof ae.snapshot!="object"?null:ae}catch{return null}},v=(ge,se)=>{!ge||!se||typeof se!="object"||u(ge,JSON.stringify(se))},I=ge=>{let se=a(ge);if(!se)return n.activeDraftKey="","";let ae=e(se);if(!n.activeDraftKey)return n.activeDraftKey=ae,ae;if(n.activeDraftKey!==ae){let Se=x(ae),je=x(n.activeDraftKey);!Se&&je&&v(ae,je),p(n.activeDraftKey),n.activeDraftKey=ae}return n.activeDraftKey},P=(ge,se=null)=>{let ae=a(ge);if(!ae)return;let Se=se||h(ae);if(!Se)return;let je=I(ae);je&&v(je,{version:1,savedAt:Date.now(),snapshot:Se})},b=ge=>{let se=a(ge);if(!se)return;let ae=I(se);p(ae)},y=(ge,{clearDraft:se=!1,resetRestorePrompt:ae=!1}={})=>{let Se=a(ge);if(!Se)return;let je=h(Se);n.baselineSignature=g(je),n.isDirty=!1,n.pendingAutosave=!1,se&&b(Se),ae&&(n.restorePromptedKey="")},S=ge=>{let se=a(ge);if(!se||!l(se))return n.isDirty=!1,!1;let ae=h(se),Se=g(ae);return n.baselineSignature?(n.isDirty=Se!==n.baselineSignature,n.isDirty):(n.isDirty=!1,!1)},C=()=>{n.autosaveTimer&&(window.clearTimeout(n.autosaveTimer),n.autosaveTimer=null)},A=(ge,se=!1)=>{let ae=a(ge);if(!ae||n.suppressTracking)return;C(),n.pendingAutosave=!0;let Se=se?80:1500;n.autosaveTimer=window.setTimeout(()=>{n.autosaveTimer=null,$(ae)},Se)},M=(ge,{queueSave:se=!0,immediate:ae=!1}={})=>{let Se=a(ge);if(!Se||n.suppressTracking||!l(Se))return;let je=h(Se),bt=g(je);if(!n.baselineSignature){n.baselineSignature=bt,n.isDirty=!1;return}let re=bt!==n.baselineSignature;n.isDirty=re,re&&(P(Se,je),n.autosaveInFlight||E(Se,t()("Unsaved changes","gpt3-ai-content-generator"),"warning"),se&&A(Se,ae))};async function $(ge){let se=a(ge);if(!se)return;if(!l(se)||!S(se)){n.pendingAutosave=!1;return}if(n.autosaveInFlight){n.pendingAutosave=!0;return}if(typeof window.aipkitForms_saveForm!="function")return;n.autosaveInFlight=!0,n.pendingAutosave=!1;let ae=h(se);P(se,ae);try{await window.aipkitForms_saveForm(null,se,{isAutosave:!0,suppressValidationAlerts:!0,skipFetchList:!0}),y(se,{clearDraft:!0})}catch(Se){let je=Se?.code==="prompt_required"||Se?.code==="invalid_field_id"||Se?.code==="duplicate_field_id"||Se?.code==="empty_structure_confirmation_required"?t()("Unsaved changes","gpt3-ai-content-generator"):Se?.message||t()("Autosave failed.","gpt3-ai-content-generator");E(se,je,"warning")}finally{n.autosaveInFlight=!1,n.pendingAutosave&&S(se)&&A(se,!0)}}let W=ge=>{let se=t(),ae=ge.querySelector("#aipkit_form_designer_placeholder");ae||(ae=document.createElement("div"),ae.className="aipkit_form_designer_placeholder",ae.id="aipkit_form_designer_placeholder",ae.innerHTML=`<span class="dashicons dashicons-layout"></span>${se("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,ge.appendChild(ae)),ae.style.display="flex"},H=(ge,se)=>{let ae=a(ge);if(!ae)return;let je=s(ae)?.querySelector("#aipkit_ai_form_designer_area");if(!(!je||!window.aipkitAIFormsState)){if(window.aipkitAIFormsState.formStructure=Array.isArray(se)?f(se):[],je.innerHTML="",!Array.isArray(window.aipkitAIFormsState.formStructure)||window.aipkitAIFormsState.formStructure.length===0){W(je),window.aipkitAIFormsState.droppedElementCounter=0;return}if(typeof window.aipkitForms_renderLayoutRow!="function"){W(je);return}window.aipkitAIFormsState.formStructure.forEach(bt=>{window.aipkitForms_renderLayoutRow(je,bt,null,ae)}),window.aipkitAIFormsState.droppedElementCounter=_(window.aipkitAIFormsState.formStructure)}},N=(ge,se)=>{if(!ge||!se||typeof se!="object")return;let Se=Array.from(ge.querySelectorAll("input[name], select[name], textarea[name]")).reduce((ve,Ee)=>(!Ee||!Ee.name||(ve[Ee.name]||(ve[Ee.name]=[]),ve[Ee.name].push(Ee)),ve),{});Object.keys(se).forEach(ve=>{let Ee=Se[ve]||[];if(!Ee.length)return;let Fe=se[ve];Ee.forEach(Be=>{if(Be.tagName==="SELECT"&&Be.multiple){let Ve=Array.isArray(Fe)?Fe.map(Je=>String(Je)):[];Array.from(Be.options).forEach(Je=>{Je.selected=Ve.includes(Je.value)});return}if(Be.type==="checkbox"){Be.checked=Fe==="1"||Fe===!0||Fe==="true";return}if(Be.type==="radio"){Be.checked=String(Fe)===String(Be.value);return}Be.value=Fe??""})});let je=ge.querySelector("#aipkit_ai_form_ai_provider"),bt=ge.querySelector("#aipkit_ai_form_ai_model");if(je&&bt&&typeof window.aipkitForms_populateAiModels=="function"){let ve=je.value||"OpenAI",Ee=se.ai_model||bt.value||"";window.aipkitForms_populateAiModels(ve,Ee)}["#aipkit_ai_form_ai_provider",'input[name="enable_vector_store"]','input[name="openai_web_search_enabled"]','input[name="claude_web_search_enabled"]','input[name="openrouter_web_search_enabled"]','input[name="google_search_grounding_enabled"]'].forEach(ve=>{let Ee=ge.querySelector(ve);Ee&&Ee.dispatchEvent(new Event("change",{bubbles:!0}))}),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(ge)},G=(ge,se)=>{let ae=a(ge);if(!ae||!se||typeof se!="object")return;let Se=s(ae);if(!Se)return;n.suppressTracking=!0;let je=ae.querySelector("#aipkit_ai_form_title"),bt=Se.querySelector("#aipkit_ai_form_prompt_template"),re=Se.querySelector("#aipkit_ai_form_id");je&&(je.value=se.title||"",je.dispatchEvent(new Event("input",{bubbles:!0}))),bt&&(bt.value=se.promptTemplate||""),re&&se.formId&&(re.value=String(se.formId)),H(ae,se.structure||[]),N(Se,se.controls||{}),typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(ae),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(ae),n.suppressTracking=!1},Q=(ge,se={})=>{let ae=t();return new Promise(Se=>{if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(ge,{title:se.title||ae("Confirm","gpt3-ai-content-generator"),confirmText:se.confirmText||ae("Confirm","gpt3-ai-content-generator"),cancelText:se.cancelText||ae("Cancel","gpt3-ai-content-generator"),onConfirm:()=>Se(!0),onCancel:()=>Se(!1)});return}Se(window.confirm(ge))})},F=async ge=>{let se=a(ge);if(!se||!l(se))return;let ae=I(se);if(!ae||n.restorePromptedKey===ae)return;n.restorePromptedKey=ae;let Se=x(ae);if(!Se||!Se.snapshot)return;let je=h(se),bt=g(je),re=g(Se.snapshot);if(!re||re===bt){p(ae);return}let ve=t(),Ee=Se.savedAt?ve("A local unsaved draft was found. Do you want to restore it?","gpt3-ai-content-generator"):ve("Restore local unsaved draft?","gpt3-ai-content-generator");if(!await Q(Ee,{title:ve("Restore Draft","gpt3-ai-content-generator"),confirmText:ve("Restore","gpt3-ai-content-generator"),cancelText:ve("Discard","gpt3-ai-content-generator")})){p(ae);return}G(se,Se.snapshot),M(se,{queueSave:!0,immediate:!0}),E(se,ve("Recovered local draft","gpt3-ai-content-generator"),"warning")},L=async ge=>{let se=t(),ae=se("You have unsaved AI Form changes. Choose what to do before leaving.","gpt3-ai-content-generator");return typeof window.aipkit_showConfirmModal=="function"?new Promise(bt=>{window.aipkit_showConfirmModal(ae,{title:se("Unsaved Changes","gpt3-ai-content-generator"),confirmText:se("Save and Leave","gpt3-ai-content-generator"),secondaryText:se("Leave Without Saving","gpt3-ai-content-generator"),cancelText:se("Stay","gpt3-ai-content-generator"),onConfirm:()=>bt("save"),onSecondary:()=>bt("discard"),onCancel:()=>bt("stay")})}):await Q(ae,{title:se("Unsaved Changes","gpt3-ai-content-generator"),confirmText:se("Save and Leave","gpt3-ai-content-generator"),cancelText:se("Leave Without Saving","gpt3-ai-content-generator")})?"save":await Q(se("Leave without saving your recent changes?","gpt3-ai-content-generator"),{title:se("Unsaved Changes","gpt3-ai-content-generator"),confirmText:se("Leave Without Saving","gpt3-ai-content-generator"),cancelText:se("Stay","gpt3-ai-content-generator")})?"discard":"stay"},O=async(ge,se={})=>{let ae=a(ge);if(!ae||!l(ae)||!S(ae))return!0;let Se=await L(ae);if(Se==="stay")return!1;if(Se==="discard")return C(),n.pendingAutosave=!1,n.isDirty=!1,n.baselineSignature=g(h(ae)),se.keepDraftOnDiscard!==!0&&b(ae),!0;if(Se==="save"){if(typeof window.aipkitForms_saveForm!="function")return!1;try{let je=se.skipFetchListOnSave===!0;return await window.aipkitForms_saveForm(null,ae,{isAutosave:!1,suppressValidationAlerts:!1,skipFetchList:je}),!0}catch{return!1}}return!1},D=ge=>{let se=a(n.activeContainer);if(!(!se||!l(se))&&S(se))return P(se),ge.preventDefault(),ge.returnValue="",""},R=()=>{let ge=a(n.activeContainer);!ge||!l(ge)||S(ge)&&P(ge)},Z=()=>{n.unloadBound||(window.addEventListener("beforeunload",D),window.addEventListener("pagehide",R),n.unloadBound=!0)},J=ge=>{let se=a(ge);if(!se)return;if(se.dataset.aipkitEditorPersistenceBound==="true"){n.activeContainer=se,Z();return}let ae=Se=>{if(n.suppressTracking||!Se?.isTrusted)return;let je=Se.target;!je||typeof je.closest!="function"||je.matches("input, select, textarea")&&je.closest("#aipkit_form_editor_container")&&(je.closest(".aipkit_dropped_element")||l(se)&&M(se,{queueSave:!0,immediate:!1}))};se.addEventListener("input",ae,!0),se.addEventListener("change",ae,!0),se.dataset.aipkitEditorPersistenceBound="true",n.activeContainer=se,Z()},pe=ge=>{let se=a(ge);se&&(n.activeContainer=se,n.suppressTracking=!0,C(),n.pendingAutosave=!1,I(se),y(se,{resetRestorePrompt:!0}),n.suppressTracking=!1,F(se))},Ce=ge=>{let se=a(ge);se&&(C(),n.pendingAutosave=!1,n.autosaveInFlight=!1,n.isDirty=!1,n.baselineSignature="",n.restorePromptedKey="",n.activeContainer=se)},He=ge=>{let se=a(ge);se&&(I(se),y(se,{clearDraft:!0}))},Ke=(ge,se={})=>{let ae=a(ge);!ae||n.suppressTracking||!l(ae)||M(ae,{queueSave:se.queueSave!==!1,immediate:se.immediate===!0})},nt=async(ge,se,ae={})=>{let Se=a(ge);return await O(Se,ae)?(typeof se=="function"&&se(),!0):!1},mt=async ge=>{let se=document.getElementById("aipkit_ai_forms_container");return!se||ge==="ai-forms"||!l(se)?!0:O(se,{keepDraftOnDiscard:!1,skipFetchListOnSave:!0})},wt=typeof window.aipkit_beforeModuleChange=="function"?window.aipkit_beforeModuleChange:null;window.aipkit_beforeModuleChange=async function(ge){return wt&&await wt(ge)===!1?!1:mt(ge)},window.aipkitForms_initEditorPersistence=J,window.aipkitForms_onEditorReady=pe,window.aipkitForms_onEditorHidden=Ce,window.aipkitForms_onFormSaveSuccess=He,window.aipkitForms_notifyEditorMutation=Ke,window.aipkitForms_hasUnsavedChanges=S,window.aipkitForms_requestLeaveEditor=O,window.aipkitForms_runWithLeaveGuard=nt})();(function(){"use strict";function k(r,n,t){let a=window.aipkit_escapeHtml||function(l){return l};if(!r){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let s=r.querySelector("#aipkit_ai_forms_messages");s?(s.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${n}">${a(t)}</div>`,setTimeout(()=>{s.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=k})();(function(){"use strict";function k(n){if(!n){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let t=n.querySelector(".aipkit_token_limit_mode_select"),a=n.querySelector(".aipkit_token_general_user_limit_field"),s=n.querySelector(".aipkit_token_role_limits_container");if(!t||!a||!s){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let l=t.value;a.hidden=l!=="general",s.hidden=l!=="role_based"}function r(n){if(!n){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let t="data-token-listener-attached";n.getAttribute(t)!=="true"&&(n.addEventListener("change",function(a){a.target.closest(".aipkit_token_limit_mode_select")&&k(n)}),k(n),n.setAttribute(t,"true"))}window.aipkit_initAIFormsTokenManagementUI=r})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_ai_forms_container");return r||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=k})();(function(){"use strict";function k(r){let n=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;r.dataset.clickListenerAttached!=="true"&&(r.addEventListener("click",function(a){let s=a.target,l=o=>s.closest(o),c=r.querySelector("#aipkit_form_editor_container");if(s.matches("#aipkit_create_new_ai_form_btn")||l("#aipkit_create_new_ai_form_btn")){a.preventDefault();let o=()=>{typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,r)};typeof window.aipkitForms_runWithLeaveGuard=="function"?window.aipkitForms_runWithLeaveGuard(r,o,{keepDraftOnDiscard:!1}):o()}else if(l(".aipkit_actions_menu_toggle")){a.preventDefault(),a.stopPropagation();let o=s.closest(".aipkit_actions_menu");if(!o)return;let e=o.querySelector(".aipkit_actions_dropdown_menu");if(!e)return;let i=e.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(d=>{d!==e&&(d.style.display="none")}),e.style.display=i?"none":"block",!i){let d=u=>{o.contains(u.target)||(e.style.display="none")};document.addEventListener("click",d,{once:!0,capture:!0})}}else if(l("#aipkit_import_ai_forms_btn")){a.preventDefault();let o=r.querySelector("#aipkit_ai_forms_import_file_input");o&&o.click()}else if(s.matches(".aipkit_edit_ai_form_btn")||l(".aipkit_edit_ai_form_btn")){a.preventDefault();let e=l(".aipkit_edit_ai_form_btn").dataset.formId,i=()=>{typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(e,r)};typeof window.aipkitForms_runWithLeaveGuard=="function"?window.aipkitForms_runWithLeaveGuard(r,i,{keepDraftOnDiscard:!1}):i()}else if(l(".aipkit_preview_ai_form_btn")){a.preventDefault();let o=l(".aipkit_preview_ai_form_btn"),e=o.dataset.formId,i=o.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(e,i,r)}else if(s.matches(".aipkit_duplicate_ai_form_btn")||l(".aipkit_duplicate_ai_form_btn")){a.preventDefault();let o=l(".aipkit_duplicate_ai_form_btn"),e=o.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(e,o,r)}else if(s.matches("#aipkit_export_all_ai_forms_btn")||l("#aipkit_export_all_ai_forms_btn")){a.preventDefault();let o=l("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(o)}else if(s.matches(".aipkit_export_ai_form_btn")||l(".aipkit_export_ai_form_btn")){a.preventDefault();let o=l(".aipkit_export_ai_form_btn"),e=o.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(e,o)}else if(s.matches(".aipkit_delete_ai_form_btn")||l(".aipkit_delete_ai_form_btn")){a.preventDefault();let o=l(".aipkit_delete_ai_form_btn"),e=o.dataset.formId,i=o.dataset.formTitle||`Form ID ${e}`,u=`${t(n.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${i}`,p=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(e,o,r)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(u,{title:t("Confirm","gpt3-ai-content-generator"),confirmText:t("Delete","gpt3-ai-content-generator"),cancelText:t("Cancel","gpt3-ai-content-generator"),onConfirm:p});return}confirm(u)&&p()}else if(s.matches("#aipkit_delete_all_ai_forms_btn")||l("#aipkit_delete_all_ai_forms_btn")){a.preventDefault();let o=l("#aipkit_delete_all_ai_forms_btn"),e=t(n.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),i=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(o,r)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(e,{title:t("Confirm","gpt3-ai-content-generator"),confirmText:t("Delete","gpt3-ai-content-generator"),cancelText:t("Cancel","gpt3-ai-content-generator"),onConfirm:i});return}confirm(e)&&i()}else if(s.matches(".aipkit_form_shortcode_input"))a.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(s.value,s);else if(l(".aipkit_aiform_settings_toggle")){a.preventDefault();let o=l(".aipkit_aiform_settings_toggle"),e=o.dataset.formId,i=r.querySelector(`#aif-configurator-${e}`);if(!i)return;let d=i.closest("tr"),u=()=>{let m=o.getBoundingClientRect(),g=i.getBoundingClientRect(),_=g.width||400,w=g.height||0,h=window.innerWidth,E=window.innerHeight,x=12,v=m.left;v+_>h-x&&(v=m.right-_),v=Math.max(x,Math.min(v,h-_-x));let I=m.bottom+8;I+w>E-x&&(I=m.top-w-8),I=Math.max(x,Math.min(I,E-w-x)),i.style.left=`${Math.round(v)}px`,i.style.top=`${Math.round(I)}px`};r.querySelectorAll(".aipkit_shortcode_configurator").forEach(m=>{m!==i&&(m.style.display="none");let g=m.closest("tr");g&&g.classList.remove("aipkit_shortcode_row_open")});let f=i.style.display==="flex";if(i.style.display=f?"none":"flex",d&&d.classList.toggle("aipkit_shortcode_row_open",!f),!f){u();let m=g=>{!i.contains(g.target)&&!o.contains(g.target)&&(i.style.display="none",d&&d.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",m,!0))};setTimeout(()=>{document.addEventListener("click",m,{capture:!0,once:!0})},0)}}else if(l(".aipkit_aiform_shortcode_close")){a.preventDefault();let e=l(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(e){e.style.display="none";let i=e.closest("tr");i&&i.classList.remove("aipkit_shortcode_row_open")}}else if(s.matches("#aipkit_validate_prompt_btn")||l("#aipkit_validate_prompt_btn"))a.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(s.matches("#aipkit_save_ai_form_btn")||l("#aipkit_save_ai_form_btn")){a.preventDefault();let o=l("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(o,r).catch(()=>{})}else if(s.matches("#aipkit_cancel_edit_ai_form_btn")||l("#aipkit_cancel_edit_ai_form_btn")){a.preventDefault();let o=()=>{typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(r)};typeof window.aipkitForms_runWithLeaveGuard=="function"?window.aipkitForms_runWithLeaveGuard(r,o,{keepDraftOnDiscard:!1}):o()}else if(s.matches("#aipkit_preview_ai_form_btn")||l("#aipkit_preview_ai_form_btn")){a.preventDefault();let o=c.querySelector("#aipkit_ai_form_id").value;if(!o){alert(t("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let e=r.querySelector("#aipkit_ai_form_title"),i=e?e.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(o,i,r):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(l(".aipkit_dropped_element_settings_btn")){a.preventDefault();let o=l(".aipkit_dropped_element");o&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(o.id,r)}else if(l(".aipkit_dropped_element_delete_btn")){a.preventDefault();let o=l(".aipkit_dropped_element");o&&confirm(t(n.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(o.id,r)}else if(l(".aipkit_layout_row_delete_btn")){if(a.preventDefault(),confirm(t("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let o=l(".aipkit_layout_row");o&&(Array.from(o.querySelectorAll(".aipkit_dropped_element")).map(i=>i.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(r),o.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(r))}}else if(l("#aipkit_settings_panel_close_btn"))a.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(r);else if(l(".aipkit_remove_option_btn")){a.preventDefault();let o=l(".aipkit_select_option_row");o&&(o.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,r))}else l("#aipkit_add_select_option_btn")&&(a.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(r))}),r.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=k})();(function(){"use strict";let k="aipkit_ai_forms_shortcode_config_v1_";function r(l){if(!l||!window.localStorage)return null;try{let c=window.localStorage.getItem(`${k}${l}`);if(!c)return null;let o=JSON.parse(c);return o&&typeof o=="object"?o:null}catch{return null}}function n(l,c){if(!(!l||!window.localStorage))try{window.localStorage.setItem(`${k}${l}`,JSON.stringify(c))}catch{}}function t(l,c){if(!l)return;let o=c.querySelector(`#aif-configurator-${l}`),e=c.querySelector(`#aif-shortcode-input-${l}`);if(!o||!e)return;let i=o.querySelectorAll(".aipkit-aiform-config-input"),d=[],u={};i.forEach(m=>{let g=m.dataset.attrName;g&&(m.type==="checkbox"?(u[g]=!!m.checked,m.checked&&d.push(`${g}="true"`)):m.type==="select-one"&&(u[g]=m.value,m.value&&m.value!=="light"&&d.push(`${g}="${m.value}"`)))});let p=`[aipkit_ai_form id=${l}`;d.length>0&&(p+=" "+d.join(" ")),p+="]",e.value=p,c.querySelectorAll(`[data-aipkit-shortcode-display="${l}"]`).forEach(m=>{m&&"value"in m&&(m.value=p)}),n(l,u)}function a(l,c){if(!l||!c)return;let o=r(l);if(!o)return;let e=c.querySelector(`#aif-configurator-${l}`);if(!e)return;e.querySelectorAll(".aipkit-aiform-config-input").forEach(d=>{let u=d.dataset.attrName;u&&(d.type==="checkbox"?Object.prototype.hasOwnProperty.call(o,u)&&(d.checked=!!o[u]):d.type==="select-one"&&typeof o[u]=="string"&&(d.value=o[u]))}),t(l,c)}function s(l){l.dataset.changeListenerAttached!=="true"&&(l.addEventListener("change",function(c){let o=c.target;if(o.matches(".aipkit-aiform-config-input")){let e=o.dataset.formId;t(e,l)}else o.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(o),o.value="")}),l.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=s,window.aipkitForms_applyStoredShortcodeConfig=a})();(function(){"use strict";function k(r){let n=window.aipkitAIFormsState,t=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!t){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(t.dataset.inputListenerAttached==="true")return;let a=()=>{n.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(n.selectedDesignerElementId,r)};t.addEventListener("input",s=>{s.target.matches(".aipkit-setting-field")&&a()}),t.addEventListener("change",s=>{s.target.matches('.aipkit-setting-field[type="checkbox"]')&&a()}),t.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=k})();(function(){"use strict";function k(r){let n=window.aipkitAIFormsState;if(!r){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_ai_form_elements_palette"),a=r.querySelector("#aipkit_ai_form_designer_area");if(!t||!a){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(t.dataset.dragListenersAttached==="true"&&a.dataset.dragListenersAttached==="true")return;t.querySelectorAll(".aipkit_form_element_item").forEach(l=>{l.dataset.dragStartListenerAttached!=="true"&&(l.addEventListener("dragstart",c=>{c.target.classList.add("aipkit-dragging"),n.draggedElement=null,c.target.dataset.layoutType?(n.draggedLayoutType=c.target.dataset.layoutType,n.draggedElementType=null,c.dataTransfer.setData("text/plain",n.draggedLayoutType),c.dataTransfer.effectAllowed="copy"):(n.draggedElementType=c.target.dataset.elementType,n.draggedLayoutType=null,c.dataTransfer.setData("text/plain",n.draggedElementType),c.dataTransfer.effectAllowed="copy")}),l.addEventListener("dragend",c=>{c.target.classList.remove("aipkit-dragging"),n.draggedElementType=null,n.draggedLayoutType=null}),l.dataset.dragStartListenerAttached="true")}),t.dataset.dragListenersAttached="true",a.dataset.dragListenersAttached!=="true"&&(a.addEventListener("dragstart",l=>{let c=l.target.closest(".aipkit_layout_row"),o=l.target.closest(".aipkit_dropped_element");if(c&&l.target.classList.contains("aipkit_layout_row_drag_handle"))n.draggedElement=c,l.dataTransfer.setData("text/row-id",c.id),l.dataTransfer.effectAllowed="move";else if(o&&l.target.classList.contains("aipkit_dropped_element_drag_handle"))n.draggedElement=o,l.dataTransfer.setData("text/element-id",o.id),l.dataTransfer.effectAllowed="move";else return;n.draggedElementType=null,n.draggedLayoutType=null,setTimeout(()=>{n.draggedElement&&n.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),a.addEventListener("dragend",l=>{n.draggedElement&&(n.draggedElement.classList.remove("aipkit-row-dragging-source"),n.draggedElement=null)}),a.addEventListener("dragover",l=>{l.preventDefault(),a.classList.add("aipkit-drag-over"),n.draggedElement?l.dataTransfer.dropEffect="move":l.dataTransfer.dropEffect="copy"}),a.addEventListener("dragleave",l=>{a.contains(l.relatedTarget)||a.classList.remove("aipkit-drag-over")}),a.addEventListener("drop",l=>{l.preventDefault(),l.stopPropagation(),a.classList.remove("aipkit-drag-over");let c=a.querySelector("#aipkit_form_designer_placeholder");if(n.draggedLayoutType){c&&(c.style.display="none");let o=window.aipkitForms_createNewLayoutData(n.draggedLayoutType);n.formStructure.push(o),window.aipkitForms_renderLayoutRow(a,o,null,r),n.draggedLayoutType=null}else if(n.draggedElement&&n.draggedElement.classList.contains("aipkit_layout_row")){let o=l.target.closest(".aipkit_layout_row");if(o&&o!==n.draggedElement){let e=o.getBoundingClientRect(),d=l.clientY>e.top+e.height/2?o.nextSibling:o;a.insertBefore(n.draggedElement,d)}window.aipkitForms_updateFormStructureOrder()}else if(n.draggedElementType){c&&(c.style.display="none");let o=window.aipkitForms_createNewLayoutData("1-col"),e=window.aipkitForms_createNewFormElementData(n.draggedElementType);o.columns[0].elements.push(e),n.formStructure.push(o),window.aipkitForms_renderLayoutRow(a,o,null,r),n.draggedElementType=null}n.draggedElement&&(n.draggedElement.classList.remove("aipkit-row-dragging-source"),n.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r),typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(r)}),a.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=k})();(function(){"use strict";function k(r){let n=r.querySelector("#aipkit_ai_forms_settings_form");n&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(n):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=k})();(function(){"use strict";function k(r){let n=(r||document).querySelector("#aipkit_ai_forms_settings_form");if(!n)return;let t="data-aipkit-aiforms-autosave-attached";if(n.getAttribute(t)==="true")return;let a=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};n.addEventListener("change",s=>{let l=s.target;if(!l||!l.matches(".aipkit_autosave_trigger"))return;(l.tagName.toLowerCase()==="select"||l.type==="checkbox"||l.type==="range")&&a()}),n.addEventListener("blur",s=>{let l=s.target;if(!l||!l.matches(".aipkit_autosave_trigger"))return;let c=l.tagName.toLowerCase();(c==="input"||c==="textarea")&&l.type!=="range"&&l.type!=="checkbox"&&a()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),n.setAttribute(t,"true")}window.aipkitForms_initSettingsAutosave=k})();(function(){"use strict";function k(r){if(!r)return;let n="data-accordion-listener-attached";r.getAttribute(n)!=="true"&&(r.addEventListener("click",function(t){let a=t.target.closest(".aipkit_accordion-header");if(!a||!a.closest(".aipkit_ai_forms_container"))return;t.preventDefault();let s=a.closest(".aipkit_accordion-group"),l=a.dataset.aipkitContextAccordion==="1";if(s&&!a.classList.contains("aipkit_active")){let o=s.querySelector(".aipkit_accordion-header.aipkit_active");if(o){o.classList.remove("aipkit_active");let e=o.nextElementSibling;e&&e.classList.remove("aipkit_active")}}let c=a.nextElementSibling;c&&(a.classList.toggle("aipkit_active"),c.classList.toggle("aipkit_active"),l&&c.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(c))}),r.setAttribute(n,"true"))}window.aipkitForms_initializeAccordions=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(f){return f},r={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0};function n(f){if(!f)return r;let m=Array.isArray(window.aipkit_dashboard?.models?.openrouter)?window.aipkit_dashboard.models.openrouter:[],g=String(f).trim().toLowerCase(),_=m.find(w=>(w?.id?String(w.id).trim().toLowerCase():"")===g);return!_||typeof _.capabilities!="object"?r:{...r,..._.capabilities}}function t(f,m,g){return f!=="OpenRouter"||!g?!0:!!n(m)[g]}function a(f,m,g,_){if(!f||!m)return;f.classList.toggle("aipkit_popover_option_row--disabled",g),f.setAttribute("aria-disabled",g?"true":"false"),m.disabled=!!g;let w=f.querySelector(".aipkit_popover_option_label");w&&(w.dataset.defaultTooltip||(w.dataset.defaultTooltip=w.getAttribute("data-tooltip")||""),w.setAttribute("data-tooltip",g&&_||w.dataset.defaultTooltip))}function s(f,m=""){let g=document.getElementById("aipkit_ai_form_ai_model"),_=window.aipkit_dashboard?.models||{};if(!g||!_)return;let w=f.toLowerCase(),h=_[w];(typeof h>"u"||h===null)&&(h=w==="openai"?{}:[]),g.innerHTML="",g.disabled=!1;let E=window.aipkit_dashboard?.recommendedModels?.[w]||[],x=Array.isArray(E)?E:[],v=new Set(x.map(P=>P?.id).filter(Boolean));if(!h||Array.isArray(h)&&h.length===0||!Array.isArray(h)&&Object.keys(h).length===0){let P=new Option("No models found. Sync in main settings.","");g.appendChild(P),g.disabled=!0;return}let I=!1;if(Array.isArray(h)){if(x.length>0){let b=document.createElement("optgroup");b.label=k("Recommended","gpt3-ai-content-generator"),x.forEach(y=>{if(y&&y.id){let S=new Option(y.name||y.id,y.id);y.id===m&&(S.selected=!0,I=!0),b.appendChild(S)}}),b.children.length>0&&g.appendChild(b)}let P=x.length>0?document.createElement("optgroup"):null;P&&(P.label=k("All models","gpt3-ai-content-generator")),h.forEach(b=>{if(b&&b.id&&v.has(b.id))return;let y=new Option(b.name,b.id);b.id===m&&(y.selected=!0,I=!0),P?P.appendChild(y):g.appendChild(y)}),P&&P.children.length>0&&g.appendChild(P)}else{if(x.length>0){let P=document.createElement("optgroup");P.label=k("Recommended","gpt3-ai-content-generator"),x.forEach(b=>{if(b&&b.id){let y=new Option(b.name||b.id,b.id);b.id===m&&(y.selected=!0,I=!0),P.appendChild(y)}}),P.children.length>0&&g.appendChild(P)}Object.keys(h).forEach(P=>{let b=document.createElement("optgroup");b.label=P,h[P].forEach(y=>{if(y&&y.id&&v.has(y.id))return;let S=new Option(y.name,y.id);y.id===m&&(S.selected=!0,I=!0),b.appendChild(S)}),b.children.length>0&&g.appendChild(b)})}if(!I&&m){let P=new Option(`${m}`,m,!1,!0);g.insertBefore(P,g.firstChild),P.selected=!0}g.selectedIndex===-1&&g.options.length>0&&(g.options[0].selected=!0),g.options.length||(g.disabled=!0)}function l(f,m){let g=m||document,_=g.querySelector("#aipkit_ai_form_ai_model"),w=_&&_.value||"",h=t(f,w,"web_search_plugin"),E=g.querySelector('input[name="openai_web_search_enabled"]'),x=g.querySelector('input[name="claude_web_search_enabled"]'),v=g.querySelector('input[name="openrouter_web_search_enabled"]'),I=g.querySelector('input[name="google_search_grounding_enabled"]'),P=g.querySelector(".aipkit_ai_form_web_search_row--openai"),b=g.querySelector(".aipkit_ai_form_web_search_row--claude"),y=g.querySelector(".aipkit_ai_form_web_search_row--openrouter"),S=g.querySelector(".aipkit_ai_form_web_search_row--google"),C=g.querySelector(".aipkit_ai_form_openai_web_search_settings"),A=g.querySelector(".aipkit_ai_form_claude_web_search_settings"),M=g.querySelector(".aipkit_ai_form_openrouter_web_search_settings"),$=g.querySelector(".aipkit_ai_form_google_search_grounding_settings"),W=g.querySelector(".aipkit_ai_form_openai_web_search_location_details"),H=g.querySelector(".aipkit_ai_form_claude_web_search_location_details"),N=g.querySelector(".aipkit_ai_form_web_search_empty_state"),G=f==="OpenAI";P&&(P.style.display=G?"block":"none"),!G&&E&&(E.checked=!1);let Q=G&&E&&E.checked;C&&(C.style.display=Q?"block":"none"),!Q&&W?W.style.display="none":Q&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(g);let F=f==="Claude";b&&(b.style.display=F?"block":"none"),!F&&x&&(x.checked=!1);let L=F&&x&&x.checked;A&&(A.style.display=L?"block":"none"),!L&&H?H.style.display="none":L&&typeof window.aipkitForms_toggleClaudeWebSearchLocationDetails=="function"&&window.aipkitForms_toggleClaudeWebSearchLocationDetails(g);let O=f==="OpenRouter";y&&(y.style.display=O?"block":"none"),!O&&v&&(v.checked=!1);let D=O&&!h;v&&D&&(v.checked=!1),a(y,v,D,k("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"));let R=O&&h&&v&&v.checked;M&&(M.style.display=R?"block":"none");let Z=f==="Google";S&&(S.style.display=Z?"block":"none"),!Z&&I&&(I.checked=!1);let J=Z&&I&&I.checked;$&&($.style.display=J?"block":"none"),J&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(g),N&&(N.style.display=!G&&!F&&!O&&!Z?"block":"none")}function c(f){let m=f.querySelector("#aipkit_ai_form_ai_provider"),g=f.querySelector("#aipkit_ai_form_ai_model"),_=f.querySelector(".aipkit_ai_form_reasoning_effort_field"),w=f.querySelector("#aipkit_ai_form_reasoning_effort");if(!m||!g||!_||!w){_&&(_.style.display="none");return}let h=m.value,x=(g.value||"").toLowerCase();if(!(h==="OpenAI"&&o(x))){_.style.display="none";return}_.style.display="block";let v=i(x),I=new Set(v.allowed),P=w.value||"";P==="minimal"&&(P="low"),Array.from(w.options).forEach(b=>{let y=I.has(b.value);b.hidden=!y,b.disabled=!y}),I.has(P)||(P=v.defaultValue),I.has(P)||(P=v.allowed[0]||""),P&&(w.value=P)}function o(f){if(e(f))return!1;let m=f.startsWith("o1")||f.startsWith("o3")||f.startsWith("o4"),g=f.includes("gpt-5");return m||g}function e(f){return/(?:^|[-_])chat(?:[-_]|$)/.test(f)}function i(f){return u(f)?{allowed:["high"],defaultValue:"high"}:f.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:d(f)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function d(f){let m=f.match(/gpt-5\.(\d+)/);if(m)return Number.parseInt(m[1],10)>=2;let g=f.match(/gpt-(\d+)/);return g?Number.parseInt(g[1],10)>=6:!1}function u(f){return/gpt-5(\.\d+)?-pro/.test(f)}function p(f){let m=f.querySelector("#aipkit_ai_form_ai_provider"),g=f.querySelector("#aipkit_ai_form_ai_model");!m||!g||(m.dataset.modelListenerAttached!=="true"&&(m.addEventListener("change",function(){s(this.value),l(this.value,f),c(f)}),m.dataset.modelListenerAttached="true"),g.dataset.reasoningListenerAttached!=="true"&&(g.addEventListener("change",function(){c(f),l(m.value,f)}),g.dataset.reasoningListenerAttached="true"),s(m.value),l(m.value,f),c(f))}window.aipkitForms_initAiConfig=p,window.aipkitForms_populateAiModels=s,window.aipkitForms_updateWebSearchVisibility=l,window.aipkitForms_toggleReasoningEffort=c})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(N){return N},r={loaded:!1,loading:!1},n={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},t=()=>{let N=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:N&&typeof N.__=="function"?N.__:Q=>Q}},a=()=>{let N=window.aipkit_ai_forms_config||{},G=N.vectorStores?N.vectorStores.openai:[];return Array.isArray(G)?G:[]},s=N=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=N},l=N=>N?N.querySelector('select[name="openai_vector_store_ids[]"]'):null,c=N=>N?Array.from(N.options).some(G=>G.value&&!G.disabled):!1,o=(N,G)=>{let Q=N.id||N.vector_store_id||"",L=N.name||N.vector_store_name||""||`Untitled store ${G}`,O=N.file_counts?N.file_counts.total:null,D=" (Files: N/A)";return typeof O=="number"&&(D=` (${O} ${O===1?"File":"Files"})`),{id:Q,label:`${L}${D}`}},e=(N,G,Q={})=>{if(!N)return;let{__:F}=t(),O=Q.preserveSelection===!0?new Set(Array.from(N.selectedOptions||[]).map(Z=>Z.value)):new Set;N.innerHTML="";let D=Array.isArray(G)?G:[],R=1;if(D.forEach(Z=>{if(!Z||typeof Z!="object")return;let{id:J,label:pe}=o(Z,R);if(!J)return;let Ce=new Option(k(pe),J);O.has(J)&&(Ce.selected=!0),N.appendChild(Ce),R+=1}),!N.options.length){let Z=new Option(F("No stores found.","gpt3-ai-content-generator"),"");Z.disabled=!0,N.appendChild(Z)}},i=N=>{N&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(N)},d=async(N,G={})=>{let Q=l(N);if(!Q)return;let{__:F}=t(),L=G.force===!0,O=a();if(O.length&&(!L||!r.loaded)){e(Q,O,{preserveSelection:!0}),i(N),r.loaded=!0;return}if(!L&&r.loaded&&c(Q)||r.loading)return;let D=document.getElementById("aipkit_vector_store_nonce_openai"),R=D?D.value:"";if(!R||typeof window.aipkit_apiRequest!="function")return;r.loading=!0,Q.innerHTML="";let Z=new Option(F("Loading vector stores...","gpt3-ai-content-generator"),"");Z.disabled=!0,Q.appendChild(Z);try{let J=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:R,limit:100,order:"desc"}),pe=Array.isArray(J.stores)?J.stores:[];s(pe),e(Q,pe,{preserveSelection:!0}),i(N),r.loaded=!0}catch(J){let pe=J&&J.message?J.message:F("Unable to load stores.","gpt3-ai-content-generator");Q.innerHTML="";let Ce=new Option(pe,"");Ce.disabled=!0,Q.appendChild(Ce)}finally{r.loading=!1}},u=N=>{N&&d(N,{force:!0})},p=N=>{if(!N)return null;let G=N.closest(".aipkit_model_settings_popover");return G?G.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},f=(N,G,Q)=>{let F=p(N);F&&(F.textContent=G||"",F.classList.remove("success","error","loading"),Q&&F.classList.add(Q),F.style.display=G?"inline-block":"none")},m=(N,G=2500)=>{window.setTimeout(()=>{f(N,"","")},G)},g=N=>N?{pineconeKeyInput:N.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:N.querySelector('[name="qdrant_url"]'),qdrantKeyInput:N.querySelector('[name="qdrant_api_key"]')}:{},_=N=>{let G=N?.closest("#aipkit_ai_forms_container"),Q=G?G.dataset:{},{pineconeKeyInput:F,qdrantUrlInput:L,qdrantKeyInput:O}=g(N),D=F?.value.trim(),R=L?.value.trim(),Z=O?.value.trim(),J=!!(D||Q?.pineconeApiKeySet==="true"),pe=!!(R||Q?.qdrantUrlSet==="true")&&!!(Z||Q?.qdrantApiKeySet==="true");return{pinecone:J,qdrant:pe}},w=(N,G)=>N?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(N,{silent:!0,showErrors:!1,targetSelectId:G,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,N,{silent:!0,showErrors:!1,targetSelectId:G,propagateError:!0}):null:null,h=(N,G,Q)=>{if(!G)return;f(N,"Syncing...","loading");let F=w(G,Q);if(F&&typeof F.then=="function"){F.then(()=>{f(N,"Synced","success"),m(N)}).catch(L=>{f(N,`Error: ${L?.message||"Sync failed."}`,"error")});return}m(N)},E=(N,G)=>{if(!N||!G)return;if(G==="openai"){d(N);return}let Q=_(N);G==="pinecone"&&Q.pinecone?h(N,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):G==="qdrant"&&Q.qdrant&&h(N,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},x=(N,G)=>{!G||!Object.keys(G).length||typeof window.aipkit_apiRequest=="function"&&(n.saving=!0,f(N,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",G).then(Q=>{Object.keys(G).forEach(L=>{n.last[L]=G[L]});let F=N.closest("#aipkit_ai_forms_container");F&&(Object.prototype.hasOwnProperty.call(G,"pinecone_api_key")&&(F.dataset.pineconeApiKeySet=G.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(G,"qdrant_url")&&(F.dataset.qdrantUrlSet=G.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(G,"qdrant_api_key")&&(F.dataset.qdrantApiKeySet=G.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(G,"pinecone_api_key")&&E(N,"pinecone"),(Object.prototype.hasOwnProperty.call(G,"qdrant_url")||Object.prototype.hasOwnProperty.call(G,"qdrant_api_key"))&&E(N,"qdrant"),f(N,Q.message||"Saved","success"),m(N)}).catch(Q=>{f(N,`Error: ${Q?.message||"Failed to save."}`,"error")}).finally(()=>{if(n.saving=!1,n.queued){let Q=n.queued;n.queued=null,x(N,Q)}}))},v=(N,G)=>{if(!G)return;let Q=Object.keys(G).reduce((F,L)=>(G[L]!==n.last[L]&&(F[L]=G[L]),F),{});if(Object.keys(Q).length){if(n.saving){n.queued={...n.queued||{},...Q};return}x(N,Q)}},I=N=>{if(!N)return;let G=N.querySelector(".aipkit_vector_store_enable_select"),Q=N.querySelector(".aipkit_vector_store_settings_conditional_row"),F=N.querySelector(".aipkit_vector_store_provider_select"),L=N.querySelector(".aipkit_vector_store_openai_field"),O=N.querySelector(".aipkit_vector_store_pinecone_field"),D=N.querySelector(".aipkit_vector_store_pinecone_key_field"),R=N.querySelector(".aipkit_vector_store_qdrant_field"),Z=N.querySelector(".aipkit_vector_store_qdrant_url_field"),J=N.querySelector(".aipkit_vector_store_qdrant_key_field"),pe=N.querySelector(".aipkit_vector_store_embedding_config_row");if(!G||!Q||!F)return;let Ce=G.tagName==="SELECT"?G.value==="1":G.checked;if(Q.style.display=Ce?"block":"none",!Ce){[L,O,D,R,Z,J,pe].forEach(Ke=>{Ke&&(Ke.style.display="none")});return}let He=F.value||"openai";L&&(L.style.display=He==="openai"?"block":"none"),O&&(O.style.display=He==="pinecone"?"block":"none"),D&&(D.style.display=He==="pinecone"?"block":"none"),R&&(R.style.display=He==="qdrant"?"block":"none"),Z&&(Z.style.display=He==="qdrant"?"block":"none"),J&&(J.style.display=He==="qdrant"?"block":"none"),pe&&(pe.style.display=He==="pinecone"||He==="qdrant"?"block":"none"),He==="openai"&&(d(N),i(N))},P=N=>{let G=(N||"").split("::"),Q=G.shift()||"",F=G.join("::")||"";return{provider:Q,model:F}},b=(N,G)=>!N||!G?"":`${N}::${G}`,y=(N,G,Q)=>{if(!N||!G||!Q)return;let F=b(G,Q);if(!F)return;let L=typeof CSS<"u"&&CSS.escape?CSS.escape(F):F.replace(/"/g,'\\"');if(N.querySelector(`option[value="${L}"]`))return;let O=document.createElement("option");O.value=F,O.dataset.provider=G,O.textContent=`${Q}`,N.appendChild(O)},S=(N,G)=>{if(!N)return;let Q=G||N.querySelector(".aipkit_vector_embedding_select");if(!Q)return;let F=N.querySelector('select[name="vector_embedding_provider"]'),L=N.querySelector('select[name="vector_embedding_model"]'),O=F?F.value:"",D=L?L.value:"",R=b(O,D);if(R){y(Q,O,D),Q.value=R;return}Q.value=""},C=(N,G)=>{if(!G||!N)return;let Q=G.querySelector('select[name="vector_embedding_provider"]'),F=G.querySelector('select[name="vector_embedding_model"]'),{provider:L,model:O}=P(N.value);Q&&(Q.value=L),Q&&F&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(G),F&&(F.value=O)};function A(N){let G=N.querySelector(".aipkit_vector_embedding_provider_select"),Q=N.querySelector(".aipkit_vector_embedding_model_select"),L=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!G||!Q||!L)return;let D=G.value.toLowerCase(),R=L[D]||[];Q.innerHTML="",Q.appendChild(new Option(`-- Select ${G.options[G.selectedIndex]?.text||""} Model --`,"")),R&&Array.isArray(R)&&R.length>0?(R.forEach(Z=>{Q.appendChild(new Option(k(Z.name),Z.id))}),Q.disabled=!1):(Q.appendChild(new Option("(No models found - Sync in Settings)","")),Q.disabled=!0)}function M(N){let G=N||document,Q=G.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),F=G.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!Q||!F)return;let L=Q.value==="approximate";F.style.display=L?"block":"none"}function $(N){let G=N||document,Q=G.querySelector(".aipkit_ai_form_claude_web_search_loc_type_select"),F=G.querySelector(".aipkit_ai_form_claude_web_search_location_details");if(!Q||!F)return;let L=Q.value==="approximate";F.style.display=L?"block":"none"}function W(N){let G=N||document,Q=G.querySelector(".aipkit_ai_form_google_grounding_mode_select"),F=G.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!Q||!F)return;let L=Q.value==="MODE_DYNAMIC";F.style.display=L?"block":"none"}function H(N){let G=N.querySelector("#aipkit_form_editor_container");if(!G)return;let Q=G.querySelector("#aipkit_ai_form_settings_popover");if(!Q)return;let F=Q.querySelector('[data-aipkit-settings-panel="context"]'),L=Q.querySelector('[data-aipkit-settings-panel="tools"]');if(!F)return;let O=G.querySelector("#aipkit_ai_form_ai_provider"),D=g(F);n.last={pinecone_api_key:D.pineconeKeyInput?.value||"",qdrant_url:D.qdrantUrlInput?.value||"",qdrant_api_key:D.qdrantKeyInput?.value||""};let R="data-vector-config-listener-attached";if(F.getAttribute(R)!=="true"&&(F.addEventListener("change",Z=>{let J=Z.target;if(J){if(J.matches('[name="pinecone_api_key"]')||J.matches('[name="qdrant_url"]')||J.matches('[name="qdrant_api_key"]')){v(F,{[J.name]:J.value||""});return}if(J.matches(".aipkit_vector_store_enable_select")||J.matches(".aipkit_vector_store_provider_select")){I(F);let pe=F.querySelector(".aipkit_vector_store_provider_select"),Ce=pe?pe.value:"";E(F,Ce);return}if(J.matches(".aipkit_vector_embedding_select")){C(J,F);return}if(J.matches(".aipkit_vector_embedding_provider_select")||J.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(F),S(F);return}J.matches('select[name="openai_vector_store_ids[]"]')&&i(F)}}),F.addEventListener("input",Z=>{let J=Z.target;if(J){if(J.matches("#aipkit_ai_form_vector_store_top_k")){let pe=F.querySelector("#aipkit_ai_form_vector_store_top_k_value");pe&&(pe.textContent=J.value)}else if(J.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let pe=F.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");pe&&(pe.textContent=J.value+"%")}}}),F.setAttribute(R,"true")),L){let Z="data-tools-config-listener-attached";L.getAttribute(Z)!=="true"&&(L.addEventListener("change",J=>{let pe=J.target;if(pe.matches(".aipkit_ai_form_openai_web_search_toggle")||pe.matches(".aipkit_ai_form_claude_web_search_toggle")||pe.matches(".aipkit_ai_form_openrouter_web_search_toggle")||pe.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let Ce=O?O.value:"";window.aipkitForms_updateWebSearchVisibility(Ce,G)}}else pe.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?M(L):pe.matches(".aipkit_ai_form_claude_web_search_loc_type_select")?$(L):pe.matches(".aipkit_ai_form_google_grounding_mode_select")&&W(L)}),L.addEventListener("input",J=>{let pe=J.target;if(pe.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let Ce=L.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");Ce&&(Ce.textContent=parseFloat(pe.value).toFixed(2))}}),L.setAttribute(Z,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&O&&window.aipkitForms_updateWebSearchVisibility(O.value,G),I(F),A(F),S(F),i(F)}window.aipkitForms_initVectorConfig=H,window.aipkitForms_populateVectorEmbeddingModels=A,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=M,window.aipkitForms_toggleClaudeWebSearchLocationDetails=$,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=W,window.aipkitForms_refreshOpenaiStores=u,window.aipkitForms_syncEmbeddingSelectFromInputs=S})();(function(){"use strict";function k(n,t,a,s){let l=window.aipkitAIFormsState,c=document.createElement("div");c.className="aipkit_layout_row",c.id=t.internalId;let o=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,e=document.createElement("div");e.className="aipkit_layout_row_columns_container",t.columns.forEach(i=>{let d=document.createElement("div");d.className="aipkit_layout_column",d.id=i.internalId,d.style.flexBasis=i.width,r(d,s),i.elements.forEach(u=>{window.aipkitForms_renderFieldInColumn(d,u)}),e.appendChild(d)}),c.innerHTML=o,c.appendChild(e),a?n.insertBefore(c,a):n.appendChild(c)}function r(n,t){let a=window.aipkitAIFormsState;n.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation(),n.classList.add("aipkit-drag-over"),(a.draggedElement||a.draggedElementType)&&(s.dataTransfer.dropEffect=a.draggedElement?"move":"copy")}),n.addEventListener("dragleave",s=>{s.preventDefault(),s.stopPropagation(),n.classList.remove("aipkit-drag-over")}),n.addEventListener("drop",s=>{if(s.preventDefault(),n.classList.remove("aipkit-drag-over"),a.draggedElementType||a.draggedElement&&a.draggedElement.classList.contains("aipkit_dropped_element")){s.stopPropagation();let l=n.id;if(a.draggedElementType){let c=window.aipkitForms_createNewFormElementData(a.draggedElementType);a.formStructure.forEach(o=>{let e=o.columns.find(i=>i.internalId===l);e&&e.elements.push(c)}),window.aipkitForms_renderFieldInColumn(n,c,null,t)}else a.draggedElement&&(n.appendChild(a.draggedElement),window.aipkitForms_updateFormStructureOrder());a.draggedElementType=null,a.draggedElement&&(a.draggedElement.classList.remove("aipkit-row-dragging-source"),a.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector("#aipkit_ai_form_settings_popover");if(!n)return;let t=Array.from(n.querySelectorAll("[data-aipkit-settings-panel]"));if(!t.length||n.dataset.panelsBound==="true")return;let a=n.querySelector(".aipkit_model_settings_popover_title"),s=n.querySelector(".aipkit_model_settings_popover_back"),l=r.querySelector("#aipkit_ai_form_settings_trigger"),c={root:n.dataset.titleRoot||"Settings",parameters:n.dataset.titleParameters||"Parameters",context:n.dataset.titleContext||"Context",tools:n.dataset.titleTools||"Tools"},o=null,e=i=>{let d=i||"root",u=n.querySelector(`[data-aipkit-settings-panel="${d}"]`)||n.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let p=u.dataset.aipkitSettingsPanel||"root";p!==o&&(t.forEach(f=>{f.hidden=f!==u}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),o=p,n.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};n.addEventListener("click",i=>{let d=i.target.closest("[data-aipkit-panel-target]");if(!d)return;i.preventDefault();let u=d.dataset.aipkitPanelTarget;e(u)}),s&&s.addEventListener("click",i=>{i.preventDefault(),e("root")}),l&&l.addEventListener("click",()=>{e("root")}),e("root"),n.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector("#aipkit_form_editor_container");if(!n)return;let t=n.querySelector("#aipkit_ai_form_prompt_template"),a=n.querySelector(".aipkit_ai_form_prompt_expand"),s=document.getElementById("aipkit_ai_form_prompt_modal");if(!t||!a||!s)return;let l=s.querySelector(".aipkit_ai_form_prompt_modal_textarea"),c=s.querySelector(".aipkit_ai_form_prompt_count"),o=s.querySelector(".aipkit_ai_form_prompt_modal_close");if(s.dataset.bound==="1")return;let e=p=>{c&&(c.textContent=`${p.length.toLocaleString()} characters`)},i=p=>{l&&(l.value=p,e(p))},d=()=>{l&&(i(t.value||""),s.classList.add("aipkit-active"),s.setAttribute("aria-hidden","false"),setTimeout(()=>l.focus(),0))},u=p=>{if(s.classList.remove("aipkit-active"),s.setAttribute("aria-hidden","true"),!p||!l)return;let f=l.value;f!==t.value&&(t.value=f,t.dispatchEvent(new Event("input",{bubbles:!0})))};a.addEventListener("click",p=>{p.preventDefault(),d()}),o&&o.addEventListener("click",()=>{u(!0)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&s.classList.contains("aipkit-active")&&u(!0)}),l&&l.dataset.bound!=="1"&&(l.addEventListener("input",()=>{e(l.value)}),l.dataset.bound="1"),s.dataset.bound="1"}window.aipkitForms_initPromptModal=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.querySelector("#aipkit_ai_forms_settings_popover");if(!n)return;let t=Array.from(n.querySelectorAll("[data-aipkit-settings-panel]"));if(!t.length||n.dataset.panelsBound==="true")return;let a=n.querySelector(".aipkit_model_settings_popover_title"),s=n.querySelector(".aipkit_model_settings_popover_back"),l=n.querySelector(".aipkit_model_settings_popover_footer"),c=r.querySelector("#aipkit_ai_forms_settings_trigger"),o={root:n.dataset.titleRoot||"Settings",limits:n.dataset.titleLimits||"Limits","custom-css":n.dataset.titleCustomCss||"Custom CSS","provider-filtering":n.dataset.titleProviderFiltering||"Provider Filtering"},e=null,i=d=>{let u=d||"root",p=n.querySelector(`[data-aipkit-settings-panel="${u}"]`)||n.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let f=p.dataset.aipkitSettingsPanel||"root";f!==e&&(t.forEach(m=>{m.hidden=m!==p}),a&&(a.textContent=o[f]||o.root),s&&(s.hidden=f==="root"),l&&(l.hidden=f==="root"),f==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(r),e=f,n.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};n.addEventListener("click",d=>{let u=d.target.closest("[data-aipkit-panel-target]");if(!u)return;d.preventDefault();let p=u.dataset.aipkitPanelTarget;i(p)}),s&&s.addEventListener("click",d=>{d.preventDefault(),i("root")}),c&&c.addEventListener("click",()=>{i("root")}),i("root"),n.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=k})();(function(){"use strict";let k=[{key:"openai",label:"OpenAI"},{key:"google",label:"Google"},{key:"claude",label:"Claude"},{key:"openrouter",label:"OpenRouter"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"ollama",label:"Ollama",requiresPro:!0},{key:"deepseek",label:"DeepSeek"}],r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,n=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(c,o)=>c.replace("%d",o),t=c=>{if(!c)return null;if(typeof c=="string")return{id:c,name:c};if(typeof c=="object"){let o=c.id||c.name||"";return o?{id:o,name:c.name||c.id||o}:null}return null},a=c=>{if(!c)return null;if(Array.isArray(c))return c.map(t).filter(Boolean);if(typeof c=="object"){let o={};return Object.keys(c).forEach(e=>{let d=(Array.isArray(c[e])?c[e]:[]).map(t).filter(Boolean);d.length&&(o[e]=d)}),o}return null},s=c=>c?Array.isArray(c)?c.length>0:Object.keys(c).length>0:!1;function l(c){let o=c||document,e=o.querySelector("#aipkit_ai_forms_models_selector");if(!e||e.dataset.enhanced==="true")return;let i=o.querySelector("#aipkit_aiforms_frontend_models"),d=o.querySelector("#aipkit_aiforms_frontend_providers");if(!i||!d)return;let u=r(),p=n(),m=(e.dataset.initialValue||i.value||"").split(",").map(b=>b.trim()).filter(Boolean),g=new Set(m),_=window.aipkit_dashboard||{},w=_.models||{},h=!!_.isProPlan,E=k.filter(b=>!b.requiresPro||h).map(b=>({...b,models:a(w[b.key])})).filter(b=>b.keepWhenEmpty||s(b.models));e.innerHTML="",e.classList.add("aipkit_models_selector--ready");let x=document.createElement("input");x.type="search",x.placeholder=u("Filter models...","gpt3-ai-content-generator"),x.className="aipkit_models_selector-search",e.appendChild(x);let v=document.createElement("div");v.className="aipkit_models_selector-summary",e.appendChild(v);let I=document.createElement("div");I.className="aipkit_models_selector-providers",e.appendChild(I);let P=b=>{let y=Array.from(e.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),S=y.map(M=>M.value.trim()).filter(Boolean),C=new Set;y.forEach(M=>{M.dataset.providerName&&C.add(M.dataset.providerName)});let A=S.length?E.map(M=>M.label).filter(M=>C.has(M)).join(", "):"";i.value=S.join(", "),d.value=A,S.length===0?v.textContent=u("Showing all models (none selected)","gpt3-ai-content-generator"):S.length===1?v.textContent=u("1 model selected","gpt3-ai-content-generator"):v.textContent=p(u("%d models selected","gpt3-ai-content-generator"),S.length),b&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};E.forEach(b=>{let y=document.createElement("div");y.className="aipkit_models_selector-provider",y.dataset.provider=b.key;let S=document.createElement("div");S.className="aipkit_models_selector-provider-header",S.innerHTML=`<strong>${b.label}</strong>`;let C=document.createElement("div");C.className="aipkit_models_selector-provider-actions";let A=document.createElement("button");A.type="button",A.className="aipkit_btn aipkit_btn-xs",A.textContent=u("All","gpt3-ai-content-generator");let M=document.createElement("button");M.type="button",M.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",M.textContent=u("None","gpt3-ai-content-generator"),C.appendChild(A),C.appendChild(M),S.appendChild(C),y.appendChild(S);let $=document.createElement("div");$.className="aipkit_models_selector-models";let W=H=>{if(!H||!H.id)return;let N=document.createElement("label");N.className="aipkit_models_selector-item",N.title=H.id;let G=document.createElement("input");G.type="checkbox",G.value=H.id,G.checked=g.has(H.id),G.dataset.providerName=b.label,G.addEventListener("change",()=>P(!0));let Q=document.createElement("span");Q.textContent=H.name||H.id,N.appendChild(G),N.appendChild(Q),$.appendChild(N)};if(Array.isArray(b.models)?b.models.forEach(H=>W(H)):b.models&&typeof b.models=="object"&&Object.keys(b.models).forEach(H=>{let N=b.models[H]||[];if(!N.length)return;let G=document.createElement("div");G.className="aipkit_models_selector-subgroup",G.textContent=H.charAt(0).toUpperCase()+H.slice(1),$.appendChild(G),N.forEach(Q=>W(Q))}),!s(b.models)){let H=document.createElement("div");H.className="aipkit_models_selector-empty",H.textContent=u(b.emptyMessage||"No models found.","gpt3-ai-content-generator"),$.appendChild(H)}A.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(H=>{H.checked=!0}),P(!0)}),M.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(H=>{H.checked=!1}),P(!0)}),y.appendChild($),I.appendChild(y)}),x.addEventListener("input",()=>{let b=x.value.toLowerCase();I.querySelectorAll(".aipkit_models_selector-provider").forEach(y=>{let S=!1;y.querySelectorAll(".aipkit_models_selector-item").forEach(C=>{let M=C.textContent.toLowerCase().includes(b);C.style.display=M?"":"none",M&&(S=!0)}),y.style.display=S||b===""?"":"none"})}),P(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),e.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=l})();(function(){"use strict";let k=window.wp?.i18n?.__||function(I){return I},r="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",n=null,t=null,a=!1,s=I=>!!(I&&(I.id==="aipkit_ai_form_ai_provider"||I.id==="aipkit_ai_form_vector_store_provider")),l=I=>!!(I&&s(I)),c=(I,P)=>{if(!I)return!1;let b=o(P);return b?["openai","openrouter","google","azure","claude","deepseek","ollama","pinecone","qdrant"].includes(b):!1},o=I=>String(I||"").trim().toLowerCase(),e=(I,P,b)=>{if(!I)return;let y="aipkit_settings_select_picker_icon--";I.classList.forEach(A=>{A.startsWith(y)&&I.classList.remove(A)});let S=o(b),C=c(P,S);I.hidden=!C,C&&I.classList.add(`${y}${S}`)},i=I=>{if(!I)return"";let P=I.getAttribute("data-aipkit-picker-title");if(P)return P;let b=I.id&&document.querySelector(`label[for="${I.id}"]`)||I.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return b?b.textContent.trim():""},d=I=>{if(!I)return"";let P=I.selectedOptions&&I.selectedOptions.length?I.selectedOptions[0]:I.querySelector("option[selected]");if(P)return P.textContent.trim();let b=I.querySelector("option");return b?b.textContent.trim():""},u=I=>({buttonId:`${I}_picker_btn`,labelId:`${I}_picker_label`,popoverId:`${I}_picker_popover`,titleId:`${I}_picker_title`,searchId:`${I}_picker_search`,listId:`${I}_picker_list`}),p=(I,P)=>{if(!I||!I.id||!P)return null;let b=u(I.id),y=document.getElementById(b.buttonId);if(!y){if(y=document.createElement("button"),y.type="button",y.id=b.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",b.popoverId),y.setAttribute("aria-controls",b.popoverId),y.setAttribute("aria-expanded","false"),y.dataset.aipkitPopoverPlacement="bottom",s(I)){y.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),e(M,I,I.value),y.appendChild(M)}let C=document.createElement("span");C.className="aipkit_settings_select_picker_label",C.id=b.labelId,C.textContent=d(I)||k("Select","gpt3-ai-content-generator");let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),y.appendChild(C),y.appendChild(A),I.insertAdjacentElement("beforebegin",y)}I.classList.contains("screen-reader-text")||I.classList.add("screen-reader-text");let S=document.getElementById(b.popoverId);if(!S){S=document.createElement("div"),S.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",S.id=b.popoverId,S.setAttribute("aria-hidden","true"),s(I)&&S.classList.add("aipkit_settings_select_picker_popover--provider");let C=document.createElement("div");C.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",C.setAttribute("role","dialog"),C.setAttribute("aria-labelledby",b.titleId);let A=document.createElement("div");A.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=b.titleId,M.textContent=i(I)||k("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',A.appendChild(M),A.appendChild($);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let H=document.createElement("div");H.className="aipkit_settings_select_picker_search";let N=document.createElement("input");N.type="search",N.id=b.searchId,N.className="aipkit_form-input";let G=i(I),Q=G?`Search ${G.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");N.setAttribute("placeholder",Q),H.appendChild(N);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=b.listId,F.setAttribute("role","listbox"),W.appendChild(H),W.appendChild(F),C.appendChild(A),C.appendChild(W),S.appendChild(C),P.appendChild(S),l(I)&&(H.style.display="none")}return{ids:b,button:y,popover:S,label:document.getElementById(b.labelId),search:document.getElementById(b.searchId),list:document.getElementById(b.listId)}},f=I=>{let P=[];return I&&Array.from(I.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let S=Array.from(y.children).filter(C=>C.tagName==="OPTION").map(C=>({value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}));P.push({label:y.label,options:S})}else y.tagName==="OPTION"&&P.push({label:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),P},m=(I,P,b="")=>{if(!I||!P)return;P.innerHTML="";let y=f(I),S=b.trim().toLowerCase(),C=!1;if(y.forEach(A=>{let M=A.options.filter($=>S?$.label.toLowerCase().includes(S):!0);if(M.length){if(A.label){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=A.label,P.appendChild($)}M.forEach($=>{let W=document.createElement("button");if(W.type="button",W.className="aipkit_settings_select_picker_item",$.disabled&&W.classList.add("is-disabled"),$.selected&&W.classList.add("is-active"),W.dataset.value=$.value,s(I)&&c(I,$.value)){let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),e(G,I,$.value),W.appendChild(G)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=$.label||$.value;let N=document.createElement("span");N.className="dashicons dashicons-yes aipkit_settings_select_picker_check",N.setAttribute("aria-hidden","true"),W.appendChild(H),W.appendChild(N),P.appendChild(W),C=!0})}}),!C){let A=document.createElement("div");A.className="aipkit_settings_select_picker_empty",A.textContent=k(S?"No matches found.":"No options available.","gpt3-ai-content-generator"),P.appendChild(A)}},g=(I,P)=>{if(!I||!P)return;let b=d(I);if(P.textContent=b||k("Select","gpt3-ai-content-generator"),s(I)){let y=P.closest("button"),S=y?y.querySelector(".aipkit_settings_select_picker_icon"):null;e(S,I,I.value)}},_=(I,P)=>{if(!I||!P)return;let b=I.getBoundingClientRect(),y=P.getBoundingClientRect(),S=y.width||320,C=y.height||0,A=window.innerWidth,M=window.innerHeight,$=12;if(I.dataset.aipkitPopoverPlacement==="bottom"){let N=b.left;N+S>A-$&&(N=b.right-S),N=Math.max($,Math.min(N,A-S-$));let G=b.bottom+8;G+C>M-$&&(G=b.top-C-8),G=Math.max($,Math.min(G,M-C-$)),P.style.left=`${Math.round(N)}px`,P.style.top=`${Math.round(G)}px`;return}let W=b.right+10;W+S>A-$&&(W=b.left-S-10),W=Math.max($,Math.min(W,A-S-$));let H=b.top;H+C>M-$&&(H=M-C-$),H=Math.max($,H),P.style.left=`${Math.round(W)}px`,P.style.top=`${Math.round(H)}px`},w=()=>{!n||!t||a||(a=!0,window.requestAnimationFrame(()=>{let I=n.querySelector(".aipkit_model_settings_popover_panel");_(t,I),a=!1}))},h=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),t&&t.setAttribute("aria-expanded","false"),n=null,t=null)},E=(I,P,b)=>{if(!I||!P)return;n&&n!==P&&h(),n=P,t=I,P.classList.add("aipkit-active"),P.setAttribute("aria-hidden","false"),I.setAttribute("aria-expanded","true");let y=P.querySelector(".aipkit_settings_select_picker_search input"),S=P.querySelector(".aipkit_settings_select_picker_list");S&&m(b,S,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let C=P.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(I,C)})},x=(I,P)=>{if(!I||!P)return;let{button:b,popover:y,list:S,search:C}=P;if(b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("click",A=>{if(A.preventDefault(),n===y){h();return}E(b,y,I)}),b.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",M=>{M.target===y&&h()});let A=y.querySelector(".aipkit_model_settings_popover_close");A&&A.addEventListener("click",M=>{M.preventDefault(),h()}),y.dataset.overlayListenerAttached="true"}if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",A=>{let M=A.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let $=M.dataset.value??"";I.value=$,I.dispatchEvent(new Event("change",{bubbles:!0})),g(I,P.label),m(I,S,C?C.value:""),h()}),S.dataset.pickerListenerAttached="true"),C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("input",()=>{m(I,S,C.value)}),C.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerListenerAttached!=="true"&&(I.addEventListener("change",()=>{g(I,P.label),m(I,S,C?C.value:"")}),I.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerObserverAttached!=="true"){let A=!1;new MutationObserver(()=>{A||(A=!0,window.requestAnimationFrame(()=>{g(I,P.label),m(I,S,C?C.value:""),A=!1}))}).observe(I,{childList:!0,subtree:!0}),I.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",A=>{A.key==="Escape"&&n&&h()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function v(I){let P=I||document.getElementById("aipkit_ai_forms_container");if(!P)return;let b=P.querySelectorAll(r);b.length&&b.forEach(y=>{if(!y.id||y.dataset.aipkitPickerInit==="true")return;let S=p(y,P);S&&(g(y,S.label),m(y,S.list,S.search?S.search.value:""),x(y,S),y.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=v,window.aipkitForms_refreshSelectPickers=function(I){let P=I||document.getElementById("aipkit_ai_forms_container");if(!P)return;let b=P.querySelectorAll(r);b.length&&b.forEach(y=>{if(!y.id)return;let S=p(y,P);S&&(g(y,S.label),m(y,S.list,S.search?S.search.value:""),x(y,S),y.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let k={css:new Set,js:new Set},r=()=>{let d=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:d&&typeof d.__=="function"?d.__:u=>u}},n=window.aipkit_escapeHtml||(d=>d),t=d=>{if(!d||k.css.has(d))return;if(document.querySelector(`link[href="${d}"]`)){k.css.add(d);return}let u=document.createElement("link");u.rel="stylesheet",u.href=d,document.head.appendChild(u),k.css.add(d)},a=d=>!d||k.js.has(d)?Promise.resolve():new Promise((u,p)=>{if(document.querySelector(`script[src="${d}"]`)){k.js.add(d),u();return}let f=document.createElement("script");f.src=d,f.async=!0,f.onload=()=>{k.js.add(d),u()},f.onerror=()=>p(new Error(`Failed to load script: ${d}`)),document.body.appendChild(f)}),s=(d,u,p="info")=>{if(!d)return;let f=p==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",m=p==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';d.innerHTML=`
      <div class="${f}">
        ${m}
        <span>${n(u)}</span>
      </div>
    `},l=(d,u,p={})=>{let{__:f}=r(),m=window.aipkit_ai_forms_config||{},g=p.loadingText||f("Loading preview...","gpt3-ai-content-generator");return u?d?typeof window.aipkit_apiRequest!="function"?(s(u,f("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(s(u,g),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:d,_ajax_nonce:m.nonce_manage_forms}).then(_=>(_.config&&(window.aipkit_ai_forms_public_config=_.config),_.models&&(window.aipkit_ai_forms_models=_.models),_.assets&&_.assets.css&&Object.values(_.assets.css).forEach(t),u.innerHTML=_.html||"",_.assets&&_.assets.js?Promise.all(Object.values(_.assets.js).map(a)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(_=>{let w=_&&_.message?_.message:"Unknown error.";throw s(u,`${f("Preview failed:","gpt3-ai-content-generator")} ${w}`,"error"),_})):(s(u,f("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},c=d=>{let u=d||document.getElementById("aipkit_ai_forms_container");if(!u)return null;let p=u.querySelector("#aipkit_ai_forms_preview_sheet");return p?{container:u,overlay:p,panel:p.querySelector(".aipkit_builder_sheet_panel"),closeButton:p.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:p.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:p.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:p.querySelector("#aipkit_ai_forms_preview_frame")}:null},o=(d,u,p)=>{let{__:f}=r(),m=c(p);if(!m)return;let g=u&&String(u).trim()||f("Untitled","gpt3-ai-content-generator");m.title&&(m.title.textContent=f("Preview","gpt3-ai-content-generator")),m.description&&(m.description.textContent="",m.description.removeAttribute("title"),m.description.setAttribute("hidden","true")),m.overlay.classList.add("aipkit-active"),m.overlay.setAttribute("aria-hidden","false"),m.previewFrame&&l(d,m.previewFrame).catch(()=>{}),m.closeButton&&m.closeButton.focus()},e=d=>{let u=c(d);u&&(u.overlay.classList.remove("aipkit-active"),u.overlay.setAttribute("aria-hidden","true"),u.previewFrame&&(u.previewFrame.innerHTML=""))},i=d=>{let u=c(d);!u||u.overlay.dataset.previewSheetInitialized==="true"||(u.closeButton&&u.closeButton.addEventListener("click",p=>{p.preventDefault(),e(u.container)}),u.overlay.addEventListener("click",p=>{p.target===u.overlay&&e(u.container)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&u.overlay.classList.contains("aipkit-active")&&e(u.container)}),u.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=l,window.aipkitForms_openPreviewSheet=o,window.aipkitForms_closePreviewSheet=e,window.aipkitForms_initPreviewSheet=i})();(function(){"use strict";function k(){let r=window.aipkitForms_validateContainer();if(!r)return;let n=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(r):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(r.dataset.aipkitInitialized==="true"){n(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initEditorPersistence=="function"&&window.aipkitForms_initEditorPersistence(r),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(r),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(r),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(r),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(r),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(r),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(r),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(r),window.aipkitForms_initializeDragAndDrop(r),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(r),window.aipkitForms_initializeTokenUI(r);return}n(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initEditorPersistence=="function"&&window.aipkitForms_initEditorPersistence(r),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(r):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(r),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(r),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(r):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(r),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(r),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(r),window.aipkitForms_attachClickEventListeners(r),window.aipkitForms_attachChangeEventListeners(r),window.aipkitForms_attachSettingsPanelListeners(r),window.aipkitForms_initializeAccordions(r),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(r):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(r),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(r),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(r):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(r):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),r.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=k})();(function(){"use strict";let k="",r={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function n(){let l=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_provider_notice_autogpt");if(!l||!c)return;l.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(u=>{delete u.dataset.aipkitProviderNoticeArmed});let e=Array.from(l.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),i=u=>u&&(u.offsetParent!==null||u.getClientRects().length>0),d=e.filter(i);if(!d.length){c.classList.add("aipkit_provider_notice--hidden");return}d.forEach(u=>{u.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(u.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(l)}function t(l){if(!l)return null;let c="content_writing";return l==="content_indexing"?c="content_indexing":l==="community_reply_comments"?c="community_reply_comments":l==="enhance_existing_content"&&(c="enhance_existing_content"),window.aipkit_wizardConfig[c]||null}function a(l){let c=document.querySelector(".aipkit_wizard_content_container"),o=document.getElementById("aipkit_save_task_btn");if(!c)return;let e=t(l);if(!e){c.querySelectorAll(".aipkit_wizard_content_step").forEach(d=>{d.style.display="none",d.classList.remove("aipkit_active")}),o&&(o.style.display="none"),n();return}let i=new Set(Object.values(e.contentMap));c.querySelectorAll(".aipkit_wizard_content_step").forEach(d=>{let u=d.dataset.contentId||"";i.has(u)?(d.style.display="block",d.classList.add("aipkit_active")):(d.style.display="none",d.classList.remove("aipkit_active"))}),o&&(o.style.display="inline-flex"),n()}function s(l){k=l,a(l)}window.aipkit_renderWizard=s,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{k="",a("")},window.aipkit_wizardConfig=r})();(function(){"use strict";function k(r){let n=window.aipkit_automated_tasks_config||{},t=n.text||{},a=window.aipkit_escapeHtml||function(o){return o},s=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!s)return Promise.resolve();s.innerHTML=`<option value="">${a(t.loading_stores||"Loading...")}</option>`,s.disabled=!0;let l=[],c=t.select_target_store||"-- Select Target Store --";return r==="openai"&&n.openai_vector_stores?l=n.openai_vector_stores:r==="pinecone"&&n.pinecone_indexes?(l=n.pinecone_indexes,c=t.select_target_index||"-- Select Target Index --"):r==="qdrant"&&n.qdrant_collections&&(l=n.qdrant_collections,c=t.select_target_collection||"-- Select Target Collection --"),s.innerHTML=`<option value="">${a(c)}</option>`,l&&Array.isArray(l)&&l.length>0?(l.forEach(o=>{let e=o.id||o.name,i=o.name||o.id,d=a(i);r==="openai"&&o.file_counts?.total!==void 0?d+=` (Files: ${o.file_counts.total})`:r==="pinecone"&&o.dimension!==void 0&&(d+=` (Dim: ${o.dimension})`),s.appendChild(new Option(d,e))}),s.disabled=!1):(s.appendChild(new Option(a(t.no_targets_found_configure||`No ${r} targets found. Configure in AI Training.`),"")),s.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=k})();(function(){"use strict";function k(){let r=window.aipkit_automated_tasks_config||{},n=r.text||{},t=window.aipkit_escapeHtml||function(u){return u},a=document.getElementById("aipkit_task_content_indexing_embedding_model"),s=window.aipkit_automated_tasks_form_state||{},l=s.pendingEmbeddingModelSelection;if(!a)return Promise.resolve();a.innerHTML=`<option value="">${t(n.select_embedding_model||"-- Select Model --")}</option>`;let c=r.openai_embedding_models||[],o=r.google_embedding_models||[],e=r.openrouter_embedding_models||[],i=r.azure_embedding_models||[],d=(u,p,f)=>{let m=document.createElement("optgroup");return m.label=t(u),p&&p.length>0&&p.forEach(g=>{let _=`${f}:${g.id}`;m.appendChild(new Option(t(g.name||g.id),_))}),m};if(a.appendChild(d("OpenAI",c,"openai")),a.appendChild(d("Google",o,"google")),a.appendChild(d("OpenRouter",e,"openrouter")),a.appendChild(d("Azure",i,"azure")),a.disabled=c.length===0&&o.length===0&&e.length===0&&i.length===0,a.disabled&&(a.innerHTML=`<option value="">${t(n.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),l&&a.querySelector(`option[value="${CSS.escape(l)}"]`))a.value=l,s.pendingEmbeddingModelSelection=null;else if(a.options.length>1){let u=a.querySelector("optgroup");u&&u.options.length>0&&(a.value=u.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=k})();(function(){"use strict";function k(r){let n=r.target.value,t=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),a=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(n):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),t){let s=n==="pinecone"||n==="qdrant";t.style.display=s?"block":"none",a&&(a.style.display=s?"flex":"none"),s&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_autogpt_container");if(!r)return;let n=r.querySelector("#aipkit_task_content_indexing_target_store_provider");if(n){if(n.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(n.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:n}),n.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}}window.aipkit_initContentIndexingTaskFormUI=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t},r=window.wp?.i18n?.__||function(t){return t};function n(t,a){let s=t.value,l=s?s.toLowerCase():"",c=window.aipkit_dashboard?.models,o=window.aipkit_automated_tasks_form_state||{};if(!a)return;if(!c){a.innerHTML=`<option value="">${k("Error: Model data object not found")}</option>`,a.disabled=!0;return}let e=c[l];(typeof e>"u"||e===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${l}'.`),e=l==="openai"?{}:[]);let i=o.pendingModelSelection||a.value;a.innerHTML="";let d=window.aipkit_dashboard?.recommendedModels?.[l]||[],u=Array.isArray(d)?d:[],p=new Set(u.map(f=>f?.id).filter(Boolean));if(l==="openai"&&typeof e=="object"&&!Array.isArray(e)){if(u.length>0){let f=document.createElement("optgroup");f.label=k(r("Recommended","gpt3-ai-content-generator")),u.forEach(m=>{m&&typeof m=="object"&&m.id&&f.appendChild(new Option(k(m.name||m.id),m.id))}),f.children.length>0&&a.appendChild(f)}Object.keys(e).forEach(f=>{let m=document.createElement("optgroup");m.label=k(f),Array.isArray(e[f])&&e[f].forEach(g=>{if(g&&g.id){if(p.has(g.id))return;m.appendChild(new Option(k(g.name||g.id),g.id))}}),a.appendChild(m)})}else if(Array.isArray(e)){if(u.length>0){let m=document.createElement("optgroup");m.label=k(r("Recommended","gpt3-ai-content-generator")),u.forEach(g=>{g&&typeof g=="object"&&g.id&&m.appendChild(new Option(k(g.name||g.id),g.id))}),m.children.length>0&&a.appendChild(m)}let f=u.length>0?document.createElement("optgroup"):null;f&&(f.label=k(r("All models","gpt3-ai-content-generator"))),e.forEach(m=>{if(m&&m.id){if(p.has(m.id))return;let g=new Option(k(m.name||m.id),m.id);f?f.appendChild(g):a.appendChild(g)}}),f&&f.children.length>0&&a.appendChild(f)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${l}'.`),a.appendChild(new Option(k(`No models for ${s} (Format Error)`),""));if(a.options.length===0)a.appendChild(new Option(k(`No models for ${s}`),"")),a.disabled=!0;else{a.disabled=!1;let f=!1;if(i&&a.querySelector(`option[value="${CSS.escape(i)}"]`)&&(a.value=i,f=!0),!f&&a.options.length>0){let m=a.querySelector('option:not([value=""])');m&&(a.value=m.value)}}o&&(o.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),a&&a.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=n})();(function(){"use strict";function k(r){if(!r)return;let n=r.closest(".aipkit_slider_wrapper"),t=null;if(n&&(t=n.querySelector(".aipkit_slider_value")),!t){let a=r.closest(".aipkit_ai_temperature_control");a&&(t=a.querySelector(".aipkit_ai_behavior_value"))}t&&(t.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",()=>t.textContent=r.value),r.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=k})();(function(){"use strict";function k(r){if(!r)return;let n=r.closest(".aipkit_slider_wrapper"),t=n?n.querySelector(".aipkit_slider_value"):null;t&&(t.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",()=>t.textContent=r.value),r.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=k})();(function(){"use strict";function k(r){let n=r.target,t=n.closest(".aipkit_post_settings_redesigned")||n.closest(".aipkit_wizard_content_step")||document,a=t.querySelector("#aipkit_task_cw_schedule_options_wrapper"),s=t.querySelector("#aipkit_task_cw_smart_schedule_fields"),l=t.querySelector(".aipkit_task_schedule_from_input_option"),c=l?l.querySelector(".aipkit_post_schedule_radio_text"):null,o=l?l.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!a)return;let e=n.value==="publish";a.style.display=e?"block":"none";let i=document.getElementById("aipkit_automated_task_type"),d=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),u=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,p={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+u},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+u},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+u}},f={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+u},m=()=>{if(!i)return;let h=p[i.value]||f;c&&(c.textContent=h.label),o&&o.setAttribute("data-tooltip",h.tooltip)},g=i&&d.has(i.value);if(l&&(m(),l.style.display=g?"inline-flex":"none",!g)){let h=l.querySelector('input[name="schedule_mode"][value="from_input"]');if(h&&h.checked){let E=t.querySelector('input[name="schedule_mode"][value="immediate"]');E&&(E.checked=!0,E.dispatchEvent(new Event("change",{bubbles:!0})))}}i&&!i.dataset.fromInputCopyListener&&(i.addEventListener("change",()=>{m()}),i.dataset.fromInputCopyListener="true"),t.querySelectorAll('input[name="schedule_mode"]').forEach(h=>{h.dataset.listenerAttached||(h.addEventListener("change",function(){let E=i&&d.has(i.value);s&&(s.style.display=this.value==="smart"?"block":"none")}),h.dataset.listenerAttached="true")});let w=t.querySelector('input[name="schedule_mode"]:checked');w&&s&&(s.style.display=w.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||(e=>e);function r(e){if(!e)return;let i=e.querySelector(".aipkit_task_cw_vector_store_toggle"),d=e.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!i||!d.length)return;let u=i.checked;d.forEach(p=>{p.style.display=u?"block":"none"}),u&&n(e)}function n(e){if(!e)return;let i=e.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!i)return;let d=i.value,u=e.querySelector(".aipkit_task_cw_vector_openai_field"),p=e.querySelector(".aipkit_task_cw_vector_pinecone_field"),f=e.querySelector(".aipkit_task_cw_vector_qdrant_field"),m=e.querySelector(".aipkit_task_cw_vector_embedding_config_row"),g=(_,w)=>{_&&(_.style.display=w?"block":"none")};if(g(u,d==="openai"),g(p,d==="pinecone"),g(f,d==="qdrant"),m){let _=d==="pinecone"||d==="qdrant";m.style.display=_?"block":"none",_&&t(e)}}function t(e){let i=e.querySelector("#aipkit_task_cw_vector_embedding_model");if(!i)return;let d=e.querySelector("#aipkit_task_cw_vector_embedding_provider"),u=d?d.value:"openai",p=window.aipkit_automated_tasks_config||{},f=window.aipkit_automated_tasks_form_state||{},m=[];if(u==="google"?m=p.google_embedding_models||[]:u==="openrouter"?m=p.openrouter_embedding_models||[]:u==="azure"?m=p.azure_embedding_models||[]:m=p.openai_embedding_models||[],i.innerHTML="",m.length>0){i.add(new Option("-- Select Model --","")),m.forEach(_=>{i.add(new Option(k(_.name||_.id),_.id))}),i.disabled=!1;let g=f.pendingEmbeddingModelSelection;g&&Array.from(i.options).find(w=>w.value===g)&&(i.value=g,f.pendingEmbeddingModelSelection=null)}else i.add(new Option("No models found","")),i.disabled=!0}function a(e){if(!e)return;let i=e.getAttribute("aria-expanded")==="true",d=e.getAttribute("aria-controls"),u=document.getElementById(d);u&&(e.setAttribute("aria-expanded",(!i).toString()),u.setAttribute("aria-hidden",i?"true":"false"))}function s(e){if(!e)return;let i=document.getElementById(e.id+"_value");i&&(i.textContent=e.value)}function l(e){e&&(e.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(i=>{i.querySelector(".aipkit_task_cw_vector_store_toggle")&&(r(i),i.querySelectorAll(".aipkit_vector_slider").forEach(d=>{s(d)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(e))}function c(){let e=document.getElementById("aipkit_autogpt_container");!e||e.dataset.kbListenerAttached==="true"||(e.addEventListener("change",i=>{let d=i.target;if(d.matches(".aipkit_task_cw_vector_store_toggle")){let u=d.closest(".aipkit_vector_settings_redesigned");r(u)}else if(d.matches(".aipkit_task_cw_vector_store_provider_select")){let u=d.closest(".aipkit_vector_settings_redesigned");n(u)}else if(d.matches(".aipkit_task_cw_vector_embedding_provider_select")){let u=d.closest(".aipkit_vector_settings_redesigned");t(u)}}),e.addEventListener("input",i=>{let d=i.target;d.matches(".aipkit_vector_slider")&&s(d)}),e.addEventListener("click",i=>{let d=i.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!d)return;let u=d.closest(".aipkit_vector_settings_redesigned");!u||!u.querySelector(".aipkit_task_cw_vector_store_toggle")||(i.preventDefault(),a(d))}),l(e),e.dataset.kbListenerAttached="true")}function o(){let e=document.getElementById("aipkit_autogpt_container");e&&(c(),e.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(i=>{i.querySelector(".aipkit_task_cw_vector_store_toggle")&&(r(i),n(i),t(i))}))}window.aipkit_initCwKnowledgeBaseUI=c,window.aipkit_cw_task_populateEmbeddingModelSelect=t,window.aipkit_updateCwKnowledgeBaseUI=o})();(function(){"use strict";function k(){let t=document.getElementById("aipkit_automated_task_form");if(!t){console.warn("Content Writing UI Init: Could not find main form element.");return}let a=t.querySelector("#aipkit_task_cw_ai_provider"),s=t.querySelector("#aipkit_task_cw_ai_model");a&&s&&typeof window.aipkit_task_cw_populateModels=="function"&&(a.dataset.cwProviderListenerAttached||(a.addEventListener("change",()=>window.aipkit_task_cw_populateModels(a,s)),a.dataset.cwProviderListenerAttached="true"),s.dataset.cwModelListenerAttached||(s.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),s.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(a,s),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let l=t.querySelector("#aipkit_task_cw_ai_temperature");l&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(l);let c=t.querySelector("#aipkit_task_cw_post_status");c&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(c.dataset.cwStatusListenerAttached||(c.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),c.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:c})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(t),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let e=t.querySelector(".aipkit_task_cw_image_enable_toggle");e&&(e.dataset.cwImgListenerAttached||(e.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),e.dataset.cwImgListenerAttached="true"));let i=t.querySelector("#aipkit_task_cw_image_provider");i&&(i.dataset.cwImgListenerAttached||(i.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),i.dataset.cwImgListenerAttached="true"));let d=t.querySelector("#aipkit_task_cw_generate_featured_image");d&&(d.dataset.cwImgListenerAttached||(d.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),d.dataset.cwImgListenerAttached="true"));let u=t.querySelector(".aipkit_task_cw_image_placement_select");u&&(u.dataset.cwImgListenerAttached||(u.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),u.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let p=t.querySelector(".aipkit_image_settings_redesigned");p&&p.dataset.imageChunkListenerAttached!=="true"&&(p.addEventListener("click",E=>{let x=E.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!x)return;E.preventDefault();let v=x.getAttribute("aria-expanded")==="true",I=x.getAttribute("aria-controls");if(!I)return;let P=document.getElementById(I);x.setAttribute("aria-expanded",(!v).toString()),P&&P.setAttribute("aria-hidden",v?"true":"false")}),p.dataset.imageChunkListenerAttached="true");let f=async E=>{if(!E||!E.name)return;let x=E.value.trim(),v=E.dataset.apiKeyBaseline||"";if(x===v||E.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let I=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,P=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,b=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;E.dataset.apiKeySaving="true",E.dataset.apiKeyBaseline=x,I&&I("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[E.name]:x}),P&&P("Updated")}catch(y){E.dataset.apiKeyBaseline=v,b&&b(`Error: ${y.message||"Failed to save."}`)}finally{E.dataset.apiKeySaving="false"}};t.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(E=>{if(E.dataset.apiKeyListenerAttached==="true")return;E.dataset.apiKeyBaseline=E.value.trim();let x=()=>{f(E)};E.addEventListener("change",x),E.addEventListener("blur",x),E.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let g=t.querySelector("#aipkit_task_cw_ai_settings_toggle"),_=t.querySelector("#aipkit_task_cw_ai_parameters_row");g&&_&&(g.dataset.cwAiSettingsListenerAttached||(g.addEventListener("click",()=>{let E=_.style.display==="none"||_.style.display==="";_.style.display=E?"block":"none",g.classList.toggle("aipkit_active",E),g.setAttribute("aria-expanded",E)}),g.dataset.cwAiSettingsListenerAttached="true"));let w=t.querySelector("#aipkit_task_config_ai");w&&(w.dataset.cwPromptListenerAttached||(w.addEventListener("click",E=>{let x=E.target.closest(".aipkit_textarea_toggle");if(!x)return;let v=x.dataset.target,I=document.getElementById(v),P=x.querySelector(".dashicons");if(!I||!P)return;I.classList.toggle("aipkit_collapsed")?(P.classList.remove("dashicons-minus"),P.classList.add("dashicons-plus-alt2"),x.title="Expand"):(P.classList.remove("dashicons-plus-alt2"),P.classList.add("dashicons-minus"),x.title="Collapse")}),w.dataset.cwPromptListenerAttached="true"));let h=t.querySelector("#aipkit_task_config_seo");h&&(h.dataset.cwSeoPromptListenerAttached||(h.addEventListener("click",E=>{let x=E.target.closest(".aipkit_textarea_toggle");if(!x)return;let v=x.dataset.target,I=document.getElementById(v),P=x.querySelector(".dashicons");if(!I||!P)return;I.classList.toggle("aipkit_collapsed")?(P.classList.remove("dashicons-minus"),P.classList.add("dashicons-plus-alt2"),x.title="Expand"):(P.classList.remove("dashicons-plus-alt2"),P.classList.add("dashicons-minus"),x.title="Collapse")}),h.dataset.cwSeoPromptListenerAttached="true"))}function r(){let t=document.getElementById("aipkit_automated_task_form");if(!t)return;let a=window.aipkit_debug||!1,s=t.querySelector(".aipkit_task_cw_image_enable_toggle"),l=t.querySelector("#aipkit_task_cw_generate_featured_image"),c=t.querySelector(".aipkit_task_cw_image_settings_container"),o=t.querySelector("#aipkit_task_cw_image_provider");if(!s||!l||!c||!o)return;let e=s.checked,i=l.checked,d=e||i,u=o.value,p=u==="pexels"||u==="pixabay";if(c.style.display=d?"block":"none",d){let f=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=t.querySelector(".aipkit_task_cw_image_placement_select"),g=t.querySelector(".aipkit_task_cw_image_placement_x_field"),_=t.querySelector("#aipkit_task_cw_pexels_options"),w=t.querySelector("#aipkit_task_cw_pixabay_options"),h=t.querySelector("#aipkit_task_cw_replicate_options"),E=t.querySelector(".aipkit_task_cw_image_display_chunk"),x=t.querySelector("#aipkit_task_cw_image_model_group"),v=t.querySelector("#aipkit_task_cw_image_model_divider");if(f.forEach(I=>{let P=t.querySelector(I);if(P){let b=P.closest(".aipkit_form-group");b&&(b.style.display=e?"block":"none")}}),E&&(E.style.display=e?"":"none"),m&&g){let I=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(m.value);g.style.display=e&&I?"block":"none"}_&&(_.style.display=d&&p&&u==="pexels"?"block":"none"),w&&(w.style.display=d&&p&&u==="pixabay"?"block":"none"),h&&(h.style.display=d&&u==="replicate"?"block":"none"),x&&(x.style.display=d&&!p?"":"none"),v&&(v.style.display=d&&!p?"":"none"),d&&!p&&typeof n=="function"&&n(u)}}function n(t){let a=document.getElementById("aipkit_task_cw_image_model");if(!a)return;let s=a.value,c=window.aipkit_dashboard?.imageGeneratorModels?.[t.toLowerCase()]||[],o=window.aipkit_escapeHtml||function(i){return i},e=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||a.value;if(a.innerHTML="",c.length>0?(c.forEach(i=>{a.appendChild(new Option(o(i.name),i.id))}),a.querySelector(`option[value="${CSS.escape(e)}"]`)&&(a.value=e)):a.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&a.value!==s){let i=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(i)}}window.aipkit_initContentWritingTaskFormUI=k,window.aipkit_updateTaskImageSettingsUI=r,window.aipkit_populateTaskImageModels=n})();(function(){"use strict";function k(){let r=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!r)return;let n=r.querySelector("#aipkit_task_cc_ai_provider"),t=r.querySelector("#aipkit_task_cc_ai_model");n&&t&&typeof window.aipkit_task_cw_populateModels=="function"&&(n.dataset.ccProviderListenerAttached||(n.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(n,t),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),n.dataset.ccProviderListenerAttached="true"),t.dataset.ccModelListenerAttached||(t.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),t.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(n,t),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let a=r.querySelector("#aipkit_task_cc_ai_temperature");a&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(a);let s=r.querySelector("#aipkit_task_cc_content_max_tokens");s&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(s);let l=r.querySelector("#aipkit_task_cc_ai_settings_toggle"),c=r.querySelector("#aipkit_task_cc_ai_parameters_row");l&&c&&(l.dataset.ccAiSettingsListenerAttached||(l.addEventListener("click",()=>{let o=c.style.display==="none"||c.style.display==="";c.style.display=o?"block":"none",l.classList.toggle("aipkit_active",o),l.setAttribute("aria-expanded",o)}),l.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=k})();(function(){"use strict";function k(n){if(!n)return;let t=n.querySelectorAll("[data-aipkit-popover-target]");if(!t.length)return;let a=null,s=null,l=!1,c=u=>u?n.querySelector(`#${u}`):null,o=(u,p)=>{if(!u||!p)return;let f=u.getBoundingClientRect(),m=p.getBoundingClientRect(),g=m.width||400,_=m.height||0,w=window.innerWidth,h=window.innerHeight,E=12;if(u.dataset.aipkitPopoverPlacement==="bottom"){let I=f.left;I+g>w-E&&(I=f.right-g),I=Math.max(E,Math.min(I,w-g-E));let P=f.bottom+8;P+_>h-E&&(P=f.top-_-8),P=Math.max(E,Math.min(P,h-_-E)),p.style.left=`${Math.round(I)}px`,p.style.top=`${Math.round(P)}px`;return}if(u.dataset.aipkitPopoverPlacement==="left"){let I=f.left-g-10;I<E&&(I=f.right+10),I=Math.max(E,Math.min(I,w-g-E));let P=f.top;P+_>h-E&&(P=h-_-E),P=Math.max(E,P),p.style.left=`${Math.round(I)}px`,p.style.top=`${Math.round(P)}px`;return}let x=f.right+10;x+g>w-E&&(x=f.right-g-10),x=Math.max(E,Math.min(x,w-g-E));let v=f.top;v+_>h-E&&(v=h-_-E),v=Math.max(E,v),p.style.left=`${Math.round(x)}px`,p.style.top=`${Math.round(v)}px`},e=()=>{!s||!a||l||(l=!0,window.requestAnimationFrame(()=>{let u=a.querySelector(".aipkit_model_settings_popover_panel");o(s,u),l=!1}))},i=()=>{a&&(a.classList.remove("aipkit-active"),a.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-expanded","false"),a=null,s=null)},d=u=>{if(!u)return;let p=u.getAttribute("data-aipkit-popover-target"),f=c(p);if(!f)return;a&&a!==f&&i(),a=f,s=u,f.classList.add("aipkit-active"),f.setAttribute("aria-hidden","false"),u.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${p}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(n);let m=f.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{o(u,m)})};t.forEach(u=>{u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",p=>{if(p.preventDefault(),!(u.dataset.aipkitPopoverKeepOpen==="true")&&a&&s===u&&a.classList.contains("aipkit-active")){i();return}d(u)}),u.dataset.popoverListenerAttached="true")}),n.querySelectorAll(".aipkit_model_settings_popover").forEach(u=>{u.dataset.overlayListenerAttached!=="true"&&(u.addEventListener("click",f=>{f.target===u&&i()}),u.dataset.overlayListenerAttached="true");let p=u.querySelector(".aipkit_model_settings_popover_close");p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.preventDefault(),i()}),p.dataset.popoverListenerAttached="true"),u.querySelectorAll("[data-aipkit-popover-close]").forEach(f=>{f.dataset.popoverListenerAttached!=="true"&&(f.addEventListener("click",m=>{m.preventDefault(),i()}),f.dataset.popoverListenerAttached="true")})}),n.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",u=>{u.key==="Escape"&&a&&i()}),n.dataset.escapeListenerAttached="true"),n.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),n.dataset.repositionListenersAttached="true")}function r(){let n=document.getElementById("aipkit_autogpt_container");n&&k(n)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r(),window.aipkit_initAutogptPopovers=k})();(function(){"use strict";let k=o=>{if(!o)return"";let e=o.options?o.options[o.selectedIndex]:null;return e?e.textContent.trim():""},r=o=>o?Array.from(o.selectedOptions||[]).map(e=>e.textContent.trim()).filter(Boolean):[],n=(o,e)=>{let i=o.filter(Boolean);return i.length?i.join(", "):e||""},t=(o,e)=>{if(!o)return;o.textContent=e,o.title=e;let i=o.dataset.aipkitPlaceholder||"",d="active";i&&e===i&&(d="placeholder"),o.dataset.aipkitSummaryState=d},a=(o,e)=>{if(!o)return;let i=e||document,d=o.dataset.aipkitAutogptSummary||"",u=o.dataset.aipkitAutogptProvider||"",p=o.dataset.aipkitAutogptModel||"",f=p?i.querySelector(p):null,m=k(f),g=o.dataset.aipkitPlaceholder||"Select";if(d==="images"){let _=o.dataset.aipkitDisabledLabel||g,w=o.dataset.aipkitAutogptToggle||"",h=o.dataset.aipkitAutogptFeaturedToggle||"",E=w?i.querySelector(w):null,x=h?i.querySelector(h):null;if(!(E&&E.checked||x&&x.checked)){t(o,_);return}let I=u?i.querySelector(u):null,P=I?I.value:"",b=k(I);if(["pexels","pixabay"].includes(P)){t(o,b||g);return}t(o,m||b||g);return}if(d==="vector"){let _=o.dataset.aipkitDisabledLabel||g,w=o.dataset.aipkitAutogptToggle||"",h=w?i.querySelector(w):null;if(!(h?h.checked:!0)){t(o,_);return}let x=u?i.querySelector(u):null,v=x?x.value:"",I=k(x),P=o.dataset.aipkitAutogptStore||"",b=o.dataset.aipkitAutogptOpenaiStore||"",y=o.dataset.aipkitAutogptPineconeStore||"",S=o.dataset.aipkitAutogptQdrantStore||"",C="";if(v==="openai"&&b){let A=i.querySelector(b);C=r(A).join(", ")}else v==="pinecone"&&y?C=k(i.querySelector(y)):v==="qdrant"&&S?C=k(i.querySelector(S)):P&&(C=k(i.querySelector(P)));t(o,n([C,I],g));return}t(o,m||g)},s=(o,e)=>{if(!o||o.dataset.aipkitAutogptSummaryBound==="true")return;let i=e||document,d=o.dataset.aipkitAutogptProvider||"",u=o.dataset.aipkitAutogptModel||"",p=o.dataset.aipkitAutogptToggle||"",f=o.dataset.aipkitAutogptFeaturedToggle||"",m=[o.dataset.aipkitAutogptStore||"",o.dataset.aipkitAutogptOpenaiStore||"",o.dataset.aipkitAutogptPineconeStore||"",o.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),g=d?i.querySelector(d):null,_=u?i.querySelector(u):null,w=p?i.querySelector(p):null,h=f?i.querySelector(f):null,E=()=>a(o,i);g&&g.addEventListener("change",E),_&&_.addEventListener("change",E),w&&w.addEventListener("change",E),h&&h.addEventListener("change",E),m.forEach(x=>{let v=i.querySelector(x);v&&v.addEventListener("change",E)}),o.dataset.aipkitAutogptSummaryBound="true",a(o,i)};function l(o){let e=o||document.getElementById("aipkit_autogpt_container");if(!e)return;e.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(d=>{s(d,e),a(d,e)})}function c(){let o=document.getElementById("aipkit_autogpt_container");o&&l(o)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_updateAutogptAiSummaries=l})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},r={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},n=i=>String(i??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),t=()=>{let i=document.getElementById("aipkit_automated_task_type"),d=i?i.value:"";return d==="content_writing"?"bulk":d&&d.startsWith("content_writing_")&&d.replace("content_writing_","")||"bulk"},a=(i,d)=>{let u=k[i]||[],p=r[d]||[],f=[...u,...p];return f.filter((m,g)=>f.indexOf(m)===g)},s=(i,d)=>{if(!i)return;let u=i.dataset.label||"Variables:",p=i.dataset.copyTitle||"Click to copy";i.innerHTML=`${n(u)} `,d.forEach((f,m)=>{let g=document.createElement("code");g.className="aipkit-placeholder",g.title=p,g.textContent=f,i.appendChild(g),m<d.length-1&&i.appendChild(document.createTextNode(" "))})},l=i=>{let d=i||document.getElementById("aipkit_autogpt_container");if(!d)return;let u=t(),p=d.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");p.length&&p.forEach(f=>{let m=f.dataset.promptType||"",g=a(m,u);g.length&&s(f,g)})};function c(i){let d=i.querySelectorAll(".aipkit_cw_prompt_library_select");d.length&&d.forEach(u=>{u.dataset.promptLibraryAttached!=="true"&&(u.addEventListener("change",()=>{let p=u.getAttribute("data-aipkit-prompt-target");if(!p||!u.value)return;let f=i.querySelector(`#${p}`);f&&(f.value=u.value,f.dispatchEvent(new Event("input",{bubbles:!0})))}),u.dataset.promptLibraryAttached="true")})}function o(i){if(!i)return;let d=i.querySelectorAll("[data-aipkit-flyout-target]");if(!d.length)return;let u=null,p=null,f=!1,m=E=>E?i.querySelector(`#${E}`):null,g=(E,x,v)=>{if(!E||!x||!u)return;let I=E.getBoundingClientRect(),P=v?v.getBoundingClientRect():I,b=x.getBoundingClientRect(),y=b.width||580,S=b.height||420,C=window.innerWidth,A=window.innerHeight,M=12,$=P.left-y-10;$<M&&($=P.right+10),$=Math.max(M,Math.min($,C-y-M));let W=P.top;W+S>A-M&&(W=A-S-M),W=Math.max(M,W),u.style.left=`${Math.round($)}px`,u.style.top=`${Math.round(W)}px`},_=()=>{!u||!p||f||(f=!0,window.requestAnimationFrame(()=>{let E=u.querySelector(".aipkit_cw_prompt_panel"),x=p.closest(".aipkit_model_settings_popover_panel");g(p,E,x),f=!1}))},w=()=>{u&&(u.classList.remove("is-open"),u.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),u=null,p=null)},h=E=>{let x=E.getAttribute("data-aipkit-flyout-target"),v=m(x);v&&(u&&u!==v&&w(),u=v,p=E,v.classList.add("is-open"),v.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true"),l(v),window.requestAnimationFrame(()=>{let I=v.querySelector(".aipkit_cw_prompt_panel"),P=E.closest(".aipkit_model_settings_popover_panel");g(E,I,P)}))};d.forEach(E=>{E.dataset.promptFlyoutListenerAttached!=="true"&&(E.addEventListener("click",x=>{if(x.preventDefault(),u&&p===E&&u.classList.contains("is-open")){w();return}h(E)}),E.dataset.promptFlyoutListenerAttached="true")}),i.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(E=>{E.dataset.overlayListenerAttached!=="true"&&(E.addEventListener("click",x=>{x.target===E&&w()}),E.dataset.overlayListenerAttached="true")}),i.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",E=>{E.key==="Escape"&&u&&w()}),i.dataset.promptFlyoutEscapeAttached="true"),i.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",E=>{if(!u)return;let x=E.target;x.closest(".aipkit_cw_prompt_flyout")||x.closest("[data-aipkit-flyout-target]")||w()}),i.dataset.promptFlyoutClickAttached="true"),i.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),i.dataset.promptFlyoutRepositionAttached="true")}function e(i){let d=i||document.getElementById("aipkit_autogpt_container");d&&(c(d),o(d),l(d))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>e()):e(),window.aipkit_initAutogptPromptFlyouts=e,window.aipkit_updateAutogptPromptPlaceholders=()=>{l()}})();(function(){"use strict";function k(){let c=document.querySelector("#aipkit_task_cw_ai_provider"),o=document.querySelector("#aipkit_task_cw_ai_model"),e=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),i=e?e.closest(".aipkit_ai_settings_redesigned"):null;if(!c||!o||!e){e&&(e.style.display="none");return}let d=(c.value||"").toLowerCase(),p=(o.value||"").toLowerCase();d==="openai"&&n(p)?(e.style.display="block",i&&r(i,p)):e.style.display="none"}function r(c,o){let e=c.querySelector("[data-aipkit-reasoning-select]"),i=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!e||!i.length)return;let d=a(o),u=new Set(d.allowed);i.forEach(g=>{let _=g.querySelector(".aipkit_ai_reasoning_input");if(!_)return;let w=_.value==="minimal"?"low":_.value,h=u.has(w);g.style.display=h?"":"none",h||(_.checked=!1)});let p=e.value||"";p==="minimal"&&(p="low"),u.has(p)||(p=d.defaultValue),u.has(p)||(p=d.allowed[0]||"");let f=e.value;p&&(e.value=p);let m=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(m){m.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>_.classList.remove("aipkit_ai_reasoning_option--selected"));let g=m.closest(".aipkit_ai_reasoning_option");g&&g.classList.add("aipkit_ai_reasoning_option--selected")}f!==e.value&&e.dispatchEvent(new Event("change",{bubbles:!0}))}function n(c){if(t(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return o||e}function t(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_autogpt_cw_toggleReasoningEffort=k})();(function(){"use strict";function k(){let c=document.querySelector("#aipkit_task_cc_ai_provider"),o=document.querySelector("#aipkit_task_cc_ai_model"),e=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),i=e?e.closest(".aipkit_ai_settings_redesigned"):null;if(!c||!o||!e){e&&(e.style.display="none");return}let d=(c.value||"").toLowerCase(),p=(o.value||"").toLowerCase();d==="openai"&&n(p)?(e.style.display="block",i&&r(i,p)):e.style.display="none"}function r(c,o){let e=c.querySelector("[data-aipkit-reasoning-select]"),i=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!e||!i.length)return;let d=a(o),u=new Set(d.allowed);i.forEach(g=>{let _=g.querySelector(".aipkit_ai_reasoning_input");if(!_)return;let w=_.value==="minimal"?"low":_.value,h=u.has(w);g.style.display=h?"":"none",h||(_.checked=!1)});let p=e.value||"";p==="minimal"&&(p="low"),u.has(p)||(p=d.defaultValue),u.has(p)||(p=d.allowed[0]||"");let f=e.value;p&&(e.value=p);let m=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(m){m.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>_.classList.remove("aipkit_ai_reasoning_option--selected"));let g=m.closest(".aipkit_ai_reasoning_option");g&&g.classList.add("aipkit_ai_reasoning_option--selected")}f!==e.value&&e.dispatchEvent(new Event("change",{bubbles:!0}))}function n(c){if(t(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return o||e}function t(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_autogpt_cc_toggleReasoningEffort=k})();(function(){"use strict";function k(r,n){let t=document.getElementById("aipkit_save_task_btn"),a=t?t.querySelector(".aipkit_btn-text"):null,s=r.elements.task_id,l=r.elements.task_name,c=r.elements.task_type,o=r.elements.task_status,e=document.getElementById("aipkit_cancel_edit_task_btn"),d=(window.aipkit_automated_tasks_config||{}).text||{},u=document.getElementById("aipkit_autogpt_header_title_default"),p=document.getElementById("aipkit_autogpt_header_title_editor"),f=document.getElementById("aipkit_autogpt_title_display"),m=document.getElementById("aipkit_autogpt_title_text"),g=document.getElementById("aipkit_autogpt_task_title_input"),_=m&&m.dataset.defaultLabel||g&&g.placeholder||"New Task",w=()=>{let v=(g?g.value.trim():"")||_;m&&(m.textContent=v),f&&f.setAttribute("title",v),l&&(l.value=v)},h=()=>{!f||!g||(f.style.display="none",g.style.display="inline-block",g.focus(),g.select())},E=()=>{!f||!g||(g.style.display="none",f.style.display="inline-flex",w())};u&&(u.style.display="none"),p&&(p.style.display="flex"),p&&p.dataset.inlineTitleBound!=="true"&&f&&g&&(f.addEventListener("click",h),g.addEventListener("blur",E),g.addEventListener("keydown",x=>{x.key==="Enter"&&(x.preventDefault(),g.blur())}),g.addEventListener("input",w),p.dataset.inlineTitleBound="true"),n?(a&&(a.textContent=d.save_task_button||"Save Task"),s&&(s.value=n.id||""),g&&(g.value=n.task_name||_),w(),c&&(c.value=n.task_type||"content_indexing"),o&&(o.value=n.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),e&&(e.style.display="inline-flex")):(a&&(a.textContent=d.save_task_button||"Save Task"),s&&(s.value=""),g&&(g.value=_),w(),c&&(c.value="content_indexing"),o&&(o.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),e&&(e.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};function r(n){let t=document.getElementById("aipkit_automated_task_form");if(!t)return;let a=t.elements["post_types[]"];a&&(Array.from(a.options).forEach(l=>l.selected=!1),(n.post_types||[]).forEach(l=>{let c=a.querySelector(`option[value="${k(l)}"]`);c&&(c.selected=!0)}));let s=t.elements.target_store_provider;s&&(s.value=n.target_store_provider||"openai",s.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(n.target_store_provider||"openai").then(()=>{let l=t.elements.target_store_id;l&&(l.value=n.target_store_id||"")}),t.elements.index_existing_now_flag&&(t.elements.index_existing_now_flag.checked=n.index_existing_now_flag==="1"),t.elements.only_new_updated_flag&&(t.elements.only_new_updated_flag.checked=n.only_new_updated_flag==="1"),(n.target_store_provider==="pinecone"||n.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&n.embedding_provider&&n.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${n.embedding_provider}:${n.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),t.elements.task_frequency&&(t.elements.task_frequency.value=n.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};function r(n){let t=document.getElementById("aipkit_automated_task_form");if(!t)return;let a=n.cw_generation_mode||"bulk";if(a==="bulk"||a==="single"||a==="task"){let x=t.elements.content_title_bulk;x&&(x.value=n.content_title||"")}else if(a==="csv"){let x=t.elements.content_title;x&&(x.value=n.content_title||"")}else if(a==="rss"){t.elements.rss_feeds&&(t.elements.rss_feeds.value=n.rss_feeds||""),t.elements.rss_include_keywords&&(t.elements.rss_include_keywords.value=n.rss_include_keywords||""),t.elements.rss_exclude_keywords&&(t.elements.rss_exclude_keywords.value=n.rss_exclude_keywords||"");let x=t.elements.rss_feeds;x&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),x.dispatchEvent(new Event("input",{bubbles:!0})))}else if(a==="url")t.elements.url_list&&(t.elements.url_list.value=n.url_list||"");else if(a==="gsheets"){let x=t.elements.gsheets_credentials;if(x){let v=n.gsheets_credentials,I=x.closest(".aipkit_gsheets_section_container");typeof v=="object"&&v!==null?x.value=JSON.stringify(v,null,2):x.value=v||"",x.value?(x.dataset.filename="credentials.json",I&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(I),100)):(delete x.dataset.filename,I&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(I,"clear"))}t.elements.gsheets_sheet_id&&(t.elements.gsheets_sheet_id.value=n.gsheets_sheet_id||"")}t.elements.custom_title_prompt&&(t.elements.custom_title_prompt.value=n.custom_title_prompt||""),t.elements.custom_content_prompt&&(t.elements.custom_content_prompt.value=n.custom_content_prompt||"");let s=document.getElementById("aipkit_task_cw_ai_provider"),l=document.getElementById("aipkit_task_cw_ai_model");s&&(s.value=n.ai_provider?n.ai_provider.toLowerCase():"openai",n.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=n.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&l&&window.aipkit_task_cw_populateModels(s,l));let c=document.getElementById("aipkit_task_cw_ai_temperature");if(c){c.value=n.ai_temperature||"1.0";let x=document.getElementById("aipkit_task_cw_ai_temperature_value");x&&(x.textContent=c.value)}let o=document.getElementById("aipkit_task_cw_content_length");o&&(o.value=n.content_length||"medium",o.dispatchEvent(new Event("change",{bubbles:!0})));let e=t.elements.reasoning_effort;if(e){let x=n.reasoning_effort||"";x&&(e.value=x==="minimal"?"low":x,e.dispatchEvent(new Event("change",{bubbles:!0})))}l&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>l.dispatchEvent(new Event("change",{bubbles:!0})),100),t.elements.generate_meta_description&&(t.elements.generate_meta_description.checked=n.generate_meta_description==="1"),t.elements.custom_meta_prompt&&(t.elements.custom_meta_prompt.value=n.custom_meta_prompt||""),t.elements.generate_focus_keyword&&(t.elements.generate_focus_keyword.checked=n.generate_focus_keyword==="1"),t.elements.custom_keyword_prompt&&(t.elements.custom_keyword_prompt.value=n.custom_keyword_prompt||""),t.elements.generate_excerpt&&(t.elements.generate_excerpt.checked=n.generate_excerpt==="1"),t.elements.custom_excerpt_prompt&&(t.elements.custom_excerpt_prompt.value=n.custom_excerpt_prompt||""),t.elements.generate_tags&&(t.elements.generate_tags.checked=n.generate_tags==="1"),t.elements.custom_tags_prompt&&(t.elements.custom_tags_prompt.value=n.custom_tags_prompt||""),t.elements.generate_toc&&(t.elements.generate_toc.checked=n.generate_toc==="1"),t.elements.generate_seo_slug&&(t.elements.generate_seo_slug.checked=n.generate_seo_slug==="1"),t.elements.post_type&&(t.elements.post_type.value=n.post_type||"post");let i=t.elements.post_author;i&&(i.value=n.post_author||window.aipkit_dashboard?.currentUserId||"1");let d=document.getElementById("aipkit_task_cw_post_status");d&&(d.value=n.post_status||"draft");let u=n.schedule_mode||"immediate",p=t.querySelector(`input[name="schedule_mode"][value="${u}"]`);p&&(p.checked=!0),t.elements.smart_schedule_start_datetime&&(t.elements.smart_schedule_start_datetime.value=n.smart_schedule_start_datetime||""),t.elements.smart_schedule_interval_value&&(t.elements.smart_schedule_interval_value.value=n.smart_schedule_interval_value||"1"),t.elements.smart_schedule_interval_unit&&(t.elements.smart_schedule_interval_unit.value=n.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:d});let f=document.getElementById("aipkit_task_cw_post_categories");f&&f.options&&(Array.from(f.options).forEach(v=>v.selected=!1),(Array.isArray(n.post_categories)?n.post_categories.map(String):[]).forEach(v=>{let I=f.querySelector(`option[value="${k(v)}"]`);I&&(I.selected=!0)}),f.dispatchEvent(new Event("change",{bubbles:!0}))),t.elements.generate_images_enabled&&(t.elements.generate_images_enabled.checked=n.generate_images_enabled==="1"),t.elements.image_provider&&(t.elements.image_provider.value=(n.image_provider||"openai").toLowerCase()),t.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=n.image_model),t.elements.image_prompt&&(t.elements.image_prompt.value=n.image_prompt||""),t.elements.image_count&&(t.elements.image_count.value=n.image_count||"1"),t.elements.image_placement&&(t.elements.image_placement.value=n.image_placement||"after_first_h2"),t.elements.image_placement_param_x&&(t.elements.image_placement_param_x.value=n.image_placement_param_x||"2"),t.elements.image_size&&(t.elements.image_size.value=n.image_size||"large"),t.elements.image_alignment&&(t.elements.image_alignment.value=n.image_alignment||"none"),t.elements.generate_featured_image&&(t.elements.generate_featured_image.checked=n.generate_featured_image==="1"),t.elements.featured_image_prompt&&(t.elements.featured_image_prompt.value=n.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=t.querySelector('input[name="enable_vector_store"]');m&&(m.checked=n.enable_vector_store==="1",m.dispatchEvent(new Event("change",{bubbles:!0})));let g=t.querySelector("#aipkit_task_cw_vector_store_provider");g&&(g.value=n.vector_store_provider||"openai",g.dispatchEvent(new Event("change",{bubbles:!0})));let _=t.querySelector("#aipkit_task_cw_vector_store_top_k");if(_){_.value=n.vector_store_top_k||"3";let x=t.querySelector("#aipkit_task_cw_vector_store_top_k_value");x&&(x.textContent=_.value)}let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let x=Array.isArray(n.openai_vector_store_ids)?n.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(v=>{v.selected=x.includes(v.value)}),w.dispatchEvent(new Event("change",{bubbles:!0}))}let h=document.getElementById("aipkit_task_cw_pinecone_index_name");h&&(h.value=n.pinecone_index_name||"");let E=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(E&&(E.value=n.qdrant_collection_name||""),n.vector_store_provider==="pinecone"||n.vector_store_provider==="qdrant"){let x=document.getElementById("aipkit_task_cw_vector_embedding_provider");x&&(x.value=n.vector_embedding_provider||"openai",x.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),n.vector_store_provider&&(n.vector_store_provider==="pinecone"||n.vector_store_provider==="qdrant")&&n.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=n.vector_embedding_model);let x=t.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||t;x&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(x)},150),t.elements.task_frequency&&(t.elements.task_frequency.value=n.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=r})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let t=document.getElementById("aipkit_task_cc_ai_provider"),a=document.getElementById("aipkit_task_cc_ai_model");t&&a&&(t.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&r.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(t,a));let s=document.getElementById("aipkit_task_cc_ai_temperature");if(s){s.value=r.ai_temperature||1;let f=document.getElementById(s.id+"_value");f&&(f.textContent=s.value)}let l=document.getElementById("aipkit_task_cc_content_max_tokens");if(l){l.value=r.content_max_tokens||4e3;let f=document.getElementById(l.id+"_value");f&&(f.textContent=l.value),l.dispatchEvent(new Event("change",{bubbles:!0}))}let c=n.elements.cc_reasoning_effort;if(c){let f=r.reasoning_effort||"";f&&(c.value=f==="minimal"?"low":f,c.dispatchEvent(new Event("change",{bubbles:!0})))}a&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>a.dispatchEvent(new Event("change",{bubbles:!0})),100);let o=document.getElementById("aipkit_task_cc_custom_content_prompt");o&&(o.value=r.custom_content_prompt||"");let e=document.getElementById("aipkit_task_comment_reply_include_keywords");e&&(e.value=r.include_keywords||"");let i=document.getElementById("aipkit_task_comment_reply_exclude_keywords");i&&(i.value=r.exclude_keywords||"");let d=n.elements["post_types_for_comments[]"];d&&(Array.from(d.options).forEach(f=>f.selected=!1),(r.post_types_for_comments||[]).forEach(f=>{let m=d.querySelector(`option[value="${f}"]`);m&&(m.selected=!0)}));let u=n.elements.reply_action;u&&(u.value=r.reply_action||"approve");let p=n.elements.no_reply_to_replies;p&&(p.checked=r.no_reply_to_replies==="1"),n.elements.task_frequency&&(n.elements.task_frequency.value=r.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_automated_task_form"),n=window.aipkit_automated_tasks_config||{},t=window.aipkit_dashboard||{},a=n.default_cw_prompts||{};if(!r)return;r.elements.custom_title_prompt&&(r.elements.custom_title_prompt.value=a.title||""),r.elements.custom_content_prompt&&(r.elements.custom_content_prompt.value=a.content||""),r.elements.custom_meta_prompt&&(r.elements.custom_meta_prompt.value=a.meta||""),r.elements.custom_keyword_prompt&&(r.elements.custom_keyword_prompt.value=a.keyword||""),r.elements.image_prompt&&(r.elements.image_prompt.value=a.image||""),r.elements.featured_image_prompt&&(r.elements.featured_image_prompt.value=a.featured_image||"");let s=document.getElementById("aipkit_task_cw_ai_provider"),l=document.getElementById("aipkit_task_cw_ai_model");if(s&&l){let o=(t.main_provider||"openai").toLowerCase();if(s.value=o,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(s,l);let e="",i=t?.models?.[o];switch(o){case"openai":e="gpt-4.1-mini";break;case"google":e="gemini-1.5-flash-latest";break;case"openrouter":e="moonshotai/kimi-k2.5";break;case"claude":e="claude-opus-4-6",Array.isArray(i)&&i.length>0&&(i.some(u=>u&&u.id==="claude-opus-4-6")||(e=i[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(i)&&i.length>0&&(e=i[0].id||"");break}l.querySelector(`option[value="${CSS.escape(e)}"]`)?l.value=e:console.warn(`Default model ${e} not found for provider ${o}.`)}}let c=document.getElementById("aipkit_task_cw_content_length");c&&(c.value="medium",c.dispatchEvent(new Event("change",{bubbles:!0}))),r.elements.generate_images_enabled&&(r.elements.generate_images_enabled.checked=!1),r.elements.image_provider&&(r.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{r.elements.image_model&&(r.elements.image_model.value="gpt-image-1")},0)),r.elements.image_count&&(r.elements.image_count.value="1"),r.elements.image_placement&&(r.elements.image_placement.value="after_first_h2"),r.elements.generate_featured_image&&(r.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_automated_task_form"),n=window.aipkit_dashboard||{};if(!r)return;let t=document.getElementById("aipkit_task_cc_custom_content_prompt");t&&(t.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let a=document.getElementById("aipkit_task_cc_ai_provider"),s=document.getElementById("aipkit_task_cc_ai_model");if(a&&s){let c=(n.main_provider||"openai").toLowerCase();if(a.value=c,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(a,s);let o="",e=(n.models||{})[c]||{};switch(c){case"openai":o="gpt-4o-mini";break;case"google":o="gemini-1.5-flash-latest";break;case"openrouter":o="moonshotai/kimi-k2.5";break;case"claude":o="claude-opus-4-6",Array.isArray(e)&&e.length>0&&(e.some(d=>d&&d.id==="claude-opus-4-6")||(o=e[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(e)&&e.length>0&&(o=e[0].id||"");break}s.querySelector(`option[value="${CSS.escape(o)}"]`)&&(s.value=o)}}let l=document.getElementById("aipkit_task_cc_content_max_tokens");l&&(l.value="4000",l.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=k})();(function(){"use strict";function k(r,n,t,a=null){let s=document.getElementById("aipkit_automated_task_form"),l=document.getElementById("aipkit_automated_task_queue_wrapper");if(!s){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),s.reset(),s.elements.task_id&&(s.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),a){let d=((window.aipkit_automated_tasks_config||{}).task_types||{})[a.task_type];if(d){let u=s.elements.task_category;if(u){u.value=d.category;let p=new Event("change",{bubbles:!0});u.dispatchEvent(p)}}}else{let i=s.elements.task_category,d=s.elements.task_type;i&&d&&(i.value="content_creation",i.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{d.value="content_writing_bulk",d.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(s,a):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let c=s.elements.task_type;if(c&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:c}),a){let i=JSON.parse(a.task_config||"{}");a.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(i):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):a.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(i):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):a.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(i):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):a.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(i):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}r&&(r.style.display="block"),n&&(n.style.display="none"),l&&(l.style.display="none"),t&&(t.style.display="none");let o=document.getElementById("aipkit_autogpt_editor_actions");o&&(o.style.display="flex");let e=document.getElementById("aipkit_autogpt_cron_info");e&&(e.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers()}window.aipkit_form_showAutomatedTaskForm=k})();(function(){"use strict";function k(r,n,t){let a=document.getElementById("aipkit_automated_task_queue_wrapper");r&&(r.style.display="none"),n&&(n.style.display="block"),a&&(a.style.display="block"),t&&(t.style.display="inline-flex");let s=document.getElementById("aipkit_autogpt_editor_actions");s&&(s.style.display="none");let l=document.getElementById("aipkit_autogpt_cron_info");l&&(l.style.display="inline-flex");let c=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_id"),e=document.getElementById("aipkit_automated_task_category"),i=document.getElementById("aipkit_autogpt_header_title_default"),d=document.getElementById("aipkit_autogpt_header_title_editor"),u=document.getElementById("aipkit_autogpt_title_display"),p=document.getElementById("aipkit_autogpt_task_title_input");c&&c.reset(),o&&(o.value=""),i&&(i.style.display="block"),d&&(d.style.display="none"),u&&(u.style.display="inline-flex"),p&&(p.style.display="none"),e&&(e.value="",e.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=k})();(function(){"use strict";let k=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function r(s,l,c,o){if(!s||!l)return;s.innerHTML="";let e={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};c.forEach(([i,d])=>{let u=document.createElement("label");u.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",u.classList.toggle("is-active",i===o);let p=document.createElement("input");p.type="radio",p.name="aipkit_task_type_radio",p.value=i,p.checked=i===o,p.disabled=!!d.disabled,p.className="aipkit_task_type_input",p.addEventListener("change",()=>{p.checked&&(l.value=i,l.dispatchEvent(new Event("change",{bubbles:!0})),s.querySelectorAll(".aipkit_cw_mode_card").forEach(w=>w.classList.remove("is-active")),u.classList.add("is-active"))});let f=e[i]||{},m=document.createElement("span");m.className="aipkit_cw_mode_icon",m.innerHTML=`<span class="dashicons ${f.icon||"dashicons-admin-generic"}"></span>`;let g=document.createElement("span");g.className="aipkit_cw_mode_text";let _=document.createElement("span");_.className="aipkit_cw_mode_title",_.textContent=d.label,g.appendChild(_),d.disabled&&(u.classList.add("is-disabled"),u.setAttribute("aria-disabled","true")),u.appendChild(p),u.appendChild(m),u.appendChild(g),s.appendChild(u)})}function n(s,l){s&&s.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(c=>{let o=c.value===l;c.checked=o;let e=c.closest(".aipkit_cw_mode_card");e&&e.classList.toggle("is-active",o)})}function t(s){let l=s.target.value,c=document.querySelector(".aipkit_autogpt_form_right"),o=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(c){let h=!o&&l==="content_enhancement";c.style.display=h?"none":""}let e=document.getElementById("aipkit_automated_task_type"),i=document.getElementById("aipkit_automated_task_type_group"),d=document.getElementById("aipkit_automated_task_type_radios"),u=(window.aipkit_automated_tasks_config||{}).task_types||{},p=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),f=p.lastTaskTypeByCategory||{};p.lastTaskTypeByCategory=f;let m=window.aipkit_escapeHtml||function(h){return h};e.innerHTML="",e.disabled=!0,i&&(i.style.display="none"),d&&(d.innerHTML="");let g=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(g&&g.querySelectorAll(".aipkit_task_config_section").forEach(h=>{h.id==="aipkit_task_cw_input_modes_wrapper"&&h.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(E=>{E.style.display="none"}),h.style.display="none"}),!l){e.appendChild(new Option(m("-- Select a category first --"),"")),e.dispatchEvent(new Event("change",{bubbles:!0}));return}let _=Object.entries(u).filter(([h,E])=>E.category===l);if(_.length===0)e.appendChild(new Option(m("-- No tasks in this category --"),""));else if(_.length===1){let[h,E]=_[0],x=new Option(m(E.label),h);E.disabled&&(x.disabled=!0),e.appendChild(x),e.value=h,e.disabled=!0,i&&(i.style.display="none")}else e.appendChild(new Option(m("-- Select a Task Type --"),"")),_.forEach(([h,E])=>{let x=new Option(m(E.label),h);E.disabled&&(x.disabled=!0),e.appendChild(x)}),e.disabled=!1;if(_.length>1){let h=f[l];!h&&l==="content_creation"&&(h="content_writing_bulk"),!h&&_.length>0&&e.options.length&&(h=_[0][0]),h&&(e.value=h)}let w=!!d&&_.length>1&&l==="content_creation";i&&(i.style.display=w?"":"none"),d&&(w?r(d,e,_,e.value):d.innerHTML=""),e.dispatchEvent(new Event("change",{bubbles:!0}))}function a(s){let l=s.target.value,c=document.getElementById("aipkit_automated_task_type_radios");n(c,l);let o=document.getElementById("aipkit_automated_task_id"),e=!o||!o.value,i=document.getElementById("aipkit_wizard_next_btn"),d=i?i.querySelector(".aipkit_btn-text"):null,u=document.getElementById("aipkit_save_task_btn"),p=u?u.querySelector(".aipkit_btn-text"):null,f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,g=((window.aipkit_automated_tasks_config||{}).task_types||{})[l],_=g&&g.pro===!0,w=(window.aipkit_automated_tasks_config||{}).text||{};if(g){let S=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),C=S.lastTaskTypeByCategory||{};C[g.category]=l,S.lastTaskTypeByCategory=C}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(l):console.error("Task Type Change: aipkit_renderWizard function is missing.");let h=document.querySelector(".aipkit_task_schedule_frequency"),E=document.getElementById("aipkit_automated_task_frequency");if(h&&E){let S=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});l==="content_writing_bulk"||l==="content_writing_csv"?(!S.lastVisibleFrequency&&E.value&&(S.lastVisibleFrequency=E.value),E.value="one-time",h.style.display="none"):(h.style.display="",S.lastVisibleFrequency&&E.value==="one-time"&&(E.value=S.lastVisibleFrequency),S.lastVisibleFrequency=E.value)}let x=document.querySelectorAll("[data-aipkit-task-publishing]");if(x.length){let S=l&&l.startsWith("content_writing");x.forEach(C=>{C.style.display=S?"":"none"})}_&&!f?(d&&i&&(i.dataset.action="next",d.textContent=w.wizard_next_button||"Next",i.style.display="none"),p&&u&&(u.dataset.action="save",p.textContent=w.save_task_button||"Save Task",u.style.display="none")):(d&&i&&(i.dataset.action="next",d.textContent=w.wizard_next_button||"Next",i.style.display=""),p&&u&&(u.dataset.action="save",p.textContent=w.save_task_button||"Save Task",u.style.display=""));let v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!v){console.error("Task Type Change: Could not find setup pane.");return}let I=v.querySelector("#aipkit_task_ci_source_wrapper"),P=v.querySelector("#aipkit_task_cw_input_modes_wrapper"),b=v.querySelector("#aipkit_task_cc_source_wrapper"),y=v.querySelector("#aipkit_task_ce_content_selection_wrapper");if(I&&(I.style.display="none"),P&&(P.style.display="none"),b&&(b.style.display="none"),y&&(y.style.display="none"),!!l){if(l==="content_indexing")I&&(I.style.display="block");else if(l.startsWith("content_writing")){if(k(),P){P.style.display="block";let S=l.replace("content_writing_",""),C=S==="content_writing"?"bulk":S,A=document.getElementById("aipkit_task_cw_generation_mode");A&&(A.value=C),P.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(M=>{M.id===`aipkit_task_cw_input_mode_${C}`?M.style.display="block":M.style.display="none"})}}else if(l==="community_reply_comments")b&&(b.style.display="block");else if(l==="enhance_existing_content"){y&&(y.style.display="block");let S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),C=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(S&&C){let A=S.querySelector("#aipkit_task_ce_post_types");if(A&&!A.dataset.placeholderListenerAttached){let M=()=>{let W=Array.from(A.selectedOptions).map(N=>N.value).includes("product");C.querySelectorAll(".aipkit-product-placeholders").forEach(N=>{N.style.display=W?"inline":"none"})};A.addEventListener("change",M),A.dataset.placeholderListenerAttached="true",M()}}}e&&(l.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():l==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():l==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),l==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():l.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():l==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():l==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=t,window.aipkit_form_handleTaskTypeChange=a})();(function(){"use strict";function k(r,n="info"){let t=document.getElementById("aipkit_automated_task_form_status");if(!t)return;let a=t.classList.contains("aipkit_training_status");if(!r){t.textContent="",a?t.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):t.className="aipkit_form-help";return}if(t.textContent=r,a){let s=n==="info"?"loading":n;t.classList.remove("is-success","is-error","is-warning","is-loading"),t.classList.add("is-visible"),s&&t.classList.add(`is-${s}`)}else t.className=`aipkit_form-help aipkit_settings_message-${n}`;setTimeout(()=>{t.textContent===r&&(t.textContent="",a?t.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):t.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=k})();(function(){"use strict";function k(r){let n=new FormData(r),t=Object.fromEntries(n.entries());return t.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:n,data:t}}window.aipkit_save_task_extractBaseData=k})();(function(){"use strict";function k(r,n){if(r.task_type==="content_indexing"){if(r.post_types=n.getAll("post_types[]"),r.target_store_provider=n.get("target_store_provider")||"openai",r.target_store_id=n.get("target_store_id")||"",r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant"){let a=n.get("embedding_model")||"";if(a&&a.includes(":")){let[s,l]=a.split(":",2);r.embedding_provider=s,r.embedding_model=l}else r.embedding_provider="",r.embedding_model=a}else delete r.embedding_provider,delete r.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(a=>delete r[a])}else delete r.post_types,delete r["post_types[]"],delete r.target_store_provider,delete r.target_store_id,delete r.index_existing_now_flag,delete r.only_new_updated_flag,delete r.embedding_model,delete r.embedding_provider;return r}window.aipkit_save_task_handleContentIndexing=k})();(function(){"use strict";function k(r,n){return r.task_type.startsWith("content_writing")?(r.post_categories=n.getAll("post_categories[]"),r.openai_vector_store_ids=n.getAll("openai_vector_store_ids[]"),delete r["post_categories[]"],delete r["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(a=>delete r[a]),delete r.replicate_api_key,delete r.pexels_api_key,delete r.pixabay_api_key):(delete r.content_title,delete r.content_title_bulk,delete r.content_keywords,delete r.content_length,delete r.ai_temperature,delete r.post_type,delete r.post_author,delete r.post_status,delete r["post_categories[]"],delete r.post_categories,delete r.prompt_mode,delete r.custom_title_prompt,delete r.custom_content_prompt,delete r.generate_meta_description,delete r.custom_meta_prompt,delete r.generate_focus_keyword,delete r.custom_keyword_prompt,delete r.cw_generation_mode,delete r.rss_feeds,delete r.gsheets_sheet_id,delete r.gsheets_credentials,delete r.url_list,delete r.generate_toc,delete r.generate_images_enabled,delete r.image_provider,delete r.image_model,delete r.image_prompt,delete r.image_count,delete r.image_placement,delete r.image_placement_param_x,delete r.image_alignment,delete r.image_size,delete r.generate_featured_image,delete r.featured_image_prompt,delete r.pexels_orientation,delete r.pexels_size,delete r.pexels_color,delete r.pexels_api_key,delete r.pixabay_orientation,delete r.pixabay_image_type,delete r.pixabay_category,delete r.pixabay_api_key,delete r.replicate_api_key,delete r.enable_vector_store,delete r.vector_store_provider,delete r["openai_vector_store_ids[]"],delete r.openai_vector_store_ids,delete r.pinecone_index_name,delete r.qdrant_collection_name,delete r.vector_embedding_provider,delete r.vector_embedding_model,delete r.vector_store_top_k,delete r.rss_include_keywords,delete r.rss_exclude_keywords),r}window.aipkit_save_task_handleContentWriting=k})();(function(){"use strict";function k(r){let t=(window.aipkit_automated_tasks_config||{}).text||{};if(!r.task_name)return t.task_name_required||"Task name is required.";if(!r.task_category)return t.task_category_required||"Task category is required.";if(!r.task_type)return t.task_type_required||"Task type is required.";if(r.task_type==="content_indexing"){if(!r.target_store_id)return t.target_store_required||"A target vector store/index must be selected.";if(!r.post_types||r.post_types.length===0)return t.content_type_required||"Please select content types for indexing.";if(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant"){if(!r.embedding_provider)return t.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!r.embedding_model)return t.embedding_model_required||"Embedding model is required for this vector provider."}}if(r.task_type.startsWith("content_writing")){let a=r.cw_generation_mode||"bulk";if(a==="bulk"){if(!r.content_title_bulk?.trim())return t.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(a==="csv"){if(!r.content_title?.trim())return t.csv_required_cw_task||"Please upload a CSV file."}else{if(a==="rss"&&!r.rss_feeds?.trim())return t.rss_required_cw_task||"Please add at least one RSS feed.";if(a==="url"&&!r.url_list?.trim())return t.url_required_cw_task||"Please add at least one URL.";if(a==="gsheets"){if(!r.gsheets_sheet_id?.trim())return t.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!r.gsheets_credentials?.trim())return t.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(a==="single"&&!r.content_title?.trim())return t.content_title_required_cw_task||"Please add a topic."}if(!r.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!r.ai_provider||!r.ai_model)return t.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(r.task_type==="enhance_existing_content"){if(!r.post_types||r.post_types.length===0)return"Please select at least one post type to update.";if(r.update_title!=="1"&&r.update_excerpt!=="1"&&r.update_content!=="1"&&r.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=k})();(function(){"use strict";async function k(r){let n=window.aipkit_automated_tasks_config||{},t={...r,_ajax_nonce:n.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",t)}window.aipkit_save_task_submitRequest=k})();(function(){"use strict";function k(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=k})();(function(){"use strict";async function k(r){if(r.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let n=r.target,t=document.getElementById("aipkit_save_task_btn");if(t&&t.dataset.action==="upgrade"){let l=window.aipkit_dashboard?.upgradeUrl;l?window.open(l,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let a=(window.aipkit_automated_tasks_config||{}).text||{},s=a.save_task_button||"Save Task";try{let{formData:l,data:c}=window.aipkit_save_task_extractBaseData(n),o;c.task_type==="content_indexing"?o=window.aipkit_save_task_handleContentIndexing(c,l):c.task_type.startsWith("content_writing")?o=window.aipkit_save_task_handleContentWriting(c,l):c.task_type==="enhance_existing_content"?o=window.aipkit_save_task_handleContentEnhancement(c,l):o=c;let e=window.aipkit_save_task_validateData(o);if(e!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e,"error"),new Error("Validation failed: "+e);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!0,s,a.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(a.saving_task||"Saving task...","info");let i=await window.aipkit_save_task_submitRequest(o);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(i.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(l){console.error("Save Task Error:",l),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&l.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${l.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,s)}}window.aipkit_form_handleSaveTask=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_automated_task_form"),n=document.getElementById("aipkit_autogpt_task_status_toggle"),t=document.getElementById("aipkit_autogpt_task_status_input"),a=document.getElementById("aipkit_autogpt_task_status_label"),s=document.getElementById("aipkit_autogpt_task_status_card"),l=document.getElementById("aipkit_automated_task_category"),c=document.querySelector("[data-aipkit-autogpt-category-selector]"),o=c?Array.from(c.querySelectorAll(".aipkit_cw_mode_card")):[],e=document.getElementById("aipkit_automated_task_type"),i=document.getElementById("aipkit_cancel_edit_task_btn"),d=document.getElementById("aipkit_automated_task_form_wrapper"),u=document.getElementById("aipkit_automated_task_list_wrapper"),p=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),r&&typeof window.aipkit_form_handleSaveTask=="function"?r.addEventListener("submit",window.aipkit_form_handleSaveTask):r&&console.error("Automated Task Form Init: handleSaveTask function not found."),l&&typeof window.aipkit_form_handleCategoryChange=="function"?l.addEventListener("change",window.aipkit_form_handleCategoryChange):l&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let f=g=>{o.length&&o.forEach(_=>{let w=_.dataset.category===g;_.classList.toggle("is-active",w),_.setAttribute("aria-pressed",w?"true":"false")})};l&&o.length&&(o.forEach(g=>{g.addEventListener("click",()=>{let _=g.dataset.category||"";!_||_===l.value||(l.value=_,l.dispatchEvent(new Event("change",{bubbles:!0})))})}),l.addEventListener("change",()=>{f(l.value)}),f(l.value||"")),e&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(e.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:e})):e&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),i&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?i.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(d,u,p)}):i&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let m=()=>{if(!n||!t||!a)return;let g=(t.value||"active")==="active";n.checked=g,a.textContent=g?"Active":"Paused",s&&(s.dataset.status=g?"active":"paused")};window.aipkit_syncTaskStatusToggle=m,n&&t&&a&&(n.dataset.statusListenerAttached||(n.addEventListener("change",()=>{t.value=n.checked?"active":"paused",m()}),n.dataset.statusListenerAttached="true"),m())}window.aipkit_form_initAutomatedTaskForm=k})();(function(){"use strict";let k=!1,r=null,n=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return k},set isSubmitting(a){k=a},get pendingModelSelection(){return r},set pendingModelSelection(a){r=a},get pendingEmbeddingModelSelection(){return n},set pendingEmbeddingModelSelection(a){n=a}};function t(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=t})();(function(){"use strict";function k(r,n){r&&(r.classList.toggle("aipkit_loading",!!n),r.disabled=!!n)}window.aipkit_setAutogptActionButtonLoading=k})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_automated_tasks_tbody"),t=window.aipkit_automated_tasks_config||{},a=t.text||{},s=window.aipkit_escapeHtml||function(i){return i},l=window.aipkit_ucfirst||function(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""},c=t.frequencies||{},o=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(i=>{i.removeAttribute("data-sort-direction"),o&&i.dataset.sortBy===o.sortBy&&i.setAttribute("data-sort-direction",o.sortOrder.toLowerCase())}),!n){console.warn("Render Tasks Table: Table body not found.");return}if(n.innerHTML="",!r||r.length===0){n.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${a.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}r.forEach(i=>{let d=JSON.parse(i.task_config||"{}"),u=n.insertRow(),p=u.insertCell();p.textContent=s(i.task_name);let f=u.insertCell(),g=(t.task_types?.[i.task_type]||{}).label||l(i.task_type.replace(/_/g," "));f.innerHTML=`<span class="aipkit_task_type_badge" data-type="${s(i.task_type)}">${s(g)}</span>`;let _=d.indexing_frequency||d.task_frequency||"N/A",w=c[_]||l(_.replace(/_/g," "));u.insertCell().textContent=s(w);let h=u.insertCell();h.innerHTML=`<span class="aipkit_job_status_${s(i.status)}">${s(l(i.status))}</span>`;let E=u.insertCell(),x=i.last_run_time?new Date(i.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a.never_run||"Never",v=i.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(i.next_run_time):i.next_run_time?new Date(i.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a.not_scheduled||"Not Scheduled";E.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${a.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${i.last_run_time?"":" aipkit_never"}">${s(x)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${a.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${s(v)}</span>
          </div>
        </div>
      `;let I=u.insertCell();I.className="aipkit_actions_cell",I.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${i.id}" title="${a.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${i.status==="active"?"pause":"resume"}" data-task-id="${i.id}" title="${i.status==="active"?a.pause_button||"Pause":a.resume_button||"Resume"}">
            <span class="dashicons ${i.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${i.status==="active"?a.pause_button||"Pause":a.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${i.id}" ${i.status!=="active"?"disabled":""} title="${i.status!=="active"?a.task_not_active_run_title||"Task must be active to run":a.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${i.id}" title="${a.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=k})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_automated_task_list_pagination"),a=(window.aipkit_automated_tasks_config||{}).text||{};if(!n){console.warn("Render List Pagination: Pagination container not found.");return}n.innerHTML="";let{total_items:s,total_pages:l,current_page:c}=r||{};if(!l||l<=1){s>0&&(n.innerHTML=`<span class="aipkit_pagination-count">${Number(s).toLocaleString()} ${Number(s)===1?a.task_singular||"task":a.task_plural||"tasks"}</span>`);return}let o=document.createElement("span");o.className="aipkit_pagination-count",o.textContent=`${Number(s).toLocaleString()} ${Number(s)===1?a.task_singular||"task":a.task_plural||"tasks"}`,n.appendChild(o);let e=document.createElement("span");e.className="aipkit_pagination-links";let i=document.createElement("button");i.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",i.innerHTML=`\xAB ${a.previous_button||"Previous"}`,i.disabled=Number(c)<=1,i.disabled||(i.dataset.page=Number(c)-1),e.appendChild(i);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${a.page_label||"Page"} ${Number(c)} ${a.of_label||"of"} ${Number(l)}`,e.appendChild(d);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=`${a.next_button||"Next"} \xBB`,u.disabled=Number(c)>=Number(l),u.disabled||(u.dataset.page=Number(c)+1),e.appendChild(u),n.appendChild(e)}window.aipkit_list_renderListPagination=k})();(function(){"use strict";async function k(r=1){let n=document.getElementById("aipkit_automated_tasks_tbody"),t=window.aipkit_automated_tasks_list_state,a=window.aipkit_automated_tasks_config||{},s=a.text||{};if(!n){console.warn("Fetch Tasks: Table body not found.");return}n.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${s.loading_tasks||"Loading tasks..."}</td></tr>`,t&&(t.page=r);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let l={page:r,search:t?t.search:"",orderby:t?t.sortBy:"created_at",order:t?t.sortOrder:"DESC",_ajax_nonce:a.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_tasks",l);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=c.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(c.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(c.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(l){console.error("Fetch Tasks Error:",l),n.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${s.error_loading_tasks||"Error loading tasks:"} ${l.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=k})();(function(){"use strict";function k(r){if(!r){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),r):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=k})();(function(){"use strict";async function k(r,n){let t=window.aipkit_automated_tasks_config||{},a=t.text||{},s=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,a.delete_button||"Delete",a.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:n,_ajax_nonce:t.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${a.error_deleting_task||"Error deleting task:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,a.delete_button||"Delete")}},l=a.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(l,{title:a.confirm_title||"Confirm",confirmText:a.delete_button||"Delete",cancelText:a.cancel_button||"Cancel",onConfirm:()=>{s()}});return}confirm(l)&&await s()}window.aipkit_handleDeleteTaskAction=k})();(function(){"use strict";async function k(r,n,t){let a=window.aipkit_automated_tasks_config||{},s=a.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(r,!0):(r.classList.add("aipkit_loading"),r.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:n,status:t,_ajax_nonce:a.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.task_status_updated||"Task status updated to"} ${t}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(l){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.error_updating_status||"Error updating task status:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(r,!1):(r.classList.remove("aipkit_loading"),r.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=k})();(function(){"use strict";async function k(r,n){let t=window.aipkit_automated_tasks_config||{},a=t.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(r,!0):(r.classList.add("aipkit_loading"),r.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:n,_ajax_nonce:t.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(s){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${a.error_initiating_run||"Error initiating task run:"} ${s.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(r,!1):(r.classList.remove("aipkit_loading"),r.disabled=!1)}}window.aipkit_handleRunNowTaskAction=k})();(function(){"use strict";async function k(r){let n=r.target.closest("button[data-action]");if(!n)return;let t=n.dataset.action,a=n.dataset.taskId;if(!a)return;let l=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(c=>c.id.toString()===a.toString());switch(t){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(l);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(n,a);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let c=t==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(n,a,c)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(n,a);break;default:console.warn(`Unknown task action: ${t}`);break}}window.aipkit_list_handleTaskActionClick=k})();(function(){"use strict";function k(r){let n=r.target.closest("button[data-page]");if(n&&!n.disabled){let t=parseInt(n.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(t):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=k})();(function(){"use strict";function k(r,n="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(r,n);return}let t=document.getElementById("aipkit_automated_task_form_status");t&&(t.textContent=r,t.className=`aipkit_form-help aipkit_settings_message-${n}`,setTimeout(()=>{t.textContent===r&&(t.textContent="",t.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_automated_task_list_wrapper"),n=document.getElementById("aipkit_automated_tasks_tbody"),t=document.getElementById("aipkit_add_new_task_btn"),a=document.getElementById("aipkit_automated_task_form_wrapper"),s=document.getElementById("aipkit_automated_task_list_pagination"),l=document.getElementById("aipkit_task_list_search_input"),c=r?r.querySelector(".aipkit_data-table"):null;if(t&&a&&r&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&t.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(a,r,t)}),n&&typeof window.aipkit_list_handleTaskActionClick=="function"&&n.addEventListener("click",window.aipkit_list_handleTaskActionClick),s&&typeof window.aipkit_list_handleListPaginationClick=="function"&&s.addEventListener("click",window.aipkit_list_handleListPaginationClick),l){let o;l.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{let e=window.aipkit_automated_tasks_list_state;e&&(e.search=l.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}c&&c.addEventListener("click",o=>{let e=o.target.closest("th.aipkit-sortable-col");if(!e)return;let i=e.dataset.sortBy,d=window.aipkit_automated_tasks_list_state;if(!d)return;let u="DESC";d.sortBy===i&&(u=d.sortOrder==="DESC"?"ASC":"DESC"),d.sortBy=i,d.sortOrder=u,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=k})();(function(){"use strict";let k=[],r=1,n="",t="created_at",a="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...k]},set tasks(l){k=Array.isArray(l)?l:[]},get page(){return r},set page(l){r=l},get search(){return n},set search(l){n=l},get sortBy(){return t},set sortBy(l){t=l},get sortOrder(){return a},set sortOrder(l){a=l}};function s(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=s})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_automated_task_queue_tbody"),t=document.getElementById("aipkit_delete_queue_by_status_btn"),a=window.aipkit_automated_tasks_config||{},s=a.text||{},l=window.aipkit_escapeHtml||function(d){return d},c=window.aipkit_ucfirst||function(d){return d?d.charAt(0).toUpperCase()+d.slice(1):""},o=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(d=>{d.removeAttribute("data-sort-direction"),o&&d.dataset.sortBy===o.sortBy&&d.setAttribute("data-sort-direction",o.sortOrder.toLowerCase())}),!n){console.warn("Render Queue Table: Table body not found.");return}n.innerHTML="";let i=Array.isArray(r)&&r.length>0;if(t&&(t.disabled=!i,t.setAttribute("aria-disabled",i?"false":"true"),i?t.title=s.delete_filtered_title||"Delete filtered items":t.title=s.queue_empty_delete||"No queue items available to delete."),!i){n.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${s.queue_empty||"Task queue is currently empty."}</td></tr>`;return}r.forEach(d=>{let u=n.insertRow(),p=u.insertCell(),f=document.createElement("textarea");f.innerHTML=d.target_title||`${s.target_id_prefix||"ID:"} ${d.target_identifier}`;let m=f.value,g=d.task_type.startsWith("content_writing"),_=d.task_type==="enhance_existing_content",w=null;g&&d.status==="completed"&&d.generated_post_id?w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${d.generated_post_id}&action=edit`:_&&!isNaN(parseInt(d.target_identifier,10))&&(w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${d.target_identifier}&action=edit`),w?p.innerHTML=`<a href="${w}" target="_blank" title="${l(s.edit_generated_post_title||"View post")}">${l(m)}</a>`:p.textContent=m,u.insertCell().textContent=l(d.task_name||`${s.task_id_prefix||"Task"} ${d.task_id}`);let h=u.insertCell(),E=a.task_types&&a.task_types[d.task_type]?a.task_types[d.task_type].label:c(d.task_type.replace(/_/g," "));h.innerHTML=`<span class="aipkit_task_type_badge" data-type="${l(d.task_type)}">${l(E)}</span>`;let x=u.insertCell(),v=`<span class="aipkit_job_status_${l(d.status)}">${l(c(d.status))}`;d.status==="failed"&&d.attempts>1&&(v+=` <small>(${d.attempts}x)</small>`),v+="</span>",d.status==="failed"&&d.error_message&&(v+=`<span class="aipkit_queue_error_message" title="${l(d.error_message)}">${l(d.error_message)}</span>`),x.innerHTML=v;let I=u.insertCell();if(d.added_at){let y=new Date(d.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(d.added_at):y,C=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${l(y)}">${l(S)}</div>`;if(d.scheduled_gmt_time){let A=new Date(d.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(d.scheduled_gmt_time):A;C+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${l(A)}">${l(s.scheduled_for_label||"\u2192")} ${l(M)}</div>`}I.innerHTML=C}else I.textContent=s.not_applicable||"\u2014";let P=u.insertCell();P.className="aipkit_actions_cell";let b='<div class="aipkit-table-actions-group">';d.status==="failed"&&(b+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${d.id}" title="${s.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${s.retry_button||"Retry"}</span></button>`),b+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${d.id}" title="${s.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,b+="</div>",P.innerHTML=b})}window.aipkit_queue_renderQueueTable=k})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_automated_task_queue_pagination"),a=(window.aipkit_automated_tasks_config||{}).text||{};if(!n){console.warn("Render Queue Pagination: Pagination container not found.");return}n.innerHTML="";let{total_items:s,total_pages:l,current_page:c}=r||{};if(!s||s<=0)return;let o=document.createElement("span");if(o.className="aipkit_pagination-count",o.textContent=`${Number(s).toLocaleString()} ${Number(s)===1?a.item_singular||"item":a.item_plural||"items"}`,n.appendChild(o),l>1){let e=document.createElement("span");e.className="aipkit_pagination-links";let i=document.createElement("button");i.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",i.innerHTML=`\xAB ${a.previous_button||"Previous"}`,i.disabled=Number(c)<=1,i.disabled||(i.dataset.page=Number(c)-1),e.appendChild(i);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${a.page_label||"Page"} ${Number(c)} ${a.of_label||"of"} ${Number(l)}`,e.appendChild(d);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=`${a.next_button||"Next"} \xBB`,u.disabled=Number(c)>=Number(l),u.disabled||(u.dataset.page=Number(c)+1),e.appendChild(u),n.appendChild(e)}}window.aipkit_queue_renderQueuePagination=k})();(function(){"use strict";async function k(r=1){let n=window.aipkit_automated_tasks_queue_state;n?n.page=r:console.warn("Fetch/Render Queue: Queue state object not available.");let t=document.getElementById("aipkit_automated_task_queue_tbody"),a=window.aipkit_automated_tasks_config||{},s=a.text||{};if(!t){console.warn("Fetch/Render Queue: Table body not found.");return}t.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${s.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let l={page:r,search:n?n.search:"",status_filter:n?n.status:"all",orderby:n?n.sortBy:"q.added_at",order:n?n.sortOrder:"DESC",_ajax_nonce:a.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",l);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(c.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(c.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(l){console.error("Fetch/Render Queue Error:",l),t.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${s.error_loading_queue||"Error loading queue:"} ${l.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=k})();(function(){"use strict";async function k(r){let n=r.target.closest("button[data-action]");if(!n)return;let t=n.dataset.action,a=n.dataset.itemId;if(!a)return;let s=window.aipkit_automated_tasks_config||{},l=s.text||{},c=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,o=(e,i)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(e,i);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e,i)};if(t==="delete_queue_item"){let e=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,l.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:a,_ajax_nonce:s.nonce_manage_tasks}),o(l.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(d){o(`${l.error_deleting_queue_item||"Error deleting item:"} ${d.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,l.delete_button||"Delete")}},i=l.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(i,{title:l.confirm_title||"Confirm",confirmText:l.delete_button||"Delete",cancelText:l.cancel_button||"Cancel",onConfirm:()=>{e()}});return}if(!confirm(i))return;await e()}else if(t==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,l.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:a,_ajax_nonce:s.nonce_manage_tasks}),o(l.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(e){o(`${l.error_retrying_item||"Error retrying item:"} ${e.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,l.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=k})();(function(){"use strict";async function k(){let r=document.getElementById("aipkit_delete_queue_by_status_btn"),n=document.getElementById("aipkit_task_queue_status_filter");if(!r||!n){console.error("Delete by status button or filter dropdown not found.");return}let t=n.value,a=n.options[n.selectedIndex].text.toLowerCase(),s=window.aipkit_automated_tasks_config||{},l=s.text||{},c=t==="all"?l.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(l.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",a),o=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!0,l.delete_button||"Delete",l.deleting_task||"Deleting..."):r.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let e=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:t,_ajax_nonce:s.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(e.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(e){let i=`${l.errorDeletingAllItems||"Error deleting items:"} ${e.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(i,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(i,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!1,l.delete_button||"Delete"):r.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:l.confirm_title||"Confirm",confirmText:l.delete_button||"Delete",cancelText:l.cancel_button||"Cancel",onConfirm:()=>{o()}});return}confirm(c)&&await o()}window.aipkit_handleDeleteQueueByStatus=k})();(function(){"use strict";function k(r){let n=r.target.closest("button[data-page]");if(n&&!n.disabled){let t=parseInt(n.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(t):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_automated_task_queue_tbody"),n=document.getElementById("aipkit_refresh_task_queue_btn"),t=document.getElementById("aipkit_delete_queue_by_status_btn"),a=document.getElementById("aipkit_automated_task_queue_pagination"),s=document.getElementById("aipkit_task_queue_search_input"),l=document.getElementById("aipkit_task_queue_status_filter"),c=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(n&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&n.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),t&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&t.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),s){let o;s.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{let e=window.aipkit_automated_tasks_queue_state;e&&(e.search=s.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}l&&l.addEventListener("change",()=>{let o=window.aipkit_automated_tasks_queue_state;o&&(o.status=l.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),c&&c.addEventListener("click",o=>{let e=o.target.closest("th.aipkit-sortable-col");if(!e)return;let i=e.dataset.sortBy,d=window.aipkit_automated_tasks_queue_state;if(!d)return;let u="DESC";d.sortBy===i&&(u=d.sortOrder==="DESC"?"ASC":"DESC"),d.sortBy=i,d.sortOrder=u,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),r&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&r.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),a&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&a.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=k})();(function(){"use strict";let k=1,r="",n="all",t="q.added_at",a="DESC";window.aipkit_automated_tasks_queue_state={get page(){return k},set page(l){k=l},get search(){return r},set search(l){r=l},get status(){return n},set status(l){n=l},get sortBy(){return t},set sortBy(l){t=l},get sortOrder(){return a},set sortOrder(l){a=l}};function s(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=s})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_autogpt_container");if(r&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():r&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!r)return;let t=r.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!t)return;let a=t.dataset.aipkitCronTimestamp,s=a?parseInt(a,10):0;if(!s||Number.isNaN(s))return;let l=new Date(s*1e3),c=l.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});t.textContent=c,t.title=l.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(t){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",t)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(t){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",t)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(t){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",t)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(t){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",t)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(r)}catch(t){console.error("AIPKit AutoGPT: Error initializing settings popovers:",t)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(r)}catch(t){console.error("AIPKit AutoGPT: Error updating AI summaries:",t)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(r)}catch(t){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",t)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(r)}catch(t){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",t)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=k})();(function(){"use strict";let k=null;function r(c,o="",e=0){let i=document.getElementById("aipkit_content_writer_form_status");if(!i)return;k&&(clearTimeout(k),k=null);let d="aipkit_cw_status_badge",u=(p="")=>{i.className=p?`${d} ${p}`:d};switch(u(),c){case"progress":i.textContent=o,u("aipkit_settings_message-info");break;case"info":i.textContent=o,u("aipkit_settings_message-info");break;case"success":i.textContent=o,u("aipkit_settings_message-success");break;case"error":i.textContent=o,u("aipkit_settings_message-error");break;case"clear":default:i.textContent="",u();return}e&&(k=setTimeout(()=>{i.textContent===o&&n()},e))}function n(){r("clear")}function t(c){r("progress",c)}function a(c,o=3e3){r("info",c,o)}function s(c){r("success",c,3e3)}function l(c){r("error",c)}window.aipkit_updateGeneralStatus=r,window.aipkit_clearGeneralStatus=n,window.aipkit_showProgress=t,window.aipkit_showInfo=a,window.aipkit_showSuccess=s,window.aipkit_showError=l})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function k(){let a=window.aipkit_cw_template_state,s=a?.currentTemplateId;if(!s)return null;let l="";if(Array.isArray(a?.currentTemplates)){let o=a.currentTemplates.find(e=>String(e.id)===String(s));o?.template_name&&(l=o.template_name)}if(!l){let o=document.getElementById("aipkit_cw_template_select");o?.selectedOptions?.length&&(l=o.selectedOptions[0].textContent.trim())}let c=parseInt(s,10);return!l||Number.isNaN(c)?null:{id:c,name:l}}function r(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let a=document.getElementById("aipkit_content_writer_form");return a?window.aipkit_getContentWriterFormConfig(a):null}async function n(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let a=window.aipkit_cw_template_state;if(a?.isSavingOrDeleting)return;let s=r();if(!s)return;let l=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(s)===JSON.stringify(l))return;let c=k();if(!c)return;let o=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,e=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,i=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,o&&o("Saving...");try{let d=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:c.id,template_name:c.name,template_type:"content_writer",config:JSON.stringify(s),_ajax_nonce:d?d.value:""}),window.aipkit_cw_lastSavedData=s,a&&(a.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(s)),a.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(c.id)),e&&e("Updated")}catch(d){i&&i(`Error: ${d.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",d)}finally{window.aipkit_cw_isAutosaving=!1}}function t(){let a=r();a&&(window.aipkit_cw_lastSavedData=a)}window.aipkit_handleContentWriterAutoSave=n,window.aipkit_updateContentWriterAutosaveBaseline=t})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let n="data-aipkit-cw-autosave-attached";r.getAttribute(n)||(r.addEventListener("change",t=>{let a=t.target;if(!a||!a.matches(".aipkit_autosave_trigger"))return;(a.tagName.toLowerCase()==="select"||a.type==="checkbox"||a.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),r.addEventListener("blur",t=>{let a=t.target;if(!a||!a.matches(".aipkit_autosave_trigger"))return;let s=a.tagName.toLowerCase();(s==="input"||s==="textarea")&&a.type!=="range"&&a.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),r.setAttribute(n,"true"))}window.aipkit_initContentWriterAutosave=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("Content Writer Accordions: Main container not found.");return}r.dataset.accordionListenerAttached!=="true"&&(r.addEventListener("click",function(n){let t=n.target.closest(".aipkit_accordion-header");if(!t)return;let a=t.closest(".aipkit_accordion");if(!a)return;let s=t.nextElementSibling;if(!s||!s.classList.contains("aipkit_accordion-content"))return;let l=a.closest(".aipkit_accordion-group");if(l&&!t.classList.contains("aipkit_active")){let c=l.querySelector(".aipkit_accordion-header.aipkit_active");if(c){c.classList.remove("aipkit_active");let o=c.nextElementSibling;o&&o.classList.remove("aipkit_active")}}t.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active")}),r.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c},r=null,n={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},t=null;function a(c,o=""){if(r||(r=document.getElementById("aipkit_content_writer_form_status")),!r)return;t&&(clearTimeout(t),t=null),r.textContent=c;let e="aipkit_cw_status_badge";r.className=o?`${e} ${o}`:e}function s(c,o,e=""){let i=n[c]||"Step",d=e?k(e):"";switch(o){case"pending":break;case"generating":a(d||`Generating ${i}...`,"aipkit_settings_message-info");break;case"success":a(`${i} complete`,"aipkit_settings_message-success"),t=setTimeout(()=>{a("")},1400);break;case"error":a(`Error ${i}${d?": "+d:""}`,"aipkit_settings_message-error");break;case"skipped":d&&(a(`${i} skipped: ${d}`,"aipkit_settings_message-info"),t=setTimeout(()=>{a("")},1400));break}let u=document.getElementById(`aipkit_cw_status_${c}_generation`),p=u?u.querySelector(".aipkit_cw_status_icon"):null,f=u?u.querySelector(".status-text"):null;if(!(!u||!p||!f))switch(u.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),u.classList.add(`status-${o}`),o){case"pending":{f.textContent="Pending";let m="dashicons-text-page";c==="content"&&(m="dashicons-admin-post"),c==="image"&&(m="dashicons-format-image"),c==="excerpt"&&(m="dashicons-editor-quote"),c==="tags"&&(m="dashicons-tag"),c==="meta"&&(m="dashicons-search"),c==="keyword"&&(m="dashicons-flag"),p.className=`dashicons ${m} aipkit_cw_status_icon`;break}case"generating":f.textContent=d||"Generating...",p.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":f.textContent="Complete",p.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":f.textContent=`Error ${d?": "+d:""}`,p.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":f.textContent="Skipped",p.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function l(){a(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(c=>{s(c,"pending")})}window.aipkit_updateCwGenerationStatus=s,window.aipkit_resetAllGenerationStatuses=l})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_form_status");r&&(r.textContent="",r.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(d){return d},r=window.aipkit_escapeHtml||function(d){return d},n=(d,u)=>(d?.elements?.[u]?.value||"").trim(),t=d=>String(d||"").split(/\r?\n/).map(u=>u.trim()).filter(Boolean),a=d=>d.map(u=>u.split("|")[0].trim()).filter(Boolean),s=d=>{try{let u=new URL(d);return u.protocol==="http:"||u.protocol==="https:"}catch{return!1}},l=d=>{let u=d?.querySelector(".aipkit_gsheets_indicator");return u?u.classList.contains("aipkit_gsheets_indicator--success"):!0};function c(d,u){d&&(d.textContent=u||k("Please review your input.","gpt3-ai-content-generator"),d.id==="aipkit_cw_action_validation"?d.className="aipkit_cw_action_validation":d.className="aipkit_cw_status_badge aipkit_settings_message-error")}function o(d){d&&(d.textContent="",d.id==="aipkit_cw_action_validation"?d.className="aipkit_cw_action_validation":d.className="aipkit_cw_status_badge")}function e(d,u){let p=u||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(p==="single"&&(p="task"),p==="task")return a(t(n(d,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one topic.","gpt3-ai-content-generator")};if(p==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");return(f?f.value.trim():"")?{isValid:!0}:{isValid:!1,message:k("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(p==="rss")return t(n(d,"rss_feeds")).filter(s).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(p==="url")return t(n(d,"url_list")).filter(s).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(p==="gsheets"){let f=n(d,"gsheets_sheet_id"),m=n(d,"gsheets_credentials");return!f||!m?{isValid:!1,message:k("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:l(d)?{isValid:!0}:{isValid:!1,message:k("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function i(d,u,p){let f=new FormData(d),m=Object.fromEntries(f.entries()),g=d.elements["openai_vector_store_ids[]"];m.openai_vector_store_ids=g?Array.from(g.selectedOptions).map(P=>P.value):[],delete m["openai_vector_store_ids[]"];let _=window.aipkit_dashboard?.text||{},w=document.getElementById("aipkit_cw_mode_select"),h=w?w.value:"task";h==="single"&&(h="task"),m.cw_generation_mode=h;let E=document.getElementById("aipkit_cw_action_validation"),x=e(d,h);if(!x.isValid){let P=p||E;c(P,x.message),P!==E&&o(E);return}if(o(p),o(E),h==="csv"){let P=document.getElementById("aipkit_cw_csv_data_holder");m.content_title=P?P.value:""}else h==="url"?(m.url_list=d.elements.url_list?.value||"",m.content_title=m.url_list):h==="task"&&(m.content_title=d.elements.content_title_bulk?d.elements.content_title_bulk.value:"");delete m.content_title_bulk,delete m.content_title_csv;let v=document.getElementById("aipkit_cw_template_select"),I="";if(v&&v.selectedIndex>0){let P=v.options[v.selectedIndex];P&&(I=P.text)}if(I&&I.trim()!=="")m.task_name=I.trim();else{let P=(m.content_title||m.rss_feeds||m.gsheets_sheet_id||m.url_list||"").split(`
`)[0].trim();m.task_name=P||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(u,!0,"Create Task","Creating Task..."):(u.disabled=!0,u.textContent="Creating Task..."),p&&(p.textContent="Creating automated task...",p.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let P=document.getElementById("aipkit_content_writer_nonce");if(m._ajax_nonce=P?P.value:"",!m._ajax_nonce)throw new Error("Security token missing for task creation.");let b=await window.aipkit_apiRequest("aipkit_content_writer_create_task",m);p&&(p.textContent="",p.className="aipkit_cw_status_badge"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("autogpt"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt",{aipkit_force_refresh:!0})}catch(P){console.error("Content Writer Create Task Error:",P),p&&(p.textContent=`Error creating task: ${r(P.message||"Unknown error")}`,p.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(u,!1,"Create Task"):(u.disabled=!1,u.textContent="Create Task")}}window.aipkit_createContentWriterTask=i,window.aipkit_validateContentWriterInputs=e,window.aipkit_showContentWriterValidationError=c,window.aipkit_clearContentWriterValidationMessage=o})();(function(){"use strict";let k=()=>{let p=document.getElementById("aipkit_cw_mode_select"),f=p?p.value:"task";return f==="single"?"task":f},r=()=>{let p=k();return p==="task"||p==="csv"},n=p=>{!p?.frequencySelect||!p.frequencySelect.querySelector('option[value="one-time"]')||p.frequencySelect.value!=="one-time"&&(p.frequencySelect.value="one-time",p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},t=()=>{let p=document.getElementById("aipkit_content_writer_container");if(!p)return null;let f=p.querySelector(".aipkit_cw_generate_split");if(!f)return null;let m=f.querySelector("#aipkit_content_writer_generate_btn"),g=f.querySelector(".aipkit_cw_generate_toggle"),_=f.querySelector(".aipkit_cw_generate_menu"),w=_?_.querySelector('[data-menu-panel="actions"]'):null,h=_?_.querySelector('[data-menu-panel="intervals"]'):null,E=w?Array.from(w.querySelectorAll("[data-action]")):[],x=h?Array.from(h.querySelectorAll("[data-interval]")):[],v=h?h.querySelector("[data-menu-back]"):null,I=p.querySelector("#aipkit_cw_task_frequency");return{container:p,split:f,generateBtn:m,toggleBtn:g,menu:_,menuActions:w,menuIntervals:h,actionItems:E,intervalItems:x,backBtn:v,frequencySelect:I}},a=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!0,p.toggleBtn.setAttribute("aria-expanded","false"))},s=p=>{if(!p?.menu||!p?.split)return;let f=p.menu,m=p.split.getBoundingClientRect(),g=window.innerWidth,_=12;f.style.position="fixed",f.style.right="auto",f.style.bottom="auto",f.style.zIndex="100000",f.style.visibility="hidden";let w=f.getBoundingClientRect(),h=m.right-w.width;h=Math.max(_,Math.min(h,g-w.width-_));let E=m.bottom+6;f.style.left=`${Math.round(h)}px`,f.style.top=`${Math.round(E)}px`,f.style.visibility="visible"},l=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!1,s(p),p.toggleBtn.setAttribute("aria-expanded","true"))},c=(p,f)=>{if(!p?.menuActions||!p?.menuIntervals)return;let m=f==="intervals";p.menuActions.hidden=m,p.menuIntervals.hidden=!m},o=(p,f)=>{p&&(p.split.dataset.aipkitCwAction=f||"generate",p.actionItems.forEach(m=>{let g=m.dataset.action===f;m.classList.toggle("is-active",g),m.setAttribute("aria-checked",g?"true":"false")}))},e=p=>{if(!p?.frequencySelect)return;let f=p.frequencySelect.value||p.frequencySelect.options[0]?.value||"";p.intervalItems.forEach(m=>{let g=m.dataset.interval===f;m.classList.toggle("is-active",g),m.setAttribute("aria-checked",g?"true":"false")})},i=(p,f)=>{p?.frequencySelect&&(p.frequencySelect.value=f,p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),e(p),a(p),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},d=p=>{let f=t();if(!f)return;let m=p||"generate",g=m==="create_task"&&r();if(g&&n(f),o(f,m),typeof window.aipkit_updateContentWriterActionState=="function"&&(f.menu&&m==="create_task"&&!g&&(f.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),m==="create_task"&&f.menuIntervals&&!g){c(f,"intervals"),e(f),l(f);return}c(f,"actions"),a(f),g&&m==="create_task"&&f.generateBtn&&setTimeout(()=>{f.generateBtn.click()},0)},u=()=>{let p=t();p&&p.split.dataset.listenerAttached!=="true"&&(p.split.dataset.aipkitCwAction||(p.split.dataset.aipkitCwAction="generate"),o(p,p.split.dataset.aipkitCwAction),e(p),p.toggleBtn&&p.toggleBtn.addEventListener("click",f=>{if(f.preventDefault(),p.toggleBtn.disabled)return;(p.split.dataset.aipkitCwAction||"generate")==="create_task"&&!r()?(c(p,"intervals"),e(p)):c(p,"actions"),p.menu&&p.menu.hidden?l(p):a(p)}),p.actionItems.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),!f.disabled&&d(f.dataset.action||"generate")})}),p.intervalItems.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),!f.disabled&&i(p,f.dataset.interval||"")})}),p.backBtn&&p.backBtn.addEventListener("click",f=>{f.preventDefault(),c(p,"actions"),l(p)}),document.addEventListener("click",f=>{let m=f.target;!p.menu||p.menu.hidden||p.split.contains(m)||a(p)}),document.addEventListener("keydown",f=>{f.key==="Escape"&&(!p.menu||p.menu.hidden||a(p))}),p.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=u,window.aipkit_setCwGenerateAction=d,window.aipkit_getCwGenerateAction=()=>t()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let k=window.wp?.i18n?.__||function(L){return L},r=100,n=[{key:"write",label:k("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:k("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:L=>L.generateMeta||L.generateFocus||L.generateExcerpt||L.generateTags},{key:"publish",label:k("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],t={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Running","gpt3-ai-content-generator"),done:k("Done","gpt3-ai-content-generator"),skipped:k("Skipped","gpt3-ai-content-generator"),error:k("Error","gpt3-ai-content-generator")},a=[{key:"title",label:k("Title","gpt3-ai-content-generator"),isEnabled:L=>!!L.customTitlePrompt},{key:"content",label:k("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:k("Meta","gpt3-ai-content-generator"),isEnabled:L=>L.generateMeta},{key:"focus",label:k("Focus","gpt3-ai-content-generator"),isEnabled:L=>L.generateFocus},{key:"excerpt",label:k("Excerpt","gpt3-ai-content-generator"),isEnabled:L=>L.generateExcerpt},{key:"tags",label:k("Tags","gpt3-ai-content-generator"),isEnabled:L=>L.generateTags},{key:"image",label:k("Image","gpt3-ai-content-generator"),isEnabled:L=>L.generateImages},{key:"featured",label:k("Featured","gpt3-ai-content-generator"),isEnabled:L=>L.generateFeatured},{key:"save",label:k("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],s={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},l=(L,O)=>({customTitlePrompt:String(L.custom_title_prompt||"").trim(),generateMeta:L.generate_meta_description==="1",generateFocus:L.generate_focus_keyword==="1",generateExcerpt:L.generate_excerpt==="1",generateTags:L.generate_tags==="1",generateImages:O.generate_images_enabled==="1",generateFeatured:O.generate_featured_image==="1"}),c=L=>{let O={};return a.forEach(D=>{O[D.key]=D.isEnabled(L)?"waiting":"skipped"}),O},o=(L,O)=>{let D=document.createElement("span");D.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${O}`,D.dataset.step=L.key,D.dataset.status=O;let R=document.createElement("span");R.className="aipkit_cw_batch_step_label",R.textContent=L.label;let Z=document.createElement("span");return Z.className="aipkit_cw_batch_step_status",Z.textContent=t[O]||O,D.appendChild(R),D.appendChild(Z),{wrapper:D,status:Z}},e=(L,O,D)=>{E(L,O,D)},i=L=>{L?.phases&&Object.keys(L.phases).forEach(O=>{let D=L.phases[O],R=D.dataset.status;R==="done"||R==="skipped"||(D.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",D.dataset.status="error")})},d=()=>{let L=document.getElementById("aipkit_content_writer_container");if(!L)return null;let O=L.querySelector("#aipkit_cw_batch_queue"),D=O?O.querySelector(".aipkit_cw_batch_list"):null,R=O?O.querySelector(".aipkit_cw_batch_count"):null,Z=O?O.querySelector(".aipkit_cw_batch_progress"):null,J=O?O.querySelector(".aipkit_cw_batch_progress_bar"):null,pe=L.querySelector("#aipkit_content_writer_form_status"),Ce=L.querySelector("#aipkit_content_writer_generate_btn"),He=L.querySelector(".aipkit_cw_generate_toggle"),Ke=L.querySelector(".aipkit_cw_generate_menu"),nt=Ke?Array.from(Ke.querySelectorAll(".aipkit_cw_generate_menu_item")):[],mt=L.querySelector("#aipkit_content_writer_stop_btn");return{container:L,queue:O,list:D,count:R,progress:Z,progressBar:J,status:pe,generateBtn:Ce,generateToggle:He,generateMenu:Ke,generateMenuItems:nt,stopBtn:mt}},u=()=>{s.totals.processed=0,s.totals.completed=0,s.totals.failed=0},p=()=>{let L=d();if(!L||!L.count||!L.progressBar||!L.progress)return;let O=s.items.length,D=s.totals.completed;L.count.textContent=`${D}/${O}`;let R=O>0?Math.round(D/O*100):0;L.progressBar.style.width=`${R}%`,L.progress.setAttribute("aria-valuenow",String(R))},f=(L,O)=>{let D=d();!D||!D.status||(D.status.textContent=L||"",D.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),O&&D.status.classList.add(`aipkit_settings_message-${O}`))},m=()=>{let L=d();!L||!L.list||(L.list.innerHTML="",s.rows=[],s.items=[],u(),p())},g=()=>{let L=d();L?.queue&&(L.queue.hidden=!1)},_=()=>{let L=d();L?.queue&&(L.queue.hidden=!0)},w=(L,O)=>{let D=document.createElement("div");D.className="aipkit_cw_batch_row";let R=document.createElement("div");R.className="aipkit_cw_batch_row_content";let Z=document.createElement("span");Z.className="aipkit_cw_batch_topic",Z.textContent=L.topic||"";let J=document.createElement("div");J.className="aipkit_cw_batch_phases";let pe={},Ce=c(O),He={};n.forEach(ge=>{let se=ge.steps.some(Se=>{let je=a.find(bt=>bt.key===Se);return je&&je.isEnabled(O)});if(!ge.isEnabled(O)&&!se)return;let ae=document.createElement("span");ae.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",ae.dataset.phase=ge.key,ae.dataset.status="waiting",ae.setAttribute("title",ge.label),ae.setAttribute("aria-label",ge.label),J.appendChild(ae),pe[ge.key]=ae,ge.steps.forEach(Se=>{He[Se]={wrapper:ae,phaseKey:ge.key,status:{textContent:""}}})});let Ke=document.createElement("span");Ke.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",Ke.textContent=k("Waiting","gpt3-ai-content-generator");let nt=document.createElement("span");nt.className="aipkit_cw_batch_error",nt.hidden=!0;let mt=document.createElement("a");mt.className="aipkit_cw_batch_view",mt.textContent=k("View","gpt3-ai-content-generator"),mt.target="_blank",mt.rel="noopener noreferrer",mt.hidden=!0;let wt=document.createElement("span");return wt.className="aipkit_cw_batch_summary_text",R.appendChild(Z),R.appendChild(J),R.appendChild(Ke),R.appendChild(nt),R.appendChild(mt),D.appendChild(R),{row:D,topic:Z,summary:wt,status:Ke,error:nt,view:mt,phases:pe,steps:He}},h=L=>{let O=a.find(D=>D.key===L);return O?O.label:L},E=(L,O,D)=>{if(!L?.phases)return;let R=n.find(J=>J.steps.includes(O));if(!R)return;let Z=L.phases[R.key];Z&&(D==="running"?(Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",Z.dataset.status="running",L.status&&(L.status.textContent=`${R.label} \xB7 ${h(O)}`)):D==="done"?(Z.dataset.status==="running"||O===R.steps[R.steps.length-1])&&(Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",Z.dataset.status="done"):D==="error"&&(Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",Z.dataset.status="error"))},x=(L,O)=>{let D=d();!D||!D.list||(D.list.innerHTML="",s.rows=L.map(R=>{let Z=w(R,O);return D.list.appendChild(Z.row),Z}))},v=(L,O,D={})=>{if(!L)return;L.row.classList.toggle("is-active",O==="running"),L.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${O}`;let R={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Generating","gpt3-ai-content-generator"),success:k("Done","gpt3-ai-content-generator"),error:k("Failed","gpt3-ai-content-generator"),stopped:k("Stopped","gpt3-ai-content-generator")};if(L.status.textContent=R[O]||O,L.error&&(L.error.hidden=!0,L.error.textContent="",L.error.removeAttribute("title")),O==="success"&&L.phases&&Object.keys(L.phases).forEach(Z=>{let J=L.phases[Z];J.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",J.dataset.status="done"}),D.summary!==void 0&&(L.summary.textContent=D.summary||""),D.viewLink?(L.view.href=D.viewLink,L.view.hidden=!1):O!=="success"&&(L.view.hidden=!0),O==="error"&&L.error){let Z=P(D.summary);Z&&(L.error.textContent=Z,L.error.title=I(D.summary),L.error.hidden=!1)}},I=L=>String(L||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),P=L=>{let O=I(L);return O?O.length>140?`${O.slice(0,137)}\u2026`:O:""},b=(L,O)=>{let D=I(O||L);return D?D.length>140?`${D.slice(0,140)}\u2026`:D:""},y=L=>{let O=new FormData(L),D=Object.fromEntries(O.entries()),R=L.elements["openai_vector_store_ids[]"];D.openai_vector_store_ids=R?Array.from(R.selectedOptions).map(J=>J.value):[],delete D["openai_vector_store_ids[]"];let Z=document.getElementById("aipkit_content_writer_nonce");return Z&&Z.value&&(D._ajax_nonce=Z.value),D},S=L=>{let O=L.elements["post_categories[]"],D=O?Array.from(O.selectedOptions).map(Z=>Z.value):[],R=L.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:L.elements.ai_provider?.value||"",ai_model:L.elements.ai_model?.value||"",ai_temperature:L.elements.ai_temperature?.value||"",reasoning_effort:L.elements.reasoning_effort?.value||"",cw_generation_mode:L.elements.cw_generation_mode?.value||"",post_type:L.elements.post_type?.value||"post",post_author:L.elements.post_author?.value||"",post_status:L.elements.post_status?.value||"draft",post_schedule_date:L.elements.post_schedule_date?.value||"",post_schedule_time:L.elements.post_schedule_time?.value||"",schedule_mode:R,smart_schedule_start_datetime:L.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:L.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:L.elements.smart_schedule_interval_unit?.value||"",post_categories:D,generate_toc:L.elements.generate_toc?.checked?"1":"0",generate_seo_slug:L.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:L.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:L.elements.generate_featured_image?.checked?"1":"0",image_provider:L.elements.image_provider?.value||"",image_model:L.elements.image_model?.value||"",image_prompt:L.elements.image_prompt?.value||"",featured_image_prompt:L.elements.featured_image_prompt?.value||"",image_count:L.elements.image_count?.value||"1",image_placement:L.elements.image_placement?.value||"after_first_h2",image_placement_param_x:L.elements.image_placement_param_x?.value||"",image_alignment:L.elements.image_alignment?.value||"none",image_size:L.elements.image_size?.value||"large",pexels_orientation:L.elements.pexels_orientation?.value||"",pexels_size:L.elements.pexels_size?.value||"",pexels_color:L.elements.pexels_color?.value||"",pixabay_orientation:L.elements.pixabay_orientation?.value||"",pixabay_image_type:L.elements.pixabay_image_type?.value||"",pixabay_category:L.elements.pixabay_category?.value||"",generate_image_title:L.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:L.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:L.elements.generate_image_caption?.checked?"1":"0",generate_image_description:L.elements.generate_image_description?.checked?"1":"0",image_title_prompt:L.elements.image_title_prompt?.value||"",image_alt_text_prompt:L.elements.image_alt_text_prompt?.value||"",image_caption_prompt:L.elements.image_caption_prompt?.value||"",image_description_prompt:L.elements.image_description_prompt?.value||""}},C=(L,O)=>{let D=O.content_title||O.topic||"",R=O.inline_keywords||O.keywords||"",Z=R?`${D} | ${R}`:D,J={...L,content_title:Z};return O.rss_description&&(J.rss_description=O.rss_description),O.source_url&&(J.source_url=O.source_url),O.url_content_context&&(J.url_content_context=O.url_content_context),{data:J,topic:D,keywords:R}},A=(L,O,D,R,Z,J,pe)=>({original_topic:O,final_title:D,post_title:D,keywords:R,excerpt:Z||"",image_provider:L.image_provider,image_model:L.image_model,image_prompt:L.image_prompt,image_alignment:L.image_alignment,image_size:L.image_size,featured_image_prompt:L.featured_image_prompt,pexels_orientation:L.pexels_orientation,pexels_size:L.pexels_size,pexels_color:L.pexels_color,pixabay_orientation:L.pixabay_orientation,pixabay_image_type:L.pixabay_image_type,pixabay_category:L.pixabay_category,generate_image_title:L.generate_image_title,generate_image_alt_text:L.generate_image_alt_text,generate_image_caption:L.generate_image_caption,generate_image_description:L.generate_image_description,image_title_prompt:L.image_title_prompt,image_alt_text_prompt:L.image_alt_text_prompt,image_caption_prompt:L.image_caption_prompt,image_description_prompt:L.image_description_prompt,ai_provider:L.ai_provider,ai_model:L.ai_model,ai_temperature:L.ai_temperature,reasoning_effort:L.reasoning_effort,cw_generation_mode:L.cw_generation_mode,_ajax_nonce:J,generate_images_enabled:L.generate_images_enabled,image_count:L.image_count,generate_featured_image:L.generate_featured_image,image_placement:L.image_placement,image_placement_param_x:L.image_placement_param_x,conversation_uuid:pe}),M=(L,O,D,R,Z,J,pe)=>{let Ce=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,He=Ce?Ce.render(R):R,Ke=Array.isArray(O.post_categories)&&O.post_categories.length?O.post_categories:L.post_categories;return{post_title:D,post_content:He,generated_excerpt:Z.excerpt||"",generated_tags:Z.tags||"",meta_description:Z.meta_description||"",focus_keyword:Z.focus_keyword||"",post_type:O.post_type||L.post_type,post_author:O.post_author||L.post_author,post_status:L.post_status,post_schedule_date:O.post_schedule_date||L.post_schedule_date,post_schedule_time:O.post_schedule_time||L.post_schedule_time,post_categories:Ke,generate_toc:L.generate_toc,generate_seo_slug:L.generate_seo_slug,image_data:J?JSON.stringify(J):"",image_alignment:L.image_alignment,image_size:L.image_size,_ajax_nonce:pe}},$=async(L,O,D,R,Z)=>{let J=L.item_config||{},{data:pe,topic:Ce,keywords:He}=C(O,J),Ke=Ce,nt=pe.conversation_uuid||void 0;if(!!String(pe.custom_title_prompt||"").trim()){e(R,"title","running");let bt=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...pe,conversation_uuid:nt});if(!bt?.new_title)throw new Error(k("Title generation failed","gpt3-ai-content-generator"));Ke=bt.new_title,nt=bt.conversation_uuid||nt,e(R,"title","done")}else e(R,"title","skipped");e(R,"content","running");let ge=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...pe,conversation_uuid:nt});if(!ge?.content)throw new Error(k("Content generation failed","gpt3-ai-content-generator"));e(R,"content","done"),nt=ge.conversation_uuid||nt||void 0,e(R,"meta",Z.generateMeta?"done":"skipped"),e(R,"focus",Z.generateFocus?"done":"skipped"),e(R,"excerpt",Z.generateExcerpt?"done":"skipped"),e(R,"tags",Z.generateTags?"done":"skipped");let se=null;if(D.generate_images_enabled==="1"||D.generate_featured_image==="1"){Z.generateImages&&e(R,"image","running"),Z.generateFeatured&&e(R,"featured","running");let bt=ge.focus_keyword||He||O.content_keywords||"",re=A(D,Ce,Ke,bt,ge.excerpt||"",O._ajax_nonce,nt),ve=D.generate_images_enabled==="1",Ee=D.generate_featured_image==="1",Fe=ve&&Ee,Be=async(Ve={})=>{let Je=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...re,...Ve});if(!Je?.image_data)throw new Error(k("Image generation failed","gpt3-ai-content-generator"));return Je.image_data};if(Fe){let Ve=null,Je=Ze=>{Ve||(Ve={...Ze,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(ve){let Ze=await Be({generate_featured_image:"0"});Je(Ze),Array.isArray(Ze.in_content_images)&&Ve.in_content_images.push(...Ze.in_content_images),Z.generateImages&&e(R,"image","done")}if(Ee){let Ze=await Be({generate_images_enabled:"0",image_count:0});Je(Ze),Ze.featured_image_id&&(Ve.featured_image_id=Ze.featured_image_id),Ze.featured_image_url&&(Ve.featured_image_url=Ze.featured_image_url),Z.generateFeatured&&e(R,"featured","done")}se=Ve}else se=await Be(),Z.generateImages&&e(R,"image","done"),Z.generateFeatured&&e(R,"featured","done")}else e(R,"image","skipped"),e(R,"featured","skipped");e(R,"save","running");let Se=M(D,J,Ke,ge.content,ge,se,O._ajax_nonce),je=await window.aipkit_apiRequest("aipkit_content_writer_save_post",Se);return e(R,"save","done"),{summary:b(ge.content,ge.excerpt),viewLink:je.view_link||je.edit_link}},W=()=>{let L=d();s.active=!1,s.stopRequested=!1,L?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():L.generateBtn.disabled=!1,L.generateBtn.removeAttribute("aria-disabled")),L?.generateToggle&&(L.generateToggle.disabled=!1,L.generateToggle.removeAttribute("aria-disabled")),L?.generateMenuItems?.length&&L.generateMenuItems.forEach(O=>{O.disabled=!1,O.removeAttribute("aria-disabled")}),L?.stopBtn&&(L.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},H=()=>{s.active&&(s.stopRequested=!0,f(k("Stopping...","gpt3-ai-content-generator"),"info"))},N=L=>{s.items.slice(L).forEach((O,D)=>{let R=s.rows[L+D];v(R,"stopped")})},G=async()=>{for(let D=0;D<s.items.length;D+=1){if(s.stopRequested){N(D);break}let R=s.rows[D];v(R,"running");try{let Z=await $(s.items[D],s.baseData,s.postConfig,R,s.stepContext);v(R,"success",Z),s.totals.completed+=1}catch(Z){i(R),v(R,"error",{summary:Z?.message||k("Failed","gpt3-ai-content-generator")}),s.totals.failed+=1}s.totals.processed+=1,p()}let L=s.items.length,O=s.totals.completed;s.stopRequested?f(k("Generation stopped.","gpt3-ai-content-generator"),"error"):f(`${O}/${L} ${k("completed","gpt3-ai-content-generator")}`,"success"),W()},Q=async(L,O)=>{if(!L||!O)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let D=d();if(!D?.generateBtn)return;if(s.active){f(k("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let R=y(L),Z=S(L),J=l(R,Z);try{s.active=!0,s.stopRequested=!1,u(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(D.generateBtn,!0,k("Generate","gpt3-ai-content-generator"),k("Preparing\u2026","gpt3-ai-content-generator")):D.generateBtn.disabled=!0,D.queue&&(D.queue.dataset.cwMode=O),f(k("Preparing items\u2026","gpt3-ai-content-generator"),"info");let pe=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...R,cw_generation_mode:O}),Ce=Array.isArray(pe.items)?pe.items:[];if(!Ce.length){f(k("No items found to generate.","gpt3-ai-content-generator"),"error"),W();return}m(),s.items=Ce.slice(0,r),s.baseData=R,s.postConfig=Z,s.stepContext=J,x(s.items,J),g(),p(),f(k("Generating content\u2026","gpt3-ai-content-generator"),"info"),await G()}catch(pe){f(pe?.message||k("Batch generation failed.","gpt3-ai-content-generator"),"error"),W()}},F=()=>{s.active=!1,s.stopRequested=!1,m(),_()};window.aipkit_cw_handleBatchGeneration=Q,window.aipkit_cw_resetBatchQueue=F,window.aipkit_cw_requestBatchStop=H,window.aipkit_cw_isBatchActive=()=>s.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t},r=window.wp?.i18n?.__||function(t){return t};function n(t,a){let s=t.value,l=s?s.toLowerCase():"",c=window.aipkit_dashboard?.models;if(!a){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!c){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),a.innerHTML='<option value="">'+k("Error: Model data object not found")+"</option>",a.disabled=!0;return}let o=c[l];(typeof o>"u"||o===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${l}'. Defaulting to empty.`),o=l==="openai"?{}:[]),a.innerHTML="";let e=window.aipkit_dashboard?.recommendedModels?.[l]||[],i=Array.isArray(e)?e:[],d=new Set(i.map(u=>u?.id).filter(Boolean));if(l==="openai"&&typeof o=="object"&&!Array.isArray(o)){if(i.length>0){let u=document.createElement("optgroup");u.label=k(r("Recommended","gpt3-ai-content-generator")),i.forEach(p=>{if(p&&typeof p=="object"&&p.id){let f=new Option(k(p.name||p.id),p.id);u.appendChild(f)}}),u.children.length>0&&a.appendChild(u)}Object.keys(o).forEach(u=>{let p=document.createElement("optgroup");p.label=k(u);let f=o[u];Array.isArray(f)?f.forEach(m=>{if(!(m&&typeof m=="object"&&m.id&&d.has(m.id)))if(m&&typeof m=="object"&&m.id){let g=new Option(k(m.name||m.id),m.id);p.appendChild(g)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${u}':`,m)}):console.warn(`Content Writer Model Populator: Items for group '${u}' under '${l}' is not an array.`),p.children.length>0&&a.appendChild(p)})}else if(Array.isArray(o)){if(i.length>0){let p=document.createElement("optgroup");p.label=k(r("Recommended","gpt3-ai-content-generator")),i.forEach(f=>{if(f&&typeof f=="object"&&f.id){let m=new Option(k(f.name||f.id),f.id);p.appendChild(m)}}),p.children.length>0&&a.appendChild(p)}let u=i.length>0?document.createElement("optgroup"):null;u&&(u.label=k(r("All models","gpt3-ai-content-generator"))),o.forEach(p=>{if(!(p&&typeof p=="object"&&p.id&&d.has(p.id)))if(p&&typeof p=="object"&&p.id){let f=new Option(k(p.name||p.id),p.id);u?u.appendChild(f):a.appendChild(f)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${l}':`,p)}),u&&u.children.length>0&&a.appendChild(u)}else console.warn(`Content Writer Model Populator: Data for provider '${l}' is not in expected format. Actual type: ${typeof o}`),a.appendChild(new Option(k(`No models for ${s} (Format Error)`),""));if(!a.options||typeof a.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),a.appendChild(new Option(k("Error loading models"),"")),a.disabled=!0;else if(a.options.length===0)a.appendChild(new Option(k(`No models for ${s} (Sync in settings)`),"")),a.disabled=!0;else{a.disabled=!1;let u=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let p=window.aipkit_cw_template_state.pendingModelSelection;a.querySelector(`option[value="${CSS.escape(p)}"]`)?u=p:console.warn(`Content Writer Model Populator: Pending model '${p}' not found in new list for provider '${s}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(u===null){let p=a.querySelector("optgroup");p&&p.options&&p.options.length>0&&p.options[0].value?u=p.options[0].value:a.options&&a.options.length>0&&a.options[0].value?u=a.options[0].value:u=""}a.value=u}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let u=document.getElementById("aipkit_content_writer_container");u&&window.aipkit_cw_toggleReasoningEffort(u)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(d){return d},r=d=>d&&d!=="single"?d:"task",n=d=>typeof d=="string"&&d.startsWith("existing"),t=d=>d==="existing"?"existing-content":d,a={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},s=d=>{let u=document.getElementById("aipkit_content_writer_container");if(!u)return;let p=u.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!p.length)return;let f=a[d]||null;p.forEach(m=>{let g=m.dataset.promptKey,_=m.querySelector(".aipkit_prompt_toggle_label"),w=m.querySelector(".aipkit_prompt_toggle_desc");if(!_||!w)return;m.dataset.defaultLabel||(m.dataset.defaultLabel=_.textContent||""),m.dataset.defaultDesc||(m.dataset.defaultDesc=w.textContent||"");let h=f&&g?f[g]:null;h?(_.textContent=h.label,w.textContent=h.desc):(_.textContent=m.dataset.defaultLabel,w.textContent=m.dataset.defaultDesc)})},l=d=>{let u=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!u.length)return;let p=d==="existing-images",f=d==="existing-products";u.forEach(m=>{let g=m.querySelector(".aipkit_cw_prompt_panel"),_=m.querySelector(".aipkit_cw_prompt_editor_title");if(!g||!_)return;if(!m.dataset.defaultTitle){let h=_.textContent||g.getAttribute("aria-label")||"";m.dataset.defaultTitle=h}let w=m.dataset.defaultTitle||"";p&&m.dataset.existingImagesTitle?w=m.dataset.existingImagesTitle:f&&m.dataset.existingProductsTitle&&(w=m.dataset.existingProductsTitle),w&&(_.textContent=w,g.setAttribute("aria-label",w))})};function c(d){if(!document.getElementById("aipkit_content_writer_form"))return;let p=r(d),f=t(p),m=document.getElementById("aipkit_cw_single_output_wrapper");m&&f!=="task"&&(m.style.display="none");let g=document.getElementById("aipkit_cw_output_card");if(g){let h=m&&m.style.display!=="none";g.style.display=f==="task"&&h?"block":"none"}let _=document.getElementById("aipkit_cw_content_prompt_placeholders");if(_){let h="Use placeholders: {topic}, {keywords}",E=n(f);f==="rss"?h+=", {description}, {source_url}":f==="url"&&(h+=", {url_content}"),h+=".";let x=h.replace(/(\{[a-zA-Z0-9_]+\})/g,v=>`<code class="aipkit-placeholder" title="Click to copy">${k(v)}</code>`);_.innerHTML=x,_.hidden=E}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(f),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(f);let w=document.getElementById("aipkit_cw_batch_queue");if(w){let h=w.querySelector(".aipkit_cw_batch_list"),E=h?h.children.length>0:!1,x=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();w.hidden=!(x||E)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),f.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function o(d){let u=document.getElementById("aipkit_content_writer_form");if(!u)return;let p=document.getElementById("aipkit_content_writer_generate_btn"),f=p?p.querySelector(".aipkit_btn-text"):null,m=p?p.querySelector(".aipkit_cw_task_suffix"):null,g=document.querySelector(".aipkit_cw_post_summary_trigger"),_=document.querySelector(".aipkit_cw_generate_split"),w=_?_.querySelector(".aipkit_cw_generate_toggle"):null,h=_?_.querySelector(".aipkit_cw_generate_menu"):null,E=u.querySelector("#aipkit_cw_task_frequency"),x=h?Array.from(h.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],v=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,I=new Set(["task","csv","rss","gsheets","url"]),P=new Set(["rss","gsheets","url"]),b=r(d||document.getElementById("aipkit_cw_mode_select")?.value||"task");b=t(b);let y=n(b),S=b==="existing-images",C=b==="existing-products",A=b==="existing-content",M=I.has(b),$=P.has(b),W=M&&(!$||v),H=b==="task"||b==="csv";u.classList.toggle("aipkit_cw_mode_existing",y),u.classList.toggle("aipkit_cw_mode_existing_images",S),u.classList.toggle("aipkit_cw_mode_existing_products",C),u.classList.toggle("aipkit_cw_mode_existing_content",A),u.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(D=>{D.classList.remove("aipkit-active"),D.setAttribute("aria-hidden","true")}),u.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(D=>D.setAttribute("aria-expanded","false")),u.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(D=>{let Z=D.dataset.aipkitCwModeOnly===b;D.hidden=!Z,D.setAttribute("aria-hidden",Z?"false":"true"),!Z&&D.classList.contains("aipkit_model_settings_popover")&&(D.classList.remove("aipkit-active"),D.setAttribute("aria-hidden","true")),!Z&&D.classList.contains("aipkit_cw_popover_trigger")&&D.setAttribute("aria-expanded","false")}),s(b),l(b),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!n)return;let D=window.aipkit_cw_template_state;if(!D)return;let Z=(Array.isArray(D.currentTemplates)?D.currentTemplates.find(J=>String(J.id)===String(D.currentTemplateId||"")):null)?.config||D.initialConfigForSelectedTemplate;!Z||typeof Z!="object"||["generate_title","generate_content"].forEach(J=>{if(!Object.prototype.hasOwnProperty.call(Z,J))return;let pe=u.elements[J];if(!pe)return;let Ce=Z[J];pe.checked=Ce==="1"||Ce===1||Ce===!0})})(),E&&H&&Array.from(E.options).some(R=>R.value==="one-time")&&E.value!=="one-time"&&(E.value="one-time");let G=!1;if(b==="rss"){let D=document.getElementById("aipkit_cw_rss_items_count");G=D&&parseInt(D.value,10)>0}let Q=_?.dataset?.aipkitCwAction||"generate";if(y?Q=!v&&C?"upgrade":"update":(M||(Q="generate"),!W&&$&&(Q="upgrade")),!y&&b==="rss"&&W?G?Q==="fetch_feeds"&&(Q="generate"):Q="fetch_feeds":Q==="fetch_feeds"&&(Q="generate"),!y&&Q==="create_task"&&!W&&(Q="generate"),!y&&W&&Q!=="generate"&&Q!=="create_task"&&Q!=="fetch_feeds"&&(Q="generate"),_&&(_.dataset.aipkitCwAction=Q),x.forEach(D=>{let R=D.dataset.action||"generate",Z=!M||$&&!v||y;R==="create_task"&&(D.hidden=Z);let J=R===Q;D.classList.toggle("is-active",J),D.setAttribute("aria-checked",J?"true":"false")}),w){let D=W&&!y&&!(b==="rss"&&!G);w.style.display=D?"":"none",w.disabled=!D}h&&(h.dataset.keepOpen==="true"||(h.hidden=!0),h.dataset.keepOpen="false"),_&&_.classList.toggle("is-single",!W||b==="rss"&&!G);let L={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[Q]||"Generate";if(f?f.textContent=L:p&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(p,L):p.textContent=L),p&&(p.dataset.action=Q,y||(p.removeAttribute("aria-disabled"),p.dataset.aipkitExistingDisabled&&(p.disabled=!1,delete p.dataset.aipkitExistingDisabled))),m)if(Q==="create_task"&&E&&!H){let D=E.options[E.selectedIndex],R=D?D.text:"";R?(m.textContent=` / ${R}`,m.hidden=!1):(m.textContent="",m.hidden=!0)}else m.textContent="",m.hidden=!0;if(g&&(g.hidden=y,g.setAttribute("aria-hidden",y?"true":"false"),y&&g.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}p?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&(Q!=="generate"||!M)&&window.aipkit_cw_resetBatchQueue()}let e={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function i(d){if(!d){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let u=d.querySelector("#aipkit_cw_mode_select"),p=Array.from(d.querySelectorAll(".aipkit_cw_mode_card")),f=Array.from(d.querySelectorAll(".aipkit_cw_bulk_source_tab")),m=Array.from(d.querySelectorAll("[data-aipkit-bulk-source-panel]")),g=d.querySelector(".aipkit_cw_tab_content_container"),_=d.querySelector("[data-aipkit-source-selector]"),w=_?.querySelector("[data-aipkit-source-trigger]"),h=_?.querySelector(".aipkit_cw_source_menu"),E=h?Array.from(h.querySelectorAll(".aipkit_cw_source_option")):[],x=w?.querySelector("[data-source-label]"),v=w?.querySelector("[data-source-icon]");if(!u||!g){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let I=A=>{p.length&&p.forEach(M=>{let $=M.dataset.mode===A;M.classList.toggle("is-active",$),M.setAttribute("aria-pressed",$?"true":"false")})},P=A=>{!f.length||!m.length||(f.forEach(M=>{let $=M.dataset.source===A;M.classList.toggle("is-active",$),M.setAttribute("aria-pressed",$?"true":"false")}),m.forEach(M=>{let $=M.dataset.aipkitBulkSourcePanel===A;M.classList.toggle("is-hidden",!$),M.hidden=!$,M.setAttribute("aria-hidden",$?"false":"true")}))},b=A=>{if(!E.length)return;let M=t(A),$=n(M);E.forEach(H=>{let N=H.dataset.source===M;H.classList.toggle("is-active",N),H.setAttribute("aria-selected",N?"true":"false")});let W=e[M]||e.task;if(x&&(x.dataset.defaultLabel||(x.dataset.defaultLabel=x.textContent||""),x.textContent=$?W.label:x.dataset.defaultLabel),v){let H=v.querySelector(".dashicons");if(H&&!v.dataset.defaultIcon){let N=H.className.split(" ").find(G=>G!=="dashicons");v.dataset.defaultIcon=N||"dashicons-plus-alt2"}if(H){let N=$?W.icon:v.dataset.defaultIcon||"dashicons-plus-alt2";H.className="dashicons "+N}v.dataset.sourceIcon=$?M:"more"}w&&w.classList.toggle("is-active",$)},y=(A=!1)=>{if(!h||!w)return;let M=w.getAttribute("aria-expanded")==="true",$=A||M;w.setAttribute("aria-expanded",$?"false":"true"),h.hidden=$},S=A=>{let M=r(A),$=t(M),W=$.startsWith("existing")?"existing":$;u.value!==M&&(u.value=M),g.querySelectorAll(".aipkit_cw_tab_content").forEach(H=>{H.classList.toggle("aipkit_active",H.dataset.pane===W)}),I($),P(M==="csv"?"csv":"task"),b($),c($)};u.addEventListener("change",function(A){S(A.target.value)}),w&&w.addEventListener("click",A=>{A.stopPropagation(),y()}),E.length&&E.forEach(A=>{A.addEventListener("click",()=>{let M=A.dataset.source||"task";u.value!==M&&(u.value=M,u.dispatchEvent(new Event("change",{bubbles:!0}))),y(!0)})}),document.addEventListener("click",A=>{_&&!_.contains(A.target)&&y(!0)}),document.addEventListener("keydown",A=>{A.key==="Escape"&&h&&!h.hidden&&(y(!0),w?.focus())}),p.length&&p.forEach(A=>{A.dataset.listenerAttached||(A.addEventListener("click",()=>{let M=A.dataset.mode||"task";u.value!==M&&(u.value=M,u.dispatchEvent(new Event("change",{bubbles:!0})))}),A.dataset.listenerAttached="true")}),f.length&&f.forEach(A=>{A.dataset.listenerAttached||(A.addEventListener("click",()=>{let $=(A.dataset.source||"task")==="csv"?"csv":"task";u.value!==$&&(u.value=$,u.dispatchEvent(new Event("change",{bubbles:!0})))}),A.dataset.listenerAttached="true")});let C=u.value||"task";S(C==="single"?"task":C)}window.aipkit_initContentWriterTabs=i,window.aipkit_updateContentWriterActionState=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(g){return String(g||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},r=["keyword","title","excerpt","content","meta","tags"],n={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},a={"existing-content":{fieldOrder:r,fieldLabels:n,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:r,fieldLabels:n,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},s=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],l=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],c={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},o=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],e=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],i={short:2e3,medium:4e3,long:6e3},d=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,u=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",p=2400;function f(g=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(g);return}window.aipkit_cw_existing_pendingFetch=g}function m(g){if(!g)return;let _=g.querySelector("[data-aipkit-existing-panel]");if(!_||_.dataset.init==="true")return;let w=_.querySelector("#aipkit_cw_existing_post_type"),h=_.querySelector("#aipkit_cw_existing_post_status"),E=_.querySelector("#aipkit_cw_existing_media_filter"),x=_.querySelector("#aipkit_cw_existing_search"),v=_.querySelector("#aipkit_cw_existing_refresh"),I=_.querySelector("#aipkit_cw_existing_select_all"),P=_.querySelector("#aipkit_cw_existing_posts_body"),b=_.querySelector("#aipkit_cw_existing_page_status"),y=_.querySelector("#aipkit_cw_existing_page_prev"),S=_.querySelector("#aipkit_cw_existing_page_next"),C=_.querySelector("#aipkit_cw_existing_selected_count"),A=document.getElementById("aipkit_content_writer_generate_btn")||_.querySelector("#aipkit_cw_existing_open_assistant"),M=document.getElementById("aipkit_cw_mode_select");if(!P)return;let $=document.getElementById("aipkit_content_writer_nonce"),W=10,H=1,N=1,G=null,Q=!1,F=!1,L=!1,O=[],D=new Set,R=new Map,Z=w?w.value:"",J=!1,pe=A?A.querySelector(".aipkit_btn-text"):null,Ce=A&&A.dataset.action||"generate",He=ke=>ke?ke==="existing"?"existing-content":ke.indexOf("existing-")===0?ke:"":"",Ke=()=>He(M?M.value:""),nt=()=>a[Ke()]||a["existing-content"],mt=()=>!!Ke(),wt=document.getElementById("aipkit_content_writer_form_status"),ge="",se=null,ae=()=>{se&&(clearTimeout(se),se=null)},Se=(ke,Le)=>{wt&&(ae(),wt.textContent=ke||"",wt.className="aipkit_cw_status_badge",Le==="info"?wt.classList.add("aipkit_settings_message-info"):Le==="error"?wt.classList.add("aipkit_settings_message-error"):Le==="success"&&wt.classList.add("aipkit_settings_message-success"),ke?wt.dataset.cwUpdateStatus="1":delete wt.dataset.cwUpdateStatus)},je=()=>{F&&(L=!0,Se("Stopping...","info"))},bt=()=>{wt&&(ae(),se=setTimeout(()=>{wt.dataset.cwUpdateStatus==="1"&&Se("","")},4e3))},re=ke=>{if(!wt){ge="";return}if(!ke){wt.dataset.cwProNotice==="1"&&(!ge||wt.textContent.startsWith(ge))&&(wt.textContent="",wt.className="aipkit_cw_status_badge"),delete wt.dataset.cwProNotice,ge="";return}let Le=u?` <a class="aipkit_popover_upgrade_link" href="${k(u)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";ge=ke,wt.dataset.cwProNotice="1",wt.className="aipkit_cw_status_badge aipkit_settings_message-info",wt.innerHTML=`${k(ke)}${Le}`};if(w&&!d){let ke=w.querySelector('option[value="product"]');ke&&!ke.dataset.proLabel&&(ke.dataset.proLabel=ke.textContent||"Products")}let ve=ke=>{J=!!ke,A&&(A.dataset.action=J?"upgrade":Ce,pe&&mt()&&(pe.textContent=J?"Upgrade":"Update"))},Ee=ke=>{let Le=[],Oe=[];return ke.forEach(qt=>{let ot=O.find(Tt=>Number(Tt.id)===qt);ot&&ot.type==="product"?Le.push(qt):Oe.push(qt)}),{productIds:Le,otherIds:Oe}},Fe=()=>{if(!mt()||Ke()!=="existing-content"){ve(!1),re("");return}if(d){ve(!1),re("");return}let ke=Array.from(D),{productIds:Le,otherIds:Oe}=Ee(ke);if(w&&w.value==="product"){ve(!0);return}if(Le.length&&!Oe.length){ve(!0);return}if(Le.length&&Oe.length){ve(!1);return}ve(!1),re("")},Be=ke=>{P&&(P.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${k(ke)}</td>
        </tr>
      `,Ve())},Ve=()=>{let ke=D.size;if(Fe(),C&&(C.textContent=`${ke} selected`),A&&mt()){let Le=J?F:ke===0||F;A.disabled=Le,A.setAttribute("aria-disabled",Le?"true":"false"),Le?A.dataset.aipkitExistingDisabled="true":delete A.dataset.aipkitExistingDisabled}if(I){let Le=O.length>0&&O.every(Oe=>D.has(Oe.id));I.checked=Le}},Je=()=>{b&&(b.textContent=`Page ${H} of ${N}`),y&&(y.disabled=H<=1),S&&(S.disabled=H>=N)},Ze=(ke,Le)=>{if(O=Array.isArray(ke)?ke:[],H=Le?.page||1,N=Le?.total_pages||1,!O.length){Be("No posts found."),Je(),Ve();return}let Oe=Ke()==="existing-images",qt=O.map(ot=>{let Tt=Number(ot.id),fi=k(ot.title||"(Untitled)"),Ht=k(ot.edit_link||"#"),hi=k(ot.type_label||""),mi=k(ot.status_label||""),Bi=Oe?k(ot.alt_text||""):"",gi=Oe?k(ot.caption||""):"",ii=Oe?k(ot.description||""):"",ji=Oe?k(ot.thumb_url||""):"",Ne=D.has(Tt)?"checked":"",ui=k(ot.type||"post"),Hi=fi?` title="${fi}"`:"",En=Bi?` title="${Bi}"`:"",Do=gi?` title="${gi}"`:"",Ao=ii?` title="${ii}"`:"",Wo=ji?`<span class="aipkit_cw_existing_thumb"><img src="${ji}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',gn=Oe?`
                <div class="aipkit_cw_existing_title_stack">
                  ${Wo}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${Ht}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${Ht}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${Tt}" data-post-type="${ui}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${Tt}" ${Ne}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${gn}
              </td>
              <td class="aipkit_cw_existing_col_type">${hi}</td>
              <td class="aipkit_cw_existing_col_status">${mi}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${En}>${Bi}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${Do}>${gi}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${Ao}>${ii}</span></td>
            </tr>
          `}).join("");P.innerHTML=qt,Je(),Ve()},Pt=ke=>{let Le=String(ke||"").trim();return Le||"(Untitled)"},Mi=(ke,Le)=>{let Oe=_.querySelector(`#post-${ke}`);if(!Oe)return;let qt=Oe.querySelector(".row-title");if(!qt)return;let ot=Pt(Le);qt.textContent=ot,qt.setAttribute("title",ot);let Tt=O.find(fi=>Number(fi.id)===ke);Tt&&(Tt.title=ot)},Qt=(ke,Le,Oe)=>{let qt=_.querySelector(`#post-${ke}`);if(!qt)return;let ot="",Tt="";if(Le==="keyword")ot=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",Tt="alt_text";else if(Le==="excerpt")ot=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",Tt="caption";else if(Le==="content")ot=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",Tt="description";else return;let fi=qt.querySelector(ot);if(!fi)return;let Ht=String(Oe||"").trim();fi.textContent=Ht,Ht?fi.setAttribute("title",Ht):fi.removeAttribute("title");let hi=O.find(mi=>Number(mi.id)===ke);hi&&Tt&&(hi[Tt]=Ht)},ti=ke=>{let Le=R.get(ke);Le&&(clearTimeout(Le),R.delete(ke))},gt=(ke,Le,Oe)=>{let qt=_.querySelector(`#post-${ke}`);if(!qt)return;let ot=qt.querySelector(".aipkit_cw_existing_status");if(ot){if(ti(ke),ot.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!Oe){ot.textContent="";return}ot.textContent=Oe,ot.classList.add("is-visible"),Le==="error"&&ot.classList.add("is-error"),Le==="success"&&ot.classList.add("is-success"),Le==="processing"&&ot.classList.add("is-processing"),Le==="queued"&&ot.classList.add("is-queued")}},tt=ke=>gt(ke,"",""),Ye=ke=>{ti(ke);let Le=setTimeout(()=>tt(ke),p);R.set(ke,Le)},ei=ke=>{if(F=ke,A&&mt()){let Le=A.dataset&&A.dataset.aipkitStopMode==="true",Oe=J?ke:D.size===0||ke&&!Le;A.disabled=Oe,A.setAttribute("aria-disabled",Oe?"true":"false"),Oe?A.dataset.aipkitExistingDisabled="true":delete A.dataset.aipkitExistingDisabled}if(v&&(v.disabled=ke),w){let Le=nt();w.disabled=ke||!!Le.postTypeOverride}h&&(h.disabled=ke),x&&(x.disabled=ke),y&&(y.disabled=ke||H<=1),S&&(S.disabled=ke||H>=N),I&&(I.disabled=ke),P.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Le=>{Le.disabled=ke})},li=()=>{let ke=nt();w&&(ke.postTypeOverride?(w.value=ke.postTypeOverride,w.disabled=!0):(w.disabled=!1,w.value=Z||"")),h&&ke.postTypeOverride==="attachment"&&(h.value="")},Jt=ke=>{!A||!mt()||A.dataset&&A.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(A,ke,"Update","Updating..."):A.disabled=ke)},Ut=(ke,Le)=>{let Oe=`${Le}_update`,qt=ke&&ke[Oe]||ke&&ke[Le]||"";return String(qt||"").trim()},Di=ke=>{let Le=document.getElementById("aipkit_content_writer_form");if(!Le||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let Oe=window.aipkit_getContentWriterFormConfig(Le),qt=!!ke.useImageMetadataPrompts;if(!d&&ke.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let ot=Ne=>qt?Ne==="title"?Oe.generate_image_title==="1":Ne==="keyword"?Oe.generate_image_alt_text==="1":Ne==="excerpt"?Oe.generate_image_caption==="1":Ne==="content"?Oe.generate_image_description==="1":!1:Ne==="meta"&&!ke.allowMeta||Ne==="tags"&&!ke.allowTags?!1:Ne==="title"?Oe.generate_title!=="0":Ne==="content"?Oe.generate_content!=="0":Ne==="meta"?Oe.generate_meta_description==="1":Ne==="keyword"?Oe.generate_focus_keyword==="1":Ne==="excerpt"?Oe.generate_excerpt==="1":Ne==="tags"?Oe.generate_tags==="1":!1,Tt=qt?{title:ot("title")?Ut(Oe,"image_title_prompt"):"",content:ot("content")?Ut(Oe,"image_description_prompt"):"",meta:"",keyword:ot("keyword")?Ut(Oe,"image_alt_text_prompt"):"",excerpt:ot("excerpt")?Ut(Oe,"image_caption_prompt"):"",tags:""}:{title:ot("title")?Ut(Oe,"custom_title_prompt"):"",content:ot("content")?Ut(Oe,"custom_content_prompt"):"",meta:ot("meta")?Ut(Oe,"custom_meta_prompt"):"",keyword:ot("keyword")?Ut(Oe,"custom_keyword_prompt"):"",excerpt:ot("excerpt")?Ut(Oe,"custom_excerpt_prompt"):"",tags:ot("tags")?Ut(Oe,"custom_tags_prompt"):""},fi=[],Ht=Ne=>ke.fieldLabels?.[Ne]||n[Ne]||Ne;if(ot("title")&&!Tt.title&&fi.push(`${Ht("title")} prompt is required.`),ot("content")&&!Tt.content&&fi.push(`${Ht("content")} prompt is required.`),ot("meta")&&!Tt.meta&&fi.push(`${Ht("meta")} prompt is required.`),ot("keyword")&&!Tt.keyword&&fi.push(`${Ht("keyword")} prompt is required.`),ot("excerpt")&&!Tt.excerpt&&fi.push(`${Ht("excerpt")} prompt is required.`),ot("tags")&&!Tt.tags&&fi.push(`${Ht("tags")} prompt is required.`),fi.length)return{error:fi.join(" ")};let hi=[],mi=(Ne,ui)=>ui.some(Hi=>Ne.includes(Hi)),Bi=Ne=>qt?o:ke.postTypeOverride==="product"&&c[Ne]||s;if(ke.fieldOrder.forEach(Ne=>{let ui=Tt[Ne];if(!ui)return;let Hi=Bi(Ne);mi(ui,Hi)||hi.push(`${Ht(Ne)} prompt: add one of ${Hi.join(", ")}.`)}),hi.length)return{error:`${qt?"Image optimization":ke.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${hi.join(`
`)}`};let gi=String(Oe.content_length||"medium"),ii=i[gi]||i.medium,ji={ai_provider:Oe.ai_provider||"openai",ai_model:Oe.ai_model||"",temperature:parseFloat(Oe.ai_temperature||"1"),max_tokens:ii,reasoning_effort:Oe.reasoning_effort||"",generate_seo_slug:ke.allowSlug&&Oe.generate_seo_slug||"0",enable_vector_store:Oe.enable_vector_store||"0",vector_store_provider:Oe.vector_store_provider||"openai",vector_store_top_k:Oe.vector_store_top_k||"3",openai_vector_store_ids:Oe.openai_vector_store_ids||[],pinecone_index_name:Oe.pinecone_index_name||"",qdrant_collection_name:Oe.qdrant_collection_name||"",vector_embedding_provider:Oe.vector_embedding_provider||"",vector_embedding_model:Oe.vector_embedding_model||""};return{prompts:Tt,baseConfig:ji}},xt=(ke,Le,Oe)=>({[ke]:{prompt:Le},ai_provider:Oe.ai_provider,ai_model:Oe.ai_model,temperature:Oe.temperature,max_tokens:Oe.max_tokens,reasoning_effort:Oe.reasoning_effort,enable_vector_store:Oe.enable_vector_store,vector_store_provider:Oe.vector_store_provider,vector_store_top_k:Oe.vector_store_top_k,openai_vector_store_ids:Oe.openai_vector_store_ids,pinecone_index_name:Oe.pinecone_index_name,qdrant_collection_name:Oe.qdrant_collection_name,vector_embedding_provider:Oe.vector_embedding_provider,vector_embedding_model:Oe.vector_embedding_model}),pi=async(ke=1)=>{if(!Q){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}Q=!0,Be("Loading posts...");try{let Oe=nt().postTypeOverride||(w?w.value:""),qt=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:$?$.value:"",post_type:Oe,post_status:h?h.value:"",media_filter:E?E.value:"",search:x?x.value.trim():"",paged:ke,per_page:W});Ze(qt.posts||[],qt.pagination||{})}catch(Le){console.error("Content Writer Existing: fetch failed",Le),Be("Unable to load posts. Please try again.")}finally{Q=!1}}},Wt=()=>{D.clear(),Ve()};P.addEventListener("change",ke=>{let Le=ke.target;if(!Le||!Le.classList.contains("aipkit_cw_existing_row_checkbox"))return;let Oe=Number(Le.value||0);Oe&&(Le.checked?D.add(Oe):D.delete(Oe),Ve())}),I&&I.addEventListener("change",()=>{let ke=I.checked;O.forEach(Oe=>{ke?D.add(Number(Oe.id)):D.delete(Number(Oe.id))}),P.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Oe=>{Oe.checked=ke}),Ve()}),y&&y.addEventListener("click",()=>{H>1&&pi(H-1)}),S&&S.addEventListener("click",()=>{H<N&&pi(H+1)}),v&&v.addEventListener("click",()=>{Wt(),pi(1)}),w&&w.addEventListener("change",()=>{nt().postTypeOverride||(Z=w.value),Wt(),pi(1)}),h&&h.addEventListener("change",()=>{Wt(),pi(1)}),E&&E.addEventListener("change",()=>{Wt(),pi(1)}),x&&x.addEventListener("input",()=>{G&&clearTimeout(G),G=setTimeout(()=>{Wt(),pi(1)},300)});let Wi=ke=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ke,{title:"Update existing"}):alert(ke)},Sn=()=>{let ke="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let Le=[];u&&Le.push({label:"Upgrade to Pro",href:u,className:"aipkit_btn aipkit_btn-primary"}),Le.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(ke,{title:"Optimize Images",actions:Le})}else alert(ke)},Ki=()=>{let ke="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let Le=[];u&&Le.push({label:"Upgrade to Pro",href:u,className:"aipkit_btn aipkit_btn-primary"}),Le.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(ke,{title:"Optimize Products",bullets:e,actions:Le})}else alert(ke)},ln=async(ke,Le,Oe,qt,ot)=>{let Tt=`cw-existing-${ke}-${Date.now()}`,fi=!1;if(L)return gt(ke,"","Stopped"),Ye(ke),{success:!1,stopped:!0};for(let Ht of ot.fieldOrder){let hi=Le[Ht];if(!hi)continue;if(L)return gt(ke,"","Stopped"),Ye(ke),{success:!1,stopped:!0};gt(ke,"processing",`Updating ${ot.fieldLabels[Ht]||Ht}...`);let mi=xt(Ht,hi,Oe),Bi={_ajax_nonce:qt,post_id:ke,field:Ht,enhancements:JSON.stringify(mi),conversation_uuid:Tt};try{let gi=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",Bi,{timeout:18e4});gi&&Object.prototype.hasOwnProperty.call(gi,"updated_value")&&(Ht==="title"?Mi(ke,gi.updated_value):Qt(ke,Ht,gi.updated_value)),fi=!0}catch(gi){let ii=gi&&gi.message||"Update failed. Please try again.";return gt(ke,"error",ii),{success:!1}}}if(L)return gt(ke,"","Stopped"),Ye(ke),{success:!1,stopped:!0};if(Oe.generate_seo_slug==="1"&&fi){gt(ke,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:qt,post_id:ke,action_type:"update_slug"},{timeout:3e4})}catch{return gt(ke,"error","URL update failed."),{success:!1}}}return fi?(gt(ke,"success","Updated"),Ye(ke),{success:!0}):(gt(ke,"error","No prompts selected."),{success:!1})},Vn=async()=>{if(F||!mt())return;let ke=Array.from(D);if(!ke.length)return;if(!d&&Ke()==="existing-content"){let{productIds:ii,otherIds:ji}=Ee(ke);if(ii.length&&!ji.length){Ki(),Ve();return}ii.length&&ji.length&&(ii.forEach(Ne=>{gt(Ne,"error","Skipped (Pro)"),Ye(Ne)}),ke=ji)}if(!ke.length){Ve();return}if(!d&&Ke()==="existing-images"&&ke.length>1){Sn();return}if(typeof window.aipkit_apiRequest!="function"){Wi("Update service is not available yet.");return}let Le=window.aipkit_post_enhancer?.nonce_generate_title;if(!Le){Wi("Update permission is missing. Please reload the page.");return}let Oe=nt(),{prompts:qt,baseConfig:ot,error:Tt}=Di(Oe);if(Tt){!d&&Oe.postTypeOverride==="product"?Ki():Wi(Tt);return}if(!Oe.fieldOrder.some(ii=>!!qt[ii])){Wi("No prompts selected for update.");return}L=!1,ke.forEach(ii=>{gt(ii,"queued","Queued")});let Ht=0,hi=0,mi=ke.length,Bi=null,gi=()=>{let ii=[];return ii.push(`Updating ${mi} item${mi===1?"":"s"}...`),Ht&&ii.push(`${Ht} done`),hi&&ii.push(`${hi} error${hi===1?"":"s"}`),ii.join(" ")};Se(gi(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):Jt(!0),ei(!0);for(let ii=0;ii<ke.length;ii+=1){let ji=ke[ii];if(L){Bi=ii;break}let Ne=await ln(ji,qt,ot,Le,Oe);if(Ne&&Ne.stopped){L=!0,Bi=ii+1;break}Ne&&Ne.success?Ht+=1:hi+=1,Se(gi(),"info")}if(ei(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():Jt(!1),L){(Bi!==null?ke.slice(Bi):[]).forEach(Ne=>{gt(Ne,"","Stopped"),Ye(Ne)});let ji=[`Update stopped: ${Ht} done`];hi&&ji.push(`${hi} error${hi===1?"":"s"}`),Se(ji.join(", ")+".","info")}else hi?Se(`Update complete: ${Ht} done, ${hi} error${hi===1?"":"s"}.`,"error"):Se(`Update complete: ${Ht} done.`,"success");bt(),Ve()};_.dataset.init="true",window.aipkit_cw_existing_handleFetch=pi,window.aipkit_runContentWriterExistingUpdate=Vn,window.aipkit_cw_isExistingUpdateActive=()=>F,window.aipkit_cw_requestExistingUpdateStop=je,M&&!M.dataset.aipkitExistingListener&&(M.addEventListener("change",()=>{E&&(E.value=""),li(),Wt()},!0),M.dataset.aipkitExistingListener="true"),li(),window.aipkit_cw_existing_pendingFetch&&(pi(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=m,window.aipkit_fetchContentWriterExistingPosts=f})();(function(){"use strict";let k=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],r={create:{},update:{}},n={},t=[],a="create",s=!1,l=g=>g&&g!=="single"?g:"task",c=()=>{let g=document.getElementById("aipkit_cw_mode_select");return l(g?.value||"task")},o=g=>g&&g.indexOf("existing")===0?"update":"create",e=(g,_,w)=>{if(w)return String(g||"");let h=String(g||"").trim()?g:_||"";return String(h||"")},i=()=>{if(s)return;let g=a==="update";t.forEach(({key:_,textarea:w,updateInput:h})=>{if(!w)return;let E=w.value||"";if(!g){r.create[_]=E;return}n[_]&&(r.update[_]=E,h&&(h.value=E))})},d=()=>{s=!0;let g=a==="update";t.forEach(({key:_,textarea:w,updateInput:h})=>{if(!w)return;let E=r.create[_]||"",x=r.update[_]||"",v=!!n[_],I=g?e(x,E,v):E;w.value=I||"",g&&h&&(h.value=v?x:"")}),s=!1},u=g=>{let _=o(l(g));_!==a&&(i(),a=_,d())},p=g=>{!g||g.dataset.aipkitPromptModeInit==="true"||(t=k.map(_=>{let w=g.querySelector(`#${_.textareaId}`)||document.getElementById(_.textareaId),h=g.querySelector(`#${_.updateInputId}`)||document.getElementById(_.updateInputId);return{..._,textarea:w,updateInput:h}}),t.some(_=>_.textarea)&&(t.forEach(_=>{let w=_.textarea&&_.textarea.value||"";r.create[_.key]=w;let h=_.updateInput&&_.updateInput.value||"";r.update[_.key]=h,n[_.key]=!!h,_.textarea&&!_.textarea.dataset.aipkitPromptModeListener&&(_.textarea.addEventListener("input",()=>{if(s)return;let E=_.textarea.value||"";a==="update"?(r.update[_.key]=E,n[_.key]=!0,_.updateInput&&(_.updateInput.value=E)):r.create[_.key]=E}),_.textarea.dataset.aipkitPromptModeListener="true")}),g.dataset.aipkitPromptModeInit="true",u(c())))},f=g=>{if(!g||typeof g!="object")return;let _=w=>Object.prototype.hasOwnProperty.call(g,w);t.forEach(w=>{let h=w.key,E=`${h}_update`;if(_(h)&&(r.create[h]=g[h]||""),_(E)){let x=g[E]||"";r.update[h]=x,n[h]=!!x,w.updateInput&&(w.updateInput.value=n[h]?x:"")}}),d()},m=()=>({create:{...r.create},update:{...r.update}});window.aipkit_initContentWriterPromptModeManager=p,window.aipkit_setContentWriterPromptMode=u,window.aipkit_applyContentWriterPromptSets=f,window.aipkit_getContentWriterPromptSets=m})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},r=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],n={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},t={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:r,content:r,meta:r,keyword:r,excerpt:r,tags:r}},a={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},s=u=>String(u??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),l=()=>{let p=document.getElementById("aipkit_cw_mode_select")?.value||"task";return p==="single"&&(p="task"),p},c=(u,p)=>{let f=window.aipkit_content_writer_config?.default_prompts||{};if(p==="existing-images"){let m=`${u}_update`;if(f[m])return f[m]}return f[u]||""},o=(u,p)=>{let f=t[p]||(p.indexOf("existing")===0?t.existing:null);if(f&&f[u])return f[u];let m=k[u]||[],g=n[p]||[],_=[...m,...g];return _.filter((w,h)=>_.indexOf(w)===h)},e=(u,p)=>{if(!u)return;let f=u.dataset.label||"Variables:",m=u.dataset.copyTitle||"Click to copy";u.innerHTML=`${s(f)} `,p.forEach((g,_)=>{let w=document.createElement("code");w.className="aipkit-placeholder",w.title=m,w.textContent=g,u.appendChild(w),_<p.length-1&&u.appendChild(document.createTextNode(" "))})},i=u=>{let p=u?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!p)return;let f=p.dataset.promptType||"",m=l(),g=o(f,m);e(p,g)};function d(u){if(!u)return;let p=u.querySelectorAll("[data-aipkit-flyout-target]");if(!p.length)return;let f=u.querySelectorAll(".aipkit_cw_prompt_library_select"),m=b=>{f.length&&f.forEach(y=>{let S=y.getAttribute("data-aipkit-prompt-target"),C=a[S];if(!C)return;let A=y.options?y.options[0]:null;if(!A)return;if(Array.from(y.options).forEach(($,W)=>{let H=$.dataset.aipkitMode||"both",N=!0;W!==0&&(b==="existing-images"?N=H!=="create":N=H!=="update"),$.hidden=!N}),y.dataset.aipkitDefaultCreate||(y.dataset.aipkitDefaultCreate=A.value||""),b==="existing-images"){let $=c(C,b);$&&(y.dataset.aipkitDefaultUpdate=$,A.value=$)}else A.value=y.dataset.aipkitDefaultCreate||A.value||"";y.selectedOptions.length&&y.selectedOptions[0].hidden&&(y.selectedIndex=0)})},g=null,_=null,w=!1,h=b=>b?u.querySelector(`#${b}`):null,E=(b,y,S)=>{if(!b||!y)return;let C=b.getBoundingClientRect(),A=S?S.getBoundingClientRect():C,M=y.getBoundingClientRect(),$=M.width||440,W=M.height||0,H=window.innerWidth,N=window.innerHeight,G=12,Q=A.left-$-10;Q<G&&(Q=A.right+10),Q=Math.max(G,Math.min(Q,H-$-G));let F=A.top;F+W>N-G&&(F=N-W-G),F=Math.max(G,F),g.style.left=`${Math.round(Q)}px`,g.style.top=`${Math.round(F)}px`},x=()=>{!_||!g||w||(w=!0,window.requestAnimationFrame(()=>{let b=g.querySelector(".aipkit_cw_prompt_panel"),y=_.closest(".aipkit_model_settings_popover_panel");E(_,b,y),w=!1}))},v=()=>{g&&(g.classList.remove("is-open"),g.setAttribute("aria-hidden","true"),_&&_.setAttribute("aria-expanded","false"),g=null,_=null)},I=b=>{let y=b.getAttribute("data-aipkit-flyout-target"),S=h(y);if(!S)return;g&&g!==S&&v(),g=S,_=b,S.classList.add("is-open"),S.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true"),i(S);let C=S.querySelector(".aipkit_cw_prompt_panel"),A=b.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{E(b,C,A)})};p.forEach(b=>{b.dataset.flyoutListenerAttached!=="true"&&(b.addEventListener("click",y=>{if(y.preventDefault(),g&&_===b&&g.classList.contains("is-open")){v();return}I(b)}),b.dataset.flyoutListenerAttached="true")});let P=l();if(m(P),f.forEach(b=>{let y=b.getAttribute("data-aipkit-prompt-target"),S=y?u.querySelector(`#${y}`):null;S&&typeof S.value=="string"&&S.value.trim()===""&&b.value&&(S.value=b.value),b.dataset.promptLibraryAttached!=="true"&&(b.addEventListener("change",()=>{let C=b.value;if(!C)return;let A=b.getAttribute("data-aipkit-prompt-target"),M=A?u.querySelector(`#${A}`):null;if(!M)return;M.value=C,M.dispatchEvent(new Event("input",{bubbles:!0})),typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave();let $=b.options?b.options[0]:null;$&&$.value===""&&(b.value="",b.selectedIndex=0)}),b.dataset.promptLibraryAttached="true")}),u.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(b=>{b.dataset.overlayListenerAttached!=="true"&&(b.addEventListener("click",S=>{S.target===b&&v()}),b.dataset.overlayListenerAttached="true");let y=b.querySelector(".aipkit_popover_flyout_close");y&&y.dataset.flyoutListenerAttached!=="true"&&(y.addEventListener("click",S=>{S.preventDefault(),v()}),y.dataset.flyoutListenerAttached="true")}),u.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",b=>{b.key==="Escape"&&g&&v()}),u.dataset.promptFlyoutEscapeAttached="true"),u.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",b=>{if(!g)return;let y=b.target;y.closest(".aipkit_cw_prompt_flyout")||y.closest("[data-aipkit-flyout-target]")||v()}),u.dataset.promptFlyoutClickAttached="true"),u.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",x),window.addEventListener("scroll",x,!0),u.dataset.promptFlyoutRepositionAttached="true"),u.dataset.promptFlyoutModeAttached!=="true"){let b=document.getElementById("aipkit_cw_mode_select");b&&b.addEventListener("change",()=>{m(l()),g&&i(g)}),u.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=v}window.aipkit_initContentWriterPromptFlyouts=d})();(function(){"use strict";let n=l=>String(l||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),t=l=>{let c=String(l||"").trim();if(!c)return{value:"",raw:""};let o=c.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return o?{value:`${o[1]}T${o[2]}`,raw:""}:{value:"",raw:c}},a=l=>l?l.replace("T"," ").trim():"";function s(l){let c=l||document.getElementById("aipkit_content_writer_container");if(!c)return;let o=c.querySelector("[data-aipkit-bulk-editor]");if(!o||o.dataset.bulkEditorAttached==="true")return;let e=o.querySelector("[data-aipkit-bulk-rows]"),i=o.querySelector("#aipkit_cw_bulk_row_template"),d=o.querySelector("#aipkit_cw_bulk_topics"),u=o.querySelector(".aipkit_cw_bulk_add_row"),p=o.querySelector(".aipkit_cw_bulk_toggle_raw"),f=o.querySelector("#aipkit_cw_bulk_raw"),m=o.querySelector(".aipkit_cw_bulk_grid"),g=o.querySelector(".aipkit_cw_bulk_toggle_details");if(!e||!i||!d)return;let _=!1,w,h=($,W)=>$?$.querySelector(`[data-bulk-field="${W}"]`):null,E=()=>{Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")).forEach((W,H)=>{let N=W.querySelector(".aipkit_cw_bulk_row_number");N&&(N.textContent=H+1)})},x=$=>{let W=n(h($,"topic")?.value||""),H=n(h($,"keywords")?.value||""),N=n(h($,"category")?.value||""),G=n(h($,"author")?.value||""),Q=n(h($,"type")?.value||""),F=h($,"schedule")?.value||"";return F?(F=a(F),$.dataset.rawSchedule=""):$.dataset.rawSchedule&&(F=$.dataset.rawSchedule),{topic:W,keywords:H,category:N,author:G,type:Q,schedule:F}},v=($,W)=>{if(!$||!W)return;let H=(G,Q)=>{let F=h($,G);F&&(F.value=Q||"")};H("topic",W.topic||""),H("keywords",W.keywords||""),H("category",W.category||""),H("author",W.author||""),H("type",W.type||"");let N=h($,"schedule");if(N){let G=t(W.schedule||"");N.value=G.value,$.dataset.rawSchedule=G.raw||""}},I=()=>{let $=Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")),W=[];return $.forEach(H=>{let{topic:N,keywords:G,category:Q,author:F,type:L,schedule:O}=x(H);if(!N)return;let D=[N,G,Q,F,L,O],R=-1;D.forEach((Z,J)=>{Z&&(R=J)}),R!==-1&&W.push(D.slice(0,R+1).join(" | "))}),W.join(`
`)},P=()=>{d&&(_=!0,d.value=I(),d.dispatchEvent(new Event("change",{bubbles:!0})),_=!1)},b=$=>{o.classList.toggle("is-details-open",$),g&&g.setAttribute("aria-expanded",$?"true":"false")},y=$=>{if(f){if(o.classList.toggle("is-raw-open",$),f.hidden=!$,p){p.setAttribute("aria-expanded",$?"true":"false");let W=$?p.dataset.labelGrid:p.dataset.labelRaw;if(W){let H=p.querySelector(".aipkit_cw_toggle_label");H?H.textContent=W:p.textContent=W}}m&&(m.hidden=$),u&&(u.hidden=$,u.disabled=$),g&&(g.hidden=$,$&&g.setAttribute("aria-expanded","false"))}},S=$=>{let H=document.importNode(i.content,!0).querySelector("[data-aipkit-bulk-row]");return H?(v(H,$||{}),H):null},C=()=>{let $=e.querySelectorAll("[data-aipkit-bulk-row]");if($.length>=1)return;let W=1-$.length;for(let H=0;H<W;H++){let N=S();N&&e.appendChild(N)}},A=()=>{let $=Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")),W=$[$.length-1];if(!W)return;let H=x(W);if(Object.values(H).some(G=>G)&&$.length<100){let G=S();G&&(e.appendChild(G),E())}},M=()=>{let W=(d.value||"").split(/\r?\n/).filter(N=>N.trim()!=="");e.innerHTML="";let H=[];if(W.slice(0,100).forEach(N=>{let G=N.split("|").map(L=>L.trim()),Q={topic:G[0]||"",keywords:G[1]||"",category:G[2]||"",author:G[3]||"",type:G[4]||"",schedule:G[5]||""},F=S(Q);F&&H.push(F)}),!H.length){C(),E(),P();return}H.forEach(N=>e.appendChild(N)),C(),E()};d.value.trim()?M():(C(),E(),P()),y(!f.hidden),g&&!g.dataset.listenerAttached&&(g.addEventListener("click",$=>{$.preventDefault();let W=o.classList.contains("is-details-open");b(!W)}),g.dataset.listenerAttached="true",b(!1)),e.addEventListener("input",$=>{let W=$.target;!W||!W.closest("[data-aipkit-bulk-row]")||(P(),A())}),e.addEventListener("change",$=>{let W=$.target;!W||!W.closest("[data-aipkit-bulk-row]")||(P(),A())}),e.addEventListener("click",$=>{let W=$.target.closest(".aipkit_cw_bulk_remove_row");if(!W)return;let H=W.closest("[data-aipkit-bulk-row]");if(!H)return;e.querySelectorAll("[data-aipkit-bulk-row]").length<=1?H.querySelectorAll("input, select").forEach(G=>{G.value=""}):H.remove(),P(),E(),A()}),u&&u.addEventListener("click",$=>{if($.preventDefault(),e.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let H=S();H&&e.appendChild(H),E()}),p&&f&&p.addEventListener("click",$=>{$.preventDefault();let W=!f.hidden;y(!W)}),d.addEventListener("input",()=>{_||(clearTimeout(w),w=setTimeout(()=>{M()},250))}),o.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=s})();(function(){"use strict";let k=null,r=0;function n(){if(!k)return;let s=k;k=null,s.classList.remove("aipkit-active"),s.__aipkitAlertKeydown&&(document.removeEventListener("keydown",s.__aipkitAlertKeydown),s.__aipkitAlertKeydown=null);let l=()=>{s.parentNode&&s.parentNode.removeChild(s)};s.addEventListener("transitionend",l,{once:!0}),window.setTimeout(l,250)}function t(s,l={}){let c=l.title||"Notice",o=l.okText||"OK",e=l.okClass||"aipkit_btn-primary",i=Array.isArray(l.actions)?l.actions:null,d=Array.isArray(l.bullets)?l.bullets:null;k&&n();let u=document.createElement("div");u.className="aipkit-modal-overlay",u.addEventListener("click",I=>{I.target===u&&n()});let p=`aipkit_cw_alert_${Date.now()}_${r++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${p}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let g=document.createElement("h3");g.className="aipkit-modal-title",g.id=`${p}_title`,g.textContent=c;let _=document.createElement("button");_.type="button",_.className="aipkit-modal-close-btn",_.setAttribute("aria-label","Close"),_.textContent="\xD7",m.appendChild(g),m.appendChild(_);let w=document.createElement("div");w.className="aipkit-modal-body";let h=document.createElement("p");if(h.className="aipkit_cw_alert_modal_message",h.textContent=s||"",d&&d.length){let I=document.createElement("ul");I.className="aipkit_cw_alert_modal_list",d.forEach(P=>{let b=document.createElement("li");b.textContent=P,I.appendChild(b)}),w.appendChild(h),w.appendChild(I)}else w.appendChild(h);let E=document.createElement("div");E.className="aipkit_cw_alert_modal_actions";let x=null;if(i&&i.length)i.forEach((I,P)=>{let b=!!(I&&I.href),y=I?.label||(P===0?o:"Close"),S=I?.className||(P===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),C=document.createElement(b?"a":"button");C.className=S,C.textContent=y,b?(C.href=I.href,C.target=I.target||"_blank",C.rel=I.rel||"noopener noreferrer"):C.type="button";let A=()=>{typeof I?.onClick=="function"&&I.onClick(),I?.closeOnClick!==!1&&n()};C.addEventListener("click",A),E.appendChild(C),x||(x=C)});else{let I=document.createElement("button");I.type="button",I.className=`aipkit_btn ${e}`,I.textContent=o,I.addEventListener("click",n),E.appendChild(I),x=I}w.appendChild(E),f.appendChild(m),f.appendChild(w),u.appendChild(f),document.body.appendChild(u);let v=I=>{I.key==="Escape"&&n()};u.__aipkitAlertKeydown=v,document.addEventListener("keydown",v),_.addEventListener("click",n),window.requestAnimationFrame(()=>{u.classList.add("aipkit-active"),x&&x.focus()}),k=u}function a(s,l={}){let c=l.title||"Confirm",o=l.confirmText||"Confirm",e=l.secondaryText||"",i=l.cancelText||"Cancel",d=l.secondaryClass||"aipkit_btn aipkit_btn-danger",u=typeof l.onConfirm=="function"?l.onConfirm:null,p=typeof l.onSecondary=="function"?l.onSecondary:null,f=typeof l.onCancel=="function"?l.onCancel:null;k&&n();let m=document.createElement("div");m.className="aipkit-modal-overlay",m.addEventListener("click",C=>{C.target===m&&(n(),f&&f())});let g=`aipkit_cw_confirm_${Date.now()}_${r++}`,_=document.createElement("div");_.className="aipkit-modal-content aipkit_cw_alert_modal_content",_.setAttribute("role","dialog"),_.setAttribute("aria-modal","true"),_.setAttribute("aria-labelledby",`${g}_title`);let w=document.createElement("div");w.className="aipkit-modal-header";let h=document.createElement("h3");h.className="aipkit-modal-title",h.id=`${g}_title`,h.textContent=c;let E=document.createElement("button");E.type="button",E.className="aipkit-modal-close-btn",E.setAttribute("aria-label","Close"),E.textContent="\xD7",w.appendChild(h),w.appendChild(E);let x=document.createElement("div");x.className="aipkit-modal-body";let v=document.createElement("p");v.className="aipkit_cw_alert_modal_message",v.textContent=s||"";let I=document.createElement("div");I.className="aipkit_cw_alert_modal_actions";let P=document.createElement("button");P.type="button",P.className="aipkit_btn aipkit_btn-secondary",P.textContent=i;let b=document.createElement("button");b.type="button",b.className=d,b.textContent=e;let y=document.createElement("button");y.type="button",y.className="aipkit_btn aipkit_btn-primary",y.textContent=o,I.appendChild(P),e&&I.appendChild(b),I.appendChild(y),x.appendChild(v),x.appendChild(I),_.appendChild(w),_.appendChild(x),m.appendChild(_),document.body.appendChild(m);let S=C=>{C.key==="Escape"&&(n(),f&&f())};m.__aipkitAlertKeydown=S,document.addEventListener("keydown",S),E.addEventListener("click",()=>{n(),f&&f()}),P.addEventListener("click",()=>{n(),f&&f()}),e&&b.addEventListener("click",()=>{n(),p&&p()}),y.addEventListener("click",()=>{n(),u&&u()}),window.requestAnimationFrame(()=>{m.classList.add("aipkit-active"),y.focus()}),k=m}window.aipkit_showAlertModal=t,window.aipkit_showConfirmModal=a,window.aipkit_closeAlertModal=n})();(function(){"use strict";function k(r,n){if(!r||!n||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(r.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(r,n),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(r,n),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let t=window.aipkit_escapeHtml||function(a){return a};n.innerHTML='<option value="">'+t("Models unavailable (Data Object Missing)")+"</option>",n.disabled=!0}}window.aipkit_handleProviderModelDropdowns=k})();(function(){"use strict";function k(r){if(!r){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let n=document.getElementById("aipkit_content_writer_temperature_value");n?r.dataset.listenerAttached||(r.addEventListener("input",()=>n.textContent=r.value),r.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=k})();(function(){"use strict";function k(r){if(!r){console.warn("Copy Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{let n=document.getElementById("aipkit_cw_generated_title_display"),t=document.getElementById("aipkit_cw_generated_content_area"),a="";n&&n.style.display!=="none"&&(a+=n.textContent+`

`),t&&(a+=t.innerText),a.trim()&&navigator.clipboard.writeText(a.trim()).then(()=>{let s=r.querySelector(".dashicons");if(s){let l=s.className;s.className="dashicons dashicons-yes",setTimeout(()=>{s.className=l},1500)}}).catch(s=>console.error("Failed to copy: ",s))}),r.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_single_output_wrapper"),t=document.getElementById("aipkit_cw_output_card"),a=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.querySelector(".aipkit_content_writer_output_actions"),c=document.getElementById("aipkit_cw_status_display_container"),o=document.getElementById("aipkit_cw_generated_title_display"),e=document.getElementById("aipkit_cw_meta_chunk"),i=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),d=document.getElementById("aipkit_cw_generated_meta_desc"),u=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),p=document.getElementById("aipkit_cw_generated_focus_keyword"),f=document.getElementById("aipkit_cw_excerpt_output_wrapper"),m=document.getElementById("aipkit_cw_generated_excerpt"),g=document.getElementById("aipkit_cw_tags_output_wrapper"),_=document.getElementById("aipkit_cw_generated_tags"),w=document.getElementById("aipkit_cw_image_data_holder"),h=document.getElementById("aipkit_content_writer_copy_btn"),E=document.getElementById("aipkit_content_writer_clear_btn");if(n&&(n.style.display="none"),t&&(t.style.display="none"),a&&s){s.classList.remove("is-streaming");let x=s.closest(".aipkit_cw_output_chunk--primary");x&&x.classList.remove("has-overflow"),s.innerHTML="",a.scrollTop=0,l&&(l.style.display="none"),h&&(h.disabled=!0),E&&(E.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let v=document.getElementById("aipkit_content_writer_form_status");v&&(v.textContent=""),c&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():c&&(c.style.display="none"),o&&(o.style.display="none",o.textContent=""),e&&(e.style.display="none"),i&&(i.style.display="none"),d&&(d.value=""),u&&(u.style.display="none"),p&&(p.value=""),f&&(f.style.display="none"),m&&(m.value=""),g&&(g.style.display="none"),_&&(_.value=""),w&&(w.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function r(n,t){if(!n){console.warn("Clear Button Handler: Button element not provided.");return}n.dataset.listenerAttached||(n.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),n.dataset.listenerAttached="true")}window.aipkit_handleClearButton=r,window.aipkit_clearContentWriterOutput=k})();(function(){"use strict";function k(){return document.getElementById("aipkit_cw_expand_preview_btn")}function r(e){return e?e.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function n(e,i,d){return e?i==="restore"?e.dataset.labelRestore||d:e.dataset.labelExpand||d:d}function t(e,i){if(!e)return;let d=e.querySelector(".aipkit_cw_expand_label"),u=e.querySelector(".dashicons"),p=i?n(e,"restore","Restore preview"):n(e,"expand","Expand preview");d&&(d.textContent=p),e.setAttribute("title",p),e.setAttribute("aria-pressed",i?"true":"false"),u&&(u.classList.toggle("dashicons-fullscreen-alt",!i),u.classList.toggle("dashicons-fullscreen-exit-alt",i))}function a(e){let i=document.getElementById("aipkit_content_writer_output_display");!i||!e||(i.scrollHeight>i.clientHeight?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}function s(e){let i=k(),d=r(i);!i||!d||(e?d.classList.add("is-expanded"):d.classList.remove("is-expanded"),t(i,e),requestAnimationFrame(()=>a(d)))}function l(e){let i=k();i&&(i.disabled=!e,i.setAttribute("aria-disabled",e?"false":"true"),e||s(!1))}function c(){s(!1)}function o(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",e=>{let i=e.target.closest("#aipkit_cw_expand_preview_btn");if(!i||i.disabled)return;let d=r(i);if(!d)return;let u=d.classList.contains("is-expanded");s(!u)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.aipkit_resetContentWriterPreviewSize=c,window.aipkit_setContentWriterPreviewExpandEnabled=l})();(function(){"use strict";let k=_=>!_||typeof _!="object"?"":_.media_library_url||_.url||_.src||_.image_url||_.preview_url||"",r=_=>_==null?"":String(_).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let _=document.getElementById("aipkit_cw_generated_content_area");return _?_.innerHTML:""},t=()=>{let _=document.getElementById("aipkit_cw_generated_content_area");if(!_)return;let w=n();w&&(_.innerHTML=w)},a=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),s=(_,w,h="")=>{_&&(_.hidden=!w,w?_.style.display=h||"":_.style.display="none")},l=_=>{_&&(_.innerHTML="",s(_,!1,"grid"))},c=()=>{let _=a();_.preview&&(_.featuredImg&&_.featuredImg.removeAttribute("src"),s(_.featuredWrap,!1,"flex"),_.inlineToggle&&(_.inlineToggle.setAttribute("aria-expanded","false"),_.inlineToggle.classList.remove("is-open")),_.inlineCount&&(_.inlineCount.textContent="0"),l(_.inlineGrid),s(_.inlineToggle,!1,"inline-flex"),s(_.preview,!1,"flex"),t())},o=_=>{!_.inlineToggle||!_.inlineGrid||_.inlineToggle.dataset.listenerAttached!=="true"&&(_.inlineToggle.addEventListener("click",()=>{let w=_.inlineToggle.getAttribute("aria-expanded")==="true";_.inlineToggle.setAttribute("aria-expanded",w?"false":"true"),_.inlineToggle.classList.toggle("is-open",!w),s(_.inlineGrid,!w,"grid")}),_.inlineToggle.dataset.listenerAttached="true")},e=(_,w)=>{if(!_.inlineToggle||!_.inlineGrid||!w.length)return!1;l(_.inlineGrid);let h=document.createDocumentFragment();return w.forEach((E,x)=>{let v=document.createElement("div");v.className="aipkit_cw_inline_image";let I=document.createElement("img");I.src=E,I.alt=`Generated image ${x+1}`,I.loading="lazy",I.decoding="async",v.appendChild(I),h.appendChild(v)}),_.inlineGrid.appendChild(h),s(_.inlineGrid,!1,"grid"),s(_.inlineToggle,!0,"inline-flex"),_.inlineToggle.setAttribute("aria-expanded","false"),_.inlineToggle.classList.remove("is-open"),_.inlineCount&&(_.inlineCount.textContent=String(w.length)),o(_),!0},i=(_,w,h)=>{let E=k(_);if(!E)return"";let x=_.alt||_.revised_prompt||_.caption||"Image",v=[];return["left","right","center","none"].includes(w)&&v.push(`align${w}`),v.push(`size-${h||"large"}`),`<img class="${r(v.join(" "))}" src="${r(E)}" alt="${r(x)}" loading="lazy" decoding="async" />`},d=(_,w)=>w.length?`${_}

${w.join(`

`)}`:_,u=(_,w,h)=>{if(!w.length)return _;let E=w.shift(),x=_.toLowerCase(),v=`</${h}>`,I=x.indexOf(v);return I!==-1?_=_.slice(0,I+v.length)+`

${E}

`+_.slice(I+v.length):_+=`

${E}`,d(_,w)},p=(_,w,h,E)=>{if(!w.length)return _;if(!E||E<=0)return d(_,w);let x=_.split(new RegExp(`(</${h}>)`,"ig")),v="",I=0,P=0;for(let b=0;b<x.length;b+=1)v+=x[b],b%2===1&&(I+=1,I%E===0&&P<w.length&&(v+=`

${w[P]}

`,P+=1));for(;P<w.length;)v+=`

${w[P]}`,P+=1;return v},f=_=>{let w=document.getElementById("aipkit_cw_generated_content_area");if(!w)return;let h=Array.isArray(_?.in_content_images)?_.in_content_images:[];if(!h.length){t();return}let E=n();if(E||(E=w.innerHTML),!E)return;let x=document.getElementById("aipkit_content_writer_form"),v=_?.placement_settings?.placement||x?.elements.image_placement?.value||"after_first_h2",I=_?.placement_settings?.param_x||x?.elements.image_placement_param_x?.value||2,P=parseInt(I,10)||2,b=x?.elements.image_alignment?.value||"none",y=x?.elements.image_size?.value||"large",S=h.map(A=>i(A,b,y)).filter(Boolean);if(!S.length){t();return}let C=E;switch(v){case"after_first_h2":C=u(C,S,"h2");break;case"after_first_h3":C=u(C,S,"h3");break;case"after_every_x_h2":C=p(C,S,"h2",P);break;case"after_every_x_h3":C=p(C,S,"h3",P);break;case"after_every_x_p":C=p(C,S,"p",P);break;case"at_end":default:C=d(C,S);break}w.innerHTML=C,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},m=(_,w)=>!_.featuredWrap||!_.featuredImg||!w?!1:(_.featuredImg.src=w,s(_.featuredWrap,!0,"flex"),!0),g=_=>{let w=a();if(!w.preview)return;c();let h=_;if(typeof _=="string")try{h=JSON.parse(_)}catch{return}if(!h||typeof h!="object")return;let x=(Array.isArray(h.in_content_images)?h.in_content_images:[]).map(k).filter(Boolean),v=h.featured_image_url||k(h.featured_image)||k(h.featured_image_data),I=m(w,v),P=e(w,x);f(h),(I||P)&&s(w.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=g,window.aipkit_clearContentWriterImagePreview=c})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_form");if(!n)return;let t=n.elements.generate_meta_description,a=n.elements.generate_focus_keyword,s=n.elements.generate_excerpt,l=n.elements.generate_tags,c=n.querySelector(".aipkit_cw_prompt_row--meta"),o=n.querySelector(".aipkit_cw_prompt_row--keyword"),e=n.querySelector(".aipkit_cw_prompt_row--excerpt"),i=n.querySelector(".aipkit_cw_prompt_row--tags"),d=!!(t&&t.checked),u=!!(a&&a.checked),p=!!(s&&s.checked),f=!!(l&&l.checked),m=(_,w)=>{if(!_)return;_.classList.toggle("aipkit_popover_option_row--disabled",!w);let h=_.querySelector(".aipkit_cw_prompt_trigger");h&&(h.disabled=!w,h.setAttribute("aria-disabled",w?"false":"true"))};m(c,d),m(o,u),m(e,p),m(i,f);let g=n.querySelector(".aipkit_cw_prompt_flyout.is-open");if(g){let _=[];d||_.push("aipkit_cw_meta_prompt_flyout"),u||_.push("aipkit_cw_keyword_prompt_flyout"),p||_.push("aipkit_cw_excerpt_prompt_flyout"),f||_.push("aipkit_cw_tags_prompt_flyout"),_.includes(g.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function r(){let n=document.getElementById("aipkit_content_writer_form");if(!n||n.dataset.optionToggleListenerAttached)return;let t=n.elements.generate_meta_description,a=n.elements.generate_focus_keyword,s=n.elements.generate_excerpt,l=n.elements.generate_tags;t&&t.addEventListener("change",k),a&&a.addEventListener("change",k),s&&s.addEventListener("change",k),l&&l.addEventListener("change",k),n.dataset.optionToggleListenerAttached="true",k()}window.aipkit_cw_toggleCustomOptionPrompts=k,window.aipkit_cw_initOptionPromptToggles=r})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("Prompt Toggle Handler: Content writer container not found.");return}r.querySelectorAll(".aipkit_textarea_toggle").forEach(a=>{let s=a.dataset.target;if(!s)return;let l=`aipkit-cw-prompt-${s}-state`,c=localStorage.getItem(l),o=document.getElementById(s),e=a.querySelector(".dashicons");o&&e&&(c==="expanded"?(o.classList.remove("aipkit_collapsed"),e.classList.remove("dashicons-plus-alt2"),e.classList.add("dashicons-minus"),a.title="Collapse"):(o.classList.add("aipkit_collapsed"),e.classList.remove("dashicons-minus"),e.classList.add("dashicons-plus-alt2"),a.title="Expand"))});let t="data-prompt-toggle-listener-attached";r.getAttribute(t)||(r.addEventListener("click",function(a){let s=a.target.closest(".aipkit_textarea_toggle");if(!s)return;let l=s.dataset.target,c=document.getElementById(l),o=s.querySelector(".dashicons");if(!c||!o){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",s);return}let e=c.classList.toggle("aipkit_collapsed");e?(o.classList.remove("dashicons-minus"),o.classList.add("dashicons-plus-alt2"),s.title="Expand"):(o.classList.remove("dashicons-plus-alt2"),o.classList.add("dashicons-minus"),s.title="Collapse");let i=`aipkit-cw-prompt-${l}-state`;localStorage.setItem(i,e?"collapsed":"expanded")}),r.setAttribute(t,"true"))}window.aipkit_initPromptToggles=k})();(function(){"use strict";let k="";function r(u){k=typeof u=="string"?u:""}function n(){return k||""}function t(){k=""}function a(){let u=document.getElementById("aipkit_cw_meta_chunk");if(!u)return;let p=!1;u.querySelectorAll(".aipkit_cw_meta_field").forEach(m=>{window.getComputedStyle(m).display!=="none"&&(p=!0)}),u.style.display=p?"block":"none"}function s(){let u=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");u&&(u.style.display="flex")}function l(){let u=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");u&&(u.style.display="none")}function c(){let u=document.getElementById("aipkit_cw_article_counter"),p=document.getElementById("aipkit_cw_generated_content_area");if(!u||!p)return;if(p.querySelector(".aipkit_spinner")){u.textContent="",u.hidden=!0;return}let m=(p.textContent||"").trim(),g=m?m.split(/\s+/).length:0;if(!g){u.textContent="",u.hidden=!0;return}let _=g===1?"word":"words";u.textContent=`${g} ${_}`,u.hidden=!1}function o(){let u=document.getElementById("aipkit_cw_generated_content_area");if(!u)return;let p=!1,f=()=>{p||(p=!0,window.requestAnimationFrame(()=>{p=!1,c()}))};new MutationObserver(()=>{f()}).observe(u,{childList:!0,subtree:!0,characterData:!0}),f()}function e(){let u=document.getElementById("aipkit_cw_generated_meta_desc"),p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!u||!p)return;function f(){let m=u.value.length,g=m>=120&&m<=160;p.textContent=`${m}/160`,p.style.color=g?"#16a34a":m>160?"#dc2626":"#94a3b8"}u.addEventListener("input",f),f()}function i(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let p=new MutationObserver(function(m){m.forEach(function(g){g.type==="attributes"&&g.attributeName==="style"&&a()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(m=>{let g=document.getElementById(m);g&&p.observe(g,{attributes:!0,attributeFilter:["style"]})})}function d(){e(),i(),o()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d(),window.aipkit_updateMetaChunkVisibility=a,window.aipkit_showPrimaryAction=s,window.aipkit_hidePrimaryAction=l,window.aipkit_updateContentWriterPreviewCounter=c,window.aipkit_setContentWriterRawHtml=r,window.aipkit_getContentWriterRawHtml=n,window.aipkit_resetContentWriterRawHtml=t,window.aipkit_resetContentWriterPreviewCounter=function(){let u=document.getElementById("aipkit_cw_article_counter");u&&(u.textContent="",u.hidden=!0)}})();(function(){"use strict";function k(c){if(!c)return;let o=c.querySelector("#aipkit_content_writer_provider"),e=c.querySelector("#aipkit_content_writer_model"),i=c.querySelector(".aipkit_cw_reasoning_effort_field"),d=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!o||!e||!i||!d){i&&(i.style.display="none");return}let u=(o.value||"").toLowerCase(),f=(e.value||"").toLowerCase();u==="openai"&&n(f)?(i.classList.contains("aipkit_popover_option_row")||i.classList.contains("aipkit_ai_behavior_control")?i.style.display="flex":i.style.display="block",r(c,f)):i.style.display="none"}function r(c,o){let e=c.querySelector("#aipkit_content_writer_reasoning_effort"),i=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!e||!i.length)return;let d=a(o),u=new Set(d.allowed);i.forEach(_=>{let w=_.querySelector(".aipkit_ai_reasoning_input");if(!w)return;let h=w.value==="minimal"?"low":w.value,E=u.has(h);_.style.display=E?"":"none",E||(w.checked=!1)});let p=e.value||"";p==="minimal"&&(p="low");let f=c.querySelector(".aipkit_ai_reasoning_input:checked");!u.has(p)&&f&&(p=f.value),u.has(p)||(p=d.defaultValue),u.has(p)||(p=d.allowed[0]||"");let m=e.value;p&&(e.value=p);let g=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(g){g.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(w=>w.classList.remove("aipkit_ai_reasoning_option--selected"));let _=g.closest(".aipkit_ai_reasoning_option");_&&_.classList.add("aipkit_ai_reasoning_option--selected")}m!==e.value&&e.dispatchEvent(new Event("change",{bubbles:!0}))}function n(c){if(t(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return o||e}function t(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_cw_toggleReasoningEffort=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(g){return g},r=["pexels_api_key","pixabay_api_key"],n={},t={},a="",s=!1,l=!1,c="";function o(g){r.forEach(_=>{let w=g.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(_)}"]`);n[_]=w?w.value.trim():"",t[_]=!1})}function e(g){let _=g.querySelector("#aipkit_cw_replicate_api_key");a=_?_.value.trim():"",s=!1}async function i(g){if(!g||!g.name)return;let _=g.name;if(!r.includes(_))return;let w=g.value.trim(),h=n[_]||"";if(w===h||t[_]||typeof window.aipkit_apiRequest!="function")return;let E=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,x=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,v=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;t[_]=!0,n[_]=w,E&&E("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[_]:w}),x&&x("Updated")}catch(I){n[_]=h,v&&v(`Error: ${I.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",I)}finally{t[_]=!1}}async function d(g){if(!g)return;let _=g.value.trim(),w=a||"";if(_===w||s||typeof window.aipkit_apiRequest!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,E=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s=!0,a=_,h&&h("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:_}),E&&E("Updated"),u(_,!0)}catch(v){a=w,x&&x(`Error: ${v.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",v)}finally{s=!1}}function u(g,_=!1){let w=(g||"").trim();if(!w||l||!_&&w===c||typeof window.aipkit_queueProviderSync!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,E=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;l=!0,h&&h("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{c=w,E&&E("Models synced!")}).catch(v=>{x&&x(`Error: ${v.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",v)}).finally(()=>{l=!1})}function p(g){let _=document.getElementById("aipkit_cw_image_model");if(!_)return;let w=window.aipkit_dashboard?.imageGeneratorModels;if(!w){console.error("Image models data not found in aipkit_dashboard object."),_.innerHTML='<option value="">Error: Models not loaded</option>';return}let h=w[g.toLowerCase()]||[],E=window.aipkit_cw_template_state?.pendingImageModelSelection,x=_.value,v=E||x;_.innerHTML="",h.length>0?(h.forEach(I=>{_.appendChild(new Option(I.name,I.id))}),_.querySelector(`option[value="${CSS.escape(v)}"]`)?_.value=v:_.options.length>0&&(_.selectedIndex=0)):_.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function f(){let g=document.getElementById("aipkit_content_writer_container");if(!g)return;let _=g.querySelector(".aipkit_cw_image_enable_toggle"),w=g.querySelector("#aipkit_cw_generate_featured_image"),h=g.querySelector("#aipkit_cw_image_placement"),E=g.querySelector("#aipkit_cw_image_provider"),x=document.getElementById("aipkit_content_writer_form"),v=x?x.classList.contains("aipkit_cw_mode_existing_images"):!1,I=g.querySelectorAll(".aipkit_cw_image_settings_container"),P=g.querySelector(".aipkit_cw_prompt_row--image"),b=g.querySelector(".aipkit_cw_prompt_row--featured"),y=g.querySelector(".aipkit_cw_image_metadata_chunk"),S=Array.from(g.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(J=>{let pe=J.closest(".aipkit_image_toggle_card");return{toggle:J,button:pe?pe.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!_||!w)return;let C=J=>J?J.closest(".aipkit_popover_option_row")||J.closest(".aipkit_form-group"):null,A=(J,pe)=>{J&&(pe?J.style.display=J.classList.contains("aipkit_popover_option_row")?"flex":"block":J.style.display="none")},M=_.checked,$=w.checked,W=M||$||v,H=E?E.value:"",N=H==="pexels"||H==="pixabay";I.forEach(J=>{J.style.display=W?"block":"none"});let G=M&&!N,Q=$&&!N,F=(J,pe)=>{if(!J)return;J.style.display="",J.classList.toggle("aipkit_popover_option_row--disabled",!pe);let Ce=J.querySelector(".aipkit_cw_prompt_trigger");Ce&&(Ce.disabled=!pe,Ce.setAttribute("aria-disabled",pe?"false":"true"))};F(P,G),F(b,Q);let L=v||W;if(y&&(y.style.display=L?"block":"none"),y){let J=y.querySelector(".aipkit_image_settings_chunk_header--collapsible"),pe=y.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(J&&pe){let Ce=v;J.setAttribute("aria-expanded",Ce?"true":"false"),pe.setAttribute("aria-hidden",Ce?"false":"true")}}S.length>0&&S.forEach(({toggle:J,button:pe})=>{let Ce=L&&J.checked;pe&&(pe.disabled=!Ce,pe.setAttribute("aria-disabled",Ce?"false":"true"))});let O=g.querySelector(".aipkit_cw_prompt_flyout.is-open"),D=O?g.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(O.id)}"]`):null,R=D?D.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,Z=R&&L?R.checked:!1;if(O&&(O.id==="aipkit_cw_image_prompt_flyout"&&!G||O.id==="aipkit_cw_featured_image_prompt_flyout"&&!Q||R&&!Z&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(O.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),W){let J=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],pe=g.querySelector("#aipkit_cw_replicate_options"),Ce=g.querySelector("#aipkit_cw_pexels_options"),He=g.querySelector("#aipkit_cw_pixabay_options"),Ke=g.querySelector("#aipkit_cw_image_model_group");if(J.forEach(mt=>{let wt=g.querySelector(mt),ge=C(wt);A(ge,M)}),h){let mt=g.querySelector(".aipkit_cw_image_placement_x_field");if(mt){let wt=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(h.value);A(mt,M&&wt)}}pe&&(pe.style.display=H==="replicate"?"block":"none"),Ce&&(Ce.style.display=N&&H==="pexels"?"block":"none"),He&&(He.style.display=N&&H==="pixabay"?"block":"none"),Ke&&(Ke.style.display=N?"none":"");let nt=g.querySelector("#aipkit_cw_image_model_wrapper");if(nt&&(nt.style.display=N?"none":""),!N&&H&&p(H),H==="replicate"){let mt=g.querySelector("#aipkit_cw_replicate_api_key");u(mt?mt.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function m(){let g=document.getElementById("aipkit_content_writer_container");g&&(g.dataset.imageHandlerAttached||(o(g),e(g),g.addEventListener("change",function(_){let w=_.target;if(w&&w.matches(".aipkit_cw_stock_api_key")){i(w);return}if(w&&w.matches(".aipkit_cw_replicate_api_key")){d(w);return}w.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&f()}),g.addEventListener("click",function(_){let w=_.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!w)return;let h=w.getAttribute("aria-expanded")==="true",E=w.getAttribute("aria-controls"),x=E?document.getElementById(E):null;w.setAttribute("aria-expanded",h?"false":"true"),x&&x.setAttribute("aria-hidden",h?"true":"false")}),f(),g.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=m,window.aipkit_updateImageSettingsUI=f})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c};function r(c){if(!c)return;let o=c.querySelector(".aipkit_cw_vector_store_toggle"),e=c.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(o&&e.length>0){let i=o.checked;e.forEach(d=>{d.style.display=i?"block":"none"}),i&&n(c)}}function n(c){if(!c)return;let o=c.querySelector(".aipkit_cw_vector_store_provider_select");if(!o)return;let e=o.value,i=c.querySelector(".aipkit_cw_vector_openai_field"),d=c.querySelector(".aipkit_cw_vector_pinecone_field"),u=c.querySelector(".aipkit_cw_vector_qdrant_field"),p=c.querySelector(".aipkit_cw_vector_embedding_config_row"),f=(m,g)=>{m&&(m.style.display=g?"block":"none")};if(f(i,e==="openai"),f(d,e==="pinecone"),f(u,e==="qdrant"),p){let m=e==="pinecone"||e==="qdrant";if(p.style.display=m?"block":"none",m){let g=p.querySelector(".aipkit_cw_vector_embedding_provider_select");g&&t(g.value)}}}function t(c){let o=document.getElementById("aipkit_cw_vector_embedding_model");if(!o)return;let i=(window.aipkit_dashboard?.embeddingModels||{})[c.toLowerCase()]||[],d=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";o.innerHTML=`<option value="">${k("-- Select Model --")}</option>`,i.length>0?(i.forEach(u=>{if(u&&u.id){let p=new Option(k(u.name||u.id),u.id);u.id===d&&(p.selected=!0),o.appendChild(p)}}),o.disabled=!1):(o.disabled=!0,o.innerHTML=`<option value="">${k("-- No models found --")}</option>`)}function a(c){if(!c)return;let o=c.getAttribute("aria-expanded")==="true",e=c.getAttribute("aria-controls"),i=document.getElementById(e);i&&(c.setAttribute("aria-expanded",!o),i.setAttribute("aria-hidden",o))}function s(c){if(!c)return;let o=document.getElementById(c.id+"_value");if(!o)return;let e=c.value;c.id==="aipkit_cw_vector_store_confidence_threshold"&&(e=e+"%"),o.textContent=e}function l(){let c=document.getElementById("aipkit_content_writer_container");if(!c||c.dataset.vectorSettingsHandlerAttached)return;c.addEventListener("change",function(e){let i=e.target;if(i.matches(".aipkit_cw_vector_store_toggle")){let d=i.closest(".aipkit_vector_settings_redesigned")||i.closest(".aipkit_popover_options_list")||c;r(d)}else if(i.matches(".aipkit_cw_vector_store_provider_select")){let d=i.closest(".aipkit_vector_settings_redesigned")||i.closest(".aipkit_cw_vector_store_settings_container")||c;n(d)}else i.matches(".aipkit_cw_vector_embedding_provider_select")&&t(i.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),c.addEventListener("input",function(e){let i=e.target;i.matches(".aipkit_vector_slider")&&s(i)}),c.addEventListener("click",function(e){let d=e.target.closest(".aipkit_vector_settings_chunk_header--collapsible");d&&(e.preventDefault(),a(d))}),c.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(e=>{e.querySelector(".aipkit_cw_vector_store_toggle")&&r(e)}),c.querySelectorAll(".aipkit_vector_slider").forEach(e=>{s(e)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),c.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=l,window.aipkit_cw_toggleVectorSettingsContainer=r,window.aipkit_cw_toggleProviderSpecificFields=n,window.aipkit_cw_populateEmbeddingModelSelect=t})();(function(){"use strict";function k(c){if(!c)return;let o=c.querySelector("#aipkit_content_writer_post_status"),e=c.querySelector(".aipkit_post_smart_schedule_container");if(!o)return;let i=o.value==="publish";e&&(e.style.display=i?"block":"none"),i&&r(c)}function r(c){if(!c)return;let o=c.querySelector('input[name="schedule_mode"]:checked'),e=c.querySelector(".aipkit_post_smart_schedule_fields");if(!e)return;let i=o&&o.value==="smart";e.style.display=i?"flex":"none"}function n(c){if(!c)return;let o=c.getAttribute("aria-expanded")==="true",e=c.getAttribute("aria-controls"),i=document.getElementById(e);i&&(c.setAttribute("aria-expanded",!o),i.setAttribute("aria-hidden",o))}function t(c){if(!c)return;let o=c.querySelector("#aipkit_content_writer_post_status");o&&(o.addEventListener("change",()=>{k(c)}),k(c)),c.querySelectorAll('input[name="schedule_mode"]').forEach(i=>{i.addEventListener("change",()=>{r(c)})}),r(c)}function a(){document.addEventListener("click",c=>{let o=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(o){c.preventDefault(),n(o);return}}),document.addEventListener("keydown",c=>{if(c.key!=="Enter"&&c.key!==" ")return;let o=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");o&&(c.preventDefault(),n(o))})}function s(c){let o=c.target;if(!o||!o.id||o.id!=="aipkit_cw_post_settings_popover")return;let e=o.querySelector(".aipkit_post_settings_redesigned");e&&!e.dataset.postSettingsInitialized&&(t(e),e.dataset.postSettingsInitialized="true")}function l(){a(),document.addEventListener("aipkit:popover:opened",s),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(e=>{e.dataset.postSettingsInitialized||(t(e),e.dataset.postSettingsInitialized="true")}),new MutationObserver(e=>{e.forEach(i=>{if(i.type==="attributes"&&i.attributeName==="aria-hidden"){let d=i.target.closest("#aipkit_cw_post_settings_popover");if(d&&i.target.getAttribute("aria-hidden")==="false"){let u=d.querySelector(".aipkit_post_settings_redesigned");u&&!u.dataset.postSettingsInitialized&&(t(u),u.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_initPostSettingsHandler=t})();(function(){"use strict";function k(r){let n=r||document.getElementById("aipkit_content_writer_container");if(!n)return;let t=n.querySelectorAll("[data-aipkit-vector-stores-dropdown]");t.length&&t.forEach(a=>{let s=a.closest(".aipkit_popover_option_main"),l=a.closest(".aipkit_cw_vector_openai_field"),c=s||l,o=c?c.querySelector(".aipkit_popover_multiselect_select"):null;if(!o)return;let e=a.querySelector(".aipkit_popover_multiselect_btn"),i=a.querySelector(".aipkit_popover_multiselect_label"),d=a.querySelector(".aipkit_popover_multiselect_panel"),u=a.querySelector(".aipkit_popover_multiselect_options"),p=a.dataset.placeholder||"Select stores",f=a.dataset.selectedLabel||"selected",m=()=>{if(!i)return;let E=Array.from(o.options).filter(v=>v.selected&&v.value);if(!E.length){i.textContent=p;return}let x=E.map(v=>v.textContent.trim()).filter(Boolean);if(x.length<=2){i.textContent=x.join(", ");return}i.textContent=`${x.length} ${f}`},g=()=>{if(!u)return;u.innerHTML="";let E=Array.from(o.options),x=E.filter(v=>v.value);if(!x.length){let v=document.createElement("div");v.className="aipkit_popover_multiselect_empty",v.textContent=E[0]?.textContent||"-- No Stores Found --",u.appendChild(v),m();return}x.forEach(v=>{let I=document.createElement("label");I.className="aipkit_popover_multiselect_item";let P=document.createElement("input");P.type="checkbox",P.value=v.value,P.checked=v.selected,P.disabled=v.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=v.textContent,I.appendChild(P),I.appendChild(b),u.appendChild(I)}),m()},_=()=>{if(!u){m();return}let E=new Set(Array.from(o.options).filter(x=>x.selected).map(x=>x.value));u.querySelectorAll('input[type="checkbox"]').forEach(x=>{x.checked=E.has(x.value)}),m()},w=E=>{if(!u)return;let x=Array.from(u.querySelectorAll('input[type="checkbox"]:checked'));if(x.length>2){let I=E&&E.target;if(I&&I.checked)I.checked=!1;else{let P=x[x.length-1];P&&(P.checked=!1)}}let v=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(I=>I.value);Array.from(o.options).forEach(I=>{I.selected=v.includes(I.value)}),o.dispatchEvent(new Event("change",{bubbles:!0})),m()},h=E=>{!a||!e||(a.classList.toggle("is-open",E),e.setAttribute("aria-expanded",E?"true":"false"),d&&(d.hidden=!E))};g(),_(),a.dataset.vectorStoreMultiselectAttached||(e&&(e.addEventListener("click",E=>{E.preventDefault(),h(!a.classList.contains("is-open"))}),e.addEventListener("keydown",E=>{E.key==="Escape"&&h(!1)})),document.addEventListener("click",E=>{a.classList.contains("is-open")&&(a.contains(E.target)||h(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",w),u.dataset.listenerAttached="true"),o.dataset.listenerAttached||(o.addEventListener("change",_),o.dataset.listenerAttached="true"),a.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=k})();(function(){"use strict";function k(r){let n=r||document.getElementById("aipkit_content_writer_container");if(!n)return;let t=n.querySelectorAll("[data-aipkit-categories-dropdown]");t.length&&t.forEach(a=>{let s=a.closest(".aipkit_popover_option_main"),l=a.closest(".aipkit_post_taxonomy_row"),c=s||l,o=c?c.querySelector('select[name="post_categories[]"]'):null;if(!o)return;let e=a.querySelector(".aipkit_popover_multiselect_btn"),i=a.querySelector(".aipkit_popover_multiselect_label"),d=a.querySelector(".aipkit_popover_multiselect_panel"),u=a.querySelector(".aipkit_popover_multiselect_options"),p=a.dataset.placeholder||"Select categories",f=a.dataset.selectedLabel||"selected",m=()=>{if(!i)return;let E=Array.from(o.options).filter(v=>v.selected&&v.value);if(!E.length){i.textContent=p;return}let x=E.map(v=>v.textContent.trim()).filter(Boolean);if(x.length<=2){i.textContent=x.join(", ");return}i.textContent=`${x.length} ${f}`},g=()=>{if(!u)return;u.innerHTML="";let E=Array.from(o.options),x=E.filter(v=>v.value);if(!x.length){let v=document.createElement("div");v.className="aipkit_popover_multiselect_empty",v.textContent=E[0]?.textContent||"-- No Categories --",u.appendChild(v),m();return}x.forEach(v=>{let I=document.createElement("label");I.className="aipkit_popover_multiselect_item";let P=document.createElement("input");P.type="checkbox",P.value=v.value,P.checked=v.selected,P.disabled=v.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=v.textContent,I.appendChild(P),I.appendChild(b),u.appendChild(I)}),m()},_=()=>{if(!u){m();return}let E=new Set(Array.from(o.options).filter(x=>x.selected).map(x=>x.value));u.querySelectorAll('input[type="checkbox"]').forEach(x=>{x.checked=E.has(x.value)}),m()},w=()=>{if(!u)return;let E=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(x=>x.value);Array.from(o.options).forEach(x=>{x.selected=E.includes(x.value)}),o.dispatchEvent(new Event("change",{bubbles:!0})),m()},h=E=>{!a||!e||(a.classList.toggle("is-open",E),e.setAttribute("aria-expanded",E?"true":"false"),d&&(d.hidden=!E))};g(),_(),a.dataset.categoriesMultiselectAttached||(e&&(e.addEventListener("click",E=>{E.preventDefault(),h(!a.classList.contains("is-open"))}),e.addEventListener("keydown",E=>{E.key==="Escape"&&h(!1)})),document.addEventListener("click",E=>{a.classList.contains("is-open")&&(a.contains(E.target)||h(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",w),u.dataset.listenerAttached="true"),o.dataset.listenerAttached||(o.addEventListener("change",_),o.dataset.listenerAttached="true"),a.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=k})();(function(){"use strict";let k=" \xB7 ",r=e=>{if(!e)return"";let i=e.options?e.options[e.selectedIndex]:null;return i?i.textContent.trim():""},n=e=>!e||!e.options?[]:Array.from(e.options).filter(i=>i.selected&&i.value).map(i=>i.textContent.trim()).filter(Boolean),t=(e,i)=>{let d=e.filter(Boolean);return d.length?d.join(k):i},a=(e,i)=>{if(!e)return;e.textContent=i,e.title=i;let d=e.closest(".aipkit_cw_settings_summary_text");d&&(d.title=i);let u=e.dataset.aipkitPlaceholder,p=e.dataset.aipkitDisabledLabel,f="active";p&&i===p?f="disabled":u&&i===u&&(f="placeholder"),e.dataset.aipkitSummaryState=f},s=e=>String(e||"").trim().toLowerCase(),l=(e,i,d=null)=>{if(!e)return;let u="aipkit_settings_select_picker_icon--";e.classList.forEach(g=>{g.startsWith(u)&&e.classList.remove(g)});let p=s(i),f=!d||d.includes(p),m=!!(p&&f);e.hidden=!m,m&&e.classList.add(`${u}${p}`)},c=e=>{if(!e)return;let i=document.getElementById("aipkit_content_writer_form"),d=i?i.classList.contains("aipkit_cw_mode_existing_images"):!1,u=e.querySelector('[data-aipkit-cw-summary="ai"]');if(u){let g=u.dataset.aipkitPlaceholder||"Not set",_=r(e.querySelector("#aipkit_content_writer_provider")),w=r(e.querySelector("#aipkit_content_writer_model"));a(u,t([w],g));let h=e.querySelector("#aipkit_content_writer_provider")?.value,E=u.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");l(E,h)}let p=e.querySelector('[data-aipkit-cw-summary="images"]');if(p){let g=p.dataset.aipkitPlaceholder||"Not set",_=p.dataset.aipkitDisabledLabel||"Disabled",w=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],h=e.querySelector("#aipkit_cw_generate_images_enabled"),E=e.querySelector("#aipkit_cw_generate_featured_image"),x=h&&h.checked||E&&E.checked,v=e.querySelector("#aipkit_cw_image_provider"),I=v?v.value:"",P=r(v),b=r(e.querySelector("#aipkit_cw_image_model")),y=p.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),S=["openai","google","azure","replicate"];if(l(y,I,S),d){l(y,"",S);let C=w.map(A=>{let M=e.querySelector(A);if(!M||!M.checked)return"";let $=M.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return $?$.textContent.trim():""}).filter(Boolean);a(p,t(C,_||g))}else x?S.includes(I)?a(p,t([b],g)):["pexels","pixabay"].includes(I)?a(p,t([P],g)):a(p,t([P,b],g)):(l(y,"",S),a(p,_))}let f=e.querySelector('[data-aipkit-cw-summary="vector"]');if(f){let g=f.dataset.aipkitPlaceholder||"Not set",_=f.dataset.aipkitDisabledLabel||"Disabled",w=e.querySelector("#aipkit_cw_enable_vector_store"),h=f.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),E=["openai","pinecone","qdrant"];if(w&&!w.checked)l(h,"",E),a(f,_);else{let x=e.querySelector("#aipkit_cw_vector_store_provider"),v=x?x.value:"",I="";if(v==="openai"){let P=e.querySelector("#aipkit_cw_openai_vector_store_ids");I=n(P).join(", ")}else v==="pinecone"?I=r(e.querySelector("#aipkit_cw_pinecone_index_name")):v==="qdrant"&&(I=r(e.querySelector("#aipkit_cw_qdrant_collection_name")));l(h,v,E),a(f,t([I],g))}}let m=e.querySelector('[data-aipkit-cw-summary="post"]');if(m){let g=m.dataset.aipkitPlaceholder||"Not set",_=r(e.querySelector("#aipkit_content_writer_post_status"));a(m,t([_],g))}};function o(e){let i=e||document.getElementById("aipkit_content_writer_container");if(!i||i.dataset.cwSummaryAttached==="true")return;let d=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],u=p=>d.some(f=>p.matches(f));i.addEventListener("change",p=>{let f=p.target;!f||!u(f)||c(i)}),c(i),i.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=o,window.aipkit_updateContentWriterSettingsSummary=function(){let e=document.getElementById("aipkit_content_writer_container");c(e)}})();(function(){"use strict";let k=window.wp?.i18n?.__||function(C){return C},r="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",n=null,t=null,a=!1,s=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),l=C=>!!(C&&C.id&&s.has(C.id)),c=C=>!!(C&&C.dataset?.aipkitPickerIcons==="assistant-position"),o=C=>!!(C&&(l(C)||c(C)||C.id==="aipkit_cw_pinecone_index_name"||C.id==="aipkit_cw_qdrant_collection_name"||C.id==="aipkit_cw_vector_embedding_model")),e=(C,A)=>{if(!C)return!1;let M=i(A);return M?C.id==="aipkit_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(M):C.id==="aipkit_task_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(M):C.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(M):C.id==="aipkit_task_cw_vector_store_provider"||C.id==="aipkit_task_ce_vector_store_provider"||C.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(M):C.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(M):C.id==="aipkit_task_cw_vector_embedding_provider"||C.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(M):["openai","openrouter","claude","google","azure","deepseek","ollama"].includes(M):!1},i=C=>String(C||"").trim().toLowerCase(),d=(C,A,M)=>{if(!C)return;let $="aipkit_settings_select_picker_icon--";C.classList.forEach(N=>{N.startsWith($)&&C.classList.remove(N)});let W=i(M),H=e(A,W);C.hidden=!H,H&&C.classList.add(`${$}${W}`)},u=(C,A)=>{if(!C)return;let M="aipkit_settings_select_picker_icon--assistant-";C.classList.forEach(W=>{W.startsWith(M)&&C.classList.remove(W)});let $=String(A||"").trim().toLowerCase();C.hidden=!$,$&&C.classList.add(`${M}${$}`)},p=C=>C&&(C.selectedOptions&&C.selectedOptions.length?C.selectedOptions[0]:C.querySelector("option[selected]"))?.dataset?.icon||"",f=C=>{if(!C)return"";let A=C.getAttribute("data-aipkit-picker-title");if(A)return A;let M=C.id&&document.querySelector(`label[for="${C.id}"]`)||C.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return M?M.textContent.trim():""},m=C=>{if(!C)return"";let A=C.selectedOptions&&C.selectedOptions.length?C.selectedOptions[0]:C.querySelector("option[selected]");if(A)return A.textContent.trim();let M=C.querySelector("option");return M?M.textContent.trim():""},g=C=>({buttonId:`${C}_picker_btn`,labelId:`${C}_picker_label`,popoverId:`${C}_picker_popover`,titleId:`${C}_picker_title`,searchId:`${C}_picker_search`,listId:`${C}_picker_list`}),_=C=>C?C.closest("#aipkit_cw_builder_sheet")||C.closest("#aipkit_content_writer_container")||C.closest("#aipkit_autogpt_container")||C.closest("#aipkit_ai_forms_container"):null,w=C=>{if(!C||!C.id)return null;let A=g(C.id),M=_(C);if(!M)return null;let $=document.getElementById(A.buttonId);if(!$){if($=document.createElement("button"),$.type="button",$.id=A.buttonId,$.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",$.setAttribute("data-aipkit-popover-target",A.popoverId),$.setAttribute("aria-controls",A.popoverId),$.setAttribute("aria-expanded","false"),$.dataset.aipkitPopoverPlacement="bottom",l(C)){$.classList.add("aipkit_settings_select_picker_btn--provider");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),d(G,C,C.value),$.appendChild(G)}else if(c(C)){let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),u(G,p(C)),$.appendChild(G)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_label",H.id=A.labelId,H.textContent=m(C)||k("Select","gpt3-ai-content-generator");let N=document.createElement("span");N.className="dashicons dashicons-arrow-down-alt2",N.setAttribute("aria-hidden","true"),$.appendChild(H),$.appendChild(N),C.insertAdjacentElement("beforebegin",$)}C.classList.contains("screen-reader-text")||C.classList.add("screen-reader-text");let W=document.getElementById(A.popoverId);if(!W){W=document.createElement("div"),W.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",W.id=A.popoverId,W.setAttribute("aria-hidden","true"),l(C)&&W.classList.add("aipkit_settings_select_picker_popover--provider");let H=document.createElement("div");H.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",H.setAttribute("role","dialog"),H.setAttribute("aria-labelledby",A.titleId);let N=document.createElement("div");N.className="aipkit_model_settings_popover_header";let G=document.createElement("span");G.className="aipkit_model_settings_popover_title",G.id=A.titleId,G.textContent=f(C)||k("Select","gpt3-ai-content-generator");let Q=document.createElement("button");Q.type="button",Q.className="aipkit_model_settings_popover_close",Q.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),Q.innerHTML='<span class="dashicons dashicons-no-alt"></span>',N.appendChild(G),N.appendChild(Q);let F=document.createElement("div");F.className="aipkit_model_settings_popover_body";let L=document.createElement("div");L.className="aipkit_settings_select_picker_search";let O=document.createElement("input");O.type="search",O.id=A.searchId,O.className="aipkit_form-input";let D=f(C),R=D?`Search ${D.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");O.setAttribute("placeholder",R),L.appendChild(O);let Z=document.createElement("div");Z.className="aipkit_settings_select_picker_list",Z.id=A.listId,Z.setAttribute("role","listbox"),F.appendChild(L),F.appendChild(Z),H.appendChild(N),H.appendChild(F),W.appendChild(H),M.appendChild(W),o(C)&&(L.style.display="none")}return{ids:A,button:$,popover:W,label:document.getElementById(A.labelId),search:document.getElementById(A.searchId),list:document.getElementById(A.listId)}},h=C=>{let A=[];return C&&Array.from(C.children).forEach($=>{if($.tagName==="OPTGROUP"){let W=Array.from($.children).filter(H=>H.tagName==="OPTION").map(H=>({value:H.value,label:H.textContent.trim(),disabled:H.disabled,selected:H.selected,icon:H.dataset?.icon||""}));A.push({label:$.label,options:W})}else $.tagName==="OPTION"&&A.push({label:"",options:[{value:$.value,label:$.textContent.trim(),disabled:$.disabled,selected:$.selected,icon:$.dataset?.icon||""}]})}),A},E=(C,A,M="")=>{if(!C||!A)return;A.innerHTML="";let $=h(C),W=M.trim().toLowerCase(),H=!1;if($.forEach(N=>{let G=N.options.filter(Q=>W?Q.label.toLowerCase().includes(W):!0);if(G.length){if(N.label){let Q=document.createElement("div");Q.className="aipkit_settings_select_picker_group_label",Q.textContent=N.label,A.appendChild(Q)}G.forEach(Q=>{let F=document.createElement("button");if(F.type="button",F.className="aipkit_settings_select_picker_item",Q.disabled&&F.classList.add("is-disabled"),Q.selected&&F.classList.add("is-active"),F.dataset.value=Q.value,l(C)&&e(C,Q.value)){let D=document.createElement("span");D.className="aipkit_settings_select_picker_icon",D.setAttribute("aria-hidden","true"),d(D,C,Q.value),F.appendChild(D)}else if(c(C)&&Q.icon){let D=document.createElement("span");D.className="aipkit_settings_select_picker_icon",D.setAttribute("aria-hidden","true"),u(D,Q.icon),F.appendChild(D)}let L=document.createElement("span");L.className="aipkit_settings_select_picker_text",L.textContent=Q.label||Q.value;let O=document.createElement("span");O.className="dashicons dashicons-yes aipkit_settings_select_picker_check",O.setAttribute("aria-hidden","true"),F.appendChild(L),F.appendChild(O),A.appendChild(F),H=!0})}}),!H){let N=document.createElement("div");N.className="aipkit_settings_select_picker_empty",N.textContent=k(W?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild(N)}},x=(C,A)=>{if(!C||!A)return;let M=m(C);if(A.textContent=M||k("Select","gpt3-ai-content-generator"),l(C)){let $=A.closest("button"),W=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;d(W,C,C.value)}else if(c(C)){let $=A.closest("button"),W=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;u(W,p(C))}},v=(C,A)=>{if(!C||!A)return;let M=C.getBoundingClientRect(),$=A.getBoundingClientRect(),W=$.width||320,H=$.height||0,N=window.innerWidth,G=window.innerHeight,Q=12;if(C.dataset.aipkitPopoverPlacement==="bottom"){let O=M.left;O+W>N-Q&&(O=M.right-W),O=Math.max(Q,Math.min(O,N-W-Q));let D=M.bottom+8;D+H>G-Q&&(D=M.top-H-8),D=Math.max(Q,Math.min(D,G-H-Q)),A.style.left=`${Math.round(O)}px`,A.style.top=`${Math.round(D)}px`;return}let F=M.right+10;F+W>N-Q&&(F=M.left-W-10),F=Math.max(Q,Math.min(F,N-W-Q));let L=M.top;L+H>G-Q&&(L=G-H-Q),L=Math.max(Q,L),A.style.left=`${Math.round(F)}px`,A.style.top=`${Math.round(L)}px`},I=()=>{!n||!t||a||(a=!0,window.requestAnimationFrame(()=>{let C=n.querySelector(".aipkit_model_settings_popover_panel");v(t,C),a=!1}))},P=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),t&&t.setAttribute("aria-expanded","false"),n=null,t=null)},b=(C,A,M)=>{if(!C||!A)return;n&&n!==A&&P(),n=A,t=C,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),C.setAttribute("aria-expanded","true");let $=A.querySelector(".aipkit_settings_select_picker_search input"),W=A.querySelector(".aipkit_settings_select_picker_list");W&&E(M,W,$?$.value:""),$&&$.offsetParent!==null&&($.focus(),$.select());let H=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{v(C,H)})},y=(C,A)=>{if(!C||!A)return;let{button:M,popover:$,list:W,search:H}=A;if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",N=>{if(N.preventDefault(),n===$){P();return}b(M,$,C)}),M.dataset.pickerListenerAttached="true"),$&&$.dataset.overlayListenerAttached!=="true"){$.addEventListener("click",G=>{G.target===$&&P()});let N=$.querySelector(".aipkit_model_settings_popover_close");N&&N.addEventListener("click",G=>{G.preventDefault(),P()}),$.dataset.overlayListenerAttached="true"}if(W&&W.dataset.pickerListenerAttached!=="true"&&(W.addEventListener("click",N=>{let G=N.target.closest(".aipkit_settings_select_picker_item");if(!G||G.classList.contains("is-disabled"))return;let Q=G.dataset.value??"";C.value=Q,C.dispatchEvent(new Event("change",{bubbles:!0})),x(C,A.label),E(C,W,H?H.value:""),P()}),W.dataset.pickerListenerAttached="true"),H&&H.dataset.pickerListenerAttached!=="true"&&(H.addEventListener("input",()=>{E(C,W,H.value)}),H.dataset.pickerListenerAttached="true"),C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("change",()=>{x(C,A.label),E(C,W,H?H.value:"")}),C.dataset.pickerListenerAttached="true"),C&&C.dataset.pickerObserverAttached!=="true"){let N=!1;new MutationObserver(()=>{N||(N=!0,window.requestAnimationFrame(()=>{x(C,A.label),E(C,W,H?H.value:""),N=!1}))}).observe(C,{childList:!0,subtree:!0}),C.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",N=>{N.key==="Escape"&&n&&P()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",I),window.addEventListener("scroll",I,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function S(){let C=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);C.length&&C.forEach(A=>{let M=A.querySelectorAll(r);M.length&&M.forEach($=>{if(!$.id||$.dataset.aipkitPickerInit==="true")return;let W=w($);W&&(x($,W.label),E($,W.list,W.search?W.search.value:""),y($,W),$.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=S,window.aipkit_refreshContentWriterSelectPickers=function(){let C=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);C.length&&C.forEach(A=>{let M=A.querySelectorAll(r);M.length&&M.forEach($=>{if(!$.id)return;let W=w($);W&&(x($,W.label),E($,W.list,W.search?W.search.value:""),y($,W),$.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function k(c){c||(c=document.getElementById("aipkit_content_writer_container")),c&&(r(c),t(c),a(c))}function r(c){let o=c.querySelectorAll(".aipkit_ai_reasoning_input"),e=c.querySelector("#aipkit_content_writer_reasoning_effort");!o.length||!e||(o.forEach(i=>{i.addEventListener("change",function(){if(this.checked){e.value=this.value,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let d=this.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected");let u=new Event("change",{bubbles:!0});e.dispatchEvent(u)}})}),n(c))}function n(c){let o=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!o)return;let e=o.value||"medium";e==="minimal"&&(e="low");let i=c.querySelector(`.aipkit_ai_reasoning_input[value="${e}"]`);if(i&&!i.checked){i.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>{u.classList.remove("aipkit_ai_reasoning_option--selected")});let d=i.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected")}}function t(c){let o=c.querySelector("#aipkit_content_writer_temperature"),e=c.querySelector("#aipkit_content_writer_temperature_value");!o||!e||o.dataset.enhancedListenerAttached!=="true"&&(o.addEventListener("input",function(){e.textContent=this.value}),o.dataset.enhancedListenerAttached="true")}function a(c){let o=c.querySelector("#aipkit_content_writer_content_length_slider"),e=c.querySelector("#aipkit_content_writer_content_length_value"),i=c.querySelector("#aipkit_content_writer_content_length_hint"),d=c.querySelector("#aipkit_content_writer_content_length");if(!o||!e||!i||!d||o.dataset.enhancedListenerAttached==="true")return;let u=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],p="medium",f=_=>{let w=u.findIndex(h=>h.key===_);return w===-1?u.findIndex(h=>h.key===p):w},m=_=>{let w=f(_),h=u[w];e.textContent=h.label,i.textContent=`Approx. ${h.words} words`,o.value=String(w+1)},g=(_,w=!1)=>{let h=u.some(E=>E.key===_)?_:p;d.value!==h&&(d.value=h),m(h),w&&d.dispatchEvent(new Event("change",{bubbles:!0}))};o.addEventListener("input",function(){let _=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,w=u[_]?.key||p;g(w,!0)}),d.addEventListener("change",function(){g(this.value,!1)}),g(d.value||p,!1),o.dataset.enhancedListenerAttached="true"}function s(c,o){if(!c||!o)return;let e=c.querySelector("#aipkit_content_writer_reasoning_effort");e&&(e.value=o==="minimal"?"low":o);let i=c.querySelector(`.aipkit_ai_reasoning_input[value="${o==="minimal"?"low":o}"]`);if(i){i.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>{u.classList.remove("aipkit_ai_reasoning_option--selected")});let d=i.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected")}}function l(c){if(!c)return"medium";let o=c.querySelector(".aipkit_ai_reasoning_input:checked");if(o)return o.value;let e=c.querySelector("#aipkit_content_writer_reasoning_effort");return e?e.value:"medium"}window.aipkit_initAiSettingsRedesigned=k,window.aipkit_setReasoningEffort=s,window.aipkit_getReasoningEffort=l})();(function(){"use strict";function k(r,n,t,a,s,l){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(r,n):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(t):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(s):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(l,s):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let c=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(c)}}window.aipkit_initContentWriterUI=k})();(function(){"use strict";let k={intervalId:null,startTime:null};function r(c){let o=Math.floor(c/1e3),e=Math.floor(o/60),i=o%60;return`${e}:${String(i).padStart(2,"0")}`}function n(c){if(!c)return null;let o=c.querySelector(".aipkit_cw_btn_timer");if(o)return o;o=document.createElement("span"),o.className="aipkit_cw_btn_timer",o.setAttribute("aria-hidden","true"),o.hidden=!0;let e=c.querySelector(".aipkit_btn-text");return e?c.insertBefore(o,e):c.insertBefore(o,c.firstChild),o}function t(c){if(!c||k.intervalId)return;let o=n(c);if(!o)return;k.startTime=Date.now();let e=()=>{let i=Date.now()-k.startTime;o.textContent=r(i),o.hidden=!1};e(),k.intervalId=window.setInterval(e,1e3)}function a(c){k.intervalId&&(clearInterval(k.intervalId),k.intervalId=null),k.startTime=null;let o=n(c);o&&(o.hidden=!0,o.textContent="")}function s(c){let o=document.getElementById("aipkit_content_writer_generate_btn");if(!o)return;let e=o.closest(".aipkit_cw_generate_split"),i=e?e.querySelector(".aipkit_cw_generate_toggle"):null,d=e?e.querySelector(".aipkit_cw_generate_menu"):null,u=d?Array.from(d.querySelectorAll(".aipkit_cw_generate_menu_item")):[],p=document.getElementById("aipkit_content_writer_stop_btn");if(c){if(o.dataset.aipkitStopMode="true",e&&e.classList.add("is-single"),t(o),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(o,"Stop");else{let f=o.querySelector(".aipkit_btn-text");f?f.textContent="Stop":o.textContent="Stop"}o.disabled=!1,o.removeAttribute("aria-disabled"),o.style.display="inline-flex",i&&(i.style.display="none",i.disabled=!0),d&&(d.hidden=!0),u.length&&u.forEach(f=>{f.disabled=!0,f.setAttribute("aria-disabled","true")}),p&&(p.style.display="none");return}o.dataset.aipkitStopMode&&delete o.dataset.aipkitStopMode,a(o),e&&e.classList.remove("is-single"),i&&(i.style.display="",i.disabled=!1,i.removeAttribute("aria-disabled")),u.length&&u.forEach(f=>{f.disabled=!1,f.removeAttribute("aria-disabled")}),p&&(p.style.display="none")}function l(){let c=document.getElementById("aipkit_content_writer_generate_btn"),o=document.getElementById("aipkit_content_writer_stop_btn"),e=c?.dataset?.action||"generate",d={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[e]||"Generate";c&&(a(c),c.dataset.aipkitStopMode&&delete c.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(c,!1,d):(c.disabled=!1,c.textContent=d),c.style.display="inline-flex"),o&&(o.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=s,window.aipkit_resetContentWriterButtons=l})();(function(){"use strict";function k(r){r.current&&(r.current.close(),r.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let n=document.getElementById("aipkit_cw_generated_content_area"),t=document.getElementById("aipkit_content_writer_output_display"),a=document.querySelector(".aipkit_content_writer_output_actions"),s=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn");n&&(n.textContent.trim().length>0||!!n.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!t||!t.classList.contains("aipkit_content_writer_output_error"))?(a&&(a.style.display="flex"),s&&(s.disabled=!1),l&&(l.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(a&&(a.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=k})();(function(){"use strict";function k(l,c,o,e){let i=l.querySelector("[data-csv-upload-zone]"),d=l.querySelector("[data-csv-status]"),u=l.querySelector("[data-csv-status-card]"),p=l.querySelector("[data-csv-status-icon]"),f=l.querySelector("[data-csv-file-name]"),m=l.querySelector("[data-csv-message]");if(!(!d||!u)){if(c==="idle"){i&&i.classList.remove("is-hidden"),d.hidden=!0;return}if(i&&i.classList.add("is-hidden"),d.hidden=!1,u.dataset.status=c,p){let g="dashicons-yes-alt";c==="loading"&&(g="dashicons-update"),c==="error"&&(g="dashicons-warning"),p.innerHTML=`<span class="dashicons ${g}" aria-hidden="true"></span>`;let _=p.querySelector(".dashicons");_&&c==="loading"&&(_.style.animation="aipkit_csv_spin 1s linear infinite")}f&&e?f.textContent=e:f&&(f.textContent=""),m&&(m.textContent=o||"")}}async function r(l){let c=l.target,o=c.closest(".aipkit_csv_import_container")||c.closest(".aipkit_form-group");if(!o)return;let e=o.querySelector("[data-csv-status]")!==null,i=o.querySelector(".aipkit_csv_analysis_results"),d=o.querySelector(".aipkit_csv_data_holder"),u=document.getElementById("aipkit_content_writer_nonce"),p=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,f=u?u.value:p;if(!d||!f){console.error("CSV Handler: Missing data holder or nonce field."),e?k(o,"error","Error: A required component is missing.",null):i&&(i.textContent="Error: A required UI component or security token is missing.",i.className="aipkit_form-help aipkit_settings_message-error");return}let m=c.files[0];if(!m){e?k(o,"idle",null,null):i&&(i.textContent="Please select a CSV file first.",i.className="aipkit_form-help aipkit_settings_message-error");return}if(!m.name.toLowerCase().endsWith(".csv")){e?k(o,"error","Invalid file type. Please upload a .csv file.",m.name):i&&(i.textContent="Invalid file type. Please upload a .csv file.",i.className="aipkit_form-help aipkit_settings_message-error");return}e?k(o,"loading","Parsing CSV...",m.name):i&&(i.textContent="Parsing CSV...",i.className="aipkit_form-help aipkit_settings_message-info");let g=new FormData;g.append("file",m),g.append("_ajax_nonce",f),g.append("action","aipkit_content_writer_parse_csv");try{let _=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:g,credentials:"same-origin"});if(!_.ok){let E=`Server returned status ${_.status}`;try{let x=await _.json();x&&x.data&&x.data.message&&(E=x.data.message)}catch{}throw new Error(E)}let w=await _.json();if(!w.success)throw new Error(w.data?.message||"Unknown server error.");let h=w.data;if(h.tasks_found>0){d.value=h.formatted_data;let x=c.id==="aipkit_task_cw_csv_file_input"||!!c.closest("#aipkit_autogpt_container")?`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;e?k(o,"success",x,m.name):i&&(i.textContent=`Success! Found ${h.tasks_found} topics in the CSV file. Ready.`,i.className="aipkit_form-help aipkit_settings_message-success")}else{d.value="";let E="No valid topics found in the CSV file.";e?k(o,"error",E,m.name):i&&(i.textContent=E,i.className="aipkit_form-help aipkit_settings_message-error")}}catch(_){d.value="";let w=_.message||"Failed to parse CSV file.";e?k(o,"error",w,m.name):i&&(i.textContent=`Error: ${w}`,i.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",_)}}function n(l){let c=l.target.closest("[data-csv-clear]");if(!c)return;let o=c.closest(".aipkit_csv_import_container");if(!o)return;let e=o.querySelector("input[type='file']"),i=o.querySelector(".aipkit_csv_data_holder");e&&(e.value=""),i&&(i.value=""),k(o,"idle",null,null)}function t(l){if(!l||l.dataset.dragDropAttached==="true")return;let c=d=>{d.preventDefault(),d.stopPropagation()},o=()=>l.classList.add("is-dragover"),e=()=>l.classList.remove("is-dragover"),i=d=>{c(d),e();let p=d.dataTransfer.files;if(p.length>0){let f=l.querySelector("input[type='file']");if(f){let m=new DataTransfer;m.items.add(p[0]),f.files=m.files,f.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(d=>{l.addEventListener(d,c,!1)}),["dragenter","dragover"].forEach(d=>{l.addEventListener(d,o,!1)}),["dragleave","drop"].forEach(d=>{l.addEventListener(d,e,!1)}),l.addEventListener("drop",i,!1),l.dataset.dragDropAttached="true"}function a(){let l=document.getElementById("aipkit_cw_csv_file_input");if(!l||l.dataset.listenerAttached==="true")return;l.addEventListener("change",r),l.dataset.listenerAttached="true";let c=l.closest(".aipkit_csv_import_container");if(c){let o=c.querySelector(".aipkit_csv_dropzone");t(o);let e=c.querySelector("[data-csv-clear]");e&&e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",n),e.dataset.listenerAttached="true")}}function s(){let l=document.getElementById("aipkit_task_cw_csv_file_input");if(!l||l.dataset.listenerAttached==="true")return;l.addEventListener("change",r),l.dataset.listenerAttached="true";let c=l.closest(".aipkit_csv_import_container");if(c){let o=c.querySelector(".aipkit_csv_dropzone");t(o);let e=c.querySelector("[data-csv-clear]");e&&e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",n),e.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=a,window.aipkit_initTaskCsvUploadHandler=s})();(function(){"use strict";function k(r,n){let t=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!t||!t.value)throw new Error("Security token missing for stream. Please reload.");let a=new URL(window.aipkit_dashboard.ajaxurl);a.searchParams.append("action","aipkit_frontend_chat_stream"),a.searchParams.append("cache_key",r),a.searchParams.append("_ajax_nonce",t.value),n.current&&n.current.close();try{let s=new EventSource(a.toString());return s.userStopped=!1,s}catch(s){throw console.error("EventSource Connection Setup: EventSource creation error:",s),new Error("Could not connect to stream. "+s.message)}}window.aipkit_stream_setupEventSourceConnection=k})();(function(){"use strict";function k(n){let t=n.parentElement,a=t?.closest(".aipkit_cw_output_chunk--primary");a&&(t.scrollHeight>t.clientHeight?a.classList.add("has-overflow"):a.classList.remove("has-overflow"))}function r(n,t,a,s){if(n.data)try{let l=JSON.parse(n.data);if(l.delta){if(t.fullContent+=l.delta,a.classList.contains("is-streaming")||a.classList.add("is-streaming"),!s&&typeof window.aipkit_getMarkdownRenderer=="function"&&(s=window.aipkit_getMarkdownRenderer()),s)a.innerHTML=s.render(t.fullContent);else{let o=a.textContent||"";a.textContent=o+l.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(a.innerHTML);let c=a.parentElement;c&&c.scrollTo({top:c.scrollHeight,behavior:"smooth"}),k(a),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(l){console.error("Stream Message Handler: Error parsing event data.",l)}}window.aipkit_stream_handleMessage=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};async function r(n,t,a,s,l,c){if(t.isDone)return;t.isDone=!0,c&&c.current&&(c.current.close(),c.current=null),a.classList.contains("is-streaming")&&a.classList.remove("is-streaming"),!s&&typeof window.aipkit_getMarkdownRenderer=="function"&&(s=window.aipkit_getMarkdownRenderer()),s&&(a.innerHTML=s.render(t.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(a.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let o=document.getElementById("aipkit_content_writer_form"),e=o?o.elements.generate_meta_description:null,i=o?o.elements.generate_focus_keyword:null,d=o?o.elements.generate_excerpt:null,u=o?o.elements.generate_tags:null,p=document.getElementById("aipkit_content_writer_nonce")?.value,f=o.elements.ai_provider?.value,m=o.elements.ai_model?.value,g=o.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",_=document.getElementById("aipkit_cw_generated_title_display"),w=_?_.textContent:o.elements.content_title?.value.split("|")[0].trim()||"Untitled",h=o.elements.content_keywords?.value.trim()||"",E="",x=document.getElementById("aipkit_content_writer_title");if(x){let S=x.value.split("|")||[];S.length>1&&(E=S[1].trim())}let v=E||h,I=v;if(i?.checked&&!v&&t.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let S=o.elements.enable_vector_store,C=S&&S.checked?"1":"0",A=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(L=>L.value):[],W=o.elements.pinecone_index_name?.value,H=o.elements.qdrant_collection_name?.value,N=o.elements.vector_store_top_k?.value,G=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:t.fullContent,final_title:w,provider:f,model:m,prompt_mode:g,custom_keyword_prompt:o.elements.custom_keyword_prompt.value,enable_vector_store:C,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",Q);if(F&&F.focus_keyword){I=F.focus_keyword;let L=document.getElementById("aipkit_cw_generated_focus_keyword"),O=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");L&&O&&(L.value=I,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",S.message||"Failed")}}else if(v){let S=document.getElementById("aipkit_cw_generated_focus_keyword"),C=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");S&&C&&(S.value=v.split(",")[0].trim(),C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let P=o?o.elements.generate_images_enabled:null,b=o?o.elements.generate_featured_image:null;if((P?.checked||b?.checked)&&t.fullContent.trim()!==""){let S=P?.checked,C=b?.checked,A=String(o.elements.image_provider?.value||"").toLowerCase(),M=String(o.elements.image_model?.value||"").toLowerCase(),$=A==="openai"&&M.startsWith("gpt-image-1"),W=S?parseInt(o.elements.image_count?.value,10)||1:0,H=document.getElementById("aipkit_cw_generated_excerpt"),N=W+(C?1:0),G=S&&C?W>1?`Generating ${W} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":C?"Generating featured image...":S?W>1?`Generating ${W} content images...`:"Generating content image...":N>1?`Generating ${N} images...`:N===1?"Generating 1 image...":"Generating images...",Q={original_topic:x?x.value.split("|")[0].trim():w,final_title:w,post_title:w,keywords:I,excerpt:H?H.value:"",ai_provider:o.elements.ai_provider?.value,ai_model:o.elements.ai_model?.value,ai_temperature:o.elements.ai_temperature?.value,reasoning_effort:o.elements.reasoning_effort?.value,image_provider:o.elements.image_provider?.value,image_model:o.elements.image_model?.value,image_prompt:o.elements.image_prompt?.value,image_alignment:o.elements.image_alignment?.value,image_size:o.elements.image_size?.value,featured_image_prompt:o.elements.featured_image_prompt?.value,generate_image_title:o.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:o.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:o.elements.generate_image_caption?.checked?"1":"0",generate_image_description:o.elements.generate_image_description?.checked?"1":"0",image_title_prompt:o.elements.image_title_prompt?.value,image_alt_text_prompt:o.elements.image_alt_text_prompt?.value,image_caption_prompt:o.elements.image_caption_prompt?.value,image_description_prompt:o.elements.image_description_prompt?.value,pexels_orientation:o.elements.pexels_orientation?.value,pexels_size:o.elements.pexels_size?.value,pexels_color:o.elements.pexels_color?.value,pixabay_orientation:o.elements.pixabay_orientation?.value,pixabay_image_type:o.elements.pixabay_image_type?.value,pixabay_category:o.elements.pixabay_category?.value,_ajax_nonce:p,generate_images_enabled:S?"1":"0",image_count:W,generate_featured_image:C?"1":"0",image_placement:o.elements.image_placement?.value,image_placement_param_x:o.elements.image_placement_param_x?.value,cw_generation_mode:o.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},F=O=>{let D=document.getElementById("aipkit_cw_image_data_holder");D&&(D.value=JSON.stringify(O)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(O)},L=async(O={},D="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&D&&window.aipkit_updateCwGenerationStatus("image","generating",D);let R=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...Q,...O});if(!R?.image_data)throw new Error("Image generation failed or returned no data.");return R.image_data};try{let O=S&&C,D=$&&S&&W>1,R=null,Z=J=>{R||(R={...J,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(O){if(S&&W>0)if(D&&W>1)for(let J=0;J<W;J++){let pe=await L({generate_featured_image:"0",image_count:1,image_start_index:J+1},`Generating content image ${J+1} of ${W}...`);Z(pe),Array.isArray(pe.in_content_images)&&R.in_content_images.push(...pe.in_content_images),F(R)}else{let J=await L({generate_featured_image:"0"},W>1?`Generating ${W} content images...`:"Generating content image...");Z(J),R.in_content_images=J.in_content_images||[],F(R)}if(C){let J=await L({generate_images_enabled:"0",image_count:0},"Generating featured image...");Z(J),R.featured_image_id=J.featured_image_id||null,R.featured_image_url=J.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",G),R=await L();if(R)F(R),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(O){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",O.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(d?.checked&&t.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let S=o.elements.enable_vector_store,C=S&&S.checked?"1":"0",A=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(L=>L.value):[],W=o.elements.pinecone_index_name?.value,H=o.elements.qdrant_collection_name?.value,N=o.elements.vector_store_top_k?.value,G=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:t.fullContent,final_title:w,keywords:I,provider:f,model:m,prompt_mode:g,custom_excerpt_prompt:o.elements.custom_excerpt_prompt.value,enable_vector_store:C,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",Q);if(F&&F.excerpt){let L=document.getElementById("aipkit_cw_generated_excerpt"),O=document.getElementById("aipkit_cw_excerpt_output_wrapper");L&&O&&(L.value=F.excerpt,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",S.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(u?.checked&&t.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let S=o.elements.enable_vector_store,C=S&&S.checked?"1":"0",A=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(L=>L.value):[],W=o.elements.pinecone_index_name?.value,H=o.elements.qdrant_collection_name?.value,N=o.elements.vector_store_top_k?.value,G=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:t.fullContent,final_title:w,keywords:I,provider:f,model:m,prompt_mode:g,custom_tags_prompt:o.elements.custom_tags_prompt.value,enable_vector_store:C,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",Q);if(F&&F.tags){let L=document.getElementById("aipkit_cw_generated_tags"),O=document.getElementById("aipkit_cw_tags_output_wrapper");L&&O&&(L.value=F.tags,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",S.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(e?.checked&&t.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let S=o.elements.enable_vector_store,C=S&&S.checked?"1":"0",A=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(L=>L.value):[],W=o.elements.pinecone_index_name?.value,H=o.elements.qdrant_collection_name?.value,N=o.elements.vector_store_top_k?.value,G=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:t.fullContent,final_title:w,keywords:I,provider:f,model:m,prompt_mode:g,custom_meta_prompt:o.elements.custom_meta_prompt.value,enable_vector_store:C,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",Q);if(F&&F.meta_description){let L=document.getElementById("aipkit_cw_generated_meta_desc"),O=document.getElementById("aipkit_cw_meta_desc_output_wrapper");L&&O&&(L.value=F.meta_description,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",S.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleDone=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};function r(n,t,a,s,l){if(t.isDone)return;if(l.current&&l.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l);return}let c="Error during streaming.";if(n.data)try{c=JSON.parse(n.data).error||c}catch{}console.error("Stream Error Handler: Error event received:",n),a&&(a.textContent="",a.className="aipkit_cw_status_badge"),s&&s.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",c),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l)}window.aipkit_stream_handleError=r})();(function(){"use strict";let k={current:null};function r(n,t){let a=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_form_status");if(!a||!s||!l){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let c=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let e of c)if(typeof window[e]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${e}`),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let o={fullContent:"",isDone:!1};s.innerHTML="",a.classList.remove("aipkit_content_writer_output_error"),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{t.current=window.aipkit_stream_setupEventSourceConnection(n,t);let e=window.aipkit_getMarkdownRenderer();t.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},t.current.onmessage=function(i){window.aipkit_stream_handleMessage(i,o,s,e)},t.current.addEventListener("done",function(i){window.aipkit_stream_handleDone(i,o,s,e,l,t)}),t.current.addEventListener("error",function(i){window.aipkit_stream_handleError(i,o,l,a,t)})}catch(e){console.error("EventSource Orchestrator: Error during setup:",e),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=r,window.aipkit_contentWriterEventSourceInstanceRef=k})();(function(){"use strict";function k(r){r&&r.current&&r.current.close()}window.aipkit_stopContentWriterEventSource=k})();(function(){"use strict";async function k(r){let n=document.getElementById("aipkit_content_writer_form"),t=document.getElementById("aipkit_content_writer_generate_btn"),a=document.getElementById("aipkit_content_writer_form_status"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),o=document.querySelector(".aipkit_content_writer_progress_bar_container"),e=document.querySelector(".aipkit_content_writer_output_actions"),i=function(m){if(!m)return"Error";let g=m.message||"Error",_=m.details||m.data?.details,w=_?.provider,h=_?.model;return w||h?`${g} (${[w,h].filter(Boolean).join(" \xB7 ")})`:g};if(!n||!t||!a||!s||!l||!c||!e){console.error("Handle SSE: Missing UI elements.");return}let d=new FormData(n),u=Object.fromEntries(d.entries()),p=n.elements["openai_vector_store_ids[]"];if(u.openai_vector_store_ids=p?Array.from(p.selectedOptions).map(m=>m.value):[],delete u["openai_vector_store_ids[]"],!u.conversation_uuid){let m=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();m&&(u.conversation_uuid=m)}if(!u.content_title){a.textContent="",a.className="aipkit_cw_status_badge";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)u._ajax_nonce=f.value;else{a.textContent="",a.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),o&&(o.style.display="none"),e.style.display="none",s&&(s.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),l.disabled=!0,c.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),a.textContent="",a.className="aipkit_cw_status_badge";try{u.content_title=document.getElementById("aipkit_content_writer_title").value;let m=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",u);if(!m.cache_key)throw new Error(m.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=m.cache_key,m.conversation_uuid){window.aipkit_current_conversation_uuid=m.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",m.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(m.cache_key,r);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(m){console.error("Content Writer Init Stream Error:",m),a&&(a.textContent=i(m),a.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(t,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),s&&(s.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t},r=function(t){if(!t)return"Error";let a=t.message||"Error",s=t.details||t.data?.details,l=s?.provider,c=s?.model;return l||c?`${a} (${[l,c].filter(Boolean).join(" \xB7 ")})`:a};async function n(){let t=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_content_writer_generate_btn"),s=document.getElementById("aipkit_content_writer_stop_btn"),l=document.getElementById("aipkit_content_writer_form_status"),c=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_copy_btn"),e=document.getElementById("aipkit_content_writer_clear_btn"),i=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=i?i.querySelector(".aipkit_content_writer_progress_bar"):null,u=document.querySelector(".aipkit_content_writer_output_actions"),p=document.getElementById("aipkit_cw_status_display_container");if(!t||!a||!s||!l||!c||!o||!e){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),l.textContent="",l.className="aipkit_cw_status_badge";return}let f=new FormData(t),m=Object.fromEntries(f.entries()),g=t.elements["openai_vector_store_ids[]"];if(m.openai_vector_store_ids=g?Array.from(g.selectedOptions).map(v=>v.value):[],delete m["openai_vector_store_ids[]"],!m.conversation_uuid){let v=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();v&&(m.conversation_uuid=v)}if(!m.content_title){l.textContent="",l.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let _=document.getElementById("aipkit_content_writer_nonce");if(_&&_.value)m._ajax_nonce=_.value;else{l.textContent="",l.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}p&&(p.style.display="block");let w=document.getElementById("aipkit_cw_generate_meta_desc"),h=document.getElementById("aipkit_cw_generate_focus_keyword"),E=document.getElementById("aipkit_cw_generate_excerpt"),x=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",E?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",x?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",h?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(a,!0,"Generate","Generating..."),s.style.display="none",u&&(u.style.display="none"),c&&(c.innerHTML=""),o.disabled=!0,e.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),l.textContent="Generating content, please wait...",l.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),i&&d&&(i.style.display="block",d.style.width="0%",d.classList.add("aipkit_indeterminate"));try{let v=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",m);if(v.content){if(v.conversation_uuid){window.aipkit_current_conversation_uuid=v.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",v.conversation_uuid)}catch{}}let I=window.aipkit_getMarkdownRenderer();if(c&&(I?c.innerHTML=I.render(v.content):c.textContent=v.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(c.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),u&&(u.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),o.disabled=!1,e.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),v.content&&E?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let P=t.elements.enable_vector_store,b=P&&P.checked?"1":"0",y=t.elements.vector_store_provider?.value,S=t.elements["openai_vector_store_ids[]"],C=S?Array.from(S.selectedOptions).map(G=>G.value):[],A=t.elements.pinecone_index_name?.value,M=t.elements.qdrant_collection_name?.value,$=t.elements.vector_store_top_k?.value,W=t.elements.vector_store_confidence_threshold?.value,H={generated_content:v.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_excerpt_prompt:m.custom_excerpt_prompt,enable_vector_store:b,vector_store_provider:y,openai_vector_store_ids:C,pinecone_index_name:A,qdrant_collection_name:M,vector_store_top_k:$,vector_store_confidence_threshold:W,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},N=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",H);if(N&&N.excerpt){let G=document.getElementById("aipkit_cw_generated_excerpt"),Q=document.getElementById("aipkit_cw_excerpt_output_wrapper");G&&Q&&(G.value=N.excerpt,Q.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(P){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",P.message||"Not returned")}}if(v.content&&x?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let P=t.elements.enable_vector_store,b=P&&P.checked?"1":"0",y=t.elements.vector_store_provider?.value,S=t.elements["openai_vector_store_ids[]"],C=S?Array.from(S.selectedOptions).map(G=>G.value):[],A=t.elements.pinecone_index_name?.value,M=t.elements.qdrant_collection_name?.value,$=t.elements.vector_store_top_k?.value,W=t.elements.vector_store_confidence_threshold?.value,H={generated_content:v.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_tags_prompt:m.custom_tags_prompt,enable_vector_store:b,vector_store_provider:y,openai_vector_store_ids:C,pinecone_index_name:A,qdrant_collection_name:M,vector_store_top_k:$,vector_store_confidence_threshold:W,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},N=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",H);if(N&&N.tags){let G=document.getElementById("aipkit_cw_generated_tags"),Q=document.getElementById("aipkit_cw_tags_output_wrapper");G&&Q&&(G.value=N.tags,Q.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(P){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",P.message||"Not returned")}}if(v.meta_description){let P=document.getElementById("aipkit_cw_generated_meta_desc"),b=document.getElementById("aipkit_cw_meta_desc_output_wrapper");P&&b&&(P.value=v.meta_description,b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else w?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(v.focus_keyword){let P=document.getElementById("aipkit_cw_generated_focus_keyword"),b=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");P&&b&&(P.value=v.focus_keyword,b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else h?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(v.message||"No content received.")}catch(v){console.error("Content Writer AJAX Error:",v),l&&(l.textContent=r(v),l.className="aipkit_cw_status_badge aipkit_settings_message-error"),c&&(c.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",v.message),E?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),x?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),w?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),u&&(u.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(a,!1,"Generate"),i&&(i.style.display="none"),d&&d.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(n){return n};function r(n){let t=document.getElementById("aipkit_content_writer_generate_btn"),a=()=>{if(t){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,k("Stopping...","gpt3-ai-content-generator"));else{let l=t.querySelector(".aipkit_btn-text");l?l.textContent=k("Stopping...","gpt3-ai-content-generator"):t.textContent=k("Stopping...","gpt3-ai-content-generator")}t.disabled=!0,t.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){a(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){a(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!n||!n.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let s=document.getElementById("aipkit_content_writer_form_status");s&&(s.textContent=k("Stopping...","gpt3-ai-content-generator"),s.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),s.classList.add("aipkit_settings_message-info")),a(),n.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(n):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=r})();(function(){"use strict";let k={rss:["{description}"],url:["{url_content}"]},r=new Set(["task","csv","gsheets"]),n="{topic}",t=d=>{if(!d)return"Error";let u=d.message||"Error",p=d.details||d.data?.details,f=p?.provider,m=p?.model;return f||m?`${u} (${[f,m].filter(Boolean).join(" \xB7 ")})`:u},a=(d,u)=>{let p=d.querySelector(u);return p?String(p.value||""):""},s=(d,u)=>u.filter(p=>!d.includes(p)),l=(d,u,p)=>{let f=[],m=d==="rss"?"RSS":"URL";return u.length&&f.push(`Title prompt: missing ${u.join(", ")}.`),p.length&&f.push(`Content prompt: missing ${p.join(", ")}.`),f.length?`${m} mode works best when your prompts include the source placeholders.

${f.join(`
`)}

Please update your prompts and try again.`:""},c=(d,u)=>{let p=k[u];if(!p)return{shouldWarn:!1,message:""};let f=a(d,"#aipkit_cw_custom_title_prompt").trim(),m=a(d,"#aipkit_cw_custom_content_prompt").trim(),g=f?s(f,p):[],_=m?s(m,p):p.slice(),w=l(u,g,_);return{shouldWarn:!!w,message:w}},o=(d,u)=>u.length?`${d} mode requires ${n} in your prompts.

${u.join(`
`)}

Please update your prompts and try again.`:"",e=(d,u)=>{if(!r.has(u))return{shouldWarn:!1,message:""};let f={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[u]||"This",m=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_tags")?.checked}],g=[];m.forEach(w=>{if(!w.enabled())return;let h=a(d,w.selector).trim();(h?s(h,[n]):[n]).length&&g.push(`${w.label}: missing ${n}.`)});let _=o(f,g);return{shouldWarn:!!_,message:_}};function i(d,u,p,f){d&&(d.dataset.listenerAttached||(d.addEventListener("click",async()=>{if(d.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(f);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let m=document.getElementById("aipkit_cw_image_data_holder");if(m&&(m.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),d.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(d.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(d):console.error("Fetch Feeds: Handler function not found.");return}let g=document.getElementById("aipkit_content_writer_form_status"),_=document.getElementById("aipkit_cw_action_validation"),w=d.dataset.action||"generate",h=w==="generate_single"?"generate":w,E=document.getElementById("aipkit_cw_mode_select"),x=E?E.value:"task";if(x==="single"&&(x="task"),x==="existing"||x.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let D="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(D,{title:"Update existing"}):alert(D)}return}let v=D=>String(D||"").split(/\r?\n/).map(R=>R.trim()).filter(Boolean),I=D=>{let R=String(D||"").split("|").map(Z=>Z.trim());return{topic:R[0]||"",keywords:R[1]||"",category:R[2]||"",authorLogin:R[3]||"",type:R[4]||"",schedule:R[5]||""}},P=()=>{let D=Array.from(u.querySelectorAll("[data-aipkit-bulk-row]"));for(let R of D){let Z=R.querySelector('[data-bulk-field="topic"]'),J=Z?Z.value.trim():"";if(!J)continue;let pe=R.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",Ce=R.querySelector('[data-bulk-field="category"]')?.value.trim()||"",He=R.querySelector('[data-bulk-field="author"]'),Ke=He?He.value.trim():"",nt=He?.selectedOptions?.[0]?.dataset?.userId||"",mt=R.querySelector('[data-bulk-field="type"]')?.value.trim()||"",wt=R.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:J,keywords:pe,category:Ce,authorLogin:Ke,authorId:nt,type:mt,schedule:wt}}return null},b=D=>{if(!D||!D.topic)return;let R=document.getElementById("aipkit_content_writer_title"),Z=D.keywords?`${D.topic} | ${D.keywords}`:D.topic;R&&(R.value=Z,R.dispatchEvent(new Event("change",{bubbles:!0})));let J=u.elements.post_type;J&&D.type&&(J.value=D.type,J.dispatchEvent(new Event("change",{bubbles:!0})));let pe=u.elements["post_categories[]"];pe&&D.category&&(Array.from(pe.options).forEach(He=>{He.selected=He.value===D.category}),pe.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let Ce=u.elements.post_author;if(Ce){let He=D.authorId||"";if(!He&&D.authorLogin){let Ke=Array.from(Ce.options).find(nt=>nt.dataset.login===D.authorLogin||nt.value===D.authorLogin);Ke&&(He=Ke.value)}He&&(Ce.value=He,Ce.dispatchEvent(new Event("change",{bubbles:!0})))}};if(h!=="upgrade"){let D=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(u,x):{isValid:!0};if(!D.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(g||_,D.message):g&&(g.textContent=D.message||"",g.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(g),window.aipkit_clearContentWriterValidationMessage(_)):_&&(_.textContent=""),h==="generate"||h==="create_task"){let{shouldWarn:D,message:R}=c(u,x);if(D){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(R,{title:"Update prompts",okText:"Review prompts"}):alert(R);return}let Z=e(u,x);if(Z.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(Z.message,{title:"Update prompts",okText:"Review prompts"}):alert(Z.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let y=document.getElementById("aipkit_cw_status_display_container"),S=document.getElementById("aipkit_cw_generated_title_display"),C=document.getElementById("aipkit_content_writer_title");if(h==="create_task"){y&&(y.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(u,d,g):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),g&&(g.textContent="",g.className="aipkit_cw_status_badge"));return}let A=u.elements.content_title_bulk,M=v(A?A.value:""),$=h==="generate"&&x==="task"&&M.length===1;if($){let D=P()||I(M[0]);b(D),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(h==="generate"&&!$){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(u,x):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let W=document.getElementById("aipkit_cw_single_output_wrapper"),H=document.getElementById("aipkit_cw_output_card");W&&(W.style.display="block"),H&&(H.style.display="block"),y&&(y.style.display="block");let N=document.getElementById("aipkit_content_writer_stream_mode"),Q=u.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),p&&(p.style.display="flex");let F={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[D,R]of Object.entries(F)){let Z=document.getElementById(R);Z&&!Z.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(D,"skipped")}let L=document.getElementById("aipkit_cw_generate_images_enabled"),O=document.getElementById("aipkit_cw_generate_featured_image");if(L&&O&&!L.checked&&!O.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),Q){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),S&&(S.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(d,!0,"Generate","Generating...");let D=new FormData(u),R=Object.fromEntries(D.entries()),Z=u.elements["openai_vector_store_ids[]"];R.openai_vector_store_ids=Z?Array.from(Z.selectedOptions).map(Ce=>Ce.value):[],delete R["openai_vector_store_ids[]"];let J=document.getElementById("aipkit_content_writer_nonce");R._ajax_nonce=J?J.value:"",window.aipkit_current_conversation_uuid&&(R.conversation_uuid=window.aipkit_current_conversation_uuid);let pe=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",R);if(pe&&pe.new_title){if(pe.conversation_uuid){window.aipkit_current_conversation_uuid=pe.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",pe.conversation_uuid)}catch{}}S&&(S.textContent=pe.new_title,S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(pe.message||"Failed to generate new title.")}catch(D){console.error("Title Generation Error:",D),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",D.message),g&&(g.textContent=t(D),g.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),S&&C&&(S.textContent=C.value.split("|")[0].trim(),S.style.display="block");!N||N.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(f):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),d.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=i})();(function(){"use strict";function k(r,n){r&&(r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(n):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),r.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=k})();(function(){"use strict";function k(r,n){if(r===n)return!0;if(r==null||typeof r!="object"||n==null||typeof n!="object")return!1;let t=Object.keys(r),a=Object.keys(n);if(t.length!==a.length)return!1;for(let s of t)if(!a.includes(s)||!k(r[s],n[s]))return!1;return!0}window.aipkit_deepEqual=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_provider"),n=document.getElementById("aipkit_content_writer_temperature"),t=document.getElementById("aipkit_content_writer_post_author"),a=t?t.value:window.aipkit_dashboard?.currentUserId||"1",l=(r&&r.options.length>0?r.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),c=r?r.value.toLowerCase():l,o="",e=window.aipkit_dashboard?.models?.[c];switch(c){case"openai":o="gpt-4.1-mini";break;case"google":o="gemini-2.5-flash";break;case"openrouter":o="moonshotai/kimi-k2.5";break;case"claude":o="claude-opus-4-6",Array.isArray(e)&&e.length>0&&(e.some(p=>p&&p.id==="claude-opus-4-6")||(o=e[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(e)&&e.length>0?o=e[0].id||"":o="";break;default:o=""}let i=n&&n.defaultValue||"1.0",d=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:c,ai_model:o,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:i,reasoning_effort:"medium",post_type:"post",post_author:a,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:d.title,custom_content_prompt:d.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:d.meta,generate_focus_keyword:"1",custom_keyword_prompt:d.keyword,generate_excerpt:"1",custom_excerpt_prompt:d.excerpt,generate_tags:"1",custom_tags_prompt:d.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:d.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:d.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:d.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:d.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:d.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:d.image_title_update||d.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:d.image_alt_text_update||d.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:d.image_caption_update||d.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:d.image_description_update||d.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:d.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=k})();(function(){"use strict";function k(r){let n={};if(!r)return n;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(v=>{r.elements[v]&&(n[v]=r.elements[v].value)});let a=r.elements.generate_meta_description;a?n.generate_meta_description=a.checked?"1":"0":n.generate_meta_description="0";let s=r.elements.generate_focus_keyword;s?n.generate_focus_keyword=s.checked?"1":"0":n.generate_focus_keyword="0";let l=r.elements.generate_excerpt;l?n.generate_excerpt=l.checked?"1":"0":n.generate_excerpt="0";let c=r.elements.generate_tags;c?n.generate_tags=c.checked?"1":"0":n.generate_tags="0";let o=r.elements.generate_title;o?n.generate_title=o.checked?"1":"0":n.generate_title="1";let e=r.elements.generate_content;e?n.generate_content=e.checked?"1":"0":n.generate_content="1";let i=r.elements.generate_toc;i?n.generate_toc=i.checked?"1":"0":n.generate_toc="0";let d=r.elements.generate_seo_slug;d?n.generate_seo_slug=d.checked?"1":"0":n.generate_seo_slug="0";let u=r.elements.generate_images_enabled;u?n.generate_images_enabled=u.checked?"1":"0":n.generate_images_enabled="0";let p=r.elements.generate_featured_image;p?n.generate_featured_image=p.checked?"1":"0":n.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(v=>{let I=r.elements[v];I?n[v]=I.checked?"1":"0":n[v]="1"});let f=r.elements.enable_vector_store;f?n.enable_vector_store=f.checked?"1":"0":n.enable_vector_store="0";let m=r.elements["openai_vector_store_ids[]"];m?n.openai_vector_store_ids=Array.from(m.selectedOptions).map(v=>v.value):n.openai_vector_store_ids=[];let g=r.querySelector("#aipkit_cw_prompt_mode_hidden_input");g?n.prompt_mode=g.value:n.prompt_mode="custom";let _=r.querySelector("#aipkit_cw_mode_select"),w=_?_.value:"task";n.cw_generation_mode=w==="single"?"task":w;let h=r.elements["post_categories[]"];h?n.post_categories=Array.from(h.selectedOptions).map(v=>v.value):n.post_categories=[];let E=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],x=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return x&&x.create&&E.forEach(v=>{Object.prototype.hasOwnProperty.call(x.create,v)&&(n[v]=x.create[v])}),x&&x.update&&E.forEach(v=>{let I=`${v}_update`;Object.prototype.hasOwnProperty.call(x.update,v)&&(n[I]=x.update[v])}),n}window.aipkit_getContentWriterFormConfig=k})();(function(){"use strict";function k(r){if(!r||!r.value)return!1;let n=r.value,t=window.aipkit_cw_template_state.currentTemplates.find(a=>String(a.id)===String(n));return t&&String(t.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_post_status"),n=document.getElementById("aipkit_cw_schedule_options_wrapper"),t=document.getElementById("aipkit_cw_smart_schedule_fields"),a=document.querySelector(".aipkit_schedule_from_input_help"),s=document.querySelector(".aipkit_schedule_from_input_option");if(!r||!n)return;let l=r.value==="publish";n.style.display=l?"block":"none";let c=document.getElementById("aipkit_cw_mode_select"),o=c?c.value:"task",e=new Set(["task","csv","gsheets"]),i=e.has(o);if(s){s.style.display=i?"inline-flex":"none";let p=s.querySelector('input[name="schedule_mode"]');if(!i&&p&&p.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(p=>{p.dataset.listenerAttached||(p.addEventListener("change",function(){let f=document.getElementById("aipkit_cw_mode_select"),m=f?f.value:"task",g=e.has(m);t&&(t.style.display=this.value==="smart"?"block":"none"),a&&(a.style.display=this.value==="from_input"&&g?"block":"none")}),p.dataset.listenerAttached="true")});let u=document.querySelector('input[name="schedule_mode"]:checked');u&&t&&(t.style.display=u.value==="smart"?"block":"none"),u&&a&&(a.style.display=u.value==="from_input"&&i?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(s){return s},r={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function n(s){if(!s)return"";let l=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(s)}"]`);if(!l)return"";let c=l.querySelector("option");return c?c.value:""}function t(){let s=document.getElementById("aipkit_cw_single_output_wrapper"),l=document.getElementById("aipkit_cw_generated_title_display"),c=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_cw_meta_chunk"),e=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),i=document.querySelector(".aipkit_content_writer_output_actions");s&&(s.style.display="none"),l&&(l.style.display="none",l.textContent=""),c&&(c.innerHTML=""),o&&(o.style.display="none"),e&&(e.style.display="none"),i&&(i.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function a(s,l=!1){let c=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let o=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,e=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=s,s?sessionStorage.setItem("aipkit_cw_last_template_id",s):sessionStorage.removeItem("aipkit_cw_last_template_id");let i=window.aipkit_cw_template_state.currentTemplates.find(f=>String(f.id)===String(s)),d;if(i)d=JSON.parse(JSON.stringify(i.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),e&&!l&&e("Error: Cannot load default template.");return}d=window.aipkit_getDefaultContentWriterTemplateConfig()}let u=d&&d.template_scope==="prompts_only";u||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(d)),window.aipkit_cw_template_state.currentTemplateModified=!1),t();let p=document.getElementById("aipkit_content_writer_form");if(!p){console.error("Apply Template: Content writer form not found.");return}if(!u&&d.ai_model&&p.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=d.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,d.image_model&&p.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=d.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,u){let f=document.getElementById("aipkit_cw_prompt_mode_hidden_input");f&&(f.value=d.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(v=>{let I=Object.prototype.hasOwnProperty.call(d,v),P=p.elements[v];if(!P)return;let b=d[v]===null||typeof d[v]>"u"?"":d[v],y=!!r[v],S=typeof b=="string"?b.trim()==="":b==="";if((!I||S)&&y){P.value=n(r[v]);return}I&&(P.value=b)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(v=>{if(!Object.prototype.hasOwnProperty.call(d,v))return;let I=p.elements[v];if(!I)return;let P=d[v];I.checked=P==="1"||P===1||P===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(v=>{if(!Object.prototype.hasOwnProperty.call(d,v))return;let I=p.elements[v];if(!I)return;let P=d[v];I.checked=P==="1"||P===1||P===!0});let w=p.elements.content_length;w&&Object.prototype.hasOwnProperty.call(d,"content_length")&&(w.value=d.content_length||"medium",w.dispatchEvent(new Event("change",{bubbles:!0})));let h=p.elements.image_provider;h&&Object.prototype.hasOwnProperty.call(d,"image_provider")&&(h.value=d.image_provider||"",h.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(v=>{if(!Object.prototype.hasOwnProperty.call(d,v))return;let I=p.elements[v];if(!I)return;let P=d[v]===null||typeof d[v]>"u"?"":d[v];I.type==="checkbox"?I.checked=P==="1"||P===1||P===!0:I.value=P});let x=p.elements.image_model;if(x&&Object.prototype.hasOwnProperty.call(d,"image_model")){let v=d.image_model||"";v&&x.querySelector(`option[value="${CSS.escape(v)}"]`)&&(x.value=v)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(y=>{let S=p.elements[y];if(S){let C=Object.prototype.hasOwnProperty.call(d,y),A=d[y]===null||typeof d[y]>"u"?"":d[y],M=!!r[y],$=typeof A=="string"?A.trim()==="":A==="";if((!C||$)&&M){S.value=n(r[y]);return}if(y==="gsheets_credentials"&&typeof A=="object"&&A!==null)S.value=JSON.stringify(A,null,2);else if((y==="ai_temperature"||y==="vector_store_top_k"||y==="vector_store_confidence_threshold")&&S.type==="range"){S.value=A||(y==="ai_temperature"?"1.0":y==="vector_store_top_k"?"3":y==="vector_store_confidence_threshold"?"20":"");let W=document.getElementById(S.id+"_value");W&&(W.textContent=y==="vector_store_confidence_threshold"?S.value+"%":S.value)}else S.type==="checkbox"?S.checked=A==="1":S.value=A;y==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),y==="content_length"&&S.dispatchEvent(new Event("change",{bubbles:!0}))}});let m=p.elements.gsheets_credentials;if(m){let y=d.gsheets_credentials,S=m.closest(".aipkit_gsheets_section_container");m.value=typeof y=="object"&&y!==null?JSON.stringify(y,null,2):y||"",m.value?(m.dataset.filename="credentials.json",S&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(S),100)):(delete m.dataset.filename,S&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(S,"clear"))}let g={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[y,S]of Object.entries(g)){let C=p.elements[y];if(C){let A=Object.prototype.hasOwnProperty.call(d,y)?d[y]:S;C.checked=A==="1"||A===1||A===!0}}let _=document.getElementById("aipkit_cw_prompt_mode_hidden_input");_&&(_.value=d.prompt_mode||"custom");let w=p.querySelector("#aipkit_cw_mode_select"),h=d.cw_generation_mode||"task",E=h==="single"?"task":h;w&&(w.value=E,w.dispatchEvent(new Event("change",{bubbles:!0})));let x=p.elements["post_categories[]"];if(x){let y=Array.isArray(d.post_categories)?d.post_categories.map(S=>String(S)):[];Array.from(x.options).forEach(S=>{S.selected=y.includes(S.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let v=p.elements["openai_vector_store_ids[]"];if(v){let y=Array.isArray(d.openai_vector_store_ids)?d.openai_vector_store_ids.map(String):[];Array.from(v.options).forEach(S=>{S.selected=y.includes(S.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let I=p.elements.enable_vector_store;I&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(I.closest(".aipkit_popover_options_list")||I.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let P=p.elements.vector_store_provider;P&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(P.value=d.vector_store_provider||"openai",P.dispatchEvent(new Event("change",{bubbles:!0})));let b=p.elements.ai_provider;if(b){let y=b.value,S=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),C=(d.ai_provider||S).toLowerCase();if(y!==C)b.value=C,b.dispatchEvent(new Event("change",{bubbles:!0}));else{let A=p.elements.ai_model;A&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(b,A):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}b.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(s?b.dataset.aipkitProviderNoticeArmed="true":delete b.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(p))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(d),u&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(p)),window.aipkit_cw_template_state.currentTemplateModified=!1),!l&&o&&o("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(s),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(s),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let f=document.getElementById("aipkit_content_writer_container");f&&window.aipkit_cw_toggleReasoningEffort(f)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{c||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};async function r(n){if(!n){console.error("Fetch & Populate Templates: Select element is missing.");return}let t=document.getElementById("aipkit_content_writer_template_nonce_field"),a=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,s=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;n.innerHTML=`<option value="">${k("Loading templates...")}</option>`,n.disabled=!0,a&&a();try{let l=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:t?t.value:""});window.aipkit_cw_template_state.currentTemplates=l.templates||[],n.innerHTML="";let c=new Option(k("-- Select Template --"),"");n.appendChild(c);let o=window.aipkit_cw_template_state.currentTemplates||[],e=window.aipkit_dashboard?.currentUserId?.toString(),i=null,d=[],u=[],p={};o.forEach(_=>{if(String(_.is_default)==="1"&&_.user_id.toString()===e&&(i=_.id),_.user_id.toString()===e)String(_.is_starter)==="1"||_.is_starter===!0?d.push(_):u.push(_);else{let w=_.display_name||`User ID: ${_.user_id}`;p[w]||(p[w]=[]),p[w].push(_)}});let f=_=>{if(_&&_.starter_order!==void 0&&_.starter_order!==null&&_.starter_order!==""){let x=Number(_.starter_order);if(Number.isFinite(x))return x}let h=(_&&_.template_name?String(_.template_name):"").match(/(\d[\d,]*)/);if(!h)return null;let E=parseInt(h[1].replace(/,/g,""),10);return Number.isFinite(E)?E:null};if(u.sort((_,w)=>_.is_default==="1"?-1:w.is_default==="1"?1:_.template_name.localeCompare(w.template_name)),d.sort((_,w)=>{let h=f(_),E=f(w);return h!==null&&E!==null?h-E:h!==null?-1:E!==null?1:_.template_name.localeCompare(w.template_name)}),d.length>0){let _=document.createElement("optgroup");_.label=k("Starter Templates"),d.forEach(w=>{_.appendChild(new Option(k(w.template_name),w.id))}),n.appendChild(_)}if(u.length>0){let _=document.createElement("optgroup");_.label=k("My Templates"),u.forEach(w=>{_.appendChild(new Option(k(w.template_name),w.id))}),n.appendChild(_)}Object.keys(p).sort().forEach(_=>{let w=document.createElement("optgroup");w.label=k(_),p[_].forEach(h=>{w.appendChild(new Option(k(h.template_name),h.id))}),n.appendChild(w)}),n.disabled=!1;let g=sessionStorage.getItem("aipkit_cw_last_template_id");g&&n.querySelector(`option[value="${CSS.escape(g)}"]`)?(n.value=g,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(g,!0)):i?(n.value=i,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(i,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(n)}catch(l){console.error("Error fetching templates:",l),n.innerHTML=`<option value="">${k("Error loading templates")}</option>`,s&&s(`Error: ${l.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(n)}}window.aipkit_fetchAndPopulateTemplates=r})();(function(){"use strict";async function k(r,n,t){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let a=document.getElementById("aipkit_content_writer_template_nonce_field"),s=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,l=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,c=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s&&s("Updating...");try{let o=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:r,template_name:n,config:JSON.stringify(t),_ajax_nonce:a?a.value:""});l&&l("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(o.template_config||t)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let e=document.getElementById("aipkit_cw_template_select"),i=o.template_id?String(o.template_id):"";i&&(window.aipkit_cw_template_state.currentTemplateId=i,sessionStorage.setItem("aipkit_cw_last_template_id",i)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&e&&(await window.aipkit_fetchAndPopulateTemplates(e),i&&(e.value=i,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(i))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(i||window.aipkit_cw_template_state.currentTemplateId)}catch(o){console.error("Error saving template:",o),c&&c(`Error: ${o.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=k})();(function(){"use strict";function k(r){let n=document.getElementById("aipkit_cw_rename_template_btn"),t=document.getElementById("aipkit_cw_delete_template_btn"),a=window.aipkit_dashboard||{},s=a.isAdmin||!1,l=a.currentUserId?String(a.currentUserId):"0",c=window.aipkit_cw_template_state.currentTemplates.find(d=>String(d.id)===String(r));if(!c){n&&(n.disabled=!0),t&&(t.disabled=!0);return}let o=String(c.user_id)===l,e=o||s,i=o||s;n&&(n.disabled=!e),t&&(t.disabled=!i)}window.aipkit_updateTemplateActionButtonsState=k})();(function(){"use strict";function k(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let n=window.aipkit_getContentWriterFormConfig(r),t=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(n,t),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=k})();(function(){"use strict";function k(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};function r(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_cw_template_select"),t=n.value,a=n.options[n.selectedIndex],s=a?a.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!t||t===""||window.aipkit_isDefaultTemplateSelected(a)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",s)}window.aipkit_handleRenameContentWriterTemplate=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n};function r(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_cw_template_select"),t=n.value,a=n.options[n.selectedIndex],s=a?a.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!t||t===""||window.aipkit_isDefaultTemplateSelected(a)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(s)}window.aipkit_handleDeleteContentWriterTemplate=r})();(function(){"use strict";let k=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,r=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,n=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function t(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let s=document.getElementById("aipkit_content_writer_template_nonce_field"),l=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,k&&k("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:s?s.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),l&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(l),r&&r("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(c){console.error("Error resetting starter templates:",c),n&&n(`Error: ${c.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function a(){let s="Reset starter templates to their original defaults?",l="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(s,{title:l,confirmText:"Reset",cancelText:"Cancel",onConfirm:t});return}window.confirm(s)&&t()}window.aipkit_handleResetStarterTemplates=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(p){return p},r={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function n(p){let f=p.toLowerCase();return f.includes("short")?r.short:f.includes("medium")?r.medium:f.includes("long")?r.long:/\b600\b/.test(f)?r.short:/\b1200\b/.test(f)?r.medium:/\b2000\b/.test(f)?r.long:""}function t(p,f){if(f){let m=p.template_name.toLowerCase();return m.includes("short")?"dashicons-text-page":m.includes("medium")?"dashicons-text":m.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return p.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function a(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function s(p,f){let m=[],g=[],_={};p.forEach(E=>{if(E.user_id.toString()===f)String(E.is_starter)==="1"||E.is_starter===!0?m.push(E):g.push(E);else{let x=E.display_name||`User ID: ${E.user_id}`;_[x]||(_[x]=[]),_[x].push(E)}});let w=E=>{if(E&&E.starter_order!==void 0&&E.starter_order!==null&&E.starter_order!==""){let P=Number(E.starter_order);if(Number.isFinite(P))return P}let v=(E&&E.template_name?String(E.template_name):"").match(/(\d[\d,]*)/);if(!v)return null;let I=parseInt(v[1].replace(/,/g,""),10);return Number.isFinite(I)?I:null};m.sort((E,x)=>{let v=w(E),I=w(x);return v!==null&&I!==null?v-I:v!==null?-1:I!==null?1:E.template_name.localeCompare(x.template_name)}),g.sort((E,x)=>E.is_default==="1"?-1:x.is_default==="1"?1:E.template_name.localeCompare(x.template_name));let h={};return Object.keys(_).sort().forEach(E=>{h[E]=_[E].sort((x,v)=>x.template_name.localeCompare(v.template_name))}),{starterTemplates:m,myTemplates:g,otherUsersTemplates:h}}function l(p){let{label:f,button:m}=a();if(!f||!m||!p)return;let g=p.options[p.selectedIndex],_=g?g.text:k("Select template");f.textContent=_||k("Select template")}function c(p,f){if(!p)return;let m=String(f||"");p.querySelectorAll(".aipkit_cw_template_list_item").forEach(g=>{let w=(g.dataset.templateId||"")===m;g.classList.toggle("is-active",w),g.setAttribute("aria-selected",w?"true":"false")})}function o(p,f=""){let{list:m}=a();if(!m||!p)return;let g=window.aipkit_cw_template_state?.currentTemplates||[],_=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!g.length){let b=p.disabled&&p.options.length&&p.options[0].text.toLowerCase().includes("loading"),y=document.createElement("div");y.className="aipkit_cw_template_picker_empty",y.textContent=k(b?"Loading templates...":"No templates found."),m.appendChild(y),l(p);return}let w=s(g,_),h=document.createDocumentFragment(),E=f.toLowerCase().trim(),x=(b,y)=>{let S=document.createElement("div");if(S.className="aipkit_cw_template_group_label",y){let A=document.createElement("span");A.className=`dashicons ${y}`,A.setAttribute("aria-hidden","true"),S.appendChild(A)}let C=document.createElement("span");return C.textContent=k(b),S.appendChild(C),S},v=(b,y)=>{let S=document.createElement("button");S.type="button",S.className="aipkit_cw_template_list_item",y&&S.classList.add("is-starter"),b.is_default==="1"&&S.classList.add("is-default"),S.dataset.templateId=String(b.id),S.dataset.templateLabel=b.template_name.toLowerCase(),S.setAttribute("role","option"),S.setAttribute("aria-selected","false");let C=t(b,y),A=document.createElement("span");A.className=`aipkit_cw_template_list_icon dashicons ${C}`,A.setAttribute("aria-hidden","true");let M=document.createElement("span");M.className="aipkit_cw_template_list_content";let $=document.createElement("span");if($.className="aipkit_cw_template_list_name",$.textContent=k(b.template_name),M.appendChild($),y){let H=n(b.template_name);if(H){let N=document.createElement("span");N.className="aipkit_cw_template_list_desc",N.textContent=k(H),M.appendChild(N)}}let W=document.createElement("span");return W.className="aipkit_cw_template_list_check dashicons dashicons-yes",W.setAttribute("aria-hidden","true"),S.appendChild(A),S.appendChild(M),S.appendChild(W),S},I=(b,y,S,C=!1)=>{let A=E?y.filter($=>$.template_name.toLowerCase().includes(E)):y;if(!A.length)return 0;let M=document.createElement("div");return M.className="aipkit_cw_template_group",C&&M.classList.add("is-starter-group"),M.appendChild(x(b,S)),A.forEach($=>{M.appendChild(v($,C))}),h.appendChild(M),A.length},P=0;if(P+=I("Starter Templates",w.starterTemplates,"dashicons-star-filled",!0),P+=I("My Templates",w.myTemplates,"dashicons-admin-users",!1),Object.keys(w.otherUsersTemplates).forEach(b=>{P+=I(b,w.otherUsersTemplates[b],"dashicons-groups",!1)}),P===0){let b=document.createElement("div");b.className="aipkit_cw_template_picker_empty",b.textContent=k(E?"No templates match your search.":"No templates found."),m.appendChild(b)}else m.appendChild(h);l(p),c(m,p.value)}function e(p){let{select:f}=a();f&&o(f,p)}function i(){let{search:p,searchClear:f}=a();if(!p)return;let m=null;p.addEventListener("input",_=>{let w=_.target.value;f&&(f.style.display=w?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{e(w)},150)}),f&&f.addEventListener("click",()=>{p.value="",f.style.display="none",e(""),p.focus()});let g=document.getElementById("aipkit_cw_template_picker_popover");g&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&g.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",f&&(f.style.display="none"),e(""))})}).observe(g,{attributes:!0})}function d(){let{select:p,list:f,button:m}=a();!p||!f||(i(),f.dataset.listenerAttached||(f.addEventListener("click",g=>{let _=g.target.closest(".aipkit_cw_template_list_item");if(!_||!p)return;let w=_.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),c(f,w),m&&m.click()}),f.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{l(p),c(f,p.value)}),p.dataset.listenerAttached="true"),o(p))}function u(p){let{select:f,list:m}=a();f&&(p!==void 0&&(f.value=p),l(f),c(m,f.value))}window.aipkit_initTemplatePicker=d,window.aipkit_renderTemplatePicker=o,window.aipkit_updateTemplatePickerSelection=u})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_template_action_list"),s=document.getElementById("aipkit_cw_template_inline_form"),l=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_name_input");a&&(a.style.display=""),s&&(s.style.display="none",delete s.dataset.mode),l&&(l.style.display="none"),c&&(c.value="")}function r(){k()}function n(a,s=""){let l=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_name_input"),o=document.getElementById("aipkit_cw_template_action_list");!l||!c||(o&&(o.style.display="none"),l.style.display="flex",l.dataset.mode=a,c.value=s,c.focus())}function t(){let a=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_name_input");!a||!s||r()}window.aipkit_showTemplateNameForm=n,window.aipkit_hideTemplateNameForm=t,window.aipkit_closeTemplateActionsPopover=r,window.aipkit_resetTemplateActionsPanel=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t};function r(t){let a=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_inline_delete_confirm"),l=document.getElementById("aipkit_cw_template_delete_confirm_text"),c=document.getElementById("aipkit_cw_template_action_list");!a||!s||!l||(a.style.display="none",c&&(c.style.display="none"),s.style.display="flex",l.innerHTML=`Delete "<strong>${k(t)}</strong>"?`)}function n(){let t=document.getElementById("aipkit_cw_template_inline_delete_confirm"),a=document.getElementById("aipkit_cw_template_action_list");t&&(t.style.display="none",a&&(a.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=r,window.aipkit_hideTemplateDeleteConfirm=n})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_template_save_inline_btn"),n=document.getElementById("aipkit_cw_template_cancel_inline_btn"),t=document.getElementById("aipkit_cw_template_inline_form"),a=document.getElementById("aipkit_cw_template_name_input");if(!r||!n||!t||!a){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}n.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),r.addEventListener("click",async()=>{let s=t.dataset.mode,l=a.value.trim();if(!l){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let c=document.getElementById("aipkit_content_writer_form"),o=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let e=window.aipkit_getContentWriterFormConfig(c);if(s==="new")await window.aipkit_saveContentWriterTemplate(0,l,e);else if(s==="rename"){let i=o.value;i&&await window.aipkit_saveContentWriterTemplate(parseInt(i),l,e)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_template_confirm_delete_btn"),n=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!r||!n){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}n.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),r.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let t=document.getElementById("aipkit_cw_template_select"),a=t.value,s=document.getElementById("aipkit_content_writer_template_nonce_field"),l=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,o=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,l&&l("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:a,_ajax_nonce:s?s.value:""}),c&&c("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(t)}catch(e){console.error("Error deleting template:",e),o&&o(`Error: ${e.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_template_select");if(!r){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(r):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?r.addEventListener("change",n=>window.aipkit_applyContentWriterTemplate(n.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_save_as_template_btn");if(!r){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_rename_template_btn");if(!r){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_delete_template_btn");if(!r){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!r){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?r.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_post_status");if(!r){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(r.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=k})();(function(){"use strict";function k(){let r=document.querySelector(".aipkit_content_writer_inputs");if(!r){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(r.addEventListener("input",window.aipkit_checkFormForModifications),r.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=k})();(function(){"use strict";function k(){let r=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let t of r)if(typeof window[t]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${t}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let n=document.getElementById("aipkit_cw_template_select");n&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(n.value):n&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t};function r(){let t=document.getElementById("aipkit_cw_save_as_post_btn");if(!t){console.warn("Save as Post Handler: Button not found.");return}t.addEventListener("click",n)}async function n(){let t=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_cw_save_as_post_btn"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_output_display"),c=document.getElementById("aipkit_cw_save_post_status");if(!t||!a||!s||!l||!c){console.error("Save as Post: Missing required UI elements.");return}let e=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||s.innerHTML;if(!(s.textContent.trim().length>0||!!s.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){c&&(c.textContent="Nothing to save. Please generate content first.",c.className="aipkit_cw_save_status aipkit_settings_message-error");return}let d=document.getElementById("aipkit_cw_generated_title_display"),u={post_title:d?d.textContent:"Untitled AI Post",post_content:e,generated_excerpt:t.elements.generated_excerpt?.value||"",generated_tags:t.elements.generated_tags?.value||"",meta_description:t.elements.meta_description?t.elements.meta_description.value:"",focus_keyword:t.elements.focus_keyword?t.elements.focus_keyword.value:"",post_type:t.elements.post_type?t.elements.post_type.value:"post",post_author:t.elements.post_author?t.elements.post_author.value:1,post_status:t.elements.post_status?t.elements.post_status.value:"draft",post_schedule_date:t.elements.post_schedule_date?t.elements.post_schedule_date.value:"",post_schedule_time:t.elements.post_schedule_time?t.elements.post_schedule_time.value:"",post_categories:t.elements["post_categories[]"]?Array.from(t.elements["post_categories[]"].selectedOptions).map(p=>p.value):[],generate_toc:t.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:t.elements.image_alignment?t.elements.image_alignment.value:"none",image_size:t.elements.image_size?t.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};c&&(c.textContent="Saving post...",c.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(a,!0,"Save","Saving...");try{let p=await window.aipkit_apiRequest("aipkit_content_writer_save_post",u);c&&(c.textContent=p.message||"Post saved successfully!",c.className="aipkit_cw_save_status aipkit_settings_message-success",p.edit_link&&(c.innerHTML+=` <a href="${k(p.edit_link)}" target="_blank">Edit Post</a>`))}catch(p){console.error("Error saving post:",p),c&&(c.textContent=`Error: ${p.message||"Failed to save post."}`,c.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(a,!1,"Save as Post"),setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=r})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let n=document.getElementById("aipkit_content_writer_form"),t=document.getElementById("aipkit_content_writer_generate_btn"),a=document.getElementById("aipkit_content_writer_stop_btn"),s=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn"),c=document.getElementById("aipkit_content_writer_provider"),o=document.getElementById("aipkit_content_writer_model"),e=document.getElementById("aipkit_content_writer_temperature"),i=document.getElementById("aipkit_cw_save_as_post_btn"),d=document.querySelector(".aipkit_cw_generation_status_indicators");if(!n||!t||!a||!s||!l||!c||!o||!e||!i){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(r):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(r),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(r):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(r):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(r):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(r):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(r):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(c.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(r)}),o.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(r)}),window.aipkit_cw_toggleReasoningEffort(r)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(r):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(r):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(c,o,e,t,s,l):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let u=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;u&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),u&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():u&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),u&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():u&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(t,n,d,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(a,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){i&&(i.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){i&&(i.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=k})();(function(){"use strict";let k=!1,r=null,n=null,t=null,a=!1,s=null,l="aipkit_image_generator_status",c="aipkit_image_gen_preview_theme",o=["dark","light"];function e(){let F=document.getElementById("aipkit_image_generator_container");if(!F){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(F.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(O){console.error("AIPKit Image Generator: Error calling public UI initializer:",O);let D=document.getElementById("aipkit_public_image_results");D&&(D.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let O=document.getElementById("aipkit_public_image_results");O&&(O.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}N(F),W(F),S(F),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function i(){return document.getElementById(l)}function d(F,L){let O=i();if(!O)return;let D=O.classList.contains("aipkit_training_status");if(O.textContent=F||"",D){O.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),F&&O.classList.add("is-visible"),L&&O.classList.add(`is-${L}`);return}O.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),L==="success"?O.classList.add("aipkit_form-help-success"):L==="error"&&O.classList.add("aipkit_form-help-error")}function u(F=2500){t&&window.clearTimeout(t),t=window.setTimeout(()=>{d("","")},F)}function p(F){window.aipkit_dashboard||(window.aipkit_dashboard={});let L=window.aipkit_dashboard.providerStatus||{};L.replicate=!!String(F||"").trim(),window.aipkit_dashboard.providerStatus=L,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function f(){return document.getElementById("aipkit_image_generator_settings_form")}function m(){let F=f();if(!F)return console.error("AIPKit Image Settings: Settings form not found."),null;let L=new FormData(F);if(L.has("frontend_models")){let D=F.querySelector("#aipkit_image_gen_frontend_models");D&&D.value===""&&L.set("frontend_models","")}else{let D=F.querySelector("#aipkit_image_gen_frontend_models");D&&L.append("frontend_models",D.value||"")}let O={};return L.forEach((D,R)=>{O[R]=D}),Object.prototype.hasOwnProperty.call(O,"replicate_api_key")&&delete O.replicate_api_key,O}function g(F){if(!F)return"";let L={};return Object.keys(F).sort().forEach(O=>{L[O]=F[O]}),JSON.stringify(L)}function _(F){n=g(F)}function w(F){return g(F)!==n}function h(F){if(!(F||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let O=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:R=>R;d(O("Syncing models...","gpt3-ai-content-generator"),"loading");let D=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return D&&typeof D.then=="function"&&D.then(()=>{d(O("Models synced!","gpt3-ai-content-generator"),"success"),u()}).catch(R=>{d(R?.message||O("Sync failed.","gpt3-ai-content-generator"),"error"),u(4e3)}),D}async function E(F){let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:O=>O;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}d(L("Saving...","gpt3-ai-content-generator"),"loading");try{let O=await window.aipkit_apiRequest("aipkit_save_image_settings",F);return d(O.message||L("Settings saved!","gpt3-ai-content-generator"),"success"),u(),_(F),O}catch(O){throw d(O.message||L("Failed to save settings.","gpt3-ai-content-generator"),"error"),u(4e3),console.error("AIPKit Image Settings Save Error:",O),O}}async function x(F){let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:O=>O;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}d(L("Saving...","gpt3-ai-content-generator"),"loading");try{let O=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:F});return p(F),d(O.message||L("Replicate key saved!","gpt3-ai-content-generator"),"success"),u(),h(F),O}catch(O){throw d(O.message||L("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),u(4e3),console.error("AIPKit Replicate Key Save Error:",O),O}}function v(F){if(F){if(k){r=F;return}k=!0,E(F).catch(()=>{}).finally(()=>{if(k=!1,r){let L=r;r=null,w(L)&&v(L)}})}}function I(){let F=m();!F||!w(F)||v(F)}function P(){let F=m();F&&_(F)}function b(F){if(!F)return;let L="data-aipkit-image-autosave-attached";if(F.hasAttribute(L))return;let O=()=>{I()};F.addEventListener("change",D=>{let R=D.target;!R||!R.matches(".aipkit_autosave_trigger")||O()}),F.addEventListener("blur",D=>{let R=D.target;!R||!R.matches(".aipkit_autosave_trigger")||O()},!0),F.setAttribute(L,"true"),P()}function y(F){let L=F.querySelector("#aipkit_replicate_api_key");if(!L)return;let O="data-replicate-autosave-attached";if(L.hasAttribute(O))return;s=L.value||"",p(s);let D=()=>{let R=L.value||"";R===s||a||(a=!0,x(R).then(()=>{s=R}).catch(()=>{}).finally(()=>{a=!1;let Z=m();Z&&_(Z)}))};L.addEventListener("change",D),L.addEventListener("blur",D),L.setAttribute(O,"true")}function S(F){let L=F.querySelector("#aipkit_image_generator_settings_popover");if(!L)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(F):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),C(L);let O="data-token-listener-attached";L.hasAttribute(O)||(L.addEventListener("change",function(D){D.target.closest(".aipkit_token_limit_mode_select")&&A(L)}),L.setAttribute(O,"true")),A(L);try{M(L)}catch(D){console.error("AIPKit Image Settings: Failed to init model selector",D)}b(L),y(L)}function C(F){let L=F.querySelector("#aipkit_image_generator_settings_panel");if(!L)return;let O=Array.from(L.querySelectorAll("[data-aipkit-settings-panel]"));if(!O.length||L.dataset.panelsBound==="true")return;let D=F.querySelector(".aipkit_model_settings_popover_title"),R=F.querySelector(".aipkit_model_settings_popover_back"),Z=document.getElementById("aipkit_image_generator_settings_trigger"),J={root:L.dataset.titleRoot||"Settings","token-management":L.dataset.titleTokenManagement||"Token Management",replicate:L.dataset.titleReplicate||"Replicate","ui-text":L.dataset.titleUiText||"UI Text","custom-css":L.dataset.titleCustomCss||"Custom CSS","provider-filtering":L.dataset.titleProviderFiltering||"Provider Filtering"},pe=null,Ce=He=>{let Ke=He||"root",nt=L.querySelector(`[data-aipkit-settings-panel="${Ke}"]`)||L.querySelector('[data-aipkit-settings-panel="root"]');if(!nt)return;let mt=nt.dataset.aipkitSettingsPanel||"root";if(mt!==pe){if(O.forEach(wt=>{wt.hidden=wt!==nt}),D&&(D.textContent=J[mt]||J.root),R&&(R.hidden=mt==="root"),mt==="token-management"&&A(F),mt==="replicate"){let wt=F.querySelector("#aipkit_replicate_api_key");h(wt?wt.value:"")}pe=mt,F.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};L.addEventListener("click",He=>{let Ke=He.target.closest("[data-aipkit-panel-target]");Ke&&(He.preventDefault(),Ce(Ke.dataset.aipkitPanelTarget))}),R&&R.addEventListener("click",He=>{He.preventDefault(),Ce("root")}),Z&&Z.addEventListener("click",()=>{Ce("root")}),Ce("root"),L.dataset.panelsBound="true"}function A(F){if(!F)return;let L=F.querySelector(".aipkit_token_limit_mode_select"),O=F.querySelector(".aipkit_token_general_user_limit_field"),D=F.querySelector(".aipkit_token_role_limits_container");if(!L||!O||!D)return;let R=L.value;O&&(O.hidden=R!=="general"),D&&(D.hidden=R!=="role_based")}function M(F){let L=F.querySelector("#aipkit_image_gen_models_selector");if(!L||L.getAttribute("data-enhanced")==="true")return;let O=F.querySelector("#aipkit_image_gen_frontend_models"),D=L.dataset.initialValue||"",Z=!0&&D===""?[]:D.split(",").map(ae=>ae.trim()).filter(Boolean),J=new Set(Z),pe=window.aipkit_image_generator_config_public||{},Ce=ae=>{if(!ae||typeof ae!="object")return!1;let Se={image_output:!0,image_generation:!0};if(!ae.capabilities||typeof ae.capabilities!="object")return!0;let je={...Se,...ae.capabilities};return!!(je.image_output||je.image_generation)},He=pe.azure_models||[];if((!He||He.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(He=window.aipkit_dashboard_providers.AzureImage.map(ae=>typeof ae=="string"?{id:ae,name:ae}:ae))}catch{}let Ke=[{key:"openai",label:"OpenAI",type:"flat",models:(pe.openai_models||[]).map(ae=>({id:ae.id,name:ae.name}))},{key:"openrouter",label:"OpenRouter",type:"flat",models:(pe.openrouter_image_models||[]).filter(ae=>Ce(ae)).map(ae=>({id:ae.id||ae.name||ae,name:ae.name||ae.id||ae}))},{key:"azure",label:"Azure",type:"flat",models:He.map(ae=>ae.id?ae:{id:ae.id||ae.name||ae,name:ae.name||ae.id||ae})},{key:"google",label:"Google",type:"grouped",models:pe.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(pe.replicate_models||[]).map(ae=>ae.id?ae:{id:ae.id||ae.name||ae,name:ae.name||ae.id||ae})}].filter(ae=>ae.key==="azure"||ae.key==="openrouter"?!0:ae.models&&(Array.isArray(ae.models)?ae.models.length:Object.keys(ae.models).length));L.innerHTML="",L.classList.add("aipkit_models_selector--ready");let nt=document.createElement("input");nt.type="search",nt.placeholder="Filter models...",nt.className="aipkit_models_selector-search",L.appendChild(nt);let mt=document.createElement("div");mt.className="aipkit_models_selector-summary",L.appendChild(mt);let wt=document.createElement("div");wt.className="aipkit_models_selector-providers",L.appendChild(wt),Ke.forEach(ae=>{let Se=document.createElement("div");Se.className="aipkit_models_selector-provider",Se.dataset.provider=ae.key;let je=document.createElement("div");je.className="aipkit_models_selector-provider-header",je.innerHTML=`<strong>${ae.label}</strong>`;let bt=document.createElement("div");bt.className="aipkit_models_selector-provider-actions";let re=document.createElement("button");re.type="button",re.className="aipkit_btn aipkit_btn-xs",re.textContent="All";let ve=document.createElement("button");ve.type="button",ve.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",ve.textContent="None",bt.appendChild(re),bt.appendChild(ve),je.appendChild(bt),Se.appendChild(je);let Ee=document.createElement("div");Ee.className="aipkit_models_selector-models";let Fe=Be=>{if(!Be||!Be.id)return;let Ve=Be.id,Je=document.createElement("label");Je.className="aipkit_models_selector-item",Je.title=Ve;let Ze=document.createElement("input");Ze.type="checkbox",Ze.value=Ve,Ze.checked=J.has(Ve),Ze.dataset.modelId=Ve,Ze.addEventListener("change",()=>{se(!0)});let Pt=document.createElement("span");Pt.textContent=Be.name||Ve,Je.appendChild(Ze),Je.appendChild(Pt),Ee.appendChild(Je)};if(ae.type==="grouped"?Object.keys(ae.models).forEach(Be=>{let Ve=ae.models[Be];if(!Array.isArray(Ve))return;let Je=document.createElement("div");Je.className="aipkit_models_selector-subgroup",Je.textContent=Be.charAt(0).toUpperCase()+Be.slice(1),Ee.appendChild(Je),Ve.forEach(Ze=>Fe(Ze))}):ae.models.forEach(Be=>Fe(Be)),ae.key==="azure"&&ae.models.length===0){let Be=document.createElement("div");Be.className="aipkit_models_selector-empty",Be.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",Ee.appendChild(Be)}if(ae.key==="openrouter"&&ae.models.length===0){let Be=document.createElement("div");Be.className="aipkit_models_selector-empty",Be.textContent="No image-capable OpenRouter models found. Sync OpenRouter models in the main Models settings first.",Ee.appendChild(Be)}re.addEventListener("click",()=>{Ee.querySelectorAll('input[type="checkbox"]').forEach(Be=>{Be.checked=!0}),se(!0)}),ve.addEventListener("click",()=>{Ee.querySelectorAll('input[type="checkbox"]').forEach(Be=>{Be.checked=!1}),se(!0)}),Se.appendChild(Ee),wt.appendChild(Se)}),nt.addEventListener("input",()=>{let ae=nt.value.toLowerCase();wt.querySelectorAll(".aipkit_models_selector-item").forEach(Se=>{let je=Se.textContent.toLowerCase();Se.style.display=je.includes(ae)?"":"none"})}),L.setAttribute("data-enhanced","true"),ge();function ge(){let ae=Array.from(L.querySelectorAll(".aipkit_models_selector-item input:checked")).map(Se=>Se.value);ae.length===0?mt.textContent="Showing all models (none selected)":mt.textContent=`${ae.length} model${ae.length>1?"s":""} selected`}function se(ae=!1){let Se=Array.from(L.querySelectorAll(".aipkit_models_selector-item input:checked")).map(je=>je.value.trim()).filter(Boolean);O&&(O.value=Se.join(", ")),ge(),ae&&I()}window.aipkit_syncAllowedModelsHiddenField=se}function $(F=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField(F)}function W(F){let L=F.querySelector("#aipkit_theme_switcher_toggle_btn"),O=F.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!L||!O){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",F);return}let D=o.indexOf(localStorage.getItem(c)||"dark");D===-1&&(D=o.indexOf("dark")),H(o[D],O,L),L.hasAttribute("data-listener-attached")||(L.addEventListener("click",function(){D=(D+1)%o.length;let R=o[D];H(R,O,L),localStorage.setItem(c,R)}),L.setAttribute("data-listener-attached","true"))}function H(F,L,O){let D=L.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");D&&(o.forEach(J=>D.classList.remove(`aipkit-theme-${J}`)),D.classList.add(`aipkit-theme-${F}`));let R=F.charAt(0).toUpperCase()+F.slice(1),Z="Toggle Preview Theme";O.title=`${Z} (Current: ${R})`}function N(F){let L=F.querySelector("#aipkit_image_generator_shortcode_snippet"),O=F.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),D=F.querySelector("#aipkit_image_generator_shortcode_configurator"),R=F.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),Z=F.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!L||!O||!D||Z.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",F);return}O.hasAttribute("data-listener-attached")||(O.addEventListener("click",()=>{let J=D.style.display==="none"||!D.style.display;D.style.display=J?"flex":"none",O.classList.toggle("aipkit_active",J),O.setAttribute("aria-expanded",J.toString())}),R&&R.addEventListener("click",()=>{D.style.display="none",O.classList.remove("aipkit_active"),O.setAttribute("aria-expanded","false")}),G(D),Z.forEach(J=>J.addEventListener("change",()=>{J.name==="cfg_mode"&&G(D),Q(F)})),L.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(L.textContent,L):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),Q(F),O.setAttribute("data-listener-attached","true"))}function G(F){if(!F)return;let L=F.querySelector('select[name="cfg_mode"]');if(!L)return;let O=F.querySelector(".aipkit_image_shortcode_default_mode_row"),D=F.querySelector(".aipkit_image_shortcode_mode_switch_row"),R=F.querySelector('select[name="cfg_default_mode"]'),Z=F.querySelector('input[name="cfg_show_mode_switch"]'),J=L.value==="both";O&&(O.hidden=!J),D&&(D.hidden=!J),J||(R&&(R.value=L.value==="edit"?"edit":"generate"),Z&&(Z.checked=!0))}function Q(F){let L=F.querySelector("#aipkit_image_generator_shortcode_snippet"),O=F.querySelector("#aipkit_image_generator_shortcode_configurator");if(!L||!O)return;let D=O.querySelector('input[name="cfg_show_provider"]').checked,R=O.querySelector('input[name="cfg_show_model"]').checked,Z=O.querySelector('input[name="cfg_show_history"]').checked,J=O.querySelector('select[name="cfg_mode"]'),pe=O.querySelector('select[name="cfg_default_mode"]'),Ce=O.querySelector('input[name="cfg_show_mode_switch"]'),He=O.querySelector('select[name="cfg_theme"]'),Ke=O.querySelector('input[name="cfg_theme"]:checked'),nt=He?He.value:Ke?Ke.value:"dark",mt=J?J.value:"generate",wt=pe?pe.value:"generate",ge=Ce?Ce.checked:!0,se="[aipkit_image_generator";D||(se+=' show_provider="false"'),R||(se+=' show_model="false"'),Z&&(se+=' history="true"'),mt!=="generate"&&(se+=` mode="${mt}"`),mt==="both"&&wt!=="generate"&&(se+=` default_mode="${wt}"`),mt==="both"&&!ge&&(se+=' show_mode_switch="false"'),nt!=="dark"&&(se+=` theme="${nt}"`),se+="]",L.textContent=se}window.aipkit_initImageGenerator=e})();(function(){"use strict";function k(r,n,t){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof n=="function"&&n(new Error("API function missing."),null,t);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_title,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof n=="function"&&n(new Error("Configuration missing (nonce)."),null,t);return}let c={_ajax_nonce:s,post_id:r};window.aipkit_apiRequest("aipkit_generate_title_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_title||"No title suggestions generated.");typeof n=="function"&&n(null,o.suggestions,t)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Title):",o),typeof n=="function"&&n(o,null,t)})}window.aipkit_fetchTitleSuggestions=k})();(function(){"use strict";let k=null;function r(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function n(s,l,c){k&&r();let o=window.aipkit_escapeHtml||function(_){return _},e=window.aipkit_escapeAttribute||o,i=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(i)}</strong>`).replace("%2$s",`<strong>${o(d)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(l.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(l.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function t(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(d){return d},e=window.aipkit_escapeAttribute||o;c.innerHTML=`
            <p>${o(l.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(d=>`<li data-new-title="${e(d)}">${o(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let i=c.querySelector(".aipkit-suggestions-list");i&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(i):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(e){return e};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(l.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${o(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=n,window.aipkit_updateModalWithSuggestions=t,window.aipkit_updateModalWithError=a,window.aipkit_closePostTitleModal=r})();(function(){"use strict";let k=!1;function r(){k=!1}function n(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,e=l.dataset.newTitle,i=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||!e||!i||!d){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),i&&(i.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),i.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_title||"Updating Title..."}`,i.style.color="",t(o,e,i,d,u)}function t(s,l,c,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let i=window.aipkit_post_enhancer?.nonce_update_title;if(!i){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:i,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_title",d).then(u=>{let p=document.querySelector(`#post-${s} .row-title`);p?p.textContent=l:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${s}.`);let f=document.getElementById(`post-${s}`);if(f){let m=f.querySelector(`#inline_${s}`);if(m){let g=m.querySelector(".post_title");g?g.textContent=l:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${s}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${s}.`)}window.aipkit_closePostTitleModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Title):",u),c.innerHTML=`<span class="error">${u.message||e.error_updating_title||"Error updating title."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-title]");c&&n({currentTarget:c})})}window.aipkit_attachSuggestionClickListener=a,window.aipkit_resetTitleUpdateFlag=r})();(function(){"use strict";function k(r,n,t){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof n=="function"&&n(new Error("API function missing."),null,t);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_excerpt,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof n=="function"&&n(new Error("Configuration missing (nonce)."),null,t);return}let c={_ajax_nonce:s,post_id:r};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof n=="function"&&n(null,o.suggestions,t)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",o),typeof n=="function"&&n(o,null,t)})}window.aipkit_fetchExcerptSuggestions=k})();(function(){"use strict";let k=null;function r(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function n(s,l,c){k&&r();let o=window.aipkit_escapeHtml||function(_){return _},e=window.aipkit_escapeAttribute||o,i=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(i)}</strong>`).replace("%2$s",`<strong>${o(d)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(l.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(l.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function t(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(d){return d},e=window.aipkit_escapeAttribute||o;c.innerHTML=`
            <p>${o(l.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(d=>`<li data-new-excerpt="${e(d)}">${o(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let i=c.querySelector(".aipkit-suggestions-list");i&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(i):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(e){return e};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(l.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${o(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=n,window.aipkit_updateModalWithExcerptSuggestions=t,window.aipkit_updateModalWithErrorExcerpt=a,window.aipkit_closePostExcerptModal=r})();(function(){"use strict";let k=!1;function r(){k=!1}function n(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,e=l.dataset.newExcerpt,i=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||e===void 0||!i||!d){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:o,newExcerpt:e,statusDiv:i,listItems:d}),i&&(i.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),i.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_excerpt||"Updating Excerpt..."}`,i.style.color="",t(o,e,i,d,u)}function t(s,l,c,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let i=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!i){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:i,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_excerpt",d).then(u=>{window.aipkit_closePostExcerptModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",u),c.innerHTML=`<span class="error">${u.message||e.error_updating_excerpt||"Error updating excerpt."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-excerpt]");c&&n({currentTarget:c})})}window.aipkit_attachExcerptSuggestionClickListener=a,window.aipkit_resetExcerptUpdateFlag=r})();(function(){"use strict";function k(r,n,t){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof n=="function"&&n(new Error("API function missing."),null,t);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_meta,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof n=="function"&&n(new Error("Configuration missing (nonce)."),null,t);return}let c={_ajax_nonce:s,post_id:r};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_meta||"No meta description suggestions generated.");typeof n=="function"&&n(null,o.suggestions,t)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",o),typeof n=="function"&&n(o,null,t)})}window.aipkit_fetchMetaSuggestions=k})();(function(){"use strict";let k=null;function r(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function n(s,l,c){k&&r();let o=window.aipkit_escapeHtml||function(_){return _},e=window.aipkit_escapeAttribute||o,i=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(i)}</strong>`).replace("%2$s",`<strong>${o(d)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(l.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(l.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function t(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(d){return d},e=window.aipkit_escapeAttribute||o;c.innerHTML=`
            <p>${o(l.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(d=>`<li data-new-meta="${e(d)}">${o(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let i=c.querySelector(".aipkit-suggestions-list");i&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(i):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(e){return e};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(l.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${o(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=n,window.aipkit_updateModalWithMetaSuggestions=t,window.aipkit_updateModalWithErrorMeta=a,window.aipkit_closePostMetaModal=r})();(function(){"use strict";let k=!1;function r(){k=!1}function n(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,e=l.dataset.newMeta,i=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||e===void 0||!i||!d){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:o,newMetaDesc:e,statusDiv:i,listItems:d}),i&&(i.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),i.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_meta||"Updating Meta Desc..."}`,i.style.color="",t(o,e,i,d,u)}function t(s,l,c,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let i=window.aipkit_post_enhancer?.nonce_update_meta;if(!i){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:i,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_meta_desc",d).then(u=>{try{let m=`${`#post-${s}`} .column-wpseo-metadesc`,g=document.querySelector(m);g&&(g.textContent=window.aipkit_escapeHtml(l),g.style.transition="background-color 0.1s ease-out",g.style.backgroundColor="#f0f7ff",setTimeout(()=>{g.style.backgroundColor=""},300))}catch(p){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",p)}window.aipkit_closePostMetaModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Meta):",u),c.innerHTML=`<span class="error">${u.message||e.error_updating_meta||"Error updating meta description."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-meta]");c&&n({currentTarget:c})})}window.aipkit_attachMetaSuggestionClickListener=a,window.aipkit_resetMetaUpdateFlag=r})();(function(){"use strict";function k(r,n,t){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof n=="function"&&n(new Error("API function missing."),null,t);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_tags,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof n=="function"&&n(new Error("Configuration missing (nonce)."),null,t);return}let c={_ajax_nonce:s,post_id:r};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_tags||"No tag suggestions generated.");typeof n=="function"&&n(null,o.suggestions,t)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",o),typeof n=="function"&&n(o,null,t)})}window.aipkit_fetchTagsSuggestions=k})();(function(){"use strict";let k=null;function r(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function n(s,l,c){k&&r();let o=window.aipkit_escapeHtml||(_=>_),e=window.aipkit_escapeAttribute||o,i=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(i)}</strong>`).replace("%2$s",`<strong>${o(d)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${o(l.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${o(l.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>k.classList.add("aipkit-active")),k}function t(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||(d=>d),e=window.aipkit_escapeAttribute||o;c.innerHTML=`
        <p>${o(l.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${s.map(d=>`<li data-new-tags="${e(d)}">${o(d)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let i=c.querySelector(".aipkit-suggestions-list");i&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(i):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||(e=>e);c.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${o(l.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${o(s)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=n,window.aipkit_updateModalWithTagsSuggestions=t,window.aipkit_updateModalWithErrorTags=a,window.aipkit_closePostTagsModal=r})();(function(){"use strict";let k=!1;function r(){k=!1}function n(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,e=l.dataset.newTags,i=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||e===void 0||!i||!d){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:o,newTags:e,statusDiv:i,listItems:d}),i&&(i.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),i.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_tags||"Updating Tags..."}`,i.style.color="",t(o,e,i,d,u)}function t(s,l,c,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let i=window.aipkit_post_enhancer?.nonce_update_tags;if(!i){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:i,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_tags",d).then(u=>{let p=document.getElementById(`post-${s}`);if(p){let f=p.querySelector(".column-tags");f&&(f.textContent=l.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Tags):",u),c.innerHTML=`<span class="error">${u.message||e.error_updating_tags||"Error updating tags."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-tags]");c&&n({currentTarget:c})})}window.aipkit_attachTagsSuggestionClickListener=a,window.aipkit_resetTagsUpdateFlag=r})();(function(){"use strict";function k(r,n,t){let s=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorTags(r.message||s.error_loading_tags,s):n?window.aipkit_updateModalWithTagsSuggestions(n,s):window.aipkit_updateModalWithErrorTags(s.error_loading_tags||"Unknown error occurred.",s)}window.aipkit_handleTagsSuggestionsResult=k})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function k(o,e=60){return o.length<=e?o:o.substring(0,e-3)+"..."}function r(o,e="info"){let i=document.getElementById("aipkit-enhancer-bulk-status-log");if(i){let d=document.createElement("div");d.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${e}`,d.textContent=o,i.appendChild(d),i.scrollTop=i.scrollHeight}}function n(){let o=document.getElementById("aipkit-enhancer-bulk-progress-bar"),e=document.getElementById("aipkit-enhancer-progress-text"),i=document.getElementById("aipkit-enhancer-progress-stats");if(o&&window.aipkit_enhancer_bulkState.total>0){let d=window.aipkit_enhancer_bulkState.completed,u=window.aipkit_enhancer_bulkState.failed,p=window.aipkit_enhancer_bulkState.total,f=d+u,m=Math.round(f/p*100);o.style.width=`${m}%`,e&&(f===p?e.textContent="Update complete!":e.textContent=`Processing ${f+1} of ${p}...`),i&&(u>0?i.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${d} successful</span> \u2022 <span style="color: #dc3545;">${u} failed</span>`:i.textContent=`${m}%`)}}function t(o){let e=document.getElementById("aipkit-enhancer-bulk-status-log");if(!e)return;let d=(window.aipkit_enhancer_postTitles||{})[o]||`Post #${o}`;d=k(d,60);let u=document.createElement("div");u.className="aipkit_enhancer_post_steps",u.id=`aipkit_enhancer_post_${o}_steps`;let p=document.createElement("div");p.className="aipkit_enhancer_post_header",p.innerHTML=`<strong>${d}</strong>`;let f=document.createElement("div");f.className="aipkit_enhancer_steps_container",f.id=`aipkit_enhancer_steps_${o}`,u.appendChild(p),u.appendChild(f),e.appendChild(u),e.scrollTop=e.scrollHeight;let m=[],g=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(_=>{g[_]&&g[_].prompt&&m.push({field:_,display_name:_.charAt(0).toUpperCase()+_.slice(1).replace("_"," ")})}),g.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(_=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${o}_${_.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${_.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,f.appendChild(w)})}function a(o,e,i,d=""){let u=document.getElementById(`aipkit_enhancer_step_${o}_${e}`);if(!u)return;u.className=`aipkit_enhancer_step aipkit_enhancer_step--${i}`;let p="\u23F3",f="Pending";switch(i){case"processing":p="\u{1F504}",f="Processing...";break;case"completed":p="\u2705",f="Completed";break;case"error":p="\u274C",f="Failed";break;case"pending":p="\u23F3",f="Pending";break}u.querySelector(".aipkit_enhancer_step_icon").textContent=p,u.querySelector(".aipkit_enhancer_step_status").textContent=f,d&&(u.title=d);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function s(o,e,i){let d=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!d||i.length===0)return;let u=e.length+i.length,p=document.createElement("div");p.className="aipkit_enhancer_completion_message",e.length===0?p.innerHTML=`<strong style="color: #dc3545;">\u274C All ${u} enhancement steps failed!</strong>`:p.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${e.length} of ${u} steps. ${i.length} failed.</strong>`,d.appendChild(p);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function l(o,e){let i=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!i)return;e.forEach(f=>{let m=document.getElementById(`aipkit_enhancer_step_${o}_${f.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${f.status}`;let g="\u23F3";switch(f.status){case"completed":g="\u2705";break;case"error":g="\u274C";break;case"processing":g="\u{1F504}";break;case"pending":g="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=g,m.querySelector(".aipkit_enhancer_step_status").textContent=f.status.charAt(0).toUpperCase()+f.status.slice(1),f.message&&(m.title=f.message)}});let d=e.filter(f=>f.status==="completed").length,u=e.length;if(d!==u){let f=document.createElement("div");f.className="aipkit_enhancer_completion_message";let m=e.filter(g=>g.status==="error").length;f.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${d} of ${u} steps. ${m} failed.</strong>`,i.appendChild(f)}let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}function c(o,e){let i=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!i)return;i.querySelectorAll(".aipkit_enhancer_step").forEach(f=>{f.classList.contains("aipkit_enhancer_step--completed")||(f.className="aipkit_enhancer_step aipkit_enhancer_step--error",f.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",f.querySelector(".aipkit_enhancer_step_status").textContent="Failed",f.title=e)});let u=document.createElement("div");u.className="aipkit_enhancer_completion_message",u.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${e}</strong>`,i.appendChild(u);let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}window.aipkit_enhancer_logToModal=r,window.aipkit_enhancer_updateProgressBar=n,window.aipkit_enhancer_initStepProgress=t,window.aipkit_enhancer_updateFieldStatus=a,window.aipkit_enhancer_showPostCompletion=s,window.aipkit_enhancer_displayStepResults=l,window.aipkit_enhancer_showStepError=c,window.aipkit_enhancer_truncateTitle=k})();(function(){"use strict";function k(n="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let t=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!t)return;n==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let a=t.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");a&&(a.textContent="Start");let s=t.querySelector("#aipkit_bulk_enhancer_start_btn");s&&(s.disabled=!1,s.hidden=!0),t.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let l=t.querySelector("#aipkit_bulk_enhancer_cancel_btn");l&&(l.hidden=!1),t.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function r(){let n=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!n)return;window.aipkit_enhancer_bulkState.isRunning&&k("user"),n.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,n.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let t=n.querySelector("#aipkit_bulk_enhancer_start_btn");t&&(t.disabled=!1,t.hidden=!1);let a=n.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");a&&(a.textContent="Start"),n.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let s=n.querySelector("#aipkit_bulk_enhancer_cancel_btn");s&&(s.hidden=!1),n.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let l=n.querySelector("#aipkit-enhancer-bulk-status-log");l&&(l.innerHTML="");let c=n.querySelector("#aipkit-enhancer-bulk-progress-bar");c&&(c.style.width="0%");let o=n.querySelector("#aipkit-enhancer-progress-text");o&&(o.textContent="Processing posts...");let e=n.querySelector("#aipkit-enhancer-progress-stats");e&&(e.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=k,window.aipkit_enhancer_returnToSettings=r})();(function(){"use strict";function k(o){let e=o.querySelector("#aipkit_bulk_ai_provider"),i=o.querySelector("#aipkit_bulk_ai_model"),d=o.querySelector(".aipkit_enhancer_reasoning_effort_field"),u=o.querySelector("#aipkit_bulk_reasoning_effort");if(!e||!i||!d||!u){d&&(d.style.display="none");return}let p=(e.value||"").toLowerCase(),m=(i.value||"").toLowerCase();if(!(p==="openai"&&n(m))){d.style.display="none";return}d.style.display="block",r(o,m)}function r(o,e){let i=o.querySelector("#aipkit_bulk_reasoning_effort");if(!i)return;let d=a(e),u=new Set(d.allowed),p=i.value||"";p==="minimal"&&(p="low"),Array.from(i.options).forEach(f=>{let m=u.has(f.value);f.hidden=!m,f.disabled=!m}),u.has(p)||(p=d.defaultValue),u.has(p)||(p=d.allowed[0]||""),p&&(i.value=p)}function n(o){if(t(o))return!1;let e=o.startsWith("o1")||o.startsWith("o3")||o.startsWith("o4"),i=o.includes("gpt-5");return e||i}function t(o){return/(?:^|[-_])chat(?:[-_]|$)/.test(o)}function a(o){return l(o)?{allowed:["high"],defaultValue:"high"}:o.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(o)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(o){let e=o.match(/gpt-5\.(\d+)/);if(e)return Number.parseInt(e[1],10)>=2;let i=o.match(/gpt-(\d+)/);return i?Number.parseInt(i[1],10)>=6:!1}function l(o){return/gpt-5(\.\d+)?-pro/.test(o)}function c(o,e){let i=o.value.toLowerCase(),u=(window.aipkit_dashboard?.models||{})[i]||[],p=window.aipkit_escapeHtml||(h=>h),f=window.wp?.i18n?.__||(h=>h),m=window.aipkit_dashboard?.recommendedModels?.[i]||[],g=Array.isArray(m)?m:[],_=new Set(g.map(h=>h?.id).filter(Boolean));if(e.innerHTML="",g.length>0){let h=document.createElement("optgroup");h.label=p(f("Recommended","gpt3-ai-content-generator")),g.forEach(E=>{E&&E.id&&h.appendChild(new Option(p(E.name||E.id),E.id))}),h.children.length>0&&e.appendChild(h)}if(i==="openai"&&typeof u=="object"&&!Array.isArray(u))Object.keys(u).forEach(h=>{let E=document.createElement("optgroup");E.label=p(h),Array.isArray(u[h])&&u[h].forEach(x=>{x&&x.id&&_.has(x.id)||x&&x.id&&E.appendChild(new Option(p(x.name||x.id),x.id))}),E.children.length>0&&e.appendChild(E)});else if(Array.isArray(u)){let h=g.length?document.createElement("optgroup"):null;h&&(h.label=p(f("All models","gpt3-ai-content-generator"))),u.forEach(E=>{if(!(E&&E.id&&_.has(E.id))&&E&&E.id){let x=new Option(p(E.name||E.id),E.id);h?h.appendChild(x):e.appendChild(x)}}),h&&h.children.length>0&&e.appendChild(h)}if(e.options.length===0)e.appendChild(new Option(p(`No models for ${o.value}`),"")),e.disabled=!0;else{e.disabled=!1;let h;switch(i){case"openai":h="gpt-4o-mini";break;case"google":h="gemini-1.5-flash-latest";break;case"openrouter":h="moonshotai/kimi-k2.5";break;case"claude":h="claude-opus-4-6",Array.isArray(u)&&u.length>0&&(u.some(x=>x&&x.id==="claude-opus-4-6")||(h=u[0].id||null));break;case"azure":case"deepseek":case"ollama":Array.isArray(u)&&u.length>0?h=u[0].id||null:h=null;break;default:h=null;break}h&&e.querySelector(`option[value="${CSS.escape(h)}"]`)?e.value=h:e.selectedIndex=0}let w=o.closest(".aipkit-enhancer-bulk-modal-overlay");w&&k(w)}window.aipkit_enhancer_populateBulkModels=c,window.aipkit_enhancer_toggleReasoningEffort=k})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],r=s=>{let l=parseInt(s,10);if(Number.isFinite(l)){if(l>=1&&l<=k.length)return k[l-1];let c=k.find(o=>o.tokens===l);if(c)return c}return k[1]};async function n(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let s=window.aipkit_enhancer_bulkState.queue.shift();await t(s),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(n,200)}async function t(s){try{let l=`enhancer-bulk-${s}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(s);let c=window.aipkit_post_enhancer?.nonce_generate_title;if(!c)throw new Error("Security nonce not found.");let o=window.aipkit_enhancer_bulkState.enhancementsConfig,e=["keyword","title","excerpt","content","meta","tags"],i=[];e.forEach(p=>{o[p]&&o[p].prompt&&i.push(p)});let d=[],u=[];for(let p of i){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"processing");let f={_ajax_nonce:c,post_id:s,field:p,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[p]:o[p],ai_provider:o.ai_provider,ai_model:o.ai_model,temperature:o.temperature,max_tokens:o.max_tokens,reasoning_effort:o.reasoning_effort,enable_vector_store:o.enable_vector_store,vector_store_provider:o.vector_store_provider,vector_store_top_k:o.vector_store_top_k,openai_vector_store_ids:o.openai_vector_store_ids,pinecone_index_name:o.pinecone_index_name,qdrant_collection_name:o.qdrant_collection_name,vector_embedding_provider:o.vector_embedding_provider,vector_embedding_model:o.vector_embedding_model}),conversation_uuid:l},m=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",f,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"completed",m.message),d.push(p)}catch(f){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"error",f.message||"Processing failed"),u.push(p),console.error(`Failed to process field ${p} for post ${s}:`,f)}}if(o.generate_seo_slug==="1"&&d.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","processing");let p={_ajax_nonce:c,post_id:s,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",p,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(s,d,u),d.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let f=(window.aipkit_enhancer_postTitles||{})[s]||`Post #${s}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(f=window.aipkit_enhancer_truncateTitle(f,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${f}". No fields were processed successfully.`,"error")}}catch(l){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(s,l.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let o=(window.aipkit_enhancer_postTitles||{})[s]||`Post #${s}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(o=window.aipkit_enhancer_truncateTitle(o,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${o}": ${l.message||"Unknown error"}`,"error")}}}function a(s){let l=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!l)return;let c={},o=l.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(o.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}o.forEach(h=>{let E=h.value,x=l.querySelector(`#aipkit_bulk_prompt_${E}`);x&&(c[E]={prompt:x.value})});let e=l.querySelector("#aipkit_bulk_ai_provider").value,i=l.querySelector("#aipkit_bulk_ai_model").value,d=l.querySelector("#aipkit_bulk_ai_temperature").value,u=l.querySelector("#aipkit_bulk_content_max_tokens"),p=r(u?u.value:""),f=l.querySelector("#aipkit_bulk_reasoning_effort").value;if(!e||!i){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}c.ai_provider=e,c.ai_model=i,c.temperature=d,c.max_tokens=p.tokens,c.reasoning_effort=f;let m=l.querySelector("#aipkit_bulk_generate_seo_slug");m&&(c.generate_seo_slug=m.checked?"1":"0");let g=l.querySelector('input[name="enable_vector_store"]');if(g&&g.checked){if(c.enable_vector_store="1",c.vector_store_provider=l.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",c.vector_store_top_k=l.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,c.vector_store_provider==="openai"){let h=l.querySelector("#aipkit_bulk_openai_vector_store_ids");h&&(c.openai_vector_store_ids=Array.from(h.selectedOptions).map(E=>E.value))}else c.vector_store_provider==="pinecone"?c.pinecone_index_name=l.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":c.vector_store_provider==="qdrant"&&(c.qdrant_collection_name=l.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(c.vector_store_provider==="pinecone"||c.vector_store_provider==="qdrant")&&(c.vector_embedding_provider=l.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",c.vector_embedding_model=l.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else c.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...s],isRunning:!0,completed:0,failed:0,total:s.length,enhancementsConfig:c},l.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,l.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let _=l.querySelector("#aipkit_bulk_enhancer_start_btn");_&&(_.disabled=!0,_.hidden=!0),l.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let w=l.querySelector("#aipkit_bulk_enhancer_cancel_btn");w&&(w.hidden=!0),l.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),n()}window.aipkit_enhancer_startBulkProcess=a})();(function(){"use strict";let k={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},r="aipkit_bulk_enhancer_selected_template",n=window.aipkit_escapeHtml||function(S){return S},t=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],a=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),s=S=>{let C=parseInt(S,10);if(Number.isFinite(C)){if(C>=1&&C<=t.length)return t[C-1];let A=t.find(M=>M.tokens===C);if(A)return A}return t[1]},l=S=>{let C=S?.content_max_tokens??S?.max_tokens??S?.max_completion_tokens??"",A=parseInt(C,10);if(Number.isFinite(A)){let H=A>=1&&A<=t.length,N=t.some(G=>G.tokens===A);return H||N?s(A):A<=t[0].tokens?t[0]:A<=t[1].tokens?t[1]:t[2]}let M=String(S?.content_length||"").trim().toLowerCase(),$=t.find(H=>H.key===M);if($)return $;let W=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(W)?W<=t[0].tokens?t[0]:W<=t[1].tokens?t[1]:t[2]:t[1]};function c(S){try{S&&String(S)!==""?localStorage.setItem(r,String(S)):localStorage.removeItem(r)}catch(C){console.warn("Failed to save template to localStorage:",C)}}function o(){try{return localStorage.getItem(r)}catch(S){return console.warn("Failed to load template from localStorage:",S),null}}function e(){let S=k.modalElement;if(!S)return{};let C={};["title","excerpt","content","meta","keyword","tags"].forEach(H=>{let N=S.querySelector(`#aipkit_bulk_enhance_${H}`),G=S.querySelector(`#aipkit_bulk_prompt_${H}`);N&&G&&(C[H]={enabled:N.checked?"1":"0",prompt:G.value})}),C.ai_provider=S.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",C.ai_model=S.querySelector("#aipkit_bulk_ai_model")?.value||"",C.ai_temperature=S.querySelector("#aipkit_bulk_ai_temperature")?.value;let M=S.querySelector("#aipkit_bulk_content_max_tokens"),$=s(M?M.value:"");C.content_max_tokens=String($.tokens),C.reasoning_effort=S.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",C.generate_seo_slug=S.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let W=S.querySelector('input[name="enable_vector_store"]');if(W&&W.checked){if(C.enable_vector_store="1",C.vector_store_provider=S.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",C.vector_store_top_k=S.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",C.vector_store_provider==="openai"){let H=S.querySelector("#aipkit_bulk_openai_vector_store_ids");H&&(C.openai_vector_store_ids=Array.from(H.selectedOptions).map(N=>N.value))}else C.vector_store_provider==="pinecone"?C.pinecone_index_name=S.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":C.vector_store_provider==="qdrant"&&(C.qdrant_collection_name=S.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(C.vector_store_provider==="pinecone"||C.vector_store_provider==="qdrant")&&(C.vector_embedding_provider=S.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",C.vector_embedding_model=S.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else C.enable_vector_store="0";return C}function i(S){k.autosaveSuspended=!0,k.currentTemplateId=S,c(S),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=S),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(S,k.modalElement);let C=k.templates.find(D=>String(D.id)===String(S)),A=C?JSON.parse(JSON.stringify(C.config)):{};if(!A.content_max_tokens&&A.content_length){let D=t.find(R=>R.key===String(A.content_length).toLowerCase());A.content_max_tokens=String(D?.tokens||t[1].tokens)}Object.prototype.hasOwnProperty.call(A,"content_length")&&delete A.content_length,k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(A));let M=k.modalElement;if(!M)return;let $=M.querySelector("#aipkit_bulk_ai_provider"),W=M.querySelector("#aipkit_bulk_ai_model"),H=M.querySelector("#aipkit_bulk_ai_temperature"),N=M.querySelector("#aipkit_bulk_ai_temperature_value"),G=M.querySelector("#aipkit_bulk_content_max_tokens"),Q=M.querySelector("#aipkit_bulk_content_max_tokens_value"),F=M.querySelector("#aipkit_bulk_reasoning_effort");if($){let D=a();$.value=A.ai_provider||D||"openai",$.dispatchEvent(new Event("change",{bubbles:!0}))}if(W&&A.ai_model&&setTimeout(()=>{W.querySelector(`option[value="${CSS.escape(A.ai_model)}"]`)&&(W.value=A.ai_model,W.dispatchEvent(new Event("change")))},150),H&&(H.value=A.ai_temperature||"1.0"),N&&(N.textContent=A.ai_temperature||"1.0"),G){let D=l(A),R=Math.max(0,t.findIndex(Z=>Z.key===D.key));G.value=String(R+1),Q&&(Q.textContent=`${D.words} words`)}F&&(F.value=A.reasoning_effort==="minimal"?"low":A.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(M)),["title","excerpt","content","meta","keyword","tags"].forEach(D=>{let R=M.querySelector(`#aipkit_bulk_enhance_${D}`),Z=M.querySelector(`#aipkit_bulk_prompt_${D}`);if(R&&Z){let J=A[D]?.enabled==="1";R.checked!==J&&(R.checked=J,R.dispatchEvent(new Event("change"))),Z.value=A[D]?.prompt||Z.defaultValue}});let L=M.querySelector("#aipkit_bulk_generate_seo_slug");if(L){let D=A.generate_seo_slug==="1";L.checked!==D&&(L.checked=D,L.dispatchEvent(new Event("change")))}let O=M.querySelector('input[name="enable_vector_store"]');if(O&&(O.checked=A.enable_vector_store==="1",O.dispatchEvent(new Event("change"))),A.enable_vector_store==="1"){let D=M.querySelector("#aipkit_bulk_vector_store_provider");D&&(D.value=A.vector_store_provider||"openai",D.dispatchEvent(new Event("change",{bubbles:!0})));let R=M.querySelector("#aipkit_bulk_vector_store_top_k");if(R){R.value=A.vector_store_top_k||"3";let Z=M.querySelector("#aipkit_bulk_vector_store_top_k_value");Z&&(Z.textContent=R.value)}setTimeout(()=>{if(A.vector_store_provider==="openai"){let Z=M.querySelector("#aipkit_bulk_openai_vector_store_ids");Z&&Array.isArray(A.openai_vector_store_ids)&&Array.from(Z.options).forEach(J=>{J.selected=A.openai_vector_store_ids.includes(J.value)})}else if(A.vector_store_provider==="pinecone"){let Z=M.querySelector("#aipkit_bulk_pinecone_index_name");Z&&(Z.value=A.pinecone_index_name||"",Z.dispatchEvent(new Event("change",{bubbles:!0})))}else if(A.vector_store_provider==="qdrant"){let Z=M.querySelector("#aipkit_bulk_qdrant_collection_name");Z&&(Z.value=A.qdrant_collection_name||"",Z.dispatchEvent(new Event("change",{bubbles:!0})))}if(A.vector_store_provider==="pinecone"||A.vector_store_provider==="qdrant"){let Z=M.querySelector("#aipkit_bulk_vector_embedding_provider"),J=M.querySelector("#aipkit_bulk_vector_embedding_model");Z&&(Z.value=A.vector_embedding_provider||"openai",Z.dispatchEvent(new Event("change"))),J&&A.vector_embedding_model&&setTimeout(()=>{J.value=A.vector_embedding_model,J.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}k.currentTemplateModified=!1,u(),window.clearTimeout(k.autosaveTimer),k.autosaveTimer=null,window.setTimeout(()=>{k.lastSavedConfig=e(),k.autosaveSuspended=!1},200)}function d(){let S=e();k.currentTemplateModified=!window.aipkit_deepEqual(S,k.initialConfigForSelectedTemplate),u(),v()}function u(){let S=k.modalElement;if(!S)return;let C=S.querySelector("#aipkit_enhancer_template_select").value,A=C&&String(C)!=="";S.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!A,S.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!A}function p(){let S=k.modalElement;if(!S)return;let C=S.querySelector("#aipkit_enhancer_template_action_list"),A=S.querySelector("#aipkit_enhancer_template_inline_form"),M=S.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=S.querySelector("#aipkit_enhancer_template_name_input");C&&(C.style.display=""),A&&(A.style.display="none",delete A.dataset.mode),M&&(M.style.display="none"),$&&($.value="")}function f(S,C=""){let A=k.modalElement;if(!A)return;let M=A.querySelector("#aipkit_enhancer_template_inline_form"),$=A.querySelector("#aipkit_enhancer_template_name_input"),W=A.querySelector("#aipkit_enhancer_template_action_list"),H=A.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!M||!$||(W&&(W.style.display="none"),H&&(H.style.display="none"),M.style.display="flex",M.dataset.mode=S,$.value=C,$.focus())}function m(){p()}function g(S){let C=k.modalElement;if(!C)return;let A=C.querySelector("#aipkit_enhancer_template_inline_form"),M=C.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=C.querySelector("#aipkit_enhancer_template_delete_confirm_text"),W=C.querySelector("#aipkit_enhancer_template_action_list");!M||!$||(A&&(A.style.display="none"),W&&(W.style.display="none"),M.style.display="flex",$.innerHTML=`Delete "<strong>${n(S)}</strong>"?`)}function _(){p()}function w(S,C="info"){h(S,C)}function h(S,C="info"){let A=k.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(A){if(k.headerStatusTimeout&&(clearTimeout(k.headerStatusTimeout),k.headerStatusTimeout=null),!S){A.textContent="",A.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}A.textContent=n(S),A.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${C}`,C==="success"&&(k.headerStatusTimeout=setTimeout(()=>{A.textContent="",A.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function E(){let S=k.currentTemplateId;if(!S)return null;let C="",A=k.templates.find($=>String($.id)===String(S));if(A?.template_name&&(C=A.template_name),!C){let $=k.modalElement?.querySelector("#aipkit_enhancer_template_select");$?.selectedOptions?.length&&(C=$.selectedOptions[0].textContent.trim())}let M=parseInt(S,10);return!C||Number.isNaN(M)?null:{id:M,name:C}}async function x(){if(k.autosaveSuspended||k.isSavingOrDeleting||k.isAutosaving)return;let S=e();if(!S||k.lastSavedConfig&&window.aipkit_deepEqual(S,k.lastSavedConfig))return;let C=E();if(C){k.isAutosaving=!0,h("Saving...","info");try{let A=window.aipkit_post_enhancer?.nonce_manage_templates;if(!A)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:C.id,template_name:C.name,config:JSON.stringify(S),template_type:"enhancer",_ajax_nonce:A}),k.lastSavedConfig=JSON.parse(JSON.stringify(S)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(S)),k.currentTemplateModified=!1,u(),h("Saved","success")}catch(A){h(`Error: ${A.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",A)}finally{k.isAutosaving=!1}}}function v(){k.autosaveSuspended||k.isSavingOrDeleting||k.currentTemplateId&&(k.autosaveTimer&&clearTimeout(k.autosaveTimer),k.autosaveTimer=setTimeout(()=>{k.autosaveTimer=null,x()},k.autosaveDelay))}async function I(){let S=k.modalElement.querySelector("#aipkit_enhancer_template_select");S.innerHTML='<option value="">Loading...</option>',S.disabled=!0;try{let C=window.aipkit_post_enhancer?.nonce_manage_templates;if(!C)throw new Error("Security nonce for templates not found.");let A=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:C});k.templates=A.templates||[],S.innerHTML='<option value="">-- Select Template --</option>',k.templates.forEach($=>{S.appendChild(new Option(n($.template_name),$.id))}),S.disabled=!1;let M=o();M&&(k.templates.some(W=>String(W.id)===String(M))?(S.value=M,i(M)):c(null)),window.aipkit_bulk_template_state={templates:k.templates,currentTemplateId:k.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(k.modalElement)}catch(C){w("Error loading templates: "+C.message,"error")}}async function P(S,C){if(!k.isSavingOrDeleting){k.isSavingOrDeleting=!0,w("Saving template...","info");try{let A=e(),M=window.aipkit_post_enhancer?.nonce_manage_templates;if(!M)throw new Error("Security nonce for templates not found.");let $=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:S,template_name:C,config:JSON.stringify(A),template_type:"enhancer",_ajax_nonce:M});w($.message,"success"),await I(),k.modalElement.querySelector("#aipkit_enhancer_template_select").value=$.template_id,k.currentTemplateId=$.template_id,c($.template_id),k.currentTemplateModified=!1,k.lastSavedConfig=JSON.parse(JSON.stringify(A)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(A)),h("Saved","success"),u()}catch(A){w("Error saving: "+A.message,"error")}finally{k.isSavingOrDeleting=!1}}}async function b(){let S=k.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!S||k.isSavingOrDeleting)){k.isSavingOrDeleting=!0,w("Deleting...","info");try{let C=window.aipkit_post_enhancer?.nonce_manage_templates;if(!C)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:S,_ajax_nonce:C}),w("Template deleted.","success"),await I(),k.currentTemplateId=null;let A=o();A&&String(A)===String(S)&&c(null),k.lastSavedConfig=null,h("Template deleted","success"),u()}catch(C){w("Error deleting: "+C.message,"error")}finally{k.isSavingOrDeleting=!1}}}function y(S){k.modalElement=S;let C=S.querySelector("#aipkit_enhancer_template_select");C.addEventListener("change",Q=>{h(""),p(),i(Q.target.value)}),S.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{f("new")}),S.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let Q=C.options[C.selectedIndex];k.currentTemplateId&&Q&&f("rename",Q.text)}),S.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let Q=C.options[C.selectedIndex];Q&&g(Q.text)});let A=S.querySelector("#aipkit_enhancer_template_inline_form"),M=S.querySelector("#aipkit_enhancer_template_save_inline_btn"),$=S.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),W=S.querySelector("#aipkit_enhancer_template_name_input");M&&$&&A&&W&&($.addEventListener("click",m),M.addEventListener("click",async()=>{let Q=A.dataset.mode,F=W.value.trim();if(!F){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if(Q==="new")await P(0,F);else if(Q==="rename"){let L=C.value;L&&await P(parseInt(L,10),F)}m()}));let H=S.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),N=S.querySelector("#aipkit_enhancer_template_cancel_delete_btn");H&&N&&(N.addEventListener("click",_),H.addEventListener("click",async()=>{await b(),_()})),I(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(S);let G=Q=>{Q.target?.id!=="aipkit_enhancer_template_select"&&d()};S.addEventListener("input",G),S.addEventListener("change",G)}window.aipkit_enhancer_initTemplateControls=y,window.aipkit_enhancer_setHeaderStatus=h})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(u){return u},r=u=>u||document.querySelector(".aipkit_enhancer_bulk_modal");function n(u){let p=r(u);return{root:p,select:p?.querySelector("#aipkit_enhancer_template_select")||null,button:p?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:p?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:p?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:p?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:p?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:p?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function t(u,p){let f=[],m={};u.forEach(_=>{if(!(String(_.is_starter)==="1"||_.is_starter===!0))if(p&&_.user_id?.toString()===p)f.push(_);else{let h=_.display_name||`User ID: ${_.user_id}`;m[h]||(m[h]=[]),m[h].push(_)}}),f.sort((_,w)=>_.is_default==="1"?-1:w.is_default==="1"?1:_.template_name.localeCompare(w.template_name));let g={};return Object.keys(m).sort().forEach(_=>{g[_]=m[_].sort((w,h)=>w.template_name.localeCompare(h.template_name))}),{myTemplates:f,otherUsersTemplates:g}}function a(u){return u.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function s(u,p){let{label:f}=n(p);if(!f||!u)return;let m=u.options[u.selectedIndex],g=m?m.text:k("Select template");f.textContent=g||k("Select template")}function l(u,p){if(!u)return;let f=String(p||"");u.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let _=(m.dataset.templateId||"")===f;m.classList.toggle("is-active",_),m.setAttribute("aria-selected",_?"true":"false")})}function c(u,p=""){let{select:f,list:m}=n(u);if(!f||!m)return;let g=window.aipkit_bulk_template_state?.templates||[],_=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!g.length){let b=f.disabled&&f.options.length&&f.options[0].text.toLowerCase().includes("loading"),y=document.createElement("div");y.className="aipkit_cw_template_picker_empty",y.textContent=k(b?"Loading templates...":"No templates found."),m.appendChild(y),s(f,u);return}let w=t(g,_),h=document.createDocumentFragment(),E=p.toLowerCase().trim(),x=(b,y)=>{let S=document.createElement("div");if(S.className="aipkit_cw_template_group_label",y){let A=document.createElement("span");A.className=`dashicons ${y}`,A.setAttribute("aria-hidden","true"),S.appendChild(A)}let C=document.createElement("span");return C.textContent=k(b),S.appendChild(C),S},v=b=>{let y=document.createElement("button");y.type="button",y.className="aipkit_cw_template_list_item",b.is_default==="1"&&y.classList.add("is-default"),y.dataset.templateId=String(b.id),y.dataset.templateLabel=b.template_name.toLowerCase(),y.setAttribute("role","option"),y.setAttribute("aria-selected","false");let S=a(b),C=document.createElement("span");C.className=`aipkit_cw_template_list_icon dashicons ${S}`,C.setAttribute("aria-hidden","true");let A=document.createElement("span");A.className="aipkit_cw_template_list_content";let M=document.createElement("span");M.className="aipkit_cw_template_list_name",M.textContent=k(b.template_name),A.appendChild(M);let $=document.createElement("span");return $.className="aipkit_cw_template_list_check dashicons dashicons-yes",$.setAttribute("aria-hidden","true"),y.appendChild(C),y.appendChild(A),y.appendChild($),y},I=(b,y,S)=>{let C=E?y.filter(M=>M.template_name.toLowerCase().includes(E)):y;if(!C.length)return 0;let A=document.createElement("div");return A.className="aipkit_cw_template_group",A.appendChild(x(b,S)),C.forEach(M=>{A.appendChild(v(M))}),h.appendChild(A),C.length},P=0;if(P+=I("My Templates",w.myTemplates,"dashicons-admin-users"),Object.keys(w.otherUsersTemplates).forEach(b=>{P+=I(b,w.otherUsersTemplates[b],"dashicons-groups")}),P===0){let b=document.createElement("div");b.className="aipkit_cw_template_picker_empty",b.textContent=k(E?"No templates match your search.":"No templates found."),m.appendChild(b)}else m.appendChild(h);s(f,u),l(m,f.value)}function o(u,p){c(u,p)}function e(u){let{search:p,searchClear:f,popover:m}=n(u);if(!p)return;let g=null;p.addEventListener("input",_=>{let w=_.target.value;f&&(f.style.display=w?"flex":"none"),clearTimeout(g),g=setTimeout(()=>{o(u,w)},150)}),f&&f.addEventListener("click",()=>{p.value="",f.style.display="none",o(u,""),p.focus()}),m&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",f&&(f.style.display="none"),o(u,""))})}).observe(m,{attributes:!0})}function i(u){let{select:p,list:f,button:m}=n(u);!p||!f||(e(u),f.dataset.listenerAttached||(f.addEventListener("click",g=>{let _=g.target.closest(".aipkit_cw_template_list_item");if(!_||!p)return;let w=_.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),l(f,w),m&&m.click()}),f.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{s(p,u),l(f,p.value)}),p.dataset.listenerAttached="true"),c(u))}function d(u,p){let{select:f,list:m}=n(p);f&&(u!==void 0&&(f.value=u),s(f,p),l(m,f.value))}window.aipkit_initBulkTemplatePicker=i,window.aipkit_renderBulkTemplatePicker=c,window.aipkit_updateBulkTemplatePickerSelection=d})();(function(){"use strict";function k(r){let{postCount:n,providerOptions:t,defaultPrompts:a,promptLibrary:s,postType:l}=r,c=h=>String(h??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=h=>c(h).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),e=(h=[])=>h.map(E=>!E?.label||!E?.prompt?"":`<option value="${o(E.prompt)}">${c(E.label)}</option>`).join(""),i=s||{},d=`<option value="${o(a.title||"")}">Default</option>${e(i.title)}`,u=`<option value="${o(a.content||"")}">Default</option>${e(i.content)}`,p=`<option value="${o(a.meta||"")}">Default</option>${e(i.meta)}`,f=`<option value="${o(a.keyword||"")}">Default</option>${e(i.keyword)}`,m=`<option value="${o(a.excerpt||"")}">Default</option>${e(i.excerpt)}`,g=`<option value="${o(a.tags||"")}">Default</option>${e(i.tags)}`,_="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";l==="product"&&(_+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),_=_.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let w="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return l==="product"&&(w+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),w=w.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${o(l)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${t}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                              <option value="openrouter">OpenRouter</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${d}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${u}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${c(a.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${w}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${f}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${g}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${n}</span>
                <span class="aipkit_enhancer_selection_label">item${n===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=k})();(function(){"use strict";function k(r,n){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let t={};r.forEach(f=>{let m=document.querySelector(`tr#post-${f}`);if(m){let g=m.querySelector(".row-title")||m.querySelector("strong a")||m.querySelector(".title a")||m.querySelector("a.row-title")||m.querySelector(".column-title strong a")||m.querySelector(".column-title .row-title");g&&(t[f]=g.textContent.trim())}t[f]||(t[f]=`Post #${f}`)}),window.aipkit_enhancer_postTitles=t;let a=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},s=window.aipkit_post_enhancer?.prompt_library||{},l=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],c=window.aipkit_post_enhancer?.default_ai_provider||"",o=String(c||"").trim().toLowerCase(),e={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",claude:"Claude",deepseek:"DeepSeek",ollama:"Ollama"},i=l.map(f=>{let m=f.toLowerCase();return`<option value="${m}" ${o&&m===o?"selected":""}>${e[m]||f.toUpperCase()}</option>`}).join(""),d=window.aipkit_enhancer_getBulkModalHtml({postCount:r.length,providerOptions:i,defaultPrompts:a,promptLibrary:s,postType:n});document.body.insertAdjacentHTML("beforeend",d);let u=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(u,r):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let p=u.querySelector("#aipkit_bulk_ai_provider");p&&o&&Array.from(p.options).some(m=>m.value===o)&&(p.value=o,p.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{u.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(b){return b},r=".aipkit_enhancer_bulk_modal",n=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),t=null,a=null,s=!1,l=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),c=b=>!!(b&&b.id&&l.has(b.id)),o=b=>String(b||"").trim().toLowerCase(),e=(b,y)=>{if(!b)return;let S="aipkit_settings_select_picker_icon--";b.classList.forEach(A=>{A.startsWith(S)&&b.classList.remove(A)}),b.classList.remove("is-hidden");let C=o(y);if(!C){b.classList.add("is-hidden");return}b.classList.add(`${S}${C}`)},i=b=>{if(!b)return"";let y=b.getAttribute("data-aipkit-picker-title");if(y)return y;let S=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return S?S.textContent.trim():""},d=b=>{if(!b)return"";let y=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(y)return y.textContent.trim();let S=b.querySelector("option");return S?S.textContent.trim():""},u=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),p=(b,y)=>{if(!b||!b.id||!y)return null;let S=u(b.id),C=y.querySelector(`#${S.buttonId}`);if(!C){if(C=document.createElement("button"),C.type="button",C.id=S.buttonId,C.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",C.setAttribute("data-aipkit-popover-target",S.popoverId),C.setAttribute("aria-controls",S.popoverId),C.setAttribute("aria-expanded","false"),C.dataset.aipkitPopoverPlacement="bottom",c(b)){C.classList.add("aipkit_settings_select_picker_btn--provider");let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),e(W,b.value),C.appendChild(W)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_label",M.id=S.labelId,M.textContent=d(b)||k("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),C.appendChild(M),C.appendChild($),b.insertAdjacentElement("beforebegin",C)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let A=y.querySelector(`#${S.popoverId}`);if(!A){A=document.createElement("div"),A.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(b)&&A.classList.add("aipkit_settings_select_picker_popover--provider"),A.id=S.popoverId,A.setAttribute("aria-hidden","true");let M=document.createElement("div");M.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",M.setAttribute("role","dialog"),M.setAttribute("aria-labelledby",S.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let W=document.createElement("span");W.className="aipkit_model_settings_popover_title",W.id=S.titleId,W.textContent=i(b)||k("Select","gpt3-ai-content-generator");let H=document.createElement("button");H.type="button",H.className="aipkit_model_settings_popover_close",H.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),H.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(W),$.appendChild(H);let N=document.createElement("div");N.className="aipkit_model_settings_popover_body";let G=document.createElement("div");G.className="aipkit_settings_select_picker_search";let Q=document.createElement("input");Q.type="search",Q.id=S.searchId,Q.className="aipkit_form-input";let F=i(b),L=F?`Search ${F.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");Q.setAttribute("placeholder",L),G.appendChild(Q);let O=document.createElement("div");O.className="aipkit_settings_select_picker_list",O.id=S.listId,O.setAttribute("role","listbox"),N.appendChild(G),N.appendChild(O),M.appendChild($),M.appendChild(N),A.appendChild(M),y.appendChild(A),c(b)&&(G.style.display="none")}return{ids:S,button:C,popover:A,label:y.querySelector(`#${S.labelId}`),search:y.querySelector(`#${S.searchId}`),list:y.querySelector(`#${S.listId}`)}},f=b=>{let y=[];return b&&Array.from(b.children).forEach(C=>{if(C.tagName==="OPTGROUP"){let A=Array.from(C.children).filter(M=>M.tagName==="OPTION").map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected}));y.push({groupLabel:C.label||"",options:A})}else C.tagName==="OPTION"&&y.push({groupLabel:"",options:[{value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}]})}),y},m=(b,y,S="")=>{if(!b||!y)return;let C=S.trim().toLowerCase();y.innerHTML="";let A=f(b),M=!1;if(A.forEach($=>{let W=$.options.filter(H=>C?H.label.toLowerCase().includes(C):!0);if(W.length){if($.groupLabel){let H=document.createElement("div");H.className="aipkit_settings_select_picker_group_label",H.textContent=$.groupLabel,y.appendChild(H)}W.forEach(H=>{let N=document.createElement("button");if(N.type="button",N.className="aipkit_settings_select_picker_item",N.setAttribute("role","option"),N.dataset.value=H.value,N.dataset.label=H.label,H.disabled&&(N.classList.add("is-disabled"),N.setAttribute("aria-disabled","true")),b.value===H.value?(N.classList.add("is-active"),N.setAttribute("aria-selected","true")):N.setAttribute("aria-selected","false"),c(b)){N.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),e(F,H.value),N.appendChild(F)}let G=document.createElement("span");G.className="aipkit_settings_select_picker_text",G.textContent=H.label;let Q=document.createElement("span");Q.className="dashicons dashicons-yes aipkit_settings_select_picker_check",N.appendChild(G),N.appendChild(Q),y.appendChild(N),M=!0})}}),!M){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=k(C?"No matches found.":"No options available.","gpt3-ai-content-generator"),y.appendChild($)}},g=(b,y)=>{if(!b||!y)return;let S=d(b);if(y.textContent=S||k("Select","gpt3-ai-content-generator"),c(b)){let C=y.closest("button"),A=C?C.querySelector(".aipkit_settings_select_picker_icon"):null;e(A,b.value)}},_=(b,y)=>{if(!b||!y)return;let S=b.getBoundingClientRect(),C=y.getBoundingClientRect(),A=C.width||320,M=C.height||0,$=window.innerWidth,W=window.innerHeight,H=12,N=S.left;N+A>$-H&&(N=S.right-A),N=Math.max(H,Math.min(N,$-A-H));let G=S.bottom+8;G+M>W-H&&(G=S.top-M-8),G=Math.max(H,Math.min(G,W-M-H)),y.style.left=`${Math.round(N)}px`,y.style.top=`${Math.round(G)}px`},w=()=>{!t||!a||s||(s=!0,window.requestAnimationFrame(()=>{let b=t.querySelector(".aipkit_model_settings_popover_panel");_(a,b),s=!1}))},h=()=>{t&&(t.classList.remove("aipkit-active"),t.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),t=null,a=null)},E=(b,y,S)=>{if(!b||!y)return;t&&t!==y&&h(),t=y,a=b,y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let C=y.querySelector(".aipkit_settings_select_picker_search input"),A=y.querySelector(".aipkit_settings_select_picker_list");A&&m(S,A,C?C.value:""),C&&C.offsetParent!==null&&(C.focus(),C.select());let M=y.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(b,M)})},x=(b,y)=>{if(!b||!y)return;let{button:S,popover:C,list:A,search:M}=y;if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",$=>{if($.preventDefault(),t===C){h();return}E(S,C,b)}),S.dataset.pickerListenerAttached="true"),C&&C.dataset.overlayListenerAttached!=="true"){C.addEventListener("click",W=>{W.target===C&&h()});let $=C.querySelector(".aipkit_model_settings_popover_close");$&&$.addEventListener("click",W=>{W.preventDefault(),h()}),C.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",$=>{let W=$.target.closest(".aipkit_settings_select_picker_item");if(!W||W.classList.contains("is-disabled"))return;let H=W.dataset.value??"";b.value=H,b.dispatchEvent(new Event("change",{bubbles:!0})),g(b,y.label),m(b,A,M?M.value:""),h()}),A.dataset.pickerListenerAttached="true"),M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("input",()=>{m(b,A,M.value)}),M.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{g(b,y.label),m(b,A,M?M.value:""),t===C&&h()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let $=!1;new MutationObserver(()=>{$||($=!0,window.requestAnimationFrame(()=>{g(b,y.label),m(b,A,M?M.value:""),$=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",$=>{$.key==="Escape"&&t&&h()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function v(b){if(!b||b.dataset.aipkitBulkPickerInit==="true")return;let y=b.querySelectorAll(n);y.length&&(y.forEach(S=>{if(!S.id||S.dataset.aipkitPickerInit==="true")return;let C=p(S,b);C&&(g(S,C.label),m(S,C.list,C.search?C.search.value:""),x(S,C),S.dataset.aipkitPickerInit="true")}),b.dataset.aipkitBulkPickerInit="true")}function I(){document.querySelectorAll(r).forEach(v)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I(),new MutationObserver(I).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=v})();(function(){"use strict";let k=window.aipkit_escapeHtml||(i=>String(i??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),r=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],n=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],t=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],a=i=>i?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",s=(i,d)=>{let p=[...i==="meta"?n:r];return d==="product"&&p.push(...t),p.filter((f,m)=>p.indexOf(f)===m)},l=(i,d)=>{if(!i)return;let u=i.dataset.label||"Placeholders:",p=i.dataset.copyTitle||"Click to copy";i.innerHTML=`${k(u)} `,d.forEach((f,m)=>{let g=document.createElement("code");g.className="aipkit-placeholder",g.title=p,g.textContent=f,i.appendChild(g),m<d.length-1&&i.appendChild(document.createTextNode(" "))})},c=(i,d)=>{if(!i)return;let u=i.querySelector(".aipkit_bulk_prompt_placeholders");if(!u)return;let p=u.dataset.promptType||"",f=s(p,d);l(u,f)};function o(i){if(!i)return;let d=i.querySelectorAll("[data-aipkit-bulk-popover]");if(!d.length)return;let u=null,p=null,f=!1,m=E=>E?i.querySelector(`#${E}`):null,g=(E,x)=>{if(!E||!x)return;let v=E.getBoundingClientRect(),I=x.getBoundingClientRect(),P=I.width||400,b=I.height||0,y=window.innerWidth,S=window.innerHeight,C=12,A=v.left;A+P>y-C&&(A=v.right-P),A=Math.max(C,Math.min(A,y-P-C));let M=v.bottom+8;M+b>S-C&&(M=v.top-b-8),M=Math.max(C,Math.min(M,S-b-C)),x.style.left=`${Math.round(A)}px`,x.style.top=`${Math.round(M)}px`},_=()=>{!p||!u||f||(f=!0,window.requestAnimationFrame(()=>{let E=u.querySelector(".aipkit_model_settings_popover_panel");g(p,E),f=!1}))},w=()=>{u&&(u.classList.remove("aipkit-active"),u.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),u?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),u=null,p=null)},h=E=>{if(!E)return;let x=E.getAttribute("data-aipkit-popover-target"),v=m(x);if(!v)return;u&&u!==v&&w(),u=v,p=E,v.classList.add("aipkit-active"),v.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true");let I=v.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(E,I)})};d.forEach(E=>{E.dataset.popoverListenerAttached!=="true"&&(E.addEventListener("click",x=>{if(x.preventDefault(),u&&p===E){w();return}h(E)}),E.dataset.popoverListenerAttached="true")}),i.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(E=>{E.dataset.overlayListenerAttached!=="true"&&(E.addEventListener("click",v=>{v.target===E&&w()}),E.dataset.overlayListenerAttached="true");let x=E.querySelector(".aipkit_model_settings_popover_close");x&&x.dataset.popoverListenerAttached!=="true"&&(x.addEventListener("click",v=>{v.preventDefault(),w()}),x.dataset.popoverListenerAttached="true")}),i.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",E=>{E.key==="Escape"&&u&&w()}),i.dataset.bulkPromptPopoverEscapeAttached="true"),i.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),i.dataset.bulkPromptPopoverRepositionAttached="true")}function e(i){if(!i)return;let d=i.querySelectorAll(".aipkit_prompt_edit_btn");if(!d.length)return;let u=a(i),p=null,f=null,m=!1,g=v=>v?i.querySelector(`#${v}`):null,_=(v,I,P)=>{if(!v||!I)return;let b=v.getBoundingClientRect(),y=I.getBoundingClientRect(),S=P?P.getBoundingClientRect():b,C=y.width||580,A=y.height||0,M=window.innerWidth,$=window.innerHeight,W=12,H=S.left-C-12;H<W&&(H=S.right+12),H=Math.max(W,Math.min(H,M-C-W));let N=S.top;N+A>$-W&&(N=$-A-W),N=Math.max(W,N),p.style.left=`${Math.round(H)}px`,p.style.top=`${Math.round(N)}px`},w=()=>{!f||!p||m||(m=!0,window.requestAnimationFrame(()=>{let v=p.querySelector(".aipkit_cw_prompt_panel"),I=f.closest(".aipkit_model_settings_popover_panel");_(f,v,I),m=!1}))},h=()=>{p&&(p.classList.remove("is-open"),p.setAttribute("aria-hidden","true"),f&&f.setAttribute("aria-expanded","false"),p=null,f=null)},E=v=>{let I=v.getAttribute("data-aipkit-flyout-target"),P=g(I);if(!P)return;p&&p!==P&&h(),p=P,f=v,P.classList.add("is-open"),P.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true"),c(P,u);let b=P.querySelector(".aipkit_cw_prompt_panel"),y=v.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(v,b,y)})};d.forEach(v=>{v.dataset.flyoutListenerAttached!=="true"&&(v.addEventListener("click",I=>{if(I.preventDefault(),p&&f===v){h();return}E(v)}),v.dataset.flyoutListenerAttached="true")}),i.querySelectorAll(".aipkit_cw_prompt_library_select").forEach(v=>{let I=v.getAttribute("data-aipkit-prompt-target"),P=I?i.querySelector(`#${I}`):null;P&&P.value.trim()===""&&v.value&&(P.value=v.value),v.dataset.promptLibraryAttached!=="true"&&(v.addEventListener("change",()=>{if(!v.value)return;let b=v.getAttribute("data-aipkit-prompt-target"),y=b?i.querySelector(`#${b}`):null;y&&(y.value=v.value,y.dispatchEvent(new Event("input",{bubbles:!0})))}),v.dataset.promptLibraryAttached="true")}),i.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(v=>{v.dataset.overlayListenerAttached!=="true"&&(v.addEventListener("click",I=>{I.target===v&&h()}),v.dataset.overlayListenerAttached="true")}),i.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",v=>{v.key==="Escape"&&p&&h()}),i.dataset.bulkPromptFlyoutEscapeAttached="true"),i.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",v=>{if(!p)return;let I=v.target;I.closest(".aipkit_cw_prompt_flyout")||I.closest("[data-aipkit-flyout-target]")||h()}),i.dataset.bulkPromptFlyoutClickAttached="true"),i.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),i.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=h}window.aipkit_enhancer_initBulkPromptPopovers=o,window.aipkit_enhancer_initBulkPromptFlyouts=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||(i=>i||""),r=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],n=i=>{let d=parseInt(i,10);if(Number.isFinite(d)){if(d>=1&&d<=r.length)return r[d-1];let u=r.find(p=>p.tokens===d);if(u)return u}return r[1]};function t(i,d){let u=window.aipkit_post_enhancer||{},p,f,m,g,_;i==="openai"?(p=d.querySelector("#aipkit_bulk_openai_vector_store_ids"),f=u.openai_vector_stores||[],m="id",g="name",_="No OpenAI stores found."):i==="pinecone"?(p=d.querySelector("#aipkit_bulk_pinecone_index_name"),f=u.pinecone_indexes||[],m="name",g="name",_="No Pinecone indexes found."):i==="qdrant"&&(p=d.querySelector("#aipkit_bulk_qdrant_collection_name"),f=u.qdrant_collections||[],m="name",g="name",_="No Qdrant collections found."),p&&(p.innerHTML="",f.length>0?p.multiple?f.forEach(w=>{p.add(new Option(k(w[g]),w[m]))}):(p.add(new Option("-- Select --","")),f.forEach(w=>{p.add(new Option(k(w[g]),w[m]))})):(p.add(new Option(_,"")),p.disabled=!0),i==="openai"&&a(d))}function a(i){let d=i.querySelector("[data-aipkit-vector-stores-dropdown]");if(!d)return;let u=d.closest(".aipkit_cw_vector_openai_field"),p=u?u.querySelector(".aipkit_popover_multiselect_select"):null;if(!p)return;let f=d.querySelector(".aipkit_popover_multiselect_btn"),m=d.querySelector(".aipkit_popover_multiselect_label"),g=d.querySelector(".aipkit_popover_multiselect_panel"),_=d.querySelector(".aipkit_popover_multiselect_options"),w=d.dataset.placeholder||"Select stores",h=d.dataset.selectedLabel||"selected",E=()=>{if(!m)return;let b=Array.from(p.options).filter(S=>S.selected&&S.value);if(!b.length){m.textContent=w;return}let y=b.map(S=>S.textContent.trim()).filter(Boolean);if(y.length<=2){m.textContent=y.join(", ");return}m.textContent=`${y.length} ${h}`},x=()=>{if(!_)return;_.innerHTML="";let b=Array.from(p.options),y=b.filter(S=>S.value);if(!y.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=b[0]?.textContent||"-- No Stores Found --",_.appendChild(S),E();return}y.forEach(S=>{let C=document.createElement("label");C.className="aipkit_popover_multiselect_item";let A=document.createElement("input");A.type="checkbox",A.value=S.value,A.checked=S.selected,A.disabled=S.disabled;let M=document.createElement("span");M.className="aipkit_popover_multiselect_text",M.textContent=S.textContent,C.appendChild(A),C.appendChild(M),_.appendChild(C)}),E()},v=()=>{if(!_){E();return}let b=new Set(Array.from(p.options).filter(y=>y.selected).map(y=>y.value));_.querySelectorAll('input[type="checkbox"]').forEach(y=>{y.checked=b.has(y.value)}),E()},I=b=>{if(!_)return;let y=Array.from(_.querySelectorAll('input[type="checkbox"]:checked'));if(y.length>2){let C=b&&b.target;if(C&&C.checked)C.checked=!1;else{let A=y[y.length-1];A&&(A.checked=!1)}}let S=Array.from(_.querySelectorAll('input[type="checkbox"]:checked')).map(C=>C.value);Array.from(p.options).forEach(C=>{C.selected=S.includes(C.value)}),p.dispatchEvent(new Event("change",{bubbles:!0})),E()},P=b=>{!d||!f||(d.classList.toggle("is-open",b),f.setAttribute("aria-expanded",b?"true":"false"),g&&(g.hidden=!b))};x(),v(),d.dataset.vectorStoreMultiselectAttached||(f&&(f.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),P(!d.classList.contains("is-open"))}),f.addEventListener("keydown",b=>{b.key==="Escape"&&P(!1)})),document.addEventListener("click",b=>{d.classList.contains("is-open")&&(d.contains(b.target)||P(!1))}),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",I),_.dataset.listenerAttached="true"),p.dataset.listenerAttached||(p.addEventListener("change",v),p.dataset.listenerAttached="true"),d.dataset.vectorStoreMultiselectAttached="true")}function s(i,d){let u=d.querySelector("#aipkit_bulk_vector_embedding_model");if(!u)return;let p=window.aipkit_post_enhancer||{},f=[];i==="google"?f=p.googleEmbeddingModels||[]:i==="openrouter"?f=p.openrouterEmbeddingModels||[]:i==="azure"?f=p.azureEmbeddingModels||[]:f=p.openaiEmbeddingModels||[],u.innerHTML="",f.length>0?(u.add(new Option("-- Select Model --","")),f.forEach(m=>{u.add(new Option(k(m.name||m.id),m.id))}),u.disabled=!1):(u.add(new Option("No models found","")),u.disabled=!0)}function l(i){let d=i.querySelector("#aipkit_bulk_vector_store_provider").value,u=i.querySelector(".aipkit_cw_vector_openai_field"),p=i.querySelector(".aipkit_cw_vector_pinecone_field"),f=i.querySelector(".aipkit_cw_vector_qdrant_field"),m=i.querySelector(".aipkit_cw_vector_embedding_config_row");u&&(u.hidden=!0),p&&(p.hidden=!0),f&&(f.hidden=!0),m&&(m.hidden=!0),d==="openai"?(u&&(u.hidden=!1),t("openai",i)):d==="pinecone"?(p&&(p.hidden=!1),m&&(m.hidden=!1),t("pinecone",i),s("openai",i)):d==="qdrant"&&(f&&(f.hidden=!1),m&&(m.hidden=!1),t("qdrant",i),s("openai",i))}function c(i){let d=i.querySelector('input[name="enable_vector_store"]'),u=i.querySelector(".aipkit_cw_vector_store_settings_container"),p=i.querySelector("#aipkit_bulk_vector_store_provider"),f=i.querySelector("#aipkit_bulk_vector_embedding_provider"),m=i.querySelector("#aipkit_bulk_vector_store_top_k"),g=i.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!d||!u||!p)){if(d.addEventListener("change",()=>{u.hidden=!d.checked}),p.addEventListener("change",()=>l(i)),f&&f.addEventListener("change",_=>s(_.target.value,i)),m&&g){let _=()=>{g.textContent=m.value};m.addEventListener("input",_),_()}u.hidden=!d.checked,l(i)}}function o(i){let d=i.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");d.length&&d.forEach(u=>{let p=u.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!p)return;let f=()=>{u.classList.toggle("is-disabled",!p.checked)};f(),p.addEventListener("change",f),u.dataset.promptToggleAttached!=="true"&&(u.addEventListener("click",m=>{m.target.closest(".aipkit_prompt_edit_btn")||m.target.closest("a")||p.disabled||(m.target.closest(".aipkit_switch")&&m.preventDefault(),p.checked=!p.checked,p.dispatchEvent(new Event("change",{bubbles:!0})))}),u.dataset.promptToggleAttached="true")})}function e(i,d){if(!i)return;let u=i.querySelector("#aipkit-enhancer-bulk-config"),p=i.querySelector("#aipkit-enhancer-bulk-progress"),f=i.querySelector("#aipkit_bulk_enhancer_start_btn"),m=i.querySelector("#aipkit_bulk_enhancer_stop_btn"),g=i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(u&&(u.hidden=!1),p&&(p.hidden=!0),f){f.disabled=!1;let y=f.querySelector(".aipkit_btn-text");y&&(y.textContent="Start")}m&&(m.hidden=!0),g&&(g.hidden=!0);let _=i.querySelectorAll(".aipkit_enhancer_advanced_details");_.length&&_.forEach(y=>{if(y.dataset.toggleListenerAttached==="true")return;let S=y.querySelector("summary");S&&(S.addEventListener("click",C=>{C.preventDefault(),y.hasAttribute("open")?y.removeAttribute("open"):y.setAttribute("open","")}),y.dataset.toggleListenerAttached="true")});let w=i.querySelector(".aipkit_enhancer_settings_popover");w&&w.dataset.checkboxDelegateAttached!=="true"&&(w.addEventListener("click",y=>{let S=y.target?.closest?.(".aipkit_switch");if(S&&w.contains(S)){let M=S.querySelector('input[type="checkbox"]');if(!M||M.disabled)return;y.preventDefault(),M.checked=!M.checked,M.dispatchEvent(new Event("change",{bubbles:!0}));return}let C=y.target.closest(".aipkit_checkbox-label");if(!C||!w.contains(C))return;let A=C.querySelector('input[type="checkbox"]');!A||A.disabled||y.target!==A&&(y.preventDefault(),A.checked=!A.checked,A.dispatchEvent(new Event("change",{bubbles:!0})))}),w.dataset.checkboxDelegateAttached="true");function h(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),i&&(i.classList.remove("aipkit-active"),i.addEventListener("transitionend",()=>i.remove(),{once:!0}),setTimeout(()=>i?.remove(),500))}i.querySelector(".aipkit-modal-close-btn").addEventListener("click",h);let E=i.querySelector("#aipkit_bulk_ai_provider"),x=i.querySelector("#aipkit_bulk_ai_model"),v=i.querySelector("#aipkit_bulk_ai_temperature"),I=i.querySelector("#aipkit_bulk_ai_temperature_value"),P=i.querySelector("#aipkit_bulk_content_max_tokens"),b=i.querySelector("#aipkit_bulk_content_max_tokens_value");if(E&&x&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(E.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(E,x)),window.aipkit_enhancer_populateBulkModels(E,x)),x&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&x.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(i)),v&&I&&v.addEventListener("input",()=>I.textContent=v.value),P&&b){let y=()=>{let S=n(P.value);b.textContent=`${S.words} words`};P.addEventListener("input",y),y()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(i),o(i),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(i),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(i),i.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(d)}),i.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),c(i)}window.aipkit_enhancer_attachBulkModalListeners=e})();(function(){"use strict"})();(function(){"use strict";function k(r,n,t){let s=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithError(r.message||s.error_loading_title,s):n?window.aipkit_updateModalWithSuggestions(n,s):window.aipkit_updateModalWithError(s.error_loading_title||"Unknown error occurred.",s)}window.aipkit_handleTitleSuggestionsResult=k})();(function(){"use strict";function k(r,n,t){let s=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorExcerpt(r.message||s.error_loading_excerpt,s):n?window.aipkit_updateModalWithExcerptSuggestions(n,s):window.aipkit_updateModalWithErrorExcerpt(s.error_loading_excerpt||"Unknown error occurred.",s)}window.aipkit_handleExcerptSuggestionsResult=k})();(function(){"use strict";function k(r,n,t){let s=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorMeta(r.message||s.error_loading_meta,s):n?window.aipkit_updateModalWithMetaSuggestions(n,s):window.aipkit_updateModalWithErrorMeta(s.error_loading_meta||"Unknown error occurred.",s)}window.aipkit_handleMetaSuggestionsResult=k})();(function(){"use strict";function k(){}function r(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=r})();(function(){"use strict";function k(n){let t=n.target.closest(".aipkit_enhancer_item"),a=n.target.closest("#aipkit_bulk_enhance_btn");if(t){if(t.classList.contains("aipkit_enhancer_placeholder")){n.target.tagName==="A"&&n.preventDefault();return}n.preventDefault();let s=t.getAttribute("data-post-id"),l=t.getAttribute("data-action-type");if(!s||!l)return;let c=window.aipkit_post_enhancer||{},o=c.text||{};switch(l){case"title":window.aipkit_showLoadingModal(s,o,c),window.aipkit_fetchTitleSuggestions(s,window.aipkit_handleTitleSuggestionsResult,t);break;case"excerpt":window.aipkit_showLoadingExcerptModal(s,o,c),window.aipkit_fetchExcerptSuggestions(s,window.aipkit_handleExcerptSuggestionsResult,t);break;case"meta":window.aipkit_showLoadingMetaModal(s,o,c),window.aipkit_fetchMetaSuggestions(s,window.aipkit_handleMetaSuggestionsResult,t);break;case"tags":window.aipkit_showLoadingTagsModal(s,o,c),window.aipkit_fetchTagsSuggestions(s,window.aipkit_handleTagsSuggestionsResult,t);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${l}'.`);break}}else if(a){n.preventDefault();let s=document.querySelectorAll('input[name="post[]"]:checked');if(s.length===0){alert("Please select at least one post.");return}let l=Array.from(s).map(o=>o.value),c=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(l,c):alert("Error: Bulk processing feature is not available.")}}function r(){let n=document;if(!n)return;let t="data-post-enhancer-listener";document.body.getAttribute(t)||(n.addEventListener("click",k),document.body.setAttribute(t,"true"))}window.aipkit_initEnhancerEventListeners=r})();(function(){"use strict";function k(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(n=>typeof window[n]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let t=new WeakMap;function a(e){l(e),e.classList.add("aipkit-open")}function s(e){l(e);let i=setTimeout(()=>{e.classList.remove("aipkit-open")},180);t.set(e,i)}function l(e){let i=t.get(e);i&&(clearTimeout(i),t.delete(e))}function c(e){if(!e||e.dataset.aipkitHoverBound==="1")return;e.dataset.aipkitHoverBound="1",e.addEventListener("mouseenter",()=>a(e)),e.addEventListener("mouseleave",()=>s(e));let i=e.querySelector(".aipkit_enhancer_popover");i&&(i.addEventListener("mouseenter",()=>a(e)),i.addEventListener("mouseleave",()=>s(e)))}function o(){document.querySelectorAll(".aipkit_enhancer_action").forEach(c),new MutationObserver(d=>{for(let u of d)u.addedNodes&&u.addedNodes.length&&u.addedNodes.forEach(p=>{p.nodeType===1&&(p.matches&&p.matches(".aipkit_enhancer_action")&&c(p),p.querySelectorAll&&p.querySelectorAll(".aipkit_enhancer_action").forEach(c))})}).observe(document.body,{childList:!0,subtree:!0})}o()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initPostEnhancer=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t};function r(){n()}function n(){let t=document.getElementById("aipkit_vpp_embedding_model_select");if(!t){console.error("VPP Embedding Util: Embedding model select not found.");return}let a=window.aipkit_vpp_config||{},s=a.text||{};t.innerHTML=`<option value="">${k(s.select_model||"-- Select Model --")}</option>`;let l=[{key:"openai",label:"OpenAI",models:a.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:a.googleEmbeddingModels||[]},{key:"openrouter",label:"OpenRouter",models:a.openrouterEmbeddingModels||[]},{key:"azure",label:"Azure",models:a.azureEmbeddingModels||[]}],c=!1;l.forEach(o=>{if(!o.models||o.models.length===0)return;c=!0;let e=document.createElement("optgroup");e.label=o.label,o.models.forEach(i=>{if(i&&i.id){let d=document.createElement("option");d.value=i.id,d.textContent=k(i.name||i.id),d.dataset.provider=o.key,e.appendChild(d)}}),e.children.length&&t.appendChild(e)}),c?(t.disabled=!1,t.options.length>1&&(t.selectedIndex=1)):(t.appendChild(new Option(k(s.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),t.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=r,window.aipkit_vpp_populateEmbeddingModelSelect=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t};function r(){let t=document.getElementById("aipkit_vpp_openai_vector_store_id"),a=document.getElementById("aipkit_vpp_openai_store_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.openai_vector_stores||[];if(!t){console.error("VPP OpenAI Provider: Store select not found.");return}t.innerHTML="",a&&(a.textContent=""),c.length>0?(t.appendChild(new Option(`-- ${k(l.select_store||"Select Existing Store")} --`,"")),c.forEach(o=>{let e="(Files: N/A)";o.file_counts&&typeof o.file_counts.total=="number"?e=`(${o.file_counts.total} ${o.file_counts.total===1?"File":"Files"})`:o.file_counts&&(e="(Files: ?)");let i=`${k(o.name||o.id)} ${e}`,d=new Option(i,o.id);t.appendChild(d)})):t.appendChild(new Option(k(l.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),t.disabled=c.length===0}async function n(t,a,s,l){let c=window.aipkit_vpp_config||{},o=c.text||{},e=t.length,i=0,d=0,u=0,p=[];try{let f=c.nonce_index_posts;if(!f)throw new Error("Nonce for indexing posts is missing in config.");for(let g of t){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}i++;let _=document.querySelector(`#post-${g}`),w=_?_.querySelector(".title .row-title"):null,h=w?w.textContent.trim():`Post #${g}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(g,"processing","",h),typeof window.aipkit_vpp_updateProgress=="function"){let x=i/e*100,v=(o.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",i).replace("%2$d",e)+` "${k(h)}"`;window.aipkit_vpp_updateProgress(x,v)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let E={_ajax_nonce:f,post_ids:[g],post_type:l,target_store_id:a,new_store_name_openai:s||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",E),d++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(g,"success","",h)}catch(x){if(u++,p.push({id:g,title:h,error:x.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${g}:`,x),typeof window.aipkit_vpp_updateProgressItem=="function"){let v=x?.message||o.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(g,"error",v,h)}}}let m=`Indexing complete. ${d} successful, ${u} failed.`;window.aipkit_isIndexingStopped&&i<e?m=`Indexing stopped. ${d} successful, ${u} failed.`:u>0&&console.error("Failed Posts:",p),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,u>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${d}/${e}`)}catch(f){console.error("VPP OpenAI Provider: Indexing setup error:",f),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,o.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(f.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),u>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=r,window.aipkit_vpp_startIndexingOpenAI=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t};function r(){let t=document.getElementById("aipkit_vpp_pinecone_target_index_select"),a=document.getElementById("aipkit_vpp_pinecone_index_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.pinecone_indexes||[];if(!t){console.error("VPP Pinecone Provider: Index select not found.");return}t.innerHTML="",a&&(a.textContent=""),c.length>0?(t.appendChild(new Option(`-- ${k(l.select_pinecone_index||"Select Pinecone Index")} --`,"")),c.forEach(o=>{let e=o.name||o.id;if(e){let i=`${k(e)} (${o.dimension||"?"})`;t.appendChild(new Option(i,e))}})):t.appendChild(new Option(k(l.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),t.disabled=c.length===0}async function n(t,a,s,l,c){let o=window.aipkit_vpp_config||{},e=o.text||{},i=t.length,d=0,u=0,p=0,f=[];try{let m=o.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let _ of t){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let w=document.querySelector(`#post-${_}`),h=w?w.querySelector(".title .row-title"):null,E=h?h.textContent.trim():`Post #${_}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"processing","",E),typeof window.aipkit_vpp_updateProgress=="function"){let v=d/i*100,I=(e.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",i)+` "${k(E)}"`;window.aipkit_vpp_updateProgress(v,I)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let x={_ajax_nonce:m,post_ids:[_],post_type:c,target_index_id:a,provider:"pinecone",embedding_provider:s,embedding_model:l};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",x),u++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"success","",E)}catch(v){if(p++,f.push({id:_,title:E,error:v.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${_}:`,v),typeof window.aipkit_vpp_updateProgressItem=="function"){let I=v?.message||e.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(_,"error",I,E)}}}let g=`Indexing complete. ${u} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&d<i?g=`Indexing stopped. ${u} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${u}/${i}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,e.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=r,window.aipkit_vpp_startIndexingPinecone=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t};function r(){let t=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),a=document.getElementById("aipkit_vpp_qdrant_collection_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.qdrant_collections||[];if(!t){console.error("VPP Qdrant Provider: Collection select not found.");return}t.innerHTML="",a&&(a.textContent=""),c.length>0?(t.appendChild(new Option(`-- ${k(l.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),c.forEach(o=>{let e=o.name||o.id;e&&t.appendChild(new Option(k(e),e))})):t.appendChild(new Option(k(l.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),t.disabled=c.length===0}async function n(t,a,s,l,c){let o=window.aipkit_vpp_config||{},e=o.text||{},i=t.length,d=0,u=0,p=0,f=[];try{let m=o.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let _ of t){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let w=document.querySelector(`#post-${_}`),h=w?w.querySelector(".title .row-title"):null,E=h?h.textContent.trim():`Post #${_}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"processing","",E),typeof window.aipkit_vpp_updateProgress=="function"){let v=d/i*100,I=(e.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",i)+` "${k(E)}"`;window.aipkit_vpp_updateProgress(v,I)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let x={_ajax_nonce:m,post_ids:[_],post_type:c,target_collection_name:a,provider:"qdrant",embedding_provider:s,embedding_model:l};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",x),u++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"success","",E)}catch(v){if(p++,f.push({id:_,title:E,error:v.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${_}:`,v),typeof window.aipkit_vpp_updateProgressItem=="function"){let I=v?.message||e.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(_,"error",I,E)}}}let g=`Indexing complete. ${u} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&d<i?g=`Indexing stopped. ${u} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${u}/${i}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,e.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=r,window.aipkit_vpp_startIndexingQdrant=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(b){return b},r="#aipkit_vpp_modal",n=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),t=null,a=null,s=!1,l=new Set(["aipkit_vpp_vector_store_provider"]),c=b=>!!(b&&b.id&&l.has(b.id)),o=b=>String(b||"").trim().toLowerCase(),e=(b,y)=>{if(!b)return;let S="aipkit_settings_select_picker_icon--";b.classList.forEach(A=>{A.startsWith(S)&&b.classList.remove(A)}),b.classList.remove("is-hidden");let C=o(y);if(!C){b.classList.add("is-hidden");return}b.classList.add(`${S}${C}`)},i=b=>{if(!b)return"";let y=b.getAttribute("data-aipkit-picker-title");if(y)return y;let S=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return S?S.textContent.trim():""},d=b=>{if(!b)return"";let y=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(y)return y.textContent.trim();let S=b.querySelector("option");return S?S.textContent.trim():""},u=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),p=(b,y)=>{if(!b||!b.id||!y)return null;let S=u(b.id),C=y.querySelector(`#${S.buttonId}`);if(!C){if(C=document.createElement("button"),C.type="button",C.id=S.buttonId,C.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",C.setAttribute("data-aipkit-popover-target",S.popoverId),C.setAttribute("aria-controls",S.popoverId),C.setAttribute("aria-expanded","false"),C.dataset.aipkitPopoverPlacement="bottom",c(b)){C.classList.add("aipkit_settings_select_picker_btn--provider");let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),e(W,b.value),C.appendChild(W)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_label",M.id=S.labelId,M.textContent=d(b)||k("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),C.appendChild(M),C.appendChild($),b.insertAdjacentElement("beforebegin",C)}C.disabled=b.disabled,b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let A=y.querySelector(`#${S.popoverId}`);if(!A){A=document.createElement("div"),A.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(b)&&A.classList.add("aipkit_settings_select_picker_popover--provider"),A.id=S.popoverId,A.setAttribute("aria-hidden","true");let M=document.createElement("div");M.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",M.setAttribute("role","dialog"),M.setAttribute("aria-labelledby",S.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let W=document.createElement("span");W.className="aipkit_model_settings_popover_title",W.id=S.titleId,W.textContent=i(b)||k("Select","gpt3-ai-content-generator");let H=document.createElement("button");H.type="button",H.className="aipkit_model_settings_popover_close",H.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),H.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(W),$.appendChild(H);let N=document.createElement("div");N.className="aipkit_model_settings_popover_body";let G=document.createElement("div");G.className="aipkit_settings_select_picker_search";let Q=document.createElement("input");Q.type="search",Q.id=S.searchId,Q.className="aipkit_form-input";let F=i(b),L=F?`Search ${F.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");Q.setAttribute("placeholder",L),G.appendChild(Q);let O=document.createElement("div");O.className="aipkit_settings_select_picker_list",O.id=S.listId,O.setAttribute("role","listbox"),N.appendChild(G),N.appendChild(O),M.appendChild($),M.appendChild(N),A.appendChild(M),y.appendChild(A),(c(b)||b.dataset.aipkitPickerSearch==="false")&&(G.style.display="none")}return{ids:S,button:C,popover:A,label:y.querySelector(`#${S.labelId}`),search:y.querySelector(`#${S.searchId}`),list:y.querySelector(`#${S.listId}`)}},f=b=>{let y=[];return b&&Array.from(b.children).forEach(C=>{if(C.tagName==="OPTGROUP"){let A=Array.from(C.children).filter(M=>M.tagName==="OPTION").map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected}));y.push({groupLabel:C.label||"",options:A})}else C.tagName==="OPTION"&&y.push({groupLabel:"",options:[{value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}]})}),y},m=(b,y,S="")=>{if(!b||!y)return;let C=S.trim().toLowerCase();y.innerHTML="";let A=f(b),M=!1;if(A.forEach($=>{let W=$.options.filter(H=>C?H.label.toLowerCase().includes(C):!0);if(W.length){if($.groupLabel){let H=document.createElement("div");H.className="aipkit_settings_select_picker_group_label",H.textContent=$.groupLabel,y.appendChild(H)}W.forEach(H=>{let N=document.createElement("button");if(N.type="button",N.className="aipkit_settings_select_picker_item",N.setAttribute("role","option"),N.dataset.value=H.value,N.dataset.label=H.label,H.disabled&&(N.classList.add("is-disabled"),N.setAttribute("aria-disabled","true")),b.value===H.value?(N.classList.add("is-active"),N.setAttribute("aria-selected","true")):N.setAttribute("aria-selected","false"),c(b)){N.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),e(F,H.value),N.appendChild(F)}let G=document.createElement("span");G.className="aipkit_settings_select_picker_text",G.textContent=H.label;let Q=document.createElement("span");Q.className="dashicons dashicons-yes aipkit_settings_select_picker_check",N.appendChild(G),N.appendChild(Q),y.appendChild(N),M=!0})}}),!M){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=k(C?"No matches found.":"No options available.","gpt3-ai-content-generator"),y.appendChild($)}},g=(b,y,S)=>{if(!b||!y)return;let C=d(b);if(y.textContent=C||k("Select","gpt3-ai-content-generator"),S&&(S.disabled=b.disabled),c(b)){let A=S?S.querySelector(".aipkit_settings_select_picker_icon"):null;e(A,b.value)}},_=(b,y)=>{if(!b||!y)return;let S=b.getBoundingClientRect(),C=y.getBoundingClientRect(),A=C.width||320,M=C.height||0,$=window.innerWidth,W=window.innerHeight,H=12,N=S.left;N+A>$-H&&(N=S.right-A),N=Math.max(H,Math.min(N,$-A-H));let G=S.bottom+8;G+M>W-H&&(G=S.top-M-8),G=Math.max(H,Math.min(G,W-M-H)),y.style.left=`${Math.round(N)}px`,y.style.top=`${Math.round(G)}px`},w=()=>{!t||!a||s||(s=!0,window.requestAnimationFrame(()=>{let b=t.querySelector(".aipkit_model_settings_popover_panel");_(a,b),s=!1}))},h=()=>{t&&(t.classList.remove("aipkit-active"),t.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),t=null,a=null)},E=(b,y,S)=>{if(!b||!y)return;t&&t!==y&&h(),t=y,a=b,y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let C=y.querySelector(".aipkit_settings_select_picker_search input"),A=y.querySelector(".aipkit_settings_select_picker_list");A&&m(S,A,C?C.value:""),C&&C.offsetParent!==null&&(C.focus(),C.select());let M=y.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(b,M)})},x=(b,y)=>{if(!b||!y)return;let{button:S,popover:C,list:A,search:M,label:$}=y;if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",W=>{if(W.preventDefault(),!S.disabled){if(t===C){h();return}E(S,C,b)}}),S.dataset.pickerListenerAttached="true"),C&&C.dataset.overlayListenerAttached!=="true"){C.addEventListener("click",H=>{H.target===C&&h()});let W=C.querySelector(".aipkit_model_settings_popover_close");W&&W.addEventListener("click",H=>{H.preventDefault(),h()}),C.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",W=>{let H=W.target.closest(".aipkit_settings_select_picker_item");if(!H||H.classList.contains("is-disabled"))return;let N=H.dataset.value??"";b.value=N,b.dispatchEvent(new Event("change",{bubbles:!0})),g(b,$,S),m(b,A,M?M.value:""),h()}),A.dataset.pickerListenerAttached="true"),M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("input",()=>{m(b,A,M.value)}),M.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{g(b,$,S),m(b,A,M?M.value:""),t===C&&h()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let W=!1;new MutationObserver(()=>{W||(W=!0,window.requestAnimationFrame(()=>{g(b,$,S),m(b,A,M?M.value:""),W=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",W=>{W.key==="Escape"&&t&&h()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function v(b){if(!b||b.dataset.aipkitVppPickerInit==="true")return;let y=b.querySelectorAll(n);y.length&&(y.forEach(S=>{if(!S.id||S.dataset.aipkitPickerInit==="true")return;let C=p(S,b);C&&(g(S,C.label,C.button),m(S,C.list,C.search?C.search.value:""),x(S,C),S.dataset.aipkitPickerInit="true")}),b.dataset.aipkitVppPickerInit="true")}function I(){document.querySelectorAll(r).forEach(v)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I(),new MutationObserver(I).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=v})();(function(){"use strict";let k="aipkit_vpp_modal",r=window.aipkit_escapeHtml||function(h){return h},n=window.aipkit_escapeAttribute||r,t=[],a="",s=!1,l=h=>{if(!h)return"Post";let E=window.aipkit_vpp_postTitles||{};if(E[h])return E[h];let x=document.querySelector(`#post-${h}`),v=x?x.querySelector(".title .row-title")||x.querySelector("strong a")||x.querySelector(".title a")||x.querySelector("a.row-title")||x.querySelector(".column-title strong a")||x.querySelector(".column-title .row-title"):null,I=v?v.textContent.trim():`Post #${h}`;return E[h]=I,window.aipkit_vpp_postTitles=E,I},c=h=>{let E=window.aipkit_vpp_config?.text||{};return{pending:E.status_pending||"Pending",processing:E.status_processing||"Processing",success:E.status_completed||"Completed",error:E.status_failed||"Failed",stopped:E.status_stopped||"Stopped"}[h]||h},o=(h,E)=>{let x=document.createElement("div");x.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",x.dataset.postId=h;let v=document.createElement("div");v.className="aipkit_vpp_progress_item_main";let I=document.createElement("div");I.className="aipkit_vpp_progress_item_title",I.textContent=E;let P=document.createElement("div");P.className="aipkit_vpp_progress_item_message",P.textContent="",P.style.display="none";let b=document.createElement("div");return b.className="aipkit_vpp_progress_item_status",b.textContent=c("pending"),v.appendChild(I),v.appendChild(P),x.appendChild(v),x.appendChild(b),x};function e(h,E){if(document.getElementById(k)){console.warn("VPP Modal UI: Modal already exists.");return}t=h,a=E,s=!1;let v=(window.aipkit_vpp_config||{}).text||{},I="",P=h.length;P===1?I=r(v.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${P}</strong>`):I=r(v.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${P}</strong>`);let b=document.createElement("div");b.id=k,b.className="aipkit-modal-overlay aipkit-active";let y=document.createElement("div");y.className="aipkit-modal-content aipkit_vpp_modal_content",y.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${r(v.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${r(v.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${n(v.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${I}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${r(v.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${r(v.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${r(v.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${r(v.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${r(v.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${r(v.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${r(v.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${r(v.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${r(v.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${r(v.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${r(v.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${r(v.stop||"Stop")}</span>
                </button>
            </div>
        `,b.appendChild(y),document.body.appendChild(b),y.addEventListener("click",C=>{let A=C.target;A.closest(".aipkit-modal-close-btn")||A.closest(".aipkit_vpp_modal_close_btn")?d():A.closest("#aipkit_vpp_start_indexing_btn")?w():A.closest("#aipkit_vpp_stop_indexing_btn")&&i()}),b.addEventListener("click",C=>{C.target===b&&d()});let S=document.getElementById("aipkit_vpp_vector_store_provider");S&&(S.addEventListener("change",_),_({target:S}))}function i(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById("aipkit_vpp_stop_indexing_btn"),E=window.aipkit_vpp_config?.text||{};if(h){h.disabled=!0;let x=h.querySelector(".aipkit_btn-text");x&&(x.textContent=E.stopping||"Stopping...")}}function d(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById(k);h&&(h.classList.remove("aipkit-active"),setTimeout(()=>{h.parentNode&&h.parentNode.removeChild(h)},300))}function u(h,E){let x=document.querySelector(`#${k} .aipkit_vpp_progress_bar`),v=document.getElementById("aipkit_vpp_progress_text");x&&(x.style.width=`${Math.max(0,Math.min(100,h))}%`),v&&(v.textContent=E)}function p(h){let E=document.getElementById("aipkit_vpp_progress_log");if(!E)return;E.innerHTML="";let x=document.createDocumentFragment();(h||[]).forEach(v=>{let I=l(v);x.appendChild(o(v,I))}),E.appendChild(x),E.scrollTop=0}function f(h,E,x="",v=""){let I=document.getElementById("aipkit_vpp_progress_log");if(!I)return;let P=`.aipkit_vpp_progress_item[data-post-id="${h}"]`,b=I.querySelector(P);if(!b){let C=v||l(h);b=o(h,C),I.appendChild(b)}b.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${E}`;let y=b.querySelector(".aipkit_vpp_progress_item_status"),S=b.querySelector(".aipkit_vpp_progress_item_message");y&&(y.textContent=c(E)),S&&(S.textContent=x||"",S.style.display=x?"":"none"),I.scrollTop=I.scrollHeight}function m(h,E="info"){let x=document.getElementById("aipkit_vpp_status_message");x&&(x.textContent=h,x.className=`aipkit_vpp_status_message aipkit_message-${E}`)}function g(){s=!1;let h=document.getElementById("aipkit_vpp_start_indexing_btn"),E=document.getElementById("aipkit_vpp_stop_indexing_btn"),x=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`),v=window.aipkit_vpp_config?.text||{};if(h){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(h,v.start_indexing||"Start Indexing"),h.disabled=!1,h.hidden=!1;let P=h.querySelector(".aipkit_spinner");P&&(P.hidden=!0)}if(E){E.hidden=!0,E.disabled=!1;let P=E.querySelector(".aipkit_btn-text");P&&(P.textContent=v.stop||"Stop")}x.forEach(P=>P.disabled=!1);let I=document.getElementById("aipkit_vpp_progress_area");I&&(I.hidden=!1)}function _(h){let E=h.target.value,x=document.getElementById("aipkit_vpp_openai_options"),v=document.getElementById("aipkit_vpp_pinecone_options"),I=document.getElementById("aipkit_vpp_qdrant_options"),P=document.getElementById("aipkit_vpp_embedding_options");x&&(x.hidden=!0),v&&(v.hidden=!0),I&&(I.hidden=!0),P&&(P.hidden=!0),E==="openai"?(x&&(x.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):E==="pinecone"?(v&&(v.hidden=!1),P&&(P.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):E==="qdrant"&&(I&&(I.hidden=!1),P&&(P.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function w(){if(s)return;window.aipkit_isIndexingStopped=!1;let h=document.getElementById("aipkit_vpp_vector_store_provider").value,E=window.aipkit_vpp_config?.text||{},x="",v={post_ids:t,post_type:a,provider:h};if(h==="openai"){if(x=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!x){m(E.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}v.target_store_id=x}else if(h==="pinecone"){if(x=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!x){m(E.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}v.target_index_id=x;let S=document.getElementById("aipkit_vpp_embedding_model_select"),C=S?.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:null;if(v.embedding_model=S?S.value:"",v.embedding_provider=C&&C.dataset.provider||"",!v.embedding_provider||!v.embedding_model){m(E.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(h==="qdrant"){if(x=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!x){m(E.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}v.target_collection_name=x;let S=document.getElementById("aipkit_vpp_embedding_model_select"),C=S?.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:null;if(v.embedding_model=S?S.value:"",v.embedding_provider=C&&C.dataset.provider||"",!v.embedding_provider||!v.embedding_model){m(E.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{m(`Provider ${h} not yet supported for indexing.`,"error");return}s=!0;let I=document.getElementById("aipkit_vpp_start_indexing_btn"),P=document.getElementById("aipkit_vpp_stop_indexing_btn"),b=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`);if(I&&(I.hidden=!0),P){P.hidden=!1,P.disabled=!1;let S=P.querySelector(".aipkit_btn-text");S&&(S.textContent=E.stop||"Stop")}let y=document.getElementById("aipkit_vpp_progress_area");y&&(y.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(t),u(0,E.status_preparing||"Preparing..."),h==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(t,x,null,a):h==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(t,x,v.embedding_provider,v.embedding_model,a):h==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(t,x,v.embedding_provider,v.embedding_model,a)}window.aipkit_vpp_showModal=e,window.aipkit_vpp_closeModal=d,window.aipkit_vpp_updateProgress=u,window.aipkit_vpp_initProgressLog=p,window.aipkit_vpp_updateProgressItem=f,window.aipkit_vpp_updateStatus=m,window.aipkit_vpp_resetModalAfterProcessing=g})();(function(){"use strict";let k="aipkit_add_to_vector_store_btn";function n(){let s=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(s.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let l=Array.from(s).map(c=>c.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(l,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function t(){let s=document.getElementById(k);return s&&!s.dataset.vppBound?(s.addEventListener("click",n),s.dataset.vppBound="1",!0):!!(s&&s.dataset.vppBound)}function a(){if(t())return;let s=document.querySelector("#wpbody-content")||document.body,l=Date.now();if(!s)return;let c=new MutationObserver(()=>{(t()||Date.now()-l>15e3)&&c.disconnect()});c.observe(s,{childList:!0,subtree:!0});let o=setInterval(()=>{(t()||Date.now()-l>15e3)&&clearInterval(o)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",a):a()})();})();
